(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,44642,e=>{"use strict";let i,s,r,n,o,a,l,h,c,d,u,_,f,g,p,m,v,b,S,w,y,C,x,E,k,A;var R,L,T,B,M,I,D,N,O,P,F,W,z,U,$,V,H,K,G,Y,X,Z,j,q,Q,J,ee,et,ei,es,er,en,eo,ea,el,eh,ec,ed,eu,e_,ef,eg,ep,em,ev,eb,eS=e.i(43476),ew=e.i(71645),ey=e.i(47167),eC=Object.defineProperty,ex=Object.getOwnPropertyDescriptor,eE=(e,i,s,r)=>{for(var n,o=r>1?void 0:r?ex(i,s):i,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r?n(i,s,o):n(o))||o);return r&&o&&eC(i,s,o),o},ek=(e,i)=>(s,r)=>i(s,r,e),eA="Terminal input",eR="Too much output to announce, navigate to rows manually to read";function eL(e,i,s,r){var n;n=e=e.replace(/\r?\n/g,"\r"),e=s.decPrivateModes.bracketedPasteMode&&!0!==r.rawOptions.ignoreBracketedPasteMode?"\x1b[200~"+n+"\x1b[201~":n,s.triggerDataEvent(e,!0),i.value=""}function eT(e,i,s){let r=s.getBoundingClientRect(),n=e.clientX-r.left-10,o=e.clientY-r.top-10;i.style.width="20px",i.style.height="20px",i.style.left=`${n}px`,i.style.top=`${o}px`,i.style.zIndex="1000",i.focus()}function eB(e,i,s,r,n){eT(e,i,s),n&&r.rightClickSelect(e),i.value=r.selectionText,i.select()}function eM(e){return e>65535?String.fromCharCode(((e-=65536)>>10)+55296)+String.fromCharCode(e%1024+56320):String.fromCharCode(e)}function eI(e,i=0,s=e.length){let r="";for(let n=i;n<s;++n){let i=e[n];i>65535?(i-=65536,r+=String.fromCharCode((i>>10)+55296)+String.fromCharCode(i%1024+56320)):r+=String.fromCharCode(i)}return r}var eD=class{constructor(){this._interim=0}clear(){this._interim=0}decode(e,i){let s=e.length;if(!s)return 0;let r=0,n=0;if(this._interim){let s=e.charCodeAt(n++);56320<=s&&s<=57343?i[r++]=(this._interim-55296)*1024+s-56320+65536:(i[r++]=this._interim,i[r++]=s),this._interim=0}for(let o=n;o<s;++o){let n=e.charCodeAt(o);if(55296<=n&&n<=56319){if(++o>=s)return this._interim=n,r;let a=e.charCodeAt(o);56320<=a&&a<=57343?i[r++]=(n-55296)*1024+a-56320+65536:(i[r++]=n,i[r++]=a);continue}65279!==n&&(i[r++]=n)}return r}},eN=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(e,i){let s=e.length;if(!s)return 0;let r=0,n,o,a,l,h=0,c=0;if(this.interim[0]){let n=!1,o=this.interim[0];o&=(224&o)==192?31:(240&o)==224?15:7;let a=0,l;for(;(l=63&this.interim[++a])&&a<4;)o<<=6,o|=l;let h=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,d=h-a;for(;c<d;){if(c>=s)return 0;if((192&(l=e[c++]))!=128){c--,n=!0;break}this.interim[a++]=l,o<<=6,o|=63&l}n||(2===h?o<128?c--:i[r++]=o:3===h?o<2048||o>=55296&&o<=57343||65279===o||(i[r++]=o):o<65536||o>1114111||(i[r++]=o)),this.interim.fill(0)}let d=s-4,u=c;for(;u<s;){for(;u<d&&!(128&(n=e[u]))&&!(128&(o=e[u+1]))&&!(128&(a=e[u+2]))&&!(128&(l=e[u+3]));)i[r++]=n,i[r++]=o,i[r++]=a,i[r++]=l,u+=4;if((n=e[u++])<128)i[r++]=n;else if((224&n)==192){if(u>=s)return this.interim[0]=n,r;if((192&(o=e[u++]))!=128||(h=(31&n)<<6|63&o)<128){u--;continue}i[r++]=h}else if((240&n)==224){if(u>=s)return this.interim[0]=n,r;if((192&(o=e[u++]))!=128){u--;continue}if(u>=s)return this.interim[0]=n,this.interim[1]=o,r;if((192&(a=e[u++]))!=128){u--;continue}if((h=(15&n)<<12|(63&o)<<6|63&a)<2048||h>=55296&&h<=57343||65279===h)continue;i[r++]=h}else if((248&n)==240){if(u>=s)return this.interim[0]=n,r;if((192&(o=e[u++]))!=128){u--;continue}if(u>=s)return this.interim[0]=n,this.interim[1]=o,r;if((192&(a=e[u++]))!=128){u--;continue}if(u>=s)return this.interim[0]=n,this.interim[1]=o,this.interim[2]=a,r;if((192&(l=e[u++]))!=128){u--;continue}if((h=(7&n)<<18|(63&o)<<12|(63&a)<<6|63&l)<65536||h>1114111)continue;i[r++]=h}}return r}},eO=class e{constructor(){this.fg=0,this.bg=0,this.extended=new eP}static toColorRGB(e){return[e>>>16&255,e>>>8&255,255&e]}static fromColorRGB(e){return(255&e[0])<<16|(255&e[1])<<8|255&e[2]}clone(){let i=new e;return i.fg=this.fg,i.bg=this.bg,i.extended=this.extended.clone(),i}isInverse(){return 0x4000000&this.fg}isBold(){return 0x8000000&this.fg}isUnderline(){return this.hasExtendedAttrs()&&0!==this.extended.underlineStyle?1:0x10000000&this.fg}isBlink(){return 0x20000000&this.fg}isInvisible(){return 0x40000000&this.fg}isItalic(){return 0x4000000&this.bg}isDim(){return 0x8000000&this.bg}isStrikethrough(){return 0x80000000&this.fg}isProtected(){return 0x20000000&this.bg}isOverline(){return 0x40000000&this.bg}getFgColorMode(){return 0x3000000&this.fg}getBgColorMode(){return 0x3000000&this.bg}isFgRGB(){return(0x3000000&this.fg)==0x3000000}isBgRGB(){return(0x3000000&this.bg)==0x3000000}isFgPalette(){return(0x3000000&this.fg)==0x1000000||(0x3000000&this.fg)==0x2000000}isBgPalette(){return(0x3000000&this.bg)==0x1000000||(0x3000000&this.bg)==0x2000000}isFgDefault(){return(0x3000000&this.fg)==0}isBgDefault(){return(0x3000000&this.bg)==0}isAttributeDefault(){return 0===this.fg&&0===this.bg}getFgColor(){switch(0x3000000&this.fg){case 0x1000000:case 0x2000000:return 255&this.fg;case 0x3000000:return 0xffffff&this.fg;default:return -1}}getBgColor(){switch(0x3000000&this.bg){case 0x1000000:case 0x2000000:return 255&this.bg;case 0x3000000:return 0xffffff&this.bg;default:return -1}}hasExtendedAttrs(){return 0x10000000&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-0x10000001:this.bg|=0x10000000}getUnderlineColor(){if(0x10000000&this.bg&&~this.extended.underlineColor)switch(0x3000000&this.extended.underlineColor){case 0x1000000:case 0x2000000:return 255&this.extended.underlineColor;case 0x3000000:return 0xffffff&this.extended.underlineColor}return this.getFgColor()}getUnderlineColorMode(){return 0x10000000&this.bg&&~this.extended.underlineColor?0x3000000&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 0x10000000&this.bg&&~this.extended.underlineColor?(0x3000000&this.extended.underlineColor)==0x3000000:this.isFgRGB()}isUnderlineColorPalette(){return 0x10000000&this.bg&&~this.extended.underlineColor?(0x3000000&this.extended.underlineColor)==0x1000000||(0x3000000&this.extended.underlineColor)==0x2000000:this.isFgPalette()}isUnderlineColorDefault(){return 0x10000000&this.bg&&~this.extended.underlineColor?(0x3000000&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 0x10000000&this.fg?0x10000000&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},eP=class e{constructor(e=0,i=0){this._ext=0,this._urlId=0,this._ext=e,this._urlId=i}get ext(){return this._urlId?-0x1c000001&this._ext|this.underlineStyle<<26:this._ext}set ext(e){this._ext=e}get underlineStyle(){return this._urlId?5:(0x1c000000&this._ext)>>26}set underlineStyle(e){this._ext&=-0x1c000001,this._ext|=e<<26&0x1c000000}get underlineColor(){return 0x3ffffff&this._ext}set underlineColor(e){this._ext&=-0x4000000,this._ext|=0x3ffffff&e}get urlId(){return this._urlId}set urlId(e){this._urlId=e}get underlineVariantOffset(){let e=(0xe0000000&this._ext)>>29;return e<0?0xfffffff8^e:e}set underlineVariantOffset(e){this._ext&=0x1fffffff,this._ext|=e<<29&0xe0000000}clone(){return new e(this._ext,this._urlId)}isEmpty(){return 0===this.underlineStyle&&0===this._urlId}},eF=class e extends eO{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new eP,this.combinedData=""}static fromCharData(i){let s=new e;return s.setFromCharData(i),s}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?eM(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(e){this.fg=e[0],this.bg=0;let i=!1;if(e[1].length>2)i=!0;else if(2===e[1].length){let s=e[1].charCodeAt(0);if(55296<=s&&s<=56319){let r=e[1].charCodeAt(1);56320<=r&&r<=57343?this.content=(s-55296)*1024+r-56320+65536|e[2]<<22:i=!0}else i=!0}else this.content=e[1].charCodeAt(0)|e[2]<<22;i&&(this.combinedData=e[1],this.content=2097152|e[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},eW="di$target",ez="di$dependencies",eU=new Map;function e$(e){if(eU.has(e))return eU.get(e);let i=function(e,s,r){var n,o,a;if(3!=arguments.length)throw Error("@IServiceName-decorator can only be used to decorate a parameter");n=i,o=e,a=r,o[eW]===o?o[ez].push({id:n,index:a}):(o[ez]=[{id:n,index:a}],o[eW]=o)};return i._id=e,eU.set(e,i),i}var eV=e$("BufferService"),eH=e$("CoreMouseService"),eK=e$("CoreService"),eG=e$("CharsetService"),eY=e$("InstantiationService"),eX=e$("LogService"),eZ=e$("OptionsService"),ej=e$("OscLinkService"),eq=e$("UnicodeService"),eQ=e$("DecorationService"),eJ=class{constructor(e,i,s){this._bufferService=e,this._optionsService=i,this._oscLinkService=s}provideLinks(e,i){let s=this._bufferService.buffer.lines.get(e-1);if(!s)return void i(void 0);let r=[],n=this._optionsService.rawOptions.linkHandler,o=new eF,a=s.getTrimmedLength(),l=-1,h=-1,c=!1;for(let i=0;i<a;i++)if(!(-1===h&&!s.hasContent(i))){if(s.loadCell(i,o),o.hasExtendedAttrs()&&o.extended.urlId)if(-1===h){h=i,l=o.extended.urlId;continue}else c=o.extended.urlId!==l;else -1!==h&&(c=!0);if(c||-1!==h&&i===a-1){let s=this._oscLinkService.getLinkData(l)?.uri;if(s){let o={start:{x:h+1,y:e},end:{x:i+ +(!c&&i===a-1),y:e}},l=!1;if(!n?.allowNonHttpProtocols)try{let e=new URL(s);["http:","https:"].includes(e.protocol)||(l=!0)}catch{l=!0}l||r.push({text:s,range:o,activate:(e,i)=>n?n.activate(e,i,o):function(e,i){if(confirm(`Do you want to navigate to ${i}?

WARNING: This link could potentially be dangerous`)){let e=window.open();if(e){try{e.opener=null}catch{}e.location.href=i}else console.warn("Opening link blocked as opener could not be cleared")}}(0,i),hover:(e,i)=>n?.hover?.(e,i,o),leave:(e,i)=>n?.leave?.(e,i,o)})}c=!1,o.hasExtendedAttrs()&&o.extended.urlId?(h=i,l=o.extended.urlId):(h=-1,l=-1)}}i(r)}};eJ=eE([ek(0,eV),ek(1,eZ),ek(2,ej)],eJ);var e0=e$("CharSizeService"),e1=e$("CoreBrowserService"),e2=e$("MouseService"),e5=e$("RenderService"),e3=e$("SelectionService"),e6=e$("CharacterJoinerService"),e4=e$("ThemeService"),e9=e$("LinkProviderService"),e8=new class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?ti.isErrorNoTelemetry(e)?new ti(e.message+`

`+e.stack):Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(i=>{i(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}};function e7(e){var i;(i=e)instanceof tt||i instanceof Error&&i.name===te&&i.message===te||e8.onUnexpectedError(e)}var te="Canceled",tt=class extends Error{constructor(){super(te),this.name=this.message}},ti=class e extends Error{constructor(e){super(e),this.name="CodeExpectedError"}static fromError(i){if(i instanceof e)return i;let s=new e;return s.message=i.message,s.stack=i.stack,s}static isErrorNoTelemetry(e){return"CodeExpectedError"===e.name}},ts=class e extends Error{constructor(i){super(i||"An unexpected bug occurred."),Object.setPrototypeOf(this,e.prototype)}};function tr(e,i=0){return e[e.length-(1+i)]}(tw=ty||={}).isLessThan=function(e){return e<0},tw.isLessThanOrEqual=function(e){return e<=0},tw.isGreaterThan=function(e){return e>0},tw.isNeitherLessOrGreaterThan=function(e){return 0===e},tw.greaterThan=1,tw.lessThan=-1,tw.neitherLessOrGreaterThan=0;var tn=class e{constructor(e){this.iterate=e}forEach(e){this.iterate(i=>(e(i),!0))}toArray(){let e=[];return this.iterate(i=>(e.push(i),!0)),e}filter(i){return new e(e=>this.iterate(s=>!i(s)||e(s)))}map(i){return new e(e=>this.iterate(s=>e(i(s))))}some(e){let i=!1;return this.iterate(s=>!(i=e(s))),i}findFirst(e){let i;return this.iterate(s=>!e(s)||(i=s,!1)),i}findLast(e){let i;return this.iterate(s=>(e(s)&&(i=s),!0)),i}findLastMaxBy(e){let i,s=!0;return this.iterate(r=>((s||ty.isGreaterThan(e(r,i)))&&(s=!1,i=r),!0)),i}};tn.empty=new tn(e=>{});function to(e){}function ta(e,i){}function tl(e){if(tC.is(e)){let i=[];for(let s of e)if(s)try{s.dispose()}catch(e){i.push(e)}if(1===i.length)throw i[0];if(i.length>1)throw AggregateError(i,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}if(e)return e.dispose(),e}function th(e){let i={dispose:function(e,i){let s=this,r=!1,n;return function(){if(r)return n;if(r=!0,i)try{n=e.apply(s,arguments)}finally{i()}else n=e.apply(s,arguments);return n}}(()=>{to(i),e()})};return i}(e=>{function i(e){return e&&"object"==typeof e&&"function"==typeof e[Symbol.iterator]}e.is=i;let s=Object.freeze([]);function*r(e){yield e}e.empty=function(){return s},e.single=r,e.wrap=function(e){return i(e)?e:r(e)},e.from=function(e){return e||s},e.reverse=function*(e){for(let i=e.length-1;i>=0;i--)yield e[i]},e.isEmpty=function(e){return!e||!0===e[Symbol.iterator]().next().done},e.first=function(e){return e[Symbol.iterator]().next().value},e.some=function(e,i){let s=0;for(let r of e)if(i(r,s++))return!0;return!1},e.find=function(e,i){for(let s of e)if(i(s))return s},e.filter=function*(e,i){for(let s of e)i(s)&&(yield s)},e.map=function*(e,i){let s=0;for(let r of e)yield i(r,s++)},e.flatMap=function*(e,i){let s=0;for(let r of e)yield*i(r,s++)},e.concat=function*(...e){for(let i of e)yield*i},e.reduce=function(e,i,s){let r=s;for(let s of e)r=i(r,s);return r},e.slice=function*(e,i,s=e.length){for(i<0&&(i+=e.length),s<0?s+=e.length:s>e.length&&(s=e.length);i<s;i++)yield e[i]},e.consume=function(i,s=1/0){let r=[];if(0===s)return[r,i];let n=i[Symbol.iterator]();for(let i=0;i<s;i++){let i=n.next();if(i.done)return[r,e.empty()];r.push(i.value)}return[r,{[Symbol.iterator]:()=>n}]},e.asyncToArray=async function(e){let i=[];for await(let s of e)i.push(s);return Promise.resolve(i)}})(tC||={});var tc=class e{constructor(){var e;this._toDispose=new Set,this._isDisposed=!1,e=this}dispose(){this._isDisposed||(to(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(0!==this._toDispose.size)try{tl(this._toDispose)}finally{this._toDispose.clear()}}add(i){if(!i)return i;if(i===this)throw Error("Cannot register a disposable on itself!");return ta(i,this),this._isDisposed?e.DISABLE_DISPOSED_WARNING||console.warn(Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(i),i}delete(e){if(e){if(e===this)throw Error("Cannot dispose a disposable on itself!");this._toDispose.delete(e),e.dispose()}}deleteAndLeak(e){e&&this._toDispose.has(e)&&(this._toDispose.delete(e),ta(e,null))}};tc.DISABLE_DISPOSED_WARNING=!1;var td=tc,tu=class{constructor(){var e;this._store=new td,e=this,ta(this._store,this)}dispose(){to(this),this._store.dispose()}_register(e){if(e===this)throw Error("Cannot register a disposable on itself!");return this._store.add(e)}};tu.None=Object.freeze({dispose(){}});var t_=class{constructor(){var e;this._isDisposed=!1,e=this}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),e&&ta(e,this),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,to(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e&&ta(e,null),e}},tf="object"==typeof window?window:globalThis,tg=class e{constructor(i){this.element=i,this.next=e.Undefined,this.prev=e.Undefined}};tg.Undefined=new tg(void 0);var tp=class{constructor(){this._first=tg.Undefined,this._last=tg.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===tg.Undefined}clear(){let e=this._first;for(;e!==tg.Undefined;){let i=e.next;e.prev=tg.Undefined,e.next=tg.Undefined,e=i}this._first=tg.Undefined,this._last=tg.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,i){let s=new tg(e);if(this._first===tg.Undefined)this._first=s,this._last=s;else if(i){let e=this._last;this._last=s,s.prev=e,e.next=s}else{let e=this._first;this._first=s,s.next=e,e.prev=s}this._size+=1;let r=!1;return()=>{r||(r=!0,this._remove(s))}}shift(){if(this._first!==tg.Undefined){let e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==tg.Undefined){let e=this._last.element;return this._remove(this._last),e}}_remove(e){if(e.prev!==tg.Undefined&&e.next!==tg.Undefined){let i=e.prev;i.next=e.next,e.next.prev=i}else e.prev===tg.Undefined&&e.next===tg.Undefined?(this._first=tg.Undefined,this._last=tg.Undefined):e.next===tg.Undefined?(this._last=this._last.prev,this._last.next=tg.Undefined):e.prev===tg.Undefined&&(this._first=this._first.next,this._first.prev=tg.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==tg.Undefined;)yield e.element,e=e.next}},tm=globalThis.performance&&"function"==typeof globalThis.performance.now,tv=class e{static create(i){return new e(i)}constructor(e){this._now=tm&&!1===e?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return -1!==this._stopTime?this._stopTime-this._startTime:this._now()-this._startTime}};(e=>{function i(e){}function s(e){return(i,s=null,r)=>{let n=!1,o;return o=e(e=>{if(!n)return o?o.dispose():n=!0,i.call(s,e)},null,r),n&&o.dispose(),o}}function r(e,i,s){return o((s,r=null,n)=>e(e=>s.call(r,i(e)),null,n),s)}function n(e,i,s){return o((s,r=null,n)=>e(e=>i(e)&&s.call(r,e),null,n),s)}function o(e,s){let r,n={onWillAddFirstListener(){r=e(o.fire,o)},onDidRemoveLastListener(){r?.dispose()}};s||i(n);let o=new tB(n);return s?.add(o),o.event}function a(e,s,r=100,n=!1,o=!1,l,h){let c,d,u,_=0,f,g={leakWarningThreshold:l,onWillAddFirstListener(){c=e(e=>{_++,d=s(d,e),n&&!u&&(p.fire(d),d=void 0),f=()=>{let e=d;d=void 0,u=void 0,(!n||_>1)&&p.fire(e),_=0},"number"==typeof r?(clearTimeout(u),u=setTimeout(f,r)):void 0===u&&(u=0,queueMicrotask(f))})},onWillRemoveListener(){o&&_>0&&f?.()},onDidRemoveLastListener(){f=void 0,c.dispose()}};h||i(g);let p=new tB(g);return h?.add(p),p.event}e.None=()=>tu.None,e.defer=function(e,i){return a(e,()=>{},0,void 0,!0,void 0,i)},e.once=s,e.map=r,e.forEach=function(e,i,s){return o((s,r=null,n)=>e(e=>{i(e),s.call(r,e)},null,n),s)},e.filter=n,e.signal=function(e){return e},e.any=function(...e){return(i,s=null,r)=>{var n,o;return n=function(...e){var i,s;let r=th(()=>tl(e));return i=0,s=0,r}(...e.map(e=>e(e=>i.call(s,e)))),(o=r)instanceof Array?o.push(n):o&&o.add(n),n}},e.reduce=function(e,i,s,n){let o=s;return r(e,e=>o=i(o,e),n)},e.debounce=a,e.accumulate=function(i,s=0,r){return e.debounce(i,(e,i)=>e?(e.push(i),e):[i],s,void 0,!0,void 0,r)},e.latch=function(e,i=(e,i)=>e===i,s){let r=!0,o;return n(e,e=>{let s=r||!i(e,o);return r=!1,o=e,s},s)},e.split=function(i,s,r){return[e.filter(i,s,r),e.filter(i,e=>!s(e),r)]},e.buffer=function(e,i=!1,s=[],r){let n=s.slice(),o=e(e=>{n?n.push(e):l.fire(e)});r&&r.add(o);let a=()=>{n?.forEach(e=>l.fire(e)),n=null},l=new tB({onWillAddFirstListener(){o||(o=e(e=>l.fire(e)),r&&r.add(o))},onDidAddFirstListener(){n&&(i?setTimeout(a):a())},onDidRemoveLastListener(){o&&o.dispose(),o=null}});return r&&r.add(l),l.event},e.chain=function(e,i){return(s,r,n)=>{let o=i(new h);return e(function(e){let i=o.evaluate(e);i!==l&&s.call(r,i)},void 0,n)}};let l=Symbol("HaltChainable");class h{constructor(){this.steps=[]}map(e){return this.steps.push(e),this}forEach(e){return this.steps.push(i=>(e(i),i)),this}filter(e){return this.steps.push(i=>e(i)?i:l),this}reduce(e,i){let s=i;return this.steps.push(i=>s=e(s,i)),this}latch(e=(e,i)=>e===i){let i=!0,s;return this.steps.push(r=>{let n=i||!e(r,s);return i=!1,s=r,n?r:l}),this}evaluate(e){for(let i of this.steps)if((e=i(e))===l)break;return e}}e.fromNodeEventEmitter=function(e,i,s=e=>e){let r=(...e)=>n.fire(s(...e)),n=new tB({onWillAddFirstListener:()=>e.on(i,r),onDidRemoveLastListener:()=>e.removeListener(i,r)});return n.event},e.fromDOMEventEmitter=function(e,i,s=e=>e){let r=(...e)=>n.fire(s(...e)),n=new tB({onWillAddFirstListener:()=>e.addEventListener(i,r),onDidRemoveLastListener:()=>e.removeEventListener(i,r)});return n.event},e.toPromise=function(e){return new Promise(i=>s(e)(i))},e.fromPromise=function(e){let i=new tB;return e.then(e=>{i.fire(e)},()=>{i.fire(void 0)}).finally(()=>{i.dispose()}),i.event},e.forward=function(e,i){return e(e=>i.fire(e))},e.runAndSubscribe=function(e,i,s){return i(s),e(e=>i(e))};class c{constructor(e,s){this._observable=e,this._counter=0,this._hasChanged=!1;let r={onWillAddFirstListener:()=>{e.addObserver(this)},onDidRemoveLastListener:()=>{e.removeObserver(this)}};s||i(r),this.emitter=new tB(r),s&&s.add(this.emitter)}beginUpdate(e){this._counter++}handlePossibleChange(e){}handleChange(e,i){this._hasChanged=!0}endUpdate(e){this._counter--,0===this._counter&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}e.fromObservable=function(e,i){return new c(e,i).emitter.event},e.fromObservableLight=function(e){return(i,s,r)=>{let n=0,o=!1,a={beginUpdate(){n++},endUpdate(){0==--n&&(e.reportChanges(),o&&(o=!1,i.call(s)))},handlePossibleChange(){},handleChange(){o=!0}};e.addObserver(a),e.reportChanges();let l={dispose(){e.removeObserver(a)}};return r instanceof td?r.add(l):Array.isArray(r)&&r.push(l),l}}})(tx||={});var tb=class e{constructor(i){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${i}_${e._idPool++}`,e.all.add(this)}start(e){this._stopWatch=new tv,this.listenerCount=e}stop(){if(this._stopWatch){let e=this._stopWatch.elapsed();this.durations.push(e),this.elapsedOverall+=e,this.invocationCount+=1,this._stopWatch=void 0}}};tb.all=new Set,tb._idPool=0;var tS=class e{constructor(i,s,r=(e._idPool++).toString(16).padStart(3,"0")){this._errorHandler=i,this.threshold=s,this.name=r,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(e,i){let s=this.threshold;if(s<=0||i<s)return;this._stacks||(this._stacks=new Map);let r=this._stacks.get(e.value)||0;if(this._stacks.set(e.value,r+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=.5*s;let[e,r]=this.getMostFrequentStack(),n=`[${this.name}] potential listener LEAK detected, having ${i} listeners already. MOST frequent listener (${r}):`;console.warn(n),console.warn(e);let o=new tA(n,e);this._errorHandler(o)}return()=>{let i=this._stacks.get(e.value)||0;this._stacks.set(e.value,i-1)}}getMostFrequentStack(){if(!this._stacks)return;let e,i=0;for(let[s,r]of this._stacks)(!e||i<r)&&(e=[s,r],i=r);return e}};tS._idPool=1;var tw,ty,tC,tx,tE,tk=class e{constructor(e){this.value=e}static create(){return new e(Error().stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},tA=class extends Error{constructor(e,i){super(e),this.name="ListenerLeakError",this.stack=i}},tR=class extends Error{constructor(e,i){super(e),this.name="ListenerRefusalError",this.stack=i}},tL=0,tT=class{constructor(e){this.value=e,this.id=tL++}},tB=class{constructor(e){this._size=0,this._options=e,this._leakageMon=this._options?.leakWarningThreshold?new tS(e?.onListenerError??e7,this._options?.leakWarningThreshold??-1):void 0,this._perfMon=this._options?._profName?new tb(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){this._disposed||(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners&&(this._listeners=void 0,this._size=0),this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose())}get event(){return this._event??=(e,i,s)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let e=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(e);let i=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],s=new tR(`${e}. HINT: Stack shows most frequent listener (${i[1]}-times)`,i[0]);return(this._options?.onListenerError||e7)(s),tu.None}if(this._disposed)return tu.None;i&&(e=e.bind(i));let r=new tT(e),n;this._leakageMon&&this._size>=Math.ceil(.2*this._leakageMon.threshold)&&(r.stack=tk.create(),n=this._leakageMon.check(r.stack,this._size+1)),this._listeners?this._listeners instanceof tT?(this._deliveryQueue??=new tM,this._listeners=[this._listeners,r]):this._listeners.push(r):(this._options?.onWillAddFirstListener?.(this),this._listeners=r,this._options?.onDidAddFirstListener?.(this)),this._size++;let o=th(()=>{tE?.unregister(o),n?.(),this._removeListener(r)});if(s instanceof td?s.add(o):Array.isArray(s)&&s.push(o),tE){let e=Error().stack.split(`
`).slice(2,3).join(`
`).trim(),i=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(e);tE.register(o,i?.[2]??e,o)}return o},this._event}_removeListener(e){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(1===this._size){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let i=this._listeners,s=i.indexOf(e);if(-1===s)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),Error("Attempted to dispose unknown listener");this._size--,i[s]=void 0;let r=this._deliveryQueue.current===this;if(2*this._size<=i.length){let e=0;for(let s=0;s<i.length;s++)i[s]?i[e++]=i[s]:r&&(this._deliveryQueue.end--,e<this._deliveryQueue.i&&this._deliveryQueue.i--);i.length=e}}_deliver(e,i){if(!e)return;let s=this._options?.onListenerError||e7;try{e.value(i)}catch(e){s(e)}}_deliverQueue(e){let i=e.current._listeners;for(;e.i<e.end;)this._deliver(i[e.i++],e.value);e.reset()}fire(e){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof tT)this._deliver(this._listeners,e);else{let i=this._deliveryQueue;i.enqueue(this,e,this._listeners.length),this._deliverQueue(i)}this._perfMon?.stop()}hasListeners(){return this._size>0}},tM=class{constructor(){this.i=-1,this.end=0}enqueue(e,i,s){this.i=0,this.end=s,this.current=e,this.value=i}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},tI=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new tB,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new tB,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(e){return this.mapWindowIdToZoomLevel.get(this.getWindowId(e))??0}setZoomLevel(e,i){if(this.getZoomLevel(i)===e)return;let s=this.getWindowId(i);this.mapWindowIdToZoomLevel.set(s,e),this._onDidChangeZoomLevel.fire(s)}getZoomFactor(e){return this.mapWindowIdToZoomFactor.get(this.getWindowId(e))??1}setZoomFactor(e,i){this.mapWindowIdToZoomFactor.set(this.getWindowId(i),e)}setFullscreen(e,i){if(this.isFullscreen(i)===e)return;let s=this.getWindowId(i);this.mapWindowIdToFullScreen.set(s,e),this._onDidChangeFullscreen.fire(s)}isFullscreen(e){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(e))}getWindowId(e){return e.vscodeWindowId}};tI.INSTANCE=new tI,tI.INSTANCE.onDidChangeZoomLevel,tI.INSTANCE.onDidChangeFullscreen;var tD="object"==typeof navigator?navigator.userAgent:"",tN=tD.indexOf("Firefox")>=0,tO=tD.indexOf("AppleWebKit")>=0,tP=tD.indexOf("Chrome")>=0,tF=!tP&&tD.indexOf("Safari")>=0;tD.indexOf("Electron/"),tD.indexOf("Android");var tW=!1;if("function"==typeof tf.matchMedia){let e=tf.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),i=tf.matchMedia("(display-mode: fullscreen)");tW=e.matches,tz=e,"string"==typeof tz&&(tz=tf.matchMedia(tz)),tz.addEventListener("change",({matches:e})=>{tW&&i.matches||(tW=e)})}var tz,tU,t$,tV=!1,tH=!1,tK=!1,tG=!1,tY=!1,tX="en",tZ=globalThis;"u">typeof tZ.vscode&&"u">typeof tZ.vscode.process?t$=tZ.vscode.process:"u">typeof ey.default&&"string"==typeof ey.default?.versions?.node&&(t$=ey.default);var tj="string"==typeof t$?.versions?.electron&&t$?.type==="renderer";if("object"==typeof t$){tV="win32"===t$.platform,tH="darwin"===t$.platform,(tK="linux"===t$.platform)&&t$.env.SNAP&&t$.env.SNAP_REVISION,t$.env.CI||t$.env.BUILD_ARTIFACTSTAGINGDIRECTORY,tX="en";let e=t$.env.VSCODE_NLS_CONFIG;if(e)try{let i=JSON.parse(e);i.userLocale,i.osLocale,tX=i.resolvedLanguage||"en",i.languagePack?.translationsConfigFile}catch{}tG=!0}else"object"!=typeof navigator||tj?console.error("Unable to resolve platform."):(tV=(tU=navigator.userAgent).indexOf("Windows")>=0,tH=tU.indexOf("Macintosh")>=0,(tU.indexOf("Macintosh")>=0||tU.indexOf("iPad")>=0||tU.indexOf("iPhone")>=0)&&navigator.maxTouchPoints&&navigator.maxTouchPoints,tK=tU.indexOf("Linux")>=0,tU?.indexOf("Mobi"),tY=!0,tX=globalThis._VSCODE_NLS_LANGUAGE||"en",navigator.language.toLowerCase());var tq=tV,tQ=tH,tJ=tK,t0=tG;tY&&"function"==typeof tZ.importScripts&&tZ.origin;var t1,t2=tU,t5=tX;(is=t1||={}).value=function(){return t5},is.isDefaultVariant=function(){return 2===t5.length?"en"===t5:t5.length>=3&&"e"===t5[0]&&"n"===t5[1]&&"-"===t5[2]},is.isDefault=function(){return"en"===t5};var t3="function"==typeof tZ.postMessage&&!tZ.importScripts,t6=(()=>{if(t3){let e=[];tZ.addEventListener("message",i=>{if(i.data&&i.data.vscodeScheduleAsyncWork)for(let s=0,r=e.length;s<r;s++){let r=e[s];if(r.id===i.data.vscodeScheduleAsyncWork){e.splice(s,1),r.callback();return}}});let i=0;return s=>{let r=++i;e.push({id:r,callback:s}),tZ.postMessage({vscodeScheduleAsyncWork:r},"*")}}return e=>setTimeout(e)})(),t4=!!(t2&&t2.indexOf("Chrome")>=0);t2&&t2.indexOf("Firefox"),!t4&&t2&&t2.indexOf("Safari"),t2&&t2.indexOf("Edg/"),t2&&t2.indexOf("Android");var t9="object"==typeof navigator?navigator:{};t0||document.queryCommandSupported&&document.queryCommandSupported("copy")||t9&&t9.clipboard&&t9.clipboard.writeText,t0||t9&&t9.clipboard&&t9.clipboard.readText,t0||tW||t9.keyboard,"ontouchstart"in tf||t9.maxTouchPoints,tf.PointerEvent&&("ontouchstart"in tf||navigator.maxTouchPoints);var t8=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(e,i){this._keyCodeToStr[e]=i,this._strToKeyCode[i.toLowerCase()]=e}keyCodeToStr(e){return this._keyCodeToStr[e]}strToKeyCode(e){return this._strToKeyCode[e.toLowerCase()]||0}},t7=new t8,ie=new t8,it=new t8,ii=Array(230);(ir=io||={}).toString=function(e){return t7.keyCodeToStr(e)},ir.fromString=function(e){return t7.strToKeyCode(e)},ir.toUserSettingsUS=function(e){return ie.keyCodeToStr(e)},ir.toUserSettingsGeneral=function(e){return it.keyCodeToStr(e)},ir.fromUserSettings=function(e){return ie.strToKeyCode(e)||it.strToKeyCode(e)},ir.toElectronAccelerator=function(e){if(e>=98&&e<=113)return null;switch(e){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return t7.keyCodeToStr(e)};var is,ir,io,ia,il=class e{constructor(e,i,s,r,n){this.ctrlKey=e,this.shiftKey=i,this.altKey=s,this.metaKey=r,this.keyCode=n}equals(i){return i instanceof e&&this.ctrlKey===i.ctrlKey&&this.shiftKey===i.shiftKey&&this.altKey===i.altKey&&this.metaKey===i.metaKey&&this.keyCode===i.keyCode}getHashCode(){let e=this.ctrlKey?"1":"0",i=this.shiftKey?"1":"0",s=this.altKey?"1":"0",r=this.metaKey?"1":"0";return`K${e}${i}${s}${r}${this.keyCode}`}isModifierKey(){return 0===this.keyCode||5===this.keyCode||57===this.keyCode||6===this.keyCode||4===this.keyCode}toKeybinding(){return new ih([this])}isDuplicateModifierCase(){return this.ctrlKey&&5===this.keyCode||this.shiftKey&&4===this.keyCode||this.altKey&&6===this.keyCode||this.metaKey&&57===this.keyCode}},ih=class{constructor(e){if(0===e.length)throw function(e){return e?Error(`Illegal argument: ${e}`):Error("Illegal argument")}("chords");this.chords=e}getHashCode(){let e="";for(let i=0,s=this.chords.length;i<s;i++)0!==i&&(e+=";"),e+=this.chords[i].getHashCode();return e}equals(e){if(null===e||this.chords.length!==e.chords.length)return!1;for(let i=0;i<this.chords.length;i++)if(!this.chords[i].equals(e.chords[i]))return!1;return!0}},ic=tQ?256:2048,id=tQ?2048:256,iu=class{constructor(e){this._standardKeyboardEventBrand=!0,this.browserEvent=e,this.target=e.target,this.ctrlKey=e.ctrlKey,this.shiftKey=e.shiftKey,this.altKey=e.altKey,this.metaKey=e.metaKey,this.altGraphKey=e.getModifierState?.("AltGraph"),this.keyCode=function(e){if(e.charCode){let i=String.fromCharCode(e.charCode).toUpperCase();return io.fromString(i)}let i=e.keyCode;if(3===i)return 7;if(tN)switch(i){case 59:return 85;case 60:if(tJ)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(tQ)return 57}else if(tO&&(tQ&&93===i||!tQ&&92===i))return 57;return ii[i]||0}(e),this.code=e.code,this.ctrlKey=this.ctrlKey||5===this.keyCode,this.altKey=this.altKey||6===this.keyCode,this.shiftKey=this.shiftKey||4===this.keyCode,this.metaKey=this.metaKey||57===this.keyCode,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals(e){return this._asKeybinding===e}_computeKeybinding(){let e=0;5!==this.keyCode&&4!==this.keyCode&&6!==this.keyCode&&57!==this.keyCode&&(e=this.keyCode);let i=0;return this.ctrlKey&&(i|=ic),this.altKey&&(i|=512),this.shiftKey&&(i|=1024),this.metaKey&&(i|=id),i|=e}_computeKeyCodeChord(){let e=0;return 5!==this.keyCode&&4!==this.keyCode&&6!==this.keyCode&&57!==this.keyCode&&(e=this.keyCode),new il(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,e)}},i_=new WeakMap,ig=class{static getSameOriginWindowChain(e){let i=i_.get(e);if(!i){i=[],i_.set(e,i);let s=e,r;do(r=function(e){if(!e.parent||e.parent===e)return null;try{let i=e.location,s=e.parent.location;if("null"!==i.origin&&"null"!==s.origin&&i.origin!==s.origin)return null}catch{return null}return e.parent}(s))?i.push({window:new WeakRef(s),iframeElement:s.frameElement||null}):i.push({window:new WeakRef(s),iframeElement:null}),s=r;while(s)}return i.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow(e,i){if(!i||e===i)return{top:0,left:0};let s=0,r=0;for(let n of this.getSameOriginWindowChain(e)){let e=n.window.deref();if(s+=e?.scrollY??0,r+=e?.scrollX??0,e===i||!n.iframeElement)break;let o=n.iframeElement.getBoundingClientRect();s+=o.top,r+=o.left}return{top:s,left:r}}},ip=class{constructor(e,i){this.timestamp=Date.now(),this.browserEvent=i,this.leftButton=0===i.button,this.middleButton=1===i.button,this.rightButton=2===i.button,this.buttons=i.buttons,this.target=i.target,this.detail=i.detail||1,"dblclick"===i.type&&(this.detail=2),this.ctrlKey=i.ctrlKey,this.shiftKey=i.shiftKey,this.altKey=i.altKey,this.metaKey=i.metaKey,"number"==typeof i.pageX?(this.posx=i.pageX,this.posy=i.pageY):(this.posx=i.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=i.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);let s=ig.getPositionOfChildWindowRelativeToAncestorWindow(e,i.view);this.posx-=s.left,this.posy-=s.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}},im=class{constructor(e,i=0,s=0){this.browserEvent=e||null,this.target=e?e.target||e.targetNode||e.srcElement:null,this.deltaY=s,this.deltaX=i;let r=!1;if(tP){let e=navigator.userAgent.match(/Chrome\/(\d+)/);r=(e?parseInt(e[1]):123)<=122}if(e){let i=e.view?.devicePixelRatio||1;"u">typeof e.wheelDeltaY?r?this.deltaY=e.wheelDeltaY/(120*i):this.deltaY=e.wheelDeltaY/120:"u">typeof e.VERTICAL_AXIS&&e.axis===e.VERTICAL_AXIS?this.deltaY=-e.detail/3:"wheel"===e.type&&(e.deltaMode===e.DOM_DELTA_LINE?tN&&!tQ?this.deltaY=-e.deltaY/3:this.deltaY=-e.deltaY:this.deltaY=-e.deltaY/40),"u">typeof e.wheelDeltaX?tF&&tq?this.deltaX=-(e.wheelDeltaX/120):r?this.deltaX=e.wheelDeltaX/(120*i):this.deltaX=e.wheelDeltaX/120:"u">typeof e.HORIZONTAL_AXIS&&e.axis===e.HORIZONTAL_AXIS?this.deltaX=-e.detail/3:"wheel"===e.type&&(e.deltaMode===e.DOM_DELTA_LINE?tN&&!tQ?this.deltaX=-e.deltaX/3:this.deltaX=-e.deltaX:this.deltaX=-e.deltaX/40),0===this.deltaY&&0===this.deltaX&&e.wheelDelta&&(r?this.deltaY=e.wheelDelta/(120*i):this.deltaY=e.wheelDelta/120)}}preventDefault(){this.browserEvent?.preventDefault()}stopPropagation(){this.browserEvent?.stopPropagation()}},iv=Object.freeze(function(e,i){let s=setTimeout(e.bind(i),0);return{dispose(){clearTimeout(s)}}});(sl=ia||={}).isCancellationToken=function(e){return e===sl.None||e===sl.Cancelled||e instanceof ib||!!e&&"object"==typeof e&&"boolean"==typeof e.isCancellationRequested&&"function"==typeof e.onCancellationRequested},sl.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:tx.None}),sl.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:iv});var ib=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?iv:(this._emitter||(this._emitter=new tB),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}};Symbol("MicrotaskDelay");var iS=class{constructor(e,i){this._isDisposed=!1,this._token=-1,"function"==typeof e&&"number"==typeof i&&this.setIfNotSet(e,i)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){-1!==this._token&&(clearTimeout(this._token),this._token=-1)}cancelAndSet(e,i){if(this._isDisposed)throw new ts("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=-1,e()},i)}setIfNotSet(e,i){if(this._isDisposed)throw new ts("Calling 'setIfNotSet' on a disposed TimeoutTimer");-1===this._token&&(this._token=setTimeout(()=>{this._token=-1,e()},i))}},iw=class{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){this.disposable?.dispose(),this.disposable=void 0}cancelAndSet(e,i,s=globalThis){if(this.isDisposed)throw new ts("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();let r=s.setInterval(()=>{e()},i);this.disposable=th(()=>{s.clearInterval(r),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}};(sh=sc||={}).settled=async function(e){let i,s=await Promise.all(e.map(e=>e.then(e=>e,e=>{i||(i=e)})));if("u">typeof i)throw i;return s},sh.withAsyncBody=function(e){return new Promise(async(i,s)=>{try{await e(i,s)}catch(e){s(e)}})};var iy=class e{static fromArray(i){return new e(e=>{e.emitMany(i)})}static fromPromise(i){return new e(async e=>{e.emitMany(await i)})}static fromPromises(i){return new e(async e=>{await Promise.all(i.map(async i=>e.emitOne(await i)))})}static merge(i){return new e(async e=>{await Promise.all(i.map(async i=>{for await(let s of i)e.emitOne(s)}))})}constructor(e,i){this._state=0,this._results=[],this._error=null,this._onReturn=i,this._onStateChanged=new tB,queueMicrotask(async()=>{let i={emitOne:e=>this.emitOne(e),emitMany:e=>this.emitMany(e),reject:e=>this.reject(e)};try{await Promise.resolve(e(i)),this.resolve()}catch(e){this.reject(e)}finally{i.emitOne=void 0,i.emitMany=void 0,i.reject=void 0}})}[Symbol.asyncIterator](){let e=0;return{next:async()=>{for(;;){if(2===this._state)throw this._error;if(e<this._results.length)return{done:!1,value:this._results[e++]};if(1===this._state)return{done:!0,value:void 0};await tx.toPromise(this._onStateChanged.event)}},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(i,s){return new e(async e=>{for await(let r of i)e.emitOne(s(r))})}map(i){return e.map(this,i)}static filter(i,s){return new e(async e=>{for await(let r of i)s(r)&&e.emitOne(r)})}filter(i){return e.filter(this,i)}static coalesce(i){return e.filter(i,e=>!!e)}coalesce(){return e.coalesce(this)}static async toPromise(e){let i=[];for await(let s of e)i.push(s);return i}toPromise(){return e.toPromise(this)}emitOne(e){0===this._state&&(this._results.push(e),this._onStateChanged.fire())}emitMany(e){0===this._state&&(this._results=this._results.concat(e),this._onStateChanged.fire())}resolve(){0===this._state&&(this._state=1,this._onStateChanged.fire())}reject(e){0===this._state&&(this._state=2,this._error=e,this._onStateChanged.fire())}};iy.EMPTY=iy.fromArray([]);function iC(e,i){return(i<<5)-i+e|0}function ix(e,i){i=iC(149417,i);for(let s=0,r=e.length;s<r;s++)i=iC(e.charCodeAt(s),i);return i}new DataView(new ArrayBuffer(320));var{registerWindow:iE,getWindow:ik,getDocument:iA,getWindows:iR,getWindowsCount:iL,getWindowId:iT,getWindowById:iB,hasWindow:iM,onDidRegisterWindow:iI,onWillUnregisterWindow:iD,onDidUnregisterWindow:iN}=(h=new Map,c={window:tf,disposables:new td},h.set(tf.vscodeWindowId,c),d=new tB,u=new tB,_=new tB,{onDidRegisterWindow:d.event,onWillUnregisterWindow:_.event,onDidUnregisterWindow:u.event,registerWindow(e){if(h.has(e.vscodeWindowId))return tu.None;let i=new td,s={window:e,disposables:i.add(new td)};return h.set(e.vscodeWindowId,s),i.add(th(()=>{h.delete(e.vscodeWindowId),u.fire(e)})),i.add(iP(e,i$.BEFORE_UNLOAD,()=>{_.fire(e)})),d.fire(s),i},getWindows:()=>h.values(),getWindowsCount:()=>h.size,getWindowId:e=>e.vscodeWindowId,hasWindow:e=>h.has(e),getWindowById:function(e,i){return("number"==typeof e?h.get(e):void 0)??(i?c:void 0)},getWindow:e=>e?.ownerDocument?.defaultView?e.ownerDocument.defaultView.window:e?.view?e.view.window:tf,getDocument:e=>ik(e).document}),iO=class{constructor(e,i,s,r){this._node=e,this._type=i,this._handler=s,this._options=r||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function iP(e,i,s,r){return new iO(e,i,s,r)}var iF=function(e,i,s,r){var n;let o=s;return"click"===i||"mousedown"===i||"contextmenu"===i?(n=ik(e),o=function(e){return s(new ip(n,e))}):("keydown"===i||"keypress"===i||"keyup"===i)&&(o=function(e){return s(new iu(e))}),iP(e,i,o,r)},iW=class extends iw{constructor(e){super(),this.defaultTarget=e&&ik(e)}cancelAndSet(e,i,s){return super.cancelAndSet(e,i,s??this.defaultTarget)}},iz=class{constructor(e,i=0){this._runner=e,this.priority=i,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(e){e7(e)}}static sort(e,i){return i.priority-e.priority}};f=new Map,g=new Map,p=new Map,m=new Map,sd=(e,i,s=0)=>{let r=iT(e),n=new iz(i,s),o=f.get(r);return o||(o=[],f.set(r,o)),o.push(n),p.get(r)||(p.set(r,!0),e.requestAnimationFrame(()=>(e=>{p.set(e,!1);let i=f.get(e)??[];for(g.set(e,i),f.set(e,[]),m.set(e,!0);i.length>0;)i.sort(iz.sort),i.shift().execute();m.set(e,!1)})(r))),n};var iU=class e{constructor(e,i){this.width=e,this.height=i}with(i=this.width,s=this.height){return i!==this.width||s!==this.height?new e(i,s):this}static is(e){return"object"==typeof e&&"number"==typeof e.height&&"number"==typeof e.width}static lift(i){return i instanceof e?i:new e(i.width,i.height)}static equals(e,i){return e===i||!!e&&!!i&&e.width===i.width&&e.height===i.height}};iU.None=new iU(0,0),new class{constructor(){this.mutationObservers=new Map}observe(e,i,s){let r=this.mutationObservers.get(e);r||(r=new Map,this.mutationObservers.set(e,r));let n=function e(i,s){switch(typeof i){case"object":var r,n,o,a;return null===i?iC(349,s):Array.isArray(i)?(r=i,n=iC(104579,n=s),r.reduce((i,s)=>e(s,i),n)):(o=i,a=iC(181387,a=s),Object.keys(o).sort().reduce((i,s)=>(i=ix(s,i),e(o[s],i)),a));case"string":return ix(i,s);case"boolean":return iC(i?433:863,s);case"number":return iC(i,s);case"undefined":return iC(937,s);default:return iC(617,s)}}(s,0),o=r.get(n);if(o)o.users+=1;else{let a=new tB,l=new MutationObserver(e=>a.fire(e));l.observe(e,s);let h=o={users:1,observer:l,onDidMutate:a.event};i.add(th(()=>{h.users-=1,0===h.users&&(a.dispose(),l.disconnect(),r?.delete(n),r?.size===0&&this.mutationObservers.delete(e))})),r.set(n,o)}return o.onDidMutate}};var i$={CLICK:"click",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",KEY_DOWN:"keydown",KEY_UP:"keyup",BEFORE_UNLOAD:"beforeunload",CHANGE:"change",FOCUS:"focus",BLUR:"blur",INPUT:"input"},iV=class{constructor(e){this.domNode=e,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}setMaxWidth(e){let i=iH(e);this._maxWidth!==i&&(this._maxWidth=i,this.domNode.style.maxWidth=this._maxWidth)}setWidth(e){let i=iH(e);this._width!==i&&(this._width=i,this.domNode.style.width=this._width)}setHeight(e){let i=iH(e);this._height!==i&&(this._height=i,this.domNode.style.height=this._height)}setTop(e){let i=iH(e);this._top!==i&&(this._top=i,this.domNode.style.top=this._top)}setLeft(e){let i=iH(e);this._left!==i&&(this._left=i,this.domNode.style.left=this._left)}setBottom(e){let i=iH(e);this._bottom!==i&&(this._bottom=i,this.domNode.style.bottom=this._bottom)}setRight(e){let i=iH(e);this._right!==i&&(this._right=i,this.domNode.style.right=this._right)}setPaddingTop(e){let i=iH(e);this._paddingTop!==i&&(this._paddingTop=i,this.domNode.style.paddingTop=this._paddingTop)}setPaddingLeft(e){let i=iH(e);this._paddingLeft!==i&&(this._paddingLeft=i,this.domNode.style.paddingLeft=this._paddingLeft)}setPaddingBottom(e){let i=iH(e);this._paddingBottom!==i&&(this._paddingBottom=i,this.domNode.style.paddingBottom=this._paddingBottom)}setPaddingRight(e){let i=iH(e);this._paddingRight!==i&&(this._paddingRight=i,this.domNode.style.paddingRight=this._paddingRight)}setFontFamily(e){this._fontFamily!==e&&(this._fontFamily=e,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.domNode.style.fontWeight=this._fontWeight)}setFontSize(e){let i=iH(e);this._fontSize!==i&&(this._fontSize=i,this.domNode.style.fontSize=this._fontSize)}setFontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings(e){this._fontFeatureSettings!==e&&(this._fontFeatureSettings=e,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings(e){this._fontVariationSettings!==e&&(this._fontVariationSettings=e,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration(e){this._textDecoration!==e&&(this._textDecoration=e,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight(e){let i=iH(e);this._lineHeight!==i&&(this._lineHeight=i,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing(e){let i=iH(e);this._letterSpacing!==i&&(this._letterSpacing=i,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName(e){this._className!==e&&(this._className=e,this.domNode.className=this._className)}toggleClassName(e,i){this.domNode.classList.toggle(e,i),this._className=this.domNode.className}setDisplay(e){this._display!==e&&(this._display=e,this.domNode.style.display=this._display)}setPosition(e){this._position!==e&&(this._position=e,this.domNode.style.position=this._position)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this.domNode.style.visibility=this._visibility)}setColor(e){this._color!==e&&(this._color=e,this.domNode.style.color=this._color)}setBackgroundColor(e){this._backgroundColor!==e&&(this._backgroundColor=e,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting(e){this._layerHint!==e&&(this._layerHint=e,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow(e){this._boxShadow!==e&&(this._boxShadow=e,this.domNode.style.boxShadow=e)}setContain(e){this._contain!==e&&(this._contain=e,this.domNode.style.contain=this._contain)}setAttribute(e,i){this.domNode.setAttribute(e,i)}removeAttribute(e){this.domNode.removeAttribute(e)}appendChild(e){this.domNode.appendChild(e.domNode)}removeChild(e){this.domNode.removeChild(e.domNode)}};function iH(e){return"number"==typeof e?`${e}px`:e}function iK(e){return new iV(e)}var iG=class{constructor(){this._hooks=new td,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring(e,i){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;let s=this._onStopCallback;this._onStopCallback=null,e&&s&&s(i)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring(e,i,s,r,n){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=r,this._onStopCallback=n;let o=e;try{e.setPointerCapture(i),this._hooks.add(th(()=>{try{e.releasePointerCapture(i)}catch{}}))}catch{o=ik(e)}this._hooks.add(iP(o,i$.POINTER_MOVE,e=>{e.buttons!==s?this.stopMonitoring(!0):(e.preventDefault(),this._pointerMoveCallback(e))})),this._hooks.add(iP(o,i$.POINTER_UP,e=>this.stopMonitoring(!0)))}};(v=su||={}).Tap="-xterm-gesturetap",v.Change="-xterm-gesturechange",v.Start="-xterm-gesturestart",v.End="-xterm-gesturesend",v.Contextmenu="-xterm-gesturecontextmenu";var iY=class e extends tu{constructor(){super(),this.dispatched=!1,this.targets=new tp,this.ignoreTargets=new tp,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(tx.runAndSubscribe(iI,({window:e,disposables:i})=>{i.add(iP(e.document,"touchstart",e=>this.onTouchStart(e),{passive:!1})),i.add(iP(e.document,"touchend",i=>this.onTouchEnd(e,i))),i.add(iP(e.document,"touchmove",e=>this.onTouchMove(e),{passive:!1}))},{window:tf,disposables:this._store}))}static addTarget(i){return e.isTouchDevice()?(e.INSTANCE||(e.INSTANCE=new e),th(e.INSTANCE.targets.push(i))):tu.None}static ignoreTarget(i){return e.isTouchDevice()?(e.INSTANCE||(e.INSTANCE=new e),th(e.INSTANCE.ignoreTargets.push(i))):tu.None}static isTouchDevice(){return"ontouchstart"in tf||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(e){let i=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let s=0,r=e.targetTouches.length;s<r;s++){let r=e.targetTouches.item(s);this.activeTouches[r.identifier]={id:r.identifier,initialTarget:r.target,initialTimeStamp:i,initialPageX:r.pageX,initialPageY:r.pageY,rollingTimestamps:[i],rollingPageX:[r.pageX],rollingPageY:[r.pageY]};let n=this.newGestureEvent(su.Start,r.target);n.pageX=r.pageX,n.pageY=r.pageY,this.dispatchEvent(n)}this.dispatched&&(e.preventDefault(),e.stopPropagation(),this.dispatched=!1)}onTouchEnd(i,s){let r=Date.now(),n=Object.keys(this.activeTouches).length;for(let o=0,a=s.changedTouches.length;o<a;o++){let a=s.changedTouches.item(o);if(!this.activeTouches.hasOwnProperty(String(a.identifier))){console.warn("move of an UNKNOWN touch",a);continue}let l=this.activeTouches[a.identifier],h=Date.now()-l.initialTimeStamp;if(h<e.HOLD_DELAY&&30>Math.abs(l.initialPageX-tr(l.rollingPageX))&&30>Math.abs(l.initialPageY-tr(l.rollingPageY))){let e=this.newGestureEvent(su.Tap,l.initialTarget);e.pageX=tr(l.rollingPageX),e.pageY=tr(l.rollingPageY),this.dispatchEvent(e)}else if(h>=e.HOLD_DELAY&&30>Math.abs(l.initialPageX-tr(l.rollingPageX))&&30>Math.abs(l.initialPageY-tr(l.rollingPageY))){let e=this.newGestureEvent(su.Contextmenu,l.initialTarget);e.pageX=tr(l.rollingPageX),e.pageY=tr(l.rollingPageY),this.dispatchEvent(e)}else if(1===n){let e=tr(l.rollingPageX),s=tr(l.rollingPageY),n=tr(l.rollingTimestamps)-l.rollingTimestamps[0],o=e-l.rollingPageX[0],a=s-l.rollingPageY[0],h=[...this.targets].filter(e=>l.initialTarget instanceof Node&&e.contains(l.initialTarget));this.inertia(i,h,r,Math.abs(o)/n,o>0?1:-1,e,Math.abs(a)/n,a>0?1:-1,s)}this.dispatchEvent(this.newGestureEvent(su.End,l.initialTarget)),delete this.activeTouches[a.identifier]}this.dispatched&&(s.preventDefault(),s.stopPropagation(),this.dispatched=!1)}newGestureEvent(e,i){let s=document.createEvent("CustomEvent");return s.initEvent(e,!1,!0),s.initialTarget=i,s.tapCount=0,s}dispatchEvent(i){if(i.type===su.Tap){let s=new Date().getTime(),r=0;r=s-this._lastSetTapCountTime>e.CLEAR_TAP_COUNT_TIME?1:2,this._lastSetTapCountTime=s,i.tapCount=r}else(i.type===su.Change||i.type===su.Contextmenu)&&(this._lastSetTapCountTime=0);if(i.initialTarget instanceof Node){for(let e of this.ignoreTargets)if(e.contains(i.initialTarget))return;let e=[];for(let s of this.targets)if(s.contains(i.initialTarget)){let r=0,n=i.initialTarget;for(;n&&n!==s;)r++,n=n.parentElement;e.push([r,s])}for(let[s,r]of(e.sort((e,i)=>e[0]-i[0]),e))r.dispatchEvent(i),this.dispatched=!0}}inertia(i,s,r,n,o,a,l,h,c){this.handle=sd(i,()=>{let d=Date.now(),u=d-r,_=0,f=0,g=!0;n+=e.SCROLL_FRICTION*u,l+=e.SCROLL_FRICTION*u,n>0&&(g=!1,_=o*n*u),l>0&&(g=!1,f=h*l*u);let p=this.newGestureEvent(su.Change);p.translationX=_,p.translationY=f,s.forEach(e=>e.dispatchEvent(p)),g||this.inertia(i,s,d,n,o,a+_,l,h,c+f)})}onTouchMove(e){let i=Date.now();for(let s=0,r=e.changedTouches.length;s<r;s++){let r=e.changedTouches.item(s);if(!this.activeTouches.hasOwnProperty(String(r.identifier))){console.warn("end of an UNKNOWN touch",r);continue}let n=this.activeTouches[r.identifier],o=this.newGestureEvent(su.Change,n.initialTarget);o.translationX=r.pageX-tr(n.rollingPageX),o.translationY=r.pageY-tr(n.rollingPageY),o.pageX=r.pageX,o.pageY=r.pageY,this.dispatchEvent(o),n.rollingPageX.length>3&&(n.rollingPageX.shift(),n.rollingPageY.shift(),n.rollingTimestamps.shift()),n.rollingPageX.push(r.pageX),n.rollingPageY.push(r.pageY),n.rollingTimestamps.push(i)}this.dispatched&&(e.preventDefault(),e.stopPropagation(),this.dispatched=!1)}};iY.SCROLL_FRICTION=-.005,iY.HOLD_DELAY=700,iY.CLEAR_TAP_COUNT_TIME=400,eE([function(e,i,s){let r=null,n=null;if("function"==typeof s.value?(r="value",0!==(n=s.value).length&&console.warn("Memoize should only be used in functions with zero parameters")):"function"==typeof s.get&&(r="get",n=s.get),!n)throw Error("not supported");let o=`$memoize$${i}`;s[r]=function(...e){return this.hasOwnProperty(o)||Object.defineProperty(this,o,{configurable:!1,enumerable:!1,writable:!1,value:n.apply(this,e)}),this[o]}}],iY,"isTouchDevice",1);var iX=class extends tu{onclick(e,i){this._register(iP(e,i$.CLICK,s=>i(new ip(ik(e),s))))}onmousedown(e,i){this._register(iP(e,i$.MOUSE_DOWN,s=>i(new ip(ik(e),s))))}onmouseover(e,i){this._register(iP(e,i$.MOUSE_OVER,s=>i(new ip(ik(e),s))))}onmouseleave(e,i){this._register(iP(e,i$.MOUSE_LEAVE,s=>i(new ip(ik(e),s))))}onkeydown(e,i){this._register(iP(e,i$.KEY_DOWN,e=>i(new iu(e))))}onkeyup(e,i){this._register(iP(e,i$.KEY_UP,e=>i(new iu(e))))}oninput(e,i){this._register(iP(e,i$.INPUT,i))}onblur(e,i){this._register(iP(e,i$.BLUR,i))}onfocus(e,i){this._register(iP(e,i$.FOCUS,i))}onchange(e,i){this._register(iP(e,i$.CHANGE,i))}ignoreGesture(e){return iY.ignoreTarget(e)}},iZ=class extends iX{constructor(e){super(),this._onActivate=e.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=e.bgWidth+"px",this.bgDomNode.style.height=e.bgHeight+"px","u">typeof e.top&&(this.bgDomNode.style.top="0px"),"u">typeof e.left&&(this.bgDomNode.style.left="0px"),"u">typeof e.bottom&&(this.bgDomNode.style.bottom="0px"),"u">typeof e.right&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=e.className,this.domNode.style.position="absolute",this.domNode.style.width="11px",this.domNode.style.height="11px","u">typeof e.top&&(this.domNode.style.top=e.top+"px"),"u">typeof e.left&&(this.domNode.style.left=e.left+"px"),"u">typeof e.bottom&&(this.domNode.style.bottom=e.bottom+"px"),"u">typeof e.right&&(this.domNode.style.right=e.right+"px"),this._pointerMoveMonitor=this._register(new iG),this._register(iF(this.bgDomNode,i$.POINTER_DOWN,e=>this._arrowPointerDown(e))),this._register(iF(this.domNode,i$.POINTER_DOWN,e=>this._arrowPointerDown(e))),this._pointerdownRepeatTimer=this._register(new iW),this._pointerdownScheduleRepeatTimer=this._register(new iS)}_arrowPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let i=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),1e3/24,ik(e))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(i,200),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,e=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),e.preventDefault()}},ij=class e{constructor(e,i,s,r,n,o,a){this._forceIntegerValues=e,this._scrollStateBrand=void 0,this._forceIntegerValues&&(i|=0,s|=0,r|=0,n|=0,o|=0,a|=0),this.rawScrollLeft=r,this.rawScrollTop=a,i<0&&(i=0),r+i>s&&(r=s-i),r<0&&(r=0),n<0&&(n=0),a+n>o&&(a=o-n),a<0&&(a=0),this.width=i,this.scrollWidth=s,this.scrollLeft=r,this.height=n,this.scrollHeight=o,this.scrollTop=a}equals(e){return this.rawScrollLeft===e.rawScrollLeft&&this.rawScrollTop===e.rawScrollTop&&this.width===e.width&&this.scrollWidth===e.scrollWidth&&this.scrollLeft===e.scrollLeft&&this.height===e.height&&this.scrollHeight===e.scrollHeight&&this.scrollTop===e.scrollTop}withScrollDimensions(i,s){return new e(this._forceIntegerValues,"u">typeof i.width?i.width:this.width,"u">typeof i.scrollWidth?i.scrollWidth:this.scrollWidth,s?this.rawScrollLeft:this.scrollLeft,"u">typeof i.height?i.height:this.height,"u">typeof i.scrollHeight?i.scrollHeight:this.scrollHeight,s?this.rawScrollTop:this.scrollTop)}withScrollPosition(i){return new e(this._forceIntegerValues,this.width,this.scrollWidth,"u">typeof i.scrollLeft?i.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,"u">typeof i.scrollTop?i.scrollTop:this.rawScrollTop)}createScrollEvent(e,i){let s=this.width!==e.width,r=this.scrollWidth!==e.scrollWidth,n=this.scrollLeft!==e.scrollLeft,o=this.height!==e.height,a=this.scrollHeight!==e.scrollHeight,l=this.scrollTop!==e.scrollTop;return{inSmoothScrolling:i,oldWidth:e.width,oldScrollWidth:e.scrollWidth,oldScrollLeft:e.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:e.height,oldScrollHeight:e.scrollHeight,oldScrollTop:e.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:s,scrollWidthChanged:r,scrollLeftChanged:n,heightChanged:o,scrollHeightChanged:a,scrollTopChanged:l}}},iq=class extends tu{constructor(e){super(),this._scrollableBrand=void 0,this._onScroll=this._register(new tB),this.onScroll=this._onScroll.event,this._smoothScrollDuration=e.smoothScrollDuration,this._scheduleAtNextAnimationFrame=e.scheduleAtNextAnimationFrame,this._state=new ij(e.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration(e){this._smoothScrollDuration=e}validateScrollPosition(e){return this._state.withScrollPosition(e)}getScrollDimensions(){return this._state}setScrollDimensions(e,i){let s=this._state.withScrollDimensions(e,i);this._setState(s,!!this._smoothScrolling),this._smoothScrolling?.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow(e){let i=this._state.withScrollPosition(e);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(i,!1)}setScrollPositionSmooth(e,i){if(0===this._smoothScrollDuration)return this.setScrollPositionNow(e);if(this._smoothScrolling){let s;e={scrollLeft:typeof e.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:e.scrollLeft,scrollTop:typeof e.scrollTop>"u"?this._smoothScrolling.to.scrollTop:e.scrollTop};let r=this._state.withScrollPosition(e);if(this._smoothScrolling.to.scrollLeft===r.scrollLeft&&this._smoothScrolling.to.scrollTop===r.scrollTop)return;s=i?new i0(this._smoothScrolling.from,r,this._smoothScrolling.startTime,this._smoothScrolling.duration):this._smoothScrolling.combine(this._state,r,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=s}else{let i=this._state.withScrollPosition(e);this._smoothScrolling=i0.start(this._state,i,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;let e=this._smoothScrolling.tick(),i=this._state.withScrollPosition(e);if(this._setState(i,!0),this._smoothScrolling){if(e.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState(e,i){let s=this._state;s.equals(e)||(this._state=e,this._onScroll.fire(this._state.createScrollEvent(s,i)))}},iQ=class{constructor(e,i,s){this.scrollLeft=e,this.scrollTop=i,this.isDone=s}};function iJ(e,i){let s=i-e;return function(i){return e+s*(1-Math.pow(1-i,3))}}var i0=class e{constructor(e,i,s,r){this.from=e,this.to=i,this.duration=r,this.startTime=s,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(e,i,s){if(Math.abs(e-i)>2.5*s){var r,n;let o,a;return e<i?(o=e+.75*s,a=i-.75*s):(o=e-.75*s,a=i+.75*s),r=iJ(e,o),n=iJ(a,i),function(e){return e<.33?r(e/.33):n((e-.33)/(1-.33))}}return iJ(e,i)}dispose(){null!==this.animationFrameDisposable&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(e){this.to=e.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(e){let i=(e-this.startTime)/this.duration;return i<1?new iQ(this.scrollLeft(i),this.scrollTop(i),!1):new iQ(this.to.scrollLeft,this.to.scrollTop,!0)}combine(i,s,r){return e.start(i,s,r)}static start(i,s,r){return r+=10,new e(i,s,Date.now()-10,r)}},i1=class extends tu{constructor(e,i,s){super(),this._visibility=e,this._visibleClassName=i,this._invisibleClassName=s,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new iS)}setVisibility(e){this._visibility!==e&&(this._visibility=e,this._updateShouldBeVisible())}setShouldBeVisible(e){this._rawShouldBeVisible=e,this._updateShouldBeVisible()}_applyVisibilitySetting(){return 2!==this._visibility&&(3===this._visibility||this._rawShouldBeVisible)}_updateShouldBeVisible(){let e=this._applyVisibilitySetting();this._shouldBeVisible!==e&&(this._shouldBeVisible=e,this.ensureVisibility())}setIsNeeded(e){this._isNeeded!==e&&(this._isNeeded=e,this.ensureVisibility())}setDomNode(e){this._domNode=e,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){this._isNeeded?this._shouldBeVisible?this._reveal():this._hide(!0):this._hide(!1)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{this._domNode?.setClassName(this._visibleClassName)},0))}_hide(e){this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,this._domNode?.setClassName(this._invisibleClassName+(e?" fade":"")))}},i2=class extends iX{constructor(e){super(),this._lazyRender=e.lazyRender,this._host=e.host,this._scrollable=e.scrollable,this._scrollByPage=e.scrollByPage,this._scrollbarState=e.scrollbarState,this._visibilityController=this._register(new i1(e.visibility,"visible scrollbar "+e.extraScrollbarClassName,"invisible scrollbar "+e.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new iG),this._shouldRender=!0,this.domNode=iK(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(iP(this.domNode.domNode,i$.POINTER_DOWN,e=>this._domNodePointerDown(e)))}_createArrow(e){let i=this._register(new iZ(e));this.domNode.domNode.appendChild(i.bgDomNode),this.domNode.domNode.appendChild(i.domNode)}_createSlider(e,i,s,r){this.slider=iK(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(e),this.slider.setLeft(i),"number"==typeof s&&this.slider.setWidth(s),"number"==typeof r&&this.slider.setHeight(r),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(iP(this.slider.domNode,i$.POINTER_DOWN,e=>{0===e.button&&(e.preventDefault(),this._sliderPointerDown(e))})),this.onclick(this.slider.domNode,e=>{e.leftButton&&e.stopPropagation()})}_onElementSize(e){return this._scrollbarState.setVisibleSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize(e){return this._scrollbarState.setScrollSize(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition(e){return this._scrollbarState.setScrollPosition(e)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown(e){e.target===this.domNode.domNode&&this._onPointerDown(e)}delegatePointerDown(e){let i=this.domNode.domNode.getClientRects()[0].top,s=i+this._scrollbarState.getSliderPosition(),r=i+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),n=this._sliderPointerPosition(e);s<=n&&n<=r?0===e.button&&(e.preventDefault(),this._sliderPointerDown(e)):this._onPointerDown(e)}_onPointerDown(e){let i,s;if(e.target===this.domNode.domNode&&"number"==typeof e.offsetX&&"number"==typeof e.offsetY)i=e.offsetX,s=e.offsetY;else{var r;let n,o,a=(n=(r=this.domNode.domNode).getBoundingClientRect(),o=ik(r),{left:n.left+o.scrollX,top:n.top+o.scrollY,width:n.width,height:n.height});i=e.pageX-a.left,s=e.pageY-a.top}let n=this._pointerDownRelativePosition(i,s);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(n):this._scrollbarState.getDesiredScrollPositionFromOffset(n)),0===e.button&&(e.preventDefault(),this._sliderPointerDown(e))}_sliderPointerDown(e){if(!e.target||!(e.target instanceof Element))return;let i=this._sliderPointerPosition(e),s=this._sliderOrthogonalPointerPosition(e),r=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(e.target,e.pointerId,e.buttons,e=>{let n=Math.abs(this._sliderOrthogonalPointerPosition(e)-s);if(tq&&n>140)return void this._setDesiredScrollPositionNow(r.getScrollPosition());let o=this._sliderPointerPosition(e)-i;this._setDesiredScrollPositionNow(r.getDesiredScrollPositionFromDelta(o))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow(e){let i={};this.writeScrollPosition(i,e),this._scrollable.setScrollPositionNow(i)}updateScrollbarSize(e){this._updateScrollbarSize(e),this._scrollbarState.setScrollbarSize(e),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}},i5=class e{constructor(e,i,s,r,n,o){this._scrollbarSize=Math.round(i),this._oppositeScrollbarSize=Math.round(s),this._arrowSize=Math.round(e),this._visibleSize=r,this._scrollSize=n,this._scrollPosition=o,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new e(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(e){let i=Math.round(e);return this._visibleSize!==i&&(this._visibleSize=i,this._refreshComputedValues(),!0)}setScrollSize(e){let i=Math.round(e);return this._scrollSize!==i&&(this._scrollSize=i,this._refreshComputedValues(),!0)}setScrollPosition(e){let i=Math.round(e);return this._scrollPosition!==i&&(this._scrollPosition=i,this._refreshComputedValues(),!0)}setScrollbarSize(e){this._scrollbarSize=Math.round(e)}setOppositeScrollbarSize(e){this._oppositeScrollbarSize=Math.round(e)}static _computeValues(e,i,s,r,n){let o=Math.max(0,s-e),a=Math.max(0,o-2*i),l=r>0&&r>s;if(!l)return{computedAvailableSize:Math.round(o),computedIsNeeded:l,computedSliderSize:Math.round(a),computedSliderRatio:0,computedSliderPosition:0};let h=Math.round(Math.max(20,Math.floor(s*a/r))),c=(a-h)/(r-s);return{computedAvailableSize:Math.round(o),computedIsNeeded:l,computedSliderSize:Math.round(h),computedSliderRatio:c,computedSliderPosition:Math.round(n*c)}}_refreshComputedValues(){let i=e._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=i.computedAvailableSize,this._computedIsNeeded=i.computedIsNeeded,this._computedSliderSize=i.computedSliderSize,this._computedSliderRatio=i.computedSliderRatio,this._computedSliderPosition=i.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(e){return this._computedIsNeeded?Math.round((e-this._arrowSize-this._computedSliderSize/2)/this._computedSliderRatio):0}getDesiredScrollPositionFromOffsetPaged(e){if(!this._computedIsNeeded)return 0;let i=e-this._arrowSize,s=this._scrollPosition;return i<this._computedSliderPosition?s-=this._visibleSize:s+=this._visibleSize,s}getDesiredScrollPositionFromDelta(e){return this._computedIsNeeded?Math.round((this._computedSliderPosition+e)/this._computedSliderRatio):0}},i3=class extends i2{constructor(e,i,s){let r=e.getScrollDimensions(),n=e.getCurrentScrollPosition();if(super({lazyRender:i.lazyRender,host:s,scrollbarState:new i5(i.horizontalHasArrows?i.arrowSize:0,2===i.horizontal?0:i.horizontalScrollbarSize,2===i.vertical?0:i.verticalScrollbarSize,r.width,r.scrollWidth,n.scrollLeft),visibility:i.horizontal,extraScrollbarClassName:"horizontal",scrollable:e,scrollByPage:i.scrollByPage}),i.horizontalHasArrows)throw Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(Math.floor((i.horizontalScrollbarSize-i.horizontalSliderSize)/2),0,void 0,i.horizontalSliderSize)}_updateSlider(e,i){this.slider.setWidth(e),this.slider.setLeft(i)}_renderDomNode(e,i){this.domNode.setWidth(e),this.domNode.setHeight(i),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(e.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,i){return e}_sliderPointerPosition(e){return e.pageX}_sliderOrthogonalPointerPosition(e){return e.pageY}_updateScrollbarSize(e){this.slider.setHeight(e)}writeScrollPosition(e,i){e.scrollLeft=i}updateOptions(e){this.updateScrollbarSize(2===e.horizontal?0:e.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(2===e.vertical?0:e.verticalScrollbarSize),this._visibilityController.setVisibility(e.horizontal),this._scrollByPage=e.scrollByPage}},i6=class extends i2{constructor(e,i,s){let r=e.getScrollDimensions(),n=e.getCurrentScrollPosition();if(super({lazyRender:i.lazyRender,host:s,scrollbarState:new i5(i.verticalHasArrows?i.arrowSize:0,2===i.vertical?0:i.verticalScrollbarSize,0,r.height,r.scrollHeight,n.scrollTop),visibility:i.vertical,extraScrollbarClassName:"vertical",scrollable:e,scrollByPage:i.scrollByPage}),i.verticalHasArrows)throw Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(0,Math.floor((i.verticalScrollbarSize-i.verticalSliderSize)/2),i.verticalSliderSize,void 0)}_updateSlider(e,i){this.slider.setHeight(e),this.slider.setTop(i)}_renderDomNode(e,i){this.domNode.setWidth(i),this.domNode.setHeight(e),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll(e){return this._shouldRender=this._onElementScrollSize(e.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(e.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(e.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(e,i){return i}_sliderPointerPosition(e){return e.pageY}_sliderOrthogonalPointerPosition(e){return e.pageX}_updateScrollbarSize(e){this.slider.setWidth(e)}writeScrollPosition(e,i){e.scrollTop=i}updateOptions(e){this.updateScrollbarSize(2===e.vertical?0:e.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(e.vertical),this._scrollByPage=e.scrollByPage}},i4=class{constructor(e,i,s){this.timestamp=e,this.deltaX=i,this.deltaY=s,this.score=0}},i9=class{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(-1===this._front&&-1===this._rear)return!1;let e=1,i=0,s=1,r=this._rear;for(;;){let n=r===this._front?e:Math.pow(2,-s);if(e-=n,i+=this._memory[r].score*n,r===this._front)break;r=(this._capacity+r-1)%this._capacity,s++}return i<=.5}acceptStandardWheelEvent(e){if(tP){var i;let s=(i=ik(e.browserEvent),tI.INSTANCE.getZoomFactor(i));this.accept(Date.now(),e.deltaX*s,e.deltaY*s)}else this.accept(Date.now(),e.deltaX,e.deltaY)}accept(e,i,s){let r=null,n=new i4(e,i,s);-1===this._front&&-1===this._rear?(this._memory[0]=n,this._front=0,this._rear=0):(r=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=n),n.score=this._computeScore(n,r)}_computeScore(e,i){if(Math.abs(e.deltaX)>0&&Math.abs(e.deltaY)>0)return 1;let s=.5;if(this._isAlmostInt(e.deltaX)&&this._isAlmostInt(e.deltaY)||(s+=.25),i){let r=Math.abs(e.deltaX),n=Math.abs(e.deltaY),o=Math.abs(i.deltaX),a=Math.abs(i.deltaY),l=Math.max(Math.min(r,o),1),h=Math.max(Math.min(n,a),1),c=Math.max(n,a);Math.max(r,o)%l==0&&c%h==0&&(s-=.5)}return Math.min(Math.max(s,0),1)}_isAlmostInt(e){return .01>Math.abs(Math.round(e)-e)}};i9.INSTANCE=new i9;var i8=class extends iX{constructor(e,i,s){super(),this._onScroll=this._register(new tB),this.onScroll=this._onScroll.event,this._onWillScroll=this._register(new tB),this.onWillScroll=this._onWillScroll.event,this._options=function(e){let i={lazyRender:"u">typeof e.lazyRender&&e.lazyRender,className:"u">typeof e.className?e.className:"",useShadows:!("u">typeof e.useShadows)||e.useShadows,handleMouseWheel:!("u">typeof e.handleMouseWheel)||e.handleMouseWheel,flipAxes:"u">typeof e.flipAxes&&e.flipAxes,consumeMouseWheelIfScrollbarIsNeeded:"u">typeof e.consumeMouseWheelIfScrollbarIsNeeded&&e.consumeMouseWheelIfScrollbarIsNeeded,alwaysConsumeMouseWheel:"u">typeof e.alwaysConsumeMouseWheel&&e.alwaysConsumeMouseWheel,scrollYToX:"u">typeof e.scrollYToX&&e.scrollYToX,mouseWheelScrollSensitivity:"u">typeof e.mouseWheelScrollSensitivity?e.mouseWheelScrollSensitivity:1,fastScrollSensitivity:"u">typeof e.fastScrollSensitivity?e.fastScrollSensitivity:5,scrollPredominantAxis:!("u">typeof e.scrollPredominantAxis)||e.scrollPredominantAxis,mouseWheelSmoothScroll:!("u">typeof e.mouseWheelSmoothScroll)||e.mouseWheelSmoothScroll,arrowSize:"u">typeof e.arrowSize?e.arrowSize:11,listenOnDomNode:"u">typeof e.listenOnDomNode?e.listenOnDomNode:null,horizontal:"u">typeof e.horizontal?e.horizontal:1,horizontalScrollbarSize:"u">typeof e.horizontalScrollbarSize?e.horizontalScrollbarSize:10,horizontalSliderSize:"u">typeof e.horizontalSliderSize?e.horizontalSliderSize:0,horizontalHasArrows:"u">typeof e.horizontalHasArrows&&e.horizontalHasArrows,vertical:"u">typeof e.vertical?e.vertical:1,verticalScrollbarSize:"u">typeof e.verticalScrollbarSize?e.verticalScrollbarSize:10,verticalHasArrows:"u">typeof e.verticalHasArrows&&e.verticalHasArrows,verticalSliderSize:"u">typeof e.verticalSliderSize?e.verticalSliderSize:0,scrollByPage:"u">typeof e.scrollByPage&&e.scrollByPage};return i.horizontalSliderSize="u">typeof e.horizontalSliderSize?e.horizontalSliderSize:i.horizontalScrollbarSize,i.verticalSliderSize="u">typeof e.verticalSliderSize?e.verticalSliderSize:i.verticalScrollbarSize,tQ&&(i.className+=" mac"),i}(i),this._scrollable=s,this._register(this._scrollable.onScroll(e=>{this._onWillScroll.fire(e),this._onDidScroll(e),this._onScroll.fire(e)}));let r={onMouseWheel:e=>this._onMouseWheel(e),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new i6(this._scrollable,this._options,r)),this._horizontalScrollbar=this._register(new i3(this._scrollable,this._options,r)),this._domNode=document.createElement("div"),this._domNode.className="xterm-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.appendChild(e),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=iK(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=iK(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=iK(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,e=>this._onMouseOver(e)),this.onmouseleave(this._listenOnDomNode,e=>this._onMouseLeave(e)),this._hideTimeout=this._register(new iS),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}get options(){return this._options}dispose(){this._mouseWheelToDispose=tl(this._mouseWheelToDispose),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown(e){this._verticalScrollbar.delegatePointerDown(e)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions(e){this._scrollable.setScrollDimensions(e,!1)}updateClassName(e){this._options.className=e,tQ&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}updateOptions(e){"u">typeof e.handleMouseWheel&&(this._options.handleMouseWheel=e.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),"u">typeof e.mouseWheelScrollSensitivity&&(this._options.mouseWheelScrollSensitivity=e.mouseWheelScrollSensitivity),"u">typeof e.fastScrollSensitivity&&(this._options.fastScrollSensitivity=e.fastScrollSensitivity),"u">typeof e.scrollPredominantAxis&&(this._options.scrollPredominantAxis=e.scrollPredominantAxis),"u">typeof e.horizontal&&(this._options.horizontal=e.horizontal),"u">typeof e.vertical&&(this._options.vertical=e.vertical),"u">typeof e.horizontalScrollbarSize&&(this._options.horizontalScrollbarSize=e.horizontalScrollbarSize),"u">typeof e.verticalScrollbarSize&&(this._options.verticalScrollbarSize=e.verticalScrollbarSize),"u">typeof e.scrollByPage&&(this._options.scrollByPage=e.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}setRevealOnScroll(e){this._revealOnScroll=e}delegateScrollFromMouseWheelEvent(e){this._onMouseWheel(new im(e))}_setListeningToMouseWheel(e){if(this._mouseWheelToDispose.length>0!==e&&(this._mouseWheelToDispose=tl(this._mouseWheelToDispose),e)){let e=e=>{this._onMouseWheel(new im(e))};this._mouseWheelToDispose.push(iP(this._listenOnDomNode,i$.MOUSE_WHEEL,e,{passive:!1}))}}_onMouseWheel(e){if(e.browserEvent?.defaultPrevented)return;let i=i9.INSTANCE;i.acceptStandardWheelEvent(e);let s=!1;if(e.deltaY||e.deltaX){let r=e.deltaY*this._options.mouseWheelScrollSensitivity,n=e.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&n+r===0?n=r=0:Math.abs(r)>=Math.abs(n)?n=0:r=0),this._options.flipAxes&&([r,n]=[n,r]);let o=!tQ&&e.browserEvent&&e.browserEvent.shiftKey;(this._options.scrollYToX||o)&&!n&&(n=r,r=0),e.browserEvent&&e.browserEvent.altKey&&(n*=this._options.fastScrollSensitivity,r*=this._options.fastScrollSensitivity);let a=this._scrollable.getFutureScrollPosition(),l={};if(r){let e=50*r,i=a.scrollTop-(e<0?Math.floor(e):Math.ceil(e));this._verticalScrollbar.writeScrollPosition(l,i)}if(n){let e=50*n,i=a.scrollLeft-(e<0?Math.floor(e):Math.ceil(e));this._horizontalScrollbar.writeScrollPosition(l,i)}l=this._scrollable.validateScrollPosition(l),(a.scrollLeft!==l.scrollLeft||a.scrollTop!==l.scrollTop)&&(this._options.mouseWheelSmoothScroll&&i.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(l):this._scrollable.setScrollPositionNow(l),s=!0)}let r=s;!r&&this._options.alwaysConsumeMouseWheel&&(r=!0),!r&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(r=!0),r&&(e.preventDefault(),e.stopPropagation())}_onDidScroll(e){this._shouldRender=this._horizontalScrollbar.onDidScroll(e)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(e)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){let e=this._scrollable.getCurrentScrollPosition(),i=e.scrollTop>0,s=e.scrollLeft>0,r=s?" left":"",n=i?" top":"";this._leftShadowDomNode.setClassName(`shadow${r}`),this._topShadowDomNode.setClassName(`shadow${n}`),this._topLeftShadowDomNode.setClassName(`shadow${s||i?" top-left-corner":""}${n}${r}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave(e){this._mouseIsOver=!1,this._hide()}_onMouseOver(e){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){this._mouseIsOver||this._isDragging||(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){this._mouseIsOver||this._isDragging||this._hideTimeout.cancelAndSet(()=>this._hide(),500)}},i7=class extends i8{constructor(e,i,s){super(e,i,s)}setScrollPosition(e){e.reuseAnimation?this._scrollable.setScrollPositionSmooth(e,e.reuseAnimation):this._scrollable.setScrollPositionNow(e)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}},se=class extends tu{constructor(e,i,s,r,n,o,a,l){super(),this._bufferService=s,this._optionsService=a,this._renderService=l,this._onRequestScrollLines=this._register(new tB),this.onRequestScrollLines=this._onRequestScrollLines.event,this._isSyncing=!1,this._isHandlingScroll=!1,this._suppressOnScrollHandler=!1;let h=this._register(new iq({forceIntegerValues:!1,smoothScrollDuration:this._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:e=>sd(r.window,e)}));this._register(this._optionsService.onSpecificOptionChange("smoothScrollDuration",()=>{h.setSmoothScrollDuration(this._optionsService.rawOptions.smoothScrollDuration)})),this._scrollableElement=this._register(new i7(i,{vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0,...this._getChangeOptions()},h)),this._register(this._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],()=>this._scrollableElement.updateOptions(this._getChangeOptions()))),this._register(n.onProtocolChange(e=>{this._scrollableElement.updateOptions({handleMouseWheel:!(16&e)})})),this._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),this._register(tx.runAndSubscribe(o.onChangeColors,()=>{this._scrollableElement.getDomNode().style.backgroundColor=o.colors.background.css})),e.appendChild(this._scrollableElement.getDomNode()),this._register(th(()=>this._scrollableElement.getDomNode().remove())),this._styleElement=r.mainDocument.createElement("style"),i.appendChild(this._styleElement),this._register(th(()=>this._styleElement.remove())),this._register(tx.runAndSubscribe(o.onChangeColors,()=>{this._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {",`  background: ${o.colors.scrollbarSliderBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider:hover {",`  background: ${o.colors.scrollbarSliderHoverBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider.active {",`  background: ${o.colors.scrollbarSliderActiveBackground.css};`,"}"].join(`
`)})),this._register(this._bufferService.onResize(()=>this.queueSync())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._latestYDisp=void 0,this.queueSync()})),this._register(this._bufferService.onScroll(()=>this._sync())),this._register(this._scrollableElement.onScroll(e=>this._handleScroll(e)))}scrollLines(e){let i=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:i.scrollTop+e*this._renderService.dimensions.css.cell.height})}scrollToLine(e,i){i&&(this._latestYDisp=e),this._scrollableElement.setScrollPosition({reuseAnimation:!i,scrollTop:e*this._renderService.dimensions.css.cell.height})}_getChangeOptions(){return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:this._optionsService.rawOptions.overviewRuler?.width||14}}queueSync(e){void 0!==e&&(this._latestYDisp=e),void 0===this._queuedAnimationFrame&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(()=>{this._queuedAnimationFrame=void 0,this._sync(this._latestYDisp)}))}_sync(e=this._bufferService.buffer.ydisp){!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,e!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:e*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}_handleScroll(e){if(!this._renderService||this._isHandlingScroll||this._suppressOnScrollHandler)return;this._isHandlingScroll=!0;let i=Math.round(e.scrollTop/this._renderService.dimensions.css.cell.height),s=i-this._bufferService.buffer.ydisp;0!==s&&(this._latestYDisp=i,this._onRequestScrollLines.fire(s)),this._isHandlingScroll=!1}};se=eE([ek(2,eV),ek(3,e1),ek(4,eH),ek(5,e4),ek(6,eZ),ek(7,e5)],se);var st=class extends tu{constructor(e,i,s,r,n){super(),this._screenElement=e,this._bufferService=i,this._coreBrowserService=s,this._decorationService=r,this._renderService=n,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this._register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this._register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this._register(this._decorationService.onDecorationRemoved(e=>this._removeDecoration(e))),this._register(th(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){void 0===this._animationFrame&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){let i=this._coreBrowserService.mainDocument.createElement("div");i.classList.add("xterm-decoration"),i.classList.toggle("xterm-decoration-top-layer",e?.options?.layer==="top"),i.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,i.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,i.style.top=`${(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height}px`,i.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let s=e.options.x??0;return s&&s>this._bufferService.cols&&(i.style.display="none"),this._refreshXPosition(e,i),i}_refreshStyle(e){let i=e.marker.line-this._bufferService.buffers.active.ydisp;if(i<0||i>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let s=this._decorationElements.get(e);s||(s=this._createElement(e),e.element=s,this._decorationElements.set(e,s),this._container.appendChild(s),e.onDispose(()=>{this._decorationElements.delete(e),s.remove()})),s.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(s.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,s.style.height=`${(e.options.height||1)*this._renderService.dimensions.css.cell.height}px`,s.style.top=`${i*this._renderService.dimensions.css.cell.height}px`,s.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`),e.onRenderEmitter.fire(s)}}_refreshXPosition(e,i=e.element){if(!i)return;let s=e.options.x??0;"right"===(e.options.anchor||"left")?i.style.right=s?`${s*this._renderService.dimensions.css.cell.width}px`:"":i.style.left=s?`${s*this._renderService.dimensions.css.cell.width}px`:""}_removeDecoration(e){this._decorationElements.get(e)?.remove(),this._decorationElements.delete(e),e.dispose()}};st=eE([ek(1,eV),ek(2,e1),ek(3,eQ),ek(4,e5)],st);var si=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(e){if(e.options.overviewRulerOptions){for(let i of this._zones)if(i.color===e.options.overviewRulerOptions.color&&i.position===e.options.overviewRulerOptions.position){if(this._lineIntersectsZone(i,e.marker.line))return;if(this._lineAdjacentToZone(i,e.marker.line,e.options.overviewRulerOptions.position))return void this._addLineToZone(i,e.marker.line)}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=e.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=e.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=e.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=e.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:e.options.overviewRulerOptions.color,position:e.options.overviewRulerOptions.position,startBufferLine:e.marker.line,endBufferLine:e.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(e){this._linePadding=e}_lineIntersectsZone(e,i){return i>=e.startBufferLine&&i<=e.endBufferLine}_lineAdjacentToZone(e,i,s){return i>=e.startBufferLine-this._linePadding[s||"full"]&&i<=e.endBufferLine+this._linePadding[s||"full"]}_addLineToZone(e,i){e.startBufferLine=Math.min(e.startBufferLine,i),e.endBufferLine=Math.max(e.endBufferLine,i)}},ss={full:0,left:0,center:0,right:0},sr={full:0,left:0,center:0,right:0},sn={full:0,left:0,center:0,right:0},so=class extends tu{constructor(e,i,s,r,n,o,a,l){super(),this._viewportElement=e,this._screenElement=i,this._bufferService=s,this._decorationService=r,this._renderService=n,this._optionsService=o,this._themeService=a,this._coreBrowserService=l,this._colorZoneStore=new si,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement),this._register(th(()=>this._canvas?.remove()));let h=this._canvas.getContext("2d");if(h)this._ctx=h;else throw Error("Ctx cannot be null");this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this._register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0))),this._register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this._register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})),this._register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._register(this._optionsService.onSpecificOptionChange("overviewRuler",()=>this._queueRefresh(!0))),this._register(this._themeService.onChangeColors(()=>this._queueRefresh())),this._queueRefresh(!0)}get _width(){return this._optionsService.options.overviewRuler?.width||0}_refreshDrawConstants(){let e=Math.floor((this._canvas.width-1)/3),i=Math.ceil((this._canvas.width-1)/3);sr.full=this._canvas.width,sr.left=e,sr.center=i,sr.right=e,this._refreshDrawHeightConstants(),sn.full=1,sn.left=1,sn.center=1+sr.left,sn.right=1+sr.left+sr.center}_refreshDrawHeightConstants(){ss.full=Math.round(2*this._coreBrowserService.dpr);let e=Math.round(Math.max(Math.min(this._canvas.height/this._bufferService.buffer.lines.length,12),6)*this._coreBrowserService.dpr);ss.left=e,ss.center=e,ss.right=e}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*ss.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*ss.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*ss.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*ss.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){for(let e of(this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear(),this._decorationService.decorations))this._colorZoneStore.addDecoration(e);this._ctx.lineWidth=1,this._renderRulerOutline();let e=this._colorZoneStore.zones;for(let i of e)"full"!==i.position&&this._renderColorZone(i);for(let i of e)"full"===i.position&&this._renderColorZone(i);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderRulerOutline(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}_renderColorZone(e){this._ctx.fillStyle=e.color,this._ctx.fillRect(sn[e.position||"full"],Math.round((this._canvas.height-1)*(e.startBufferLine/this._bufferService.buffers.active.lines.length)-ss[e.position||"full"]/2),sr[e.position||"full"],Math.round((this._canvas.height-1)*((e.endBufferLine-e.startBufferLine)/this._bufferService.buffers.active.lines.length)+ss[e.position||"full"]))}_queueRefresh(e,i){this._shouldUpdateDimensions=e||this._shouldUpdateDimensions,this._shouldUpdateAnchor=i||this._shouldUpdateAnchor,void 0===this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};so=eE([ek(2,eV),ek(3,eQ),ek(4,e5),ek(5,eZ),ek(6,e4),ek(7,e1)],so),(b=s_||={}).NUL="\0",b.SOH="\x01",b.STX="\x02",b.ETX="\x03",b.EOT="\x04",b.ENQ="\x05",b.ACK="\x06",b.BEL="\x07",b.BS="\b",b.HT="	",b.LF=`
`,b.VT="\v",b.FF="\f",b.CR="\r",b.SO="\x0e",b.SI="\x0f",b.DLE="\x10",b.DC1="\x11",b.DC2="\x12",b.DC3="\x13",b.DC4="\x14",b.NAK="\x15",b.SYN="\x16",b.ETB="\x17",b.CAN="\x18",b.EM="\x19",b.SUB="\x1a",b.ESC="\x1b",b.FS="\x1c",b.GS="\x1d",b.RS="\x1e",b.US="\x1f",b.SP=" ",b.DEL="",(S=sf||={}).PAD="",S.HOP="",S.BPH="",S.NBH="",S.IND="",S.NEL="",S.SSA="",S.ESA="",S.HTS="",S.HTJ="",S.VTS="",S.PLD="",S.PLU="",S.RI="",S.SS2="",S.SS3="",S.DCS="",S.PU1="",S.PU2="",S.STS="",S.CCH="",S.MW="",S.SPA="",S.EPA="",S.SOS="",S.SGCI="",S.SCI="",S.CSI="",S.ST="",S.OSC="",S.PM="",S.APC="",(sg||={}).ST=`${s_.ESC}\\`;var sa=class{constructor(e,i,s,r,n,o){this._textarea=e,this._compositionView=i,this._bufferService=s,this._optionsService=r,this._coreService=n,this._renderService=o,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(e){this._compositionView.textContent=e.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(e){if(this._isComposing||this._isSendingComposition){if(20===e.keyCode||229===e.keyCode||16===e.keyCode||17===e.keyCode||18===e.keyCode)return!1;this._finalizeComposition(!1)}return 229!==e.keyCode||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(e){if(this._compositionView.classList.remove("active"),this._isComposing=!1,e){let e={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let i;this._isSendingComposition=!1,e.start+=this._dataAlreadySent.length,(i=this._isComposing?this._textarea.value.substring(e.start,this._compositionPosition.start):this._textarea.value.substring(e.start)).length>0&&this._coreService.triggerDataEvent(i,!0)}},0)}else{this._isSendingComposition=!1;let e=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(e,!0)}}_handleAnyTextareaChanges(){let e=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let i=this._textarea.value,s=i.replace(e,"");this._dataAlreadySent=s,i.length>e.length?this._coreService.triggerDataEvent(s,!0):i.length<e.length?this._coreService.triggerDataEvent(`${s_.DEL}`,!0):i.length===e.length&&i!==e&&this._coreService.triggerDataEvent(i,!0)}},0)}updateCompositionElements(e){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let e=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),i=this._renderService.dimensions.css.cell.height,s=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,r=e*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=r+"px",this._compositionView.style.top=s+"px",this._compositionView.style.height=i+"px",this._compositionView.style.lineHeight=i+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let n=this._compositionView.getBoundingClientRect();this._textarea.style.left=r+"px",this._textarea.style.top=s+"px",this._textarea.style.width=Math.max(n.width,1)+"px",this._textarea.style.height=Math.max(n.height,1)+"px",this._textarea.style.lineHeight=n.height+"px"}e||setTimeout(()=>this.updateCompositionElements(!0),0)}}};sa=eE([ek(2,eV),ek(3,eZ),ek(4,eK),ek(5,e5)],sa);var sl,sh,sc,sd,su,s_,sf,sg,sp,sm=0,sv=0,sb=0,sS=0,sw={css:"#00000000",rgba:0};(r4=sp||={}).toCss=function(e,i,s,r){return void 0!==r?`#${sL(e)}${sL(i)}${sL(s)}${sL(r)}`:`#${sL(e)}${sL(i)}${sL(s)}`},r4.toRgba=function(e,i,s,r=255){return(e<<24|i<<16|s<<8|r)>>>0},r4.toColor=function(e,i,s,r){return{css:r4.toCss(e,i,s,r),rgba:r4.toRgba(e,i,s,r)}};var sy=r9||={};function sC(e,i){return sS=Math.round(255*i),[sm,sv,sb]=ne.toChannels(e.rgba),{css:sp.toCss(sm,sv,sb,sS),rgba:sp.toRgba(sm,sv,sb,sS)}}sy.blend=function(e,i){if(1==(sS=(255&i.rgba)/255))return{css:i.css,rgba:i.rgba};let s=i.rgba>>24&255,r=i.rgba>>16&255,n=i.rgba>>8&255,o=e.rgba>>24&255,a=e.rgba>>16&255,l=e.rgba>>8&255;return sm=o+Math.round((s-o)*sS),sv=a+Math.round((r-a)*sS),sb=l+Math.round((n-l)*sS),{css:sp.toCss(sm,sv,sb),rgba:sp.toRgba(sm,sv,sb)}},sy.isOpaque=function(e){return(255&e.rgba)==255},sy.ensureContrastRatio=function(e,i,s){let r=ne.ensureContrastRatio(e.rgba,i.rgba,s);if(r)return sp.toColor(r>>24&255,r>>16&255,r>>8&255)},sy.opaque=function(e){let i=(255|e.rgba)>>>0;return[sm,sv,sb]=ne.toChannels(i),{css:sp.toCss(sm,sv,sb),rgba:i}},sy.opacity=sC,sy.multiplyOpacity=function(e,i){return sS=255&e.rgba,sC(e,sS*i/255)},sy.toColorRGB=function(e){return[e.rgba>>24&255,e.rgba>>16&255,e.rgba>>8&255]},(e=>{let i,s;try{let e=document.createElement("canvas");e.width=1,e.height=1;let r=e.getContext("2d",{willReadFrequently:!0});r&&((i=r).globalCompositeOperation="copy",s=i.createLinearGradient(0,0,1,1))}catch{}e.toColor=function(e){if(e.match(/#[\da-f]{3,8}/i))switch(e.length){case 4:return sm=parseInt(e.slice(1,2).repeat(2),16),sv=parseInt(e.slice(2,3).repeat(2),16),sb=parseInt(e.slice(3,4).repeat(2),16),sp.toColor(sm,sv,sb);case 5:return sm=parseInt(e.slice(1,2).repeat(2),16),sv=parseInt(e.slice(2,3).repeat(2),16),sb=parseInt(e.slice(3,4).repeat(2),16),sS=parseInt(e.slice(4,5).repeat(2),16),sp.toColor(sm,sv,sb,sS);case 7:return{css:e,rgba:(parseInt(e.slice(1),16)<<8|255)>>>0};case 9:return{css:e,rgba:parseInt(e.slice(1),16)>>>0}}let r=e.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(r)return sm=parseInt(r[1]),sv=parseInt(r[2]),sb=parseInt(r[3]),sS=Math.round((void 0===r[5]?1:parseFloat(r[5]))*255),sp.toColor(sm,sv,sb,sS);if(!i||!s||(i.fillStyle=s,i.fillStyle=e,"string"!=typeof i.fillStyle)||(i.fillRect(0,0,1,1),[sm,sv,sb,sS]=i.getImageData(0,0,1,1).data,255!==sS))throw Error("css.toColor: Unsupported css format");return{rgba:sp.toRgba(sm,sv,sb,sS),css:e}}})(r8||={});var sx=r7||={};function sE(e,i,s){let r=e/255,n=i/255,o=s/255;return .2126*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))+.7152*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.0722*(o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4))}sx.relativeLuminance=function(e){return sE(e>>16&255,e>>8&255,255&e)},sx.relativeLuminance2=sE;var sk=ne||={};function sA(e,i,s){let r=e>>24&255,n=e>>16&255,o=e>>8&255,a=i>>24&255,l=i>>16&255,h=i>>8&255,c=sT(r7.relativeLuminance2(a,l,h),r7.relativeLuminance2(r,n,o));for(;c<s&&(a>0||l>0||h>0);)a-=Math.max(0,Math.ceil(.1*a)),l-=Math.max(0,Math.ceil(.1*l)),h-=Math.max(0,Math.ceil(.1*h)),c=sT(r7.relativeLuminance2(a,l,h),r7.relativeLuminance2(r,n,o));return(a<<24|l<<16|h<<8|255)>>>0}function sR(e,i,s){let r=e>>24&255,n=e>>16&255,o=e>>8&255,a=i>>24&255,l=i>>16&255,h=i>>8&255,c=sT(r7.relativeLuminance2(a,l,h),r7.relativeLuminance2(r,n,o));for(;c<s&&(a<255||l<255||h<255);)a=Math.min(255,a+Math.ceil((255-a)*.1)),l=Math.min(255,l+Math.ceil((255-l)*.1)),h=Math.min(255,h+Math.ceil((255-h)*.1)),c=sT(r7.relativeLuminance2(a,l,h),r7.relativeLuminance2(r,n,o));return(a<<24|l<<16|h<<8|255)>>>0}function sL(e){let i=e.toString(16);return i.length<2?"0"+i:i}function sT(e,i){return e<i?(i+.05)/(e+.05):(e+.05)/(i+.05)}sk.blend=function(e,i){if(1==(sS=(255&i)/255))return i;let s=e>>24&255,r=e>>16&255,n=e>>8&255;return sm=s+Math.round(((i>>24&255)-s)*sS),sv=r+Math.round(((i>>16&255)-r)*sS),sb=n+Math.round(((i>>8&255)-n)*sS),sp.toRgba(sm,sv,sb)},sk.ensureContrastRatio=function(e,i,s){let r=r7.relativeLuminance(e>>8),n=r7.relativeLuminance(i>>8);if(sT(r,n)<s){if(n<r){let n=sA(e,i,s),o=sT(r,r7.relativeLuminance(n>>8));if(o<s){let a=sR(e,i,s);return o>sT(r,r7.relativeLuminance(a>>8))?n:a}return n}let o=sR(e,i,s),a=sT(r,r7.relativeLuminance(o>>8));if(a<s){let n=sA(e,i,s);return a>sT(r,r7.relativeLuminance(n>>8))?o:n}return o}},sk.reduceLuminance=sA,sk.increaseLuminance=sR,sk.toChannels=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]};var sB=class extends eO{constructor(e,i,s){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=i,this._width=s}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},sM=class{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new eF}register(e){let i={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(i),i.id}deregister(e){for(let i=0;i<this._characterJoiners.length;i++)if(this._characterJoiners[i].id===e)return this._characterJoiners.splice(i,1),!0;return!1}getJoinedCharacters(e){if(0===this._characterJoiners.length)return[];let i=this._bufferService.buffer.lines.get(e);if(!i||0===i.length)return[];let s=[],r=i.translateToString(!0),n=0,o=0,a=0,l=i.getFg(0),h=i.getBg(0);for(let e=0;e<i.getTrimmedLength();e++)if(i.loadCell(e,this._workCell),0!==this._workCell.getWidth()){if(this._workCell.fg!==l||this._workCell.bg!==h){if(e-n>1){let e=this._getJoinedRanges(r,a,o,i,n);for(let i=0;i<e.length;i++)s.push(e[i])}n=e,a=o,l=this._workCell.fg,h=this._workCell.bg}o+=this._workCell.getChars().length||1}if(this._bufferService.cols-n>1){let e=this._getJoinedRanges(r,a,o,i,n);for(let i=0;i<e.length;i++)s.push(e[i])}return s}_getJoinedRanges(e,i,s,r,n){let o=e.substring(i,s),a=[];try{a=this._characterJoiners[0].handler(o)}catch(e){console.error(e)}for(let e=1;e<this._characterJoiners.length;e++)try{let i=this._characterJoiners[e].handler(o);for(let e=0;e<i.length;e++)sM._mergeRanges(a,i[e])}catch(e){console.error(e)}return this._stringRangesToCellRanges(a,r,n),a}_stringRangesToCellRanges(e,i,s){let r=0,n=!1,o=0,a=e[0];if(a){for(let l=s;l<this._bufferService.cols;l++){let s=i.getWidth(l),h=i.getString(l).length||1;if(0!==s){if(!n&&a[0]<=o&&(a[0]=l,n=!0),a[1]<=o){if(a[1]=l,!(a=e[++r]))break;a[0]<=o?(a[0]=l,n=!0):n=!1}o+=h}}a&&(a[1]=this._bufferService.cols)}}static _mergeRanges(e,i){let s=!1;for(let r=0;r<e.length;r++){let n=e[r];if(s){if(i[1]<=n[0])return e[r-1][1]=i[1],e;if(i[1]<=n[1])return e[r-1][1]=Math.max(i[1],n[1]),e.splice(r,1),e;e.splice(r,1),r--}else{if(i[1]<=n[0])return e.splice(r,0,i),e;if(i[1]<=n[1])return n[0]=Math.min(i[0],n[0]),e;i[0]<n[1]&&(n[0]=Math.min(i[0],n[0]),s=!0);continue}}return s?e[e.length-1][1]=i[1]:e.push(i),e}};function sI(){return{width:0,height:0}}sM=eE([ek(0,eV)],sM);var sD=class{constructor(e,i,s,r,n,o,a){this._document=e,this._characterJoinerService=i,this._optionsService=s,this._coreBrowserService=r,this._coreService=n,this._decorationService=o,this._themeService=a,this._workCell=new eF,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(e,i,s){this._selectionStart=e,this._selectionEnd=i,this._columnSelectMode=s}createRow(e,i,s,r,n,o,a,l,h,c,d){let u=[],_=this._characterJoinerService.getJoinedCharacters(i),f=this._themeService.colors,g=e.getNoBgTrimmedLength();s&&g<o+1&&(g=o+1);let p,m=0,v="",b=0,S=0,w=0,y=0,C=!1,x=0,E=!1,k=0,A=0,R=[],L=-1!==c&&-1!==d;for(let T=0;T<g;T++){let g;e.loadCell(T,this._workCell);let B=this._workCell.getWidth();if(0===B)continue;let M=!1,I=T>=A,D=T,N=this._workCell;if(_.length>0&&T===_[0][0]&&I){let r=_.shift(),n=this._isCellInSelection(r[0],i);for(b=r[0]+1;b<r[1];b++)I&&=n===this._isCellInSelection(b,i);(I&&=!s||o<r[0]||o>=r[1])?(M=!0,N=new sB(this._workCell,e.translateToString(!0,r[0],r[1]),r[1]-r[0]),D=r[1]-1,B=N.getWidth()):A=r[1]}let O=this._isCellInSelection(T,i),P=s&&T===o,F=L&&T>=c&&T<=d,W=!1;this._decorationService.forEachDecorationAtCell(T,i,void 0,e=>{W=!0});let z=N.getChars()||" ";if(" "===z&&(N.isUnderline()||N.isOverline())&&(z=""),k=B*l-h.get(z,N.isBold(),N.isItalic()),p)if(m&&(O&&E||!O&&!E&&N.bg===S)&&(O&&E&&f.selectionForeground||N.fg===w)&&N.extended.ext===y&&F===C&&k===x&&!P&&!M&&!W&&I){N.isInvisible()?v+=" ":v+=z,m++;continue}else m&&(p.textContent=v),p=this._document.createElement("span"),m=0,v="";else p=this._document.createElement("span");if(S=N.bg,w=N.fg,y=N.extended.ext,C=F,x=k,E=O,M&&o>=T&&o<=D&&(o=T),!this._coreService.isCursorHidden&&P&&this._coreService.isCursorInitialized){if(R.push("xterm-cursor"),this._coreBrowserService.isFocused)a&&R.push("xterm-cursor-blink"),R.push("bar"===r?"xterm-cursor-bar":"underline"===r?"xterm-cursor-underline":"xterm-cursor-block");else if(n)switch(n){case"outline":R.push("xterm-cursor-outline");break;case"block":R.push("xterm-cursor-block");break;case"bar":R.push("xterm-cursor-bar");break;case"underline":R.push("xterm-cursor-underline")}}if(N.isBold()&&R.push("xterm-bold"),N.isItalic()&&R.push("xterm-italic"),N.isDim()&&R.push("xterm-dim"),v=N.isInvisible()?" ":N.getChars()||" ",N.isUnderline()&&(R.push(`xterm-underline-${N.extended.underlineStyle}`)," "===v&&(v=""),!N.isUnderlineColorDefault()))if(N.isUnderlineColorRGB())p.style.textDecorationColor=`rgb(${eO.toColorRGB(N.getUnderlineColor()).join(",")})`;else{let e=N.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&N.isBold()&&e<8&&(e+=8),p.style.textDecorationColor=f.ansi[e].css}N.isOverline()&&(R.push("xterm-overline")," "===v&&(v="")),N.isStrikethrough()&&R.push("xterm-strikethrough"),F&&(p.style.textDecoration="underline");let U=N.getFgColor(),$=N.getFgColorMode(),V=N.getBgColor(),H=N.getBgColorMode(),K=!!N.isInverse();if(K){let e=U;U=V,V=e;let i=$;$=H,H=i}let G,Y,X=!1;switch(this._decorationService.forEachDecorationAtCell(T,i,void 0,e=>{"top"!==e.options.layer&&X||(e.backgroundColorRGB&&(H=0x3000000,V=e.backgroundColorRGB.rgba>>8&0xffffff,G=e.backgroundColorRGB),e.foregroundColorRGB&&($=0x3000000,U=e.foregroundColorRGB.rgba>>8&0xffffff,Y=e.foregroundColorRGB),X="top"===e.options.layer)}),!X&&O&&(V=(G=this._coreBrowserService.isFocused?f.selectionBackgroundOpaque:f.selectionInactiveBackgroundOpaque).rgba>>8&0xffffff,H=0x3000000,X=!0,f.selectionForeground&&($=0x3000000,U=f.selectionForeground.rgba>>8&0xffffff,Y=f.selectionForeground)),X&&R.push("xterm-decoration-top"),H){case 0x1000000:case 0x2000000:g=f.ansi[V],R.push(`xterm-bg-${V}`);break;case 0x3000000:g=sp.toColor(V>>16,V>>8&255,255&V),this._addStyle(p,`background-color:#${sN((V>>>0).toString(16),"0",6)}`);break;default:K?(g=f.foreground,R.push("xterm-bg-257")):g=f.background}switch(G||N.isDim()&&(G=r9.multiplyOpacity(g,.5)),$){case 0x1000000:case 0x2000000:N.isBold()&&U<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(U+=8),this._applyMinimumContrast(p,g,f.ansi[U],N,G,void 0)||R.push(`xterm-fg-${U}`);break;case 0x3000000:let Z=sp.toColor(U>>16&255,U>>8&255,255&U);this._applyMinimumContrast(p,g,Z,N,G,Y)||this._addStyle(p,`color:#${sN(U.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(p,g,f.foreground,N,G,Y)||K&&R.push("xterm-fg-257")}R.length&&(p.className=R.join(" "),R.length=0),P||M||W||!I?p.textContent=v:m++,k!==this.defaultSpacing&&(p.style.letterSpacing=`${k}px`),u.push(p),T=D}return p&&m&&(p.textContent=v),u}_applyMinimumContrast(e,i,s,r,n,o){var a,l,h;if(1===this._optionsService.rawOptions.minimumContrastRatio||57508<=(l=a=r.getCode())&&l<=57558||9472<=(h=a)&&h<=9631)return!1;let c=this._getContrastCache(r),d;if(n||o||(d=c.getColor(i.rgba,s.rgba)),void 0===d){let e=this._optionsService.rawOptions.minimumContrastRatio/(r.isDim()?2:1);d=r9.ensureContrastRatio(n||i,o||s,e),c.setColor((n||i).rgba,(o||s).rgba,d??null)}return!!d&&(this._addStyle(e,`color:${d.css}`),!0)}_getContrastCache(e){return e.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(e,i){e.setAttribute("style",`${e.getAttribute("style")||""}${i};`)}_isCellInSelection(e,i){let s=this._selectionStart,r=this._selectionEnd;return!!s&&!!r&&(this._columnSelectMode?s[0]<=r[0]?e>=s[0]&&i>=s[1]&&e<r[0]&&i<=r[1]:e<s[0]&&i>=s[1]&&e>=r[0]&&i<=r[1]:i>s[1]&&i<r[1]||s[1]===r[1]&&i===s[1]&&e>=s[0]&&e<r[0]||s[1]<r[1]&&i===r[1]&&e<r[0]||s[1]<r[1]&&i===s[1]&&e>=s[0])}};function sN(e,i,s){for(;e.length<s;)e=i+e;return e}sD=eE([ek(1,e6),ek(2,eZ),ek(3,e1),ek(4,eK),ek(5,eQ),ek(6,e4)],sD);var sO=class{constructor(e,i){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=e.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let s=e.createElement("span");s.classList.add("xterm-char-measure-element");let r=e.createElement("span");r.classList.add("xterm-char-measure-element"),r.style.fontWeight="bold";let n=e.createElement("span");n.classList.add("xterm-char-measure-element"),n.style.fontStyle="italic";let o=e.createElement("span");o.classList.add("xterm-char-measure-element"),o.style.fontWeight="bold",o.style.fontStyle="italic",this._measureElements=[s,r,n,o],this._container.appendChild(s),this._container.appendChild(r),this._container.appendChild(n),this._container.appendChild(o),i.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(e,i,s,r){e===this._font&&i===this._fontSize&&s===this._weight&&r===this._weightBold||(this._font=e,this._fontSize=i,this._weight=s,this._weightBold=r,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${s}`,this._measureElements[1].style.fontWeight=`${r}`,this._measureElements[2].style.fontWeight=`${s}`,this._measureElements[3].style.fontWeight=`${r}`,this.clear())}get(e,i,s){let r=0;if(!i&&!s&&1===e.length&&(r=e.charCodeAt(0))<256){if(-9999!==this._flat[r])return this._flat[r];let i=this._measure(e,0);return i>0&&(this._flat[r]=i),i}let n=e;i&&(n+="B"),s&&(n+="I");let o=this._holey.get(n);if(void 0===o){let r=0;i&&(r|=1),s&&(r|=2),(o=this._measure(e,r))>0&&this._holey.set(n,o)}return o}_measure(e,i){let s=this._measureElements[i];return s.textContent=e.repeat(32),s.offsetWidth/32}},sP=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,i,s,r=!1){if(this.selectionStart=i,this.selectionEnd=s,!i||!s||i[0]===s[0]&&i[1]===s[1])return void this.clear();let n=e.buffers.active.ydisp,o=i[1]-n,a=s[1]-n,l=Math.max(o,0),h=Math.min(a,e.rows-1);l>=e.rows||h<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=r,this.viewportStartRow=o,this.viewportEndRow=a,this.viewportCappedStartRow=l,this.viewportCappedEndRow=h,this.startCol=i[0],this.endCol=s[0])}isCellSelected(e,i,s){return!!this.hasSelection&&(s-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?i>=this.startCol&&s>=this.viewportCappedStartRow&&i<this.endCol&&s<=this.viewportCappedEndRow:i<this.startCol&&s>=this.viewportCappedStartRow&&i>=this.endCol&&s<=this.viewportCappedEndRow:s>this.viewportStartRow&&s<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&s===this.viewportStartRow&&i>=this.startCol&&i<this.endCol||this.viewportStartRow<this.viewportEndRow&&s===this.viewportEndRow&&i<this.endCol||this.viewportStartRow<this.viewportEndRow&&s===this.viewportStartRow&&i>=this.startCol)}},sF="xterm-dom-renderer-owner-",sW="xterm-rows",sz="xterm-fg-",sU="xterm-bg-",s$="xterm-focus",sV="xterm-selection",sH=1,sK=class extends tu{constructor(e,i,s,r,n,o,a,l,h,c,d,u,_,f){super(),this._terminal=e,this._document=i,this._element=s,this._screenElement=r,this._viewportElement=n,this._helperContainer=o,this._linkifier2=a,this._charSizeService=h,this._optionsService=c,this._bufferService=d,this._coreService=u,this._coreBrowserService=_,this._themeService=f,this._terminalClass=sH++,this._rowElements=[],this._selectionRenderModel=new sP,this.onRequestRedraw=this._register(new tB).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(sW),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(sV),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions={css:{canvas:sI(),cell:sI()},device:{canvas:sI(),cell:sI(),char:{width:0,height:0,left:0,top:0}}},this._updateDimensions(),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._themeService.onChangeColors(e=>this._injectCss(e))),this._injectCss(this._themeService.colors),this._rowFactory=l.createInstance(sD,document),this._element.classList.add(sF+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this._register(this._linkifier2.onShowLinkUnderline(e=>this._handleLinkHover(e))),this._register(this._linkifier2.onHideLinkUnderline(e=>this._handleLinkLeave(e))),this._register(th(()=>{this._element.classList.remove(sF+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new sO(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let e=this._coreBrowserService.dpr;for(let i of(this.dimensions.device.char.width=this._charSizeService.width*e,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*e),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/e),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/e),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows,this._rowElements))i.style.width=`${this.dimensions.css.canvas.width}px`,i.style.height=`${this.dimensions.css.cell.height}px`,i.style.lineHeight=`${this.dimensions.css.cell.height}px`,i.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let i=`${this._terminalSelector} .${sW} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=i,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(e){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let i=`${this._terminalSelector} .${sW} { pointer-events: none; color: ${e.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;i+=`${this._terminalSelector} .${sW} .xterm-dim { color: ${r9.multiplyOpacity(e.foreground,.5).css};}${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let s=`blink_underline_${this._terminalClass}`,r=`blink_bar_${this._terminalClass}`,n=`blink_block_${this._terminalClass}`;for(let[o,a]of(i+=`@keyframes ${s} { 50% {  border-bottom-style: hidden; }}@keyframes ${r} { 50% {  box-shadow: none; }}@keyframes ${n} { 0% {  background-color: ${e.cursor.css};  color: ${e.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${e.cursor.css}; }}${this._terminalSelector} .${sW}.${s$} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${s} 1s step-end infinite;}${this._terminalSelector} .${sW}.${s$} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${r} 1s step-end infinite;}${this._terminalSelector} .${sW}.${s$} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${n} 1s step-end infinite;}${this._terminalSelector} .${sW} .xterm-cursor.xterm-cursor-block { background-color: ${e.cursor.css}; color: ${e.cursorAccent.css};}${this._terminalSelector} .${sW} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${e.cursor.css} !important; color: ${e.cursorAccent.css} !important;}${this._terminalSelector} .${sW} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${e.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${sW} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${e.cursor.css} inset;}${this._terminalSelector} .${sW} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${e.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}${this._terminalSelector} .${sV} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${sV} div { position: absolute; background-color: ${e.selectionBackgroundOpaque.css};}${this._terminalSelector} .${sV} div { position: absolute; background-color: ${e.selectionInactiveBackgroundOpaque.css};}`,e.ansi.entries()))i+=`${this._terminalSelector} .${sz}${o} { color: ${a.css}; }${this._terminalSelector} .${sz}${o}.xterm-dim { color: ${r9.multiplyOpacity(a,.5).css}; }${this._terminalSelector} .${sU}${o} { background-color: ${a.css}; }`;i+=`${this._terminalSelector} .${sz}257 { color: ${r9.opaque(e.background).css}; }${this._terminalSelector} .${sz}257.xterm-dim { color: ${r9.multiplyOpacity(r9.opaque(e.background),.5).css}; }${this._terminalSelector} .${sU}257 { background-color: ${e.foreground.css}; }`,this._themeStyleElement.textContent=i}_setDefaultSpacing(){let e=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${e}px`,this._rowFactory.defaultSpacing=e}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(e,i){for(let e=this._rowElements.length;e<=i;e++){let e=this._document.createElement("div");this._rowContainer.appendChild(e),this._rowElements.push(e)}for(;this._rowElements.length>i;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(e,i){this._refreshRowElements(e,i),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(s$),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(s$),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(e,i,s){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(e,i,s),this.renderRows(0,this._bufferService.rows-1),!e||!i||(this._selectionRenderModel.update(this._terminal,e,i,s),!this._selectionRenderModel.hasSelection))return;let r=this._selectionRenderModel.viewportStartRow,n=this._selectionRenderModel.viewportEndRow,o=this._selectionRenderModel.viewportCappedStartRow,a=this._selectionRenderModel.viewportCappedEndRow,l=this._document.createDocumentFragment();if(s){let s=e[0]>i[0];l.appendChild(this._createSelectionElement(o,s?i[0]:e[0],s?e[0]:i[0],a-o+1))}else{let s=r===o?e[0]:0,h=o===n?i[0]:this._bufferService.cols;if(l.appendChild(this._createSelectionElement(o,s,h)),l.appendChild(this._createSelectionElement(o+1,0,this._bufferService.cols,a-o-1)),o!==a){let e=n===a?i[0]:this._bufferService.cols;l.appendChild(this._createSelectionElement(a,0,e))}}this._selectionContainer.appendChild(l)}_createSelectionElement(e,i,s,r=1){let n=this._document.createElement("div"),o=i*this.dimensions.css.cell.width,a=this.dimensions.css.cell.width*(s-i);return o+a>this.dimensions.css.canvas.width&&(a=this.dimensions.css.canvas.width-o),n.style.height=`${r*this.dimensions.css.cell.height}px`,n.style.top=`${e*this.dimensions.css.cell.height}px`,n.style.left=`${o}px`,n.style.width=`${a}px`,n}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let e of this._rowElements)e.replaceChildren()}renderRows(e,i){let s=this._bufferService.buffer,r=s.ybase+s.y,n=Math.min(s.x,this._bufferService.cols-1),o=this._coreService.decPrivateModes.cursorBlink??this._optionsService.rawOptions.cursorBlink,a=this._coreService.decPrivateModes.cursorStyle??this._optionsService.rawOptions.cursorStyle,l=this._optionsService.rawOptions.cursorInactiveStyle;for(let h=e;h<=i;h++){let e=h+s.ydisp,i=this._rowElements[h],c=s.lines.get(e);if(!i||!c)break;i.replaceChildren(...this._rowFactory.createRow(c,e,e===r,a,l,n,o,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${sF}${this._terminalClass}`}_handleLinkHover(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!0)}_handleLinkLeave(e){this._setCellUnderline(e.x1,e.x2,e.y1,e.y2,e.cols,!1)}_setCellUnderline(e,i,s,r,n,o){s<0&&(e=0),r<0&&(i=0);let a=this._bufferService.rows-1;s=Math.max(Math.min(s,a),0),r=Math.max(Math.min(r,a),0),n=Math.min(n,this._bufferService.cols);let l=this._bufferService.buffer,h=l.ybase+l.y,c=Math.min(l.x,n-1),d=this._optionsService.rawOptions.cursorBlink,u=this._optionsService.rawOptions.cursorStyle,_=this._optionsService.rawOptions.cursorInactiveStyle;for(let a=s;a<=r;++a){let f=a+l.ydisp,g=this._rowElements[a],p=l.lines.get(f);if(!g||!p)break;g.replaceChildren(...this._rowFactory.createRow(p,f,f===h,u,_,c,d,this.dimensions.css.cell.width,this._widthCache,o?a===s?e:0:-1,o?(a===r?i:n)-1:-1))}}};sK=eE([ek(7,eY),ek(8,e0),ek(9,eZ),ek(10,eV),ek(11,eK),ek(12,e1),ek(13,e4)],sK);var sG=class extends tu{constructor(e,i,s){super(),this._optionsService=s,this.width=0,this.height=0,this._onCharSizeChange=this._register(new tB),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this._register(new sZ(this._optionsService))}catch{this._measureStrategy=this._register(new sX(e,i,this._optionsService))}this._register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let e=this._measureStrategy.measure();(e.width!==this.width||e.height!==this.height)&&(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};sG=eE([ek(2,eZ)],sG);var sY=class extends tu{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(e,i){void 0!==e&&e>0&&void 0!==i&&i>0&&(this._result.width=e,this._result.height=i)}},sX=class extends sY{constructor(e,i,s){super(),this._document=e,this._parentElement=i,this._optionsService=s,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}},sZ=class extends sY{constructor(e){super(),this._optionsService=e,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let i=this._ctx.measureText("W");if(!("width"in i&&"fontBoundingBoxAscent"in i&&"fontBoundingBoxDescent"in i))throw Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let e=this._ctx.measureText("W");return this._validateAndSet(e.width,e.fontBoundingBoxAscent+e.fontBoundingBoxDescent),this._result}},sj=class extends tu{constructor(e,i,s){super(),this._textarea=e,this._window=i,this.mainDocument=s,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=this._register(new sq(this._window)),this._onDprChange=this._register(new tB),this.onDprChange=this._onDprChange.event,this._onWindowChange=this._register(new tB),this.onWindowChange=this._onWindowChange.event,this._register(this.onWindowChange(e=>this._screenDprMonitor.setWindow(e))),this._register(tx.forward(this._screenDprMonitor.onDprChange,this._onDprChange)),this._register(iP(this._textarea,"focus",()=>this._isFocused=!0)),this._register(iP(this._textarea,"blur",()=>this._isFocused=!1))}get window(){return this._window}set window(e){this._window!==e&&(this._window=e,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return void 0===this._cachedIsFocused&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}},sq=class extends tu{constructor(e){super(),this._parentWindow=e,this._windowResizeListener=this._register(new t_),this._onDprChange=this._register(new tB),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this._register(th(()=>this.clearListener()))}setWindow(e){this._parentWindow=e,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=iP(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}},sQ=class extends tu{constructor(){super(),this.linkProviders=[],this._register(th(()=>this.linkProviders.length=0))}registerLinkProvider(e){return this.linkProviders.push(e),{dispose:()=>{let i=this.linkProviders.indexOf(e);-1!==i&&this.linkProviders.splice(i,1)}}}};function sJ(e,i,s){let r=s.getBoundingClientRect(),n=e.getComputedStyle(s),o=parseInt(n.getPropertyValue("padding-left")),a=parseInt(n.getPropertyValue("padding-top"));return[i.clientX-r.left-o,i.clientY-r.top-a]}var s0=class{constructor(e,i){this._renderService=e,this._charSizeService=i}getCoords(e,i,s,r,n){return function(e,i,s,r,n,o,a,l,h){if(!o)return;let c=sJ(e,i,s);return c[0]=Math.ceil((c[0]+(h?a/2:0))/a),c[1]=Math.ceil(c[1]/l),c[0]=Math.min(Math.max(c[0],1),r+ +!!h),c[1]=Math.min(Math.max(c[1],1),n),c}(window,e,i,s,r,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,n)}getMouseReportCoords(e,i){let s=sJ(window,e,i);if(this._charSizeService.hasValidSize)return s[0]=Math.min(Math.max(s[0],0),this._renderService.dimensions.css.canvas.width-1),s[1]=Math.min(Math.max(s[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(s[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(s[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(s[0]),y:Math.floor(s[1])}}};s0=eE([ek(0,e5),ek(1,e0)],s0);var s1=class{constructor(e,i){this._renderCallback=e,this._coreBrowserService=i,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(e){return this._refreshCallbacks.push(e),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(e,i,s){this._rowCount=s,e=void 0!==e?e:0,i=void 0!==i?i:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,e):e,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,i):i,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return void this._runRefreshCallbacks();let e=Math.max(this._rowStart,0),i=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,i),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let e of this._refreshCallbacks)e(0);this._refreshCallbacks=[]}},s2={},s5={getSafariVersion:()=>rt,isChromeOS:()=>ra,isFirefox:()=>s8,isIpad:()=>rs,isIphone:()=>rr,isLegacyEdge:()=>s7,isLinux:()=>ro,isMac:()=>ri,isNode:()=>s6,isSafari:()=>re,isWindows:()=>rn};for(var s3 in s5)eC(s2,s3,{get:s5[s3],enumerable:!0});var s6="u">typeof ey.default&&"title"in ey.default,s4=s6?"node":navigator.userAgent,s9=s6?"node":navigator.platform,s8=s4.includes("Firefox"),s7=s4.includes("Edge"),re=/^((?!chrome|android).)*safari/i.test(s4);function rt(){if(!re)return 0;let e=s4.match(/Version\/(\d+)/);return null===e||e.length<2?0:parseInt(e[1])}var ri=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(s9),rs="iPad"===s9,rr="iPhone"===s9,rn=["Windows","Win16","Win32","WinCE"].includes(s9),ro=s9.indexOf("Linux")>=0,ra=/\bCrOS\b/.test(s4),rl=class{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let i=0,s=0,r=e.timeRemaining(),n=0;for(;this._i<this._tasks.length;){if(i=performance.now(),this._tasks[this._i]()||this._i++,1.5*(s=Math.max(i=Math.max(1,performance.now()-i),s))>(n=e.timeRemaining())){r-i<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(r-i))}ms`),this._start();return}r=n}this.clear()}},rh=class extends rl{_requestCallback(e){return setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){let i=performance.now()+e;return{timeRemaining:()=>Math.max(0,i-performance.now())}}},rc=class extends rl{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}},rd=!s6&&"requestIdleCallback"in window?rc:rh,ru=class{constructor(){this._queue=new rd}set(e){this._queue.clear(),this._queue.enqueue(e)}flush(){this._queue.flush()}},r_=class extends tu{constructor(e,i,s,r,n,o,a,l,h){super(),this._rowCount=e,this._optionsService=s,this._charSizeService=r,this._coreService=n,this._coreBrowserService=l,this._renderer=this._register(new t_),this._pausedResizeTask=new ru,this._observerDisposable=this._register(new t_),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this._register(new tB),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this._register(new tB),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this._register(new tB),this.onRender=this._onRender.event,this._onRefreshRequest=this._register(new tB),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new s1((e,i)=>this._renderRows(e,i),this._coreBrowserService),this._register(this._renderDebouncer),this._syncOutputHandler=new rf(this._coreBrowserService,this._coreService,()=>this._fullRefresh()),this._register(th(()=>this._syncOutputHandler.dispose())),this._register(this._coreBrowserService.onDprChange(()=>this.handleDevicePixelRatioChange())),this._register(a.onResize(()=>this._fullRefresh())),this._register(a.buffers.onBufferActivate(()=>this._renderer.value?.clear())),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this._register(o.onDecorationRegistered(()=>this._fullRefresh())),this._register(o.onDecorationRemoved(()=>this._fullRefresh())),this._register(this._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(a.cols,a.rows),this._fullRefresh()})),this._register(this._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(a.buffer.y,a.buffer.y,!0))),this._register(h.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(this._coreBrowserService.window,i),this._register(this._coreBrowserService.onWindowChange(e=>this._registerIntersectionObserver(e,i)))}get dimensions(){return this._renderer.value.dimensions}_registerIntersectionObserver(e,i){if("IntersectionObserver"in e){let s=new e.IntersectionObserver(e=>this._handleIntersectionChange(e[e.length-1]),{threshold:0});s.observe(i),this._observerDisposable.value=th(()=>s.disconnect())}}_handleIntersectionChange(e){this._isPaused=void 0===e.isIntersecting?0===e.intersectionRatio:!e.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,i,s=!1){if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput)return void this._syncOutputHandler.bufferRows(e,i);let r=this._syncOutputHandler.flush();r&&(e=Math.min(e,r.start),i=Math.max(i,r.end)),s||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,i,this._rowCount)}_renderRows(e,i){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput)return void this._syncOutputHandler.bufferRows(e,i);e=Math.min(e,this._rowCount-1),i=Math.min(i,this._rowCount-1),this._renderer.value.renderRows(e,i),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:i}),this._onRender.fire({start:e,end:i}),this._isNextRenderRedrawOnly=!0}}resize(e,i){this._rowCount=i,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw(e=>this.refreshRows(e.start,e.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,i){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value?.handleResize(e,i)):this._renderer.value.handleResize(e,i),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(e,i,s){this._selectionState.start=e,this._selectionState.end=i,this._selectionState.columnSelectMode=s,this._renderer.value?.handleSelectionChanged(e,i,s)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};r_=eE([ek(2,eZ),ek(3,e0),ek(4,eK),ek(5,eQ),ek(6,eV),ek(7,e1),ek(8,e4)],r_);var rf=class{constructor(e,i,s){this._coreBrowserService=e,this._coreService=i,this._onTimeout=s,this._start=0,this._end=0,this._isBuffering=!1}bufferRows(e,i){this._isBuffering?(this._start=Math.min(this._start,e),this._end=Math.max(this._end,i)):(this._start=e,this._end=i,this._isBuffering=!0),void 0===this._timeout&&(this._timeout=this._coreBrowserService.window.setTimeout(()=>{this._timeout=void 0,this._coreService.decPrivateModes.synchronizedOutput=!1,this._onTimeout()},1e3))}flush(){if(void 0!==this._timeout&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),!this._isBuffering)return;let e={start:this._start,end:this._end};return this._isBuffering=!1,e}dispose(){void 0!==this._timeout&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}};function rg(e,i,s,r){return rb(Math.abs(e-rp(e,s)-(i-rp(i,s)))-function(e,i,s){let r=0,n=e-rp(e,s),o=i-rp(i,s);for(let a=0;a<Math.abs(n-o);a++){let o="A"===function(e,i){return e>i?"A":"B"}(e,i)?-1:1;s.buffer.lines.get(n+o*a)?.isWrapped&&r++}return r}(e,i,s),rv(e>i?"A":"B",r))}function rp(e,i){let s=0,r=i.buffer.lines.get(e),n=r?.isWrapped;for(;n&&e>=0&&e<i.rows;)s++,r=i.buffer.lines.get(--e),n=r?.isWrapped;return s}function rm(e,i,s,r,n,o){let a=e,l=i,h="";for(;(a!==s||l!==r)&&l>=0&&l<o.buffer.lines.length;)a+=n?1:-1,n&&a>o.cols-1?(h+=o.buffer.translateBufferLineToString(l,!1,e,a),a=0,e=0,l++):!n&&a<0&&(h+=o.buffer.translateBufferLineToString(l,!1,0,e+1),e=a=o.cols-1,l--);return h+o.buffer.translateBufferLineToString(l,!1,e,a)}function rv(e,i){return s_.ESC+(i?"O":"[")+e}function rb(e,i){e=Math.floor(e);let s="";for(let r=0;r<e;r++)s+=i;return s}var rS=class{constructor(e){this._bufferService=e,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?e%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)-1]:[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[e,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let e=this.selectionStart[0]+this.selectionStartLength;return e>this._bufferService.cols?[e%this._bufferService.cols,this.selectionStart[1]+Math.floor(e/this._bufferService.cols)]:[Math.max(e,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let e=this.selectionStart,i=this.selectionEnd;return!!e&&!!i&&(e[1]>i[1]||e[1]===i[1]&&e[0]>i[0])}handleTrim(e){return this.selectionStart&&(this.selectionStart[1]-=e),this.selectionEnd&&(this.selectionEnd[1]-=e),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}};function rw(e,i){if(e.start.y>e.end.y)throw Error(`Buffer range end (${e.end.x}, ${e.end.y}) cannot be before start (${e.start.x}, ${e.start.y})`);return i*(e.end.y-e.start.y)+(e.end.x-e.start.x+1)}var ry=RegExp("","g"),rC=class extends tu{constructor(e,i,s,r,n,o,a,l,h){super(),this._element=e,this._screenElement=i,this._linkifier=s,this._bufferService=r,this._coreService=n,this._mouseService=o,this._optionsService=a,this._renderService=l,this._coreBrowserService=h,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new eF,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this._register(new tB),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this._register(new tB),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this._register(new tB),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this._register(new tB),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=e=>this._handleMouseMove(e),this._mouseUpListener=e=>this._handleMouseUp(e),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(e=>this._handleTrim(e)),this._register(this._bufferService.buffers.onBufferActivate(e=>this._handleBufferActivate(e))),this.enable(),this._model=new rS(this._bufferService),this._activeSelectionMode=0,this._register(th(()=>{this._removeMouseDownListeners()})),this._register(this._bufferService.onResize(e=>{e.rowsChanged&&this.clearSelection()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let e=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;return!!e&&!!i&&(e[0]!==i[0]||e[1]!==i[1])}get selectionText(){let e=this._model.finalSelectionStart,i=this._model.finalSelectionEnd;if(!e||!i)return"";let s=this._bufferService.buffer,r=[];if(3===this._activeSelectionMode){if(e[0]===i[0])return"";let n=e[0]<i[0]?e[0]:i[0],o=e[0]<i[0]?i[0]:e[0];for(let a=e[1];a<=i[1];a++){let e=s.translateBufferLineToString(a,!0,n,o);r.push(e)}}else{let n=e[1]===i[1]?i[0]:void 0;r.push(s.translateBufferLineToString(e[1],!0,e[0],n));for(let n=e[1]+1;n<=i[1]-1;n++){let e=s.lines.get(n),i=s.translateBufferLineToString(n,!0);e?.isWrapped?r[r.length-1]+=i:r.push(i)}if(e[1]!==i[1]){let e=s.lines.get(i[1]),n=s.translateBufferLineToString(i[1],!0,0,i[0]);e&&e.isWrapped?r[r.length-1]+=n:r.push(n)}}return r.map(e=>e.replace(ry," ")).join(rn?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(e){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),ro&&e&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:3===this._activeSelectionMode})}_isClickInSelection(e){let i=this._getMouseBufferCoords(e),s=this._model.finalSelectionStart,r=this._model.finalSelectionEnd;return!!s&&!!r&&!!i&&this._areCoordsInSelection(i,s,r)}isCellInSelection(e,i){let s=this._model.finalSelectionStart,r=this._model.finalSelectionEnd;return!!s&&!!r&&this._areCoordsInSelection([e,i],s,r)}_areCoordsInSelection(e,i,s){return e[1]>i[1]&&e[1]<s[1]||i[1]===s[1]&&e[1]===i[1]&&e[0]>=i[0]&&e[0]<s[0]||i[1]<s[1]&&e[1]===s[1]&&e[0]<s[0]||i[1]<s[1]&&e[1]===i[1]&&e[0]>=i[0]}_selectWordAtCursor(e,i){let s=this._linkifier.currentLink?.link?.range;if(s)return this._model.selectionStart=[s.start.x-1,s.start.y-1],this._model.selectionStartLength=rw(s,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let r=this._getMouseBufferCoords(e);return!!r&&(this._selectWordAt(r,i),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(e,i){this._model.clearSelection(),e=Math.max(e,0),i=Math.min(i,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,e],this._model.selectionEnd=[this._bufferService.cols,i],this.refresh(),this._onSelectionChange.fire()}_handleTrim(e){this._model.handleTrim(e)&&this.refresh()}_getMouseBufferCoords(e){let i=this._mouseService.getCoords(e,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(i)return i[0]--,i[1]--,i[1]+=this._bufferService.buffer.ydisp,i}_getMouseEventScrollAmount(e){let i=sJ(this._coreBrowserService.window,e,this._screenElement)[1],s=this._renderService.dimensions.css.canvas.height;return i>=0&&i<=s?0:(i>s&&(i-=s),(i=Math.min(Math.max(i,-50),50)/50)/Math.abs(i)+Math.round(14*i))}shouldForceSelection(e){return ri?e.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:e.shiftKey}handleMouseDown(e){if(this._mouseDownTimeStamp=e.timeStamp,!(2===e.button&&this.hasSelection)&&0===e.button){if(!this._enabled){if(!this.shouldForceSelection(e))return;e.stopPropagation()}e.preventDefault(),this._dragScrollAmount=0,this._enabled&&e.shiftKey?this._handleIncrementalClick(e):1===e.detail?this._handleSingleClick(e):2===e.detail?this._handleDoubleClick(e):3===e.detail&&this._handleTripleClick(e),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(e){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(e))}_handleSingleClick(e){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=3*!!this.shouldColumnSelect(e),this._model.selectionStart=this._getMouseBufferCoords(e),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let i=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);i&&i.length!==this._model.selectionStart[0]&&0===i.hasWidth(this._model.selectionStart[0])&&this._model.selectionStart[0]++}_handleDoubleClick(e){this._selectWordAtCursor(e,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(e){let i=this._getMouseBufferCoords(e);i&&(this._activeSelectionMode=2,this._selectLineAt(i[1]))}shouldColumnSelect(e){return e.altKey&&!(ri&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(e){if(e.stopImmediatePropagation(),!this._model.selectionStart)return;let i=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(e),!this._model.selectionEnd)return void this.refresh(!0);2===this._activeSelectionMode?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:1===this._activeSelectionMode&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(e),3!==this._activeSelectionMode&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let s=this._bufferService.buffer;if(this._model.selectionEnd[1]<s.lines.length){let e=s.lines.get(this._model.selectionEnd[1]);e&&0===e.hasWidth(this._model.selectionEnd[0])&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}i&&i[0]===this._model.selectionEnd[0]&&i[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let e=this._bufferService.buffer;this._dragScrollAmount>0?(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(e.ydisp+this._bufferService.rows,e.lines.length-1)):(3!==this._activeSelectionMode&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=e.ydisp),this.refresh()}}_handleMouseUp(e){let i=e.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&i<500&&e.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let i=this._mouseService.getCoords(e,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(i&&void 0!==i[0]&&void 0!==i[1]){let e=function(e,i,s,r){var n,o,a,l,h,c,d,u,_,f,g,p,m,v,b,S,w,y;let C,x=s.buffer.x,E=s.buffer.y;if(!s.buffer.hasScrollback){let w,y,C;return n=x,a=0,(0===rg(o=E,i,l=s,h=r).length?"":rb(rm(n,o,n,o-rp(o,l),!1,l).length,rv("D",h)))+rg(E,i,s,r)+(c=x,d=E,u=e,w=rg(d,_=i,f=s,g=r).length>0?_-rp(_,f):d,C=(p=c,m=d,y=rg(v=u,b=_,S=f,g).length>0?b-rp(b,S):m,p<v&&y<=b||p>=v&&y<b?"C":"D"),rb(rm(c,w,u,_,"C"===C,f).length,rv(C,g)))}if(E===i)return C=x>e?"D":"C",rb(Math.abs(x-e),rv(C,r));C=E>i?"D":"C";let k=Math.abs(E-i);return rb((w=E>i?e:x,s.cols-w+(k-1)*s.cols+1+(y=0,(E>i?x:e)-1)),rv(C,r))}(i[0]-1,i[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(e,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let e=this._model.finalSelectionStart,i=this._model.finalSelectionEnd,s=!!e&&!!i&&(e[0]!==i[0]||e[1]!==i[1]);if(!s){this._oldHasSelection&&this._fireOnSelectionChange(e,i,s);return}!e||!i||this._oldSelectionStart&&this._oldSelectionEnd&&e[0]===this._oldSelectionStart[0]&&e[1]===this._oldSelectionStart[1]&&i[0]===this._oldSelectionEnd[0]&&i[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(e,i,s)}_fireOnSelectionChange(e,i,s){this._oldSelectionStart=e,this._oldSelectionEnd=i,this._oldHasSelection=s,this._onSelectionChange.fire()}_handleBufferActivate(e){this.clearSelection(),this._trimListener.dispose(),this._trimListener=e.activeBuffer.lines.onTrim(e=>this._handleTrim(e))}_convertViewportColToCharacterIndex(e,i){let s=i;for(let r=0;i>=r;r++){let n=e.loadCell(r,this._workCell).getChars().length;0===this._workCell.getWidth()?s--:n>1&&i!==r&&(s+=n-1)}return s}setSelection(e,i,s){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[e,i],this._model.selectionStartLength=s,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(e){this._isClickInSelection(e)||(this._selectWordAtCursor(e,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(e,i,s=!0,r=!0){if(e[0]>=this._bufferService.cols)return;let n=this._bufferService.buffer,o=n.lines.get(e[1]);if(!o)return;let a=n.translateBufferLineToString(e[1],!1),l=this._convertViewportColToCharacterIndex(o,e[0]),h=l,c=e[0]-l,d=0,u=0,_=0,f=0;if(" "===a.charAt(l)){for(;l>0&&" "===a.charAt(l-1);)l--;for(;h<a.length&&" "===a.charAt(h+1);)h++}else{let i=e[0],s=e[0];0===o.getWidth(i)&&(d++,i--),2===o.getWidth(s)&&(u++,s++);let r=o.getString(s).length;for(r>1&&(f+=r-1,h+=r-1);i>0&&l>0&&!this._isCharWordSeparator(o.loadCell(i-1,this._workCell));){o.loadCell(i-1,this._workCell);let e=this._workCell.getChars().length;0===this._workCell.getWidth()?(d++,i--):e>1&&(_+=e-1,l-=e-1),l--,i--}for(;s<o.length&&h+1<a.length&&!this._isCharWordSeparator(o.loadCell(s+1,this._workCell));){o.loadCell(s+1,this._workCell);let e=this._workCell.getChars().length;2===this._workCell.getWidth()?(u++,s++):e>1&&(f+=e-1,h+=e-1),h++,s++}}h++;let g=l+c-d+_,p=Math.min(this._bufferService.cols,h-l+d+u-_-f);if(!(!i&&""===a.slice(l,h).trim())){if(s&&0===g&&32!==o.getCodePoint(0)){let i=n.lines.get(e[1]-1);if(i&&o.isWrapped&&32!==i.getCodePoint(this._bufferService.cols-1)){let i=this._getWordAt([this._bufferService.cols-1,e[1]-1],!1,!0,!1);if(i){let e=this._bufferService.cols-i.start;g-=e,p+=e}}}if(r&&g+p===this._bufferService.cols&&32!==o.getCodePoint(this._bufferService.cols-1)){let i=n.lines.get(e[1]+1);if(i?.isWrapped&&32!==i.getCodePoint(0)){let i=this._getWordAt([0,e[1]+1],!1,!1,!0);i&&(p+=i.length)}}return{start:g,length:p}}}_selectWordAt(e,i){let s=this._getWordAt(e,i);if(s){for(;s.start<0;)s.start+=this._bufferService.cols,e[1]--;this._model.selectionStart=[s.start,e[1]],this._model.selectionStartLength=s.length}}_selectToWordAt(e){let i=this._getWordAt(e,!0);if(i){let s=e[1];for(;i.start<0;)i.start+=this._bufferService.cols,s--;if(!this._model.areSelectionValuesReversed())for(;i.start+i.length>this._bufferService.cols;)i.length-=this._bufferService.cols,s++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?i.start:i.start+i.length,s]}}_isCharWordSeparator(e){return 0!==e.getWidth()&&this._optionsService.rawOptions.wordSeparator.indexOf(e.getChars())>=0}_selectLineAt(e){let i=this._bufferService.buffer.getWrappedRangeForLine(e),s={start:{x:0,y:i.first},end:{x:this._bufferService.cols-1,y:i.last}};this._model.selectionStart=[0,i.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=rw(s,this._bufferService.cols)}};rC=eE([ek(3,eV),ek(4,eK),ek(5,e2),ek(6,eZ),ek(7,e5),ek(8,e1)],rC);var rx=class{constructor(){this._data={}}set(e,i,s){this._data[e]||(this._data[e]={}),this._data[e][i]=s}get(e,i){return this._data[e]?this._data[e][i]:void 0}clear(){this._data={}}},rE=class{constructor(){this._color=new rx,this._css=new rx}setCss(e,i,s){this._css.set(e,i,s)}getCss(e,i){return this._css.get(e,i)}setColor(e,i,s){this._color.set(e,i,s)}getColor(e,i){return this._color.get(e,i)}clear(){this._color.clear(),this._css.clear()}},rk=Object.freeze((()=>{let e=[r8.toColor("#2e3436"),r8.toColor("#cc0000"),r8.toColor("#4e9a06"),r8.toColor("#c4a000"),r8.toColor("#3465a4"),r8.toColor("#75507b"),r8.toColor("#06989a"),r8.toColor("#d3d7cf"),r8.toColor("#555753"),r8.toColor("#ef2929"),r8.toColor("#8ae234"),r8.toColor("#fce94f"),r8.toColor("#729fcf"),r8.toColor("#ad7fa8"),r8.toColor("#34e2e2"),r8.toColor("#eeeeec")],i=[0,95,135,175,215,255];for(let s=0;s<216;s++){let r=i[s/36%6|0],n=i[s/6%6|0],o=i[s%6];e.push({css:sp.toCss(r,n,o),rgba:sp.toRgba(r,n,o)})}for(let i=0;i<24;i++){let s=8+10*i;e.push({css:sp.toCss(s,s,s),rgba:sp.toRgba(s,s,s)})}return e})()),rA=r8.toColor("#ffffff"),rR=r8.toColor("#000000"),rL=r8.toColor("#ffffff"),rT={css:"rgba(255, 255, 255, 0.3)",rgba:0xffffff4d},rB=class extends tu{constructor(e){super(),this._optionsService=e,this._contrastCache=new rE,this._halfContrastCache=new rE,this._onChangeColors=this._register(new tB),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:rA,background:rR,cursor:rL,cursorAccent:rR,selectionForeground:void 0,selectionBackgroundTransparent:rT,selectionBackgroundOpaque:r9.blend(rR,rT),selectionInactiveBackgroundTransparent:rT,selectionInactiveBackgroundOpaque:r9.blend(rR,rT),scrollbarSliderBackground:r9.opacity(rA,.2),scrollbarSliderHoverBackground:r9.opacity(rA,.4),scrollbarSliderActiveBackground:r9.opacity(rA,.5),overviewRulerBorder:rA,ansi:rk.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this._register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this._register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(e={}){let i=this._colors;if(i.foreground=rM(e.foreground,rA),i.background=rM(e.background,rR),i.cursor=r9.blend(i.background,rM(e.cursor,rL)),i.cursorAccent=r9.blend(i.background,rM(e.cursorAccent,rR)),i.selectionBackgroundTransparent=rM(e.selectionBackground,rT),i.selectionBackgroundOpaque=r9.blend(i.background,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundTransparent=rM(e.selectionInactiveBackground,i.selectionBackgroundTransparent),i.selectionInactiveBackgroundOpaque=r9.blend(i.background,i.selectionInactiveBackgroundTransparent),i.selectionForeground=e.selectionForeground?rM(e.selectionForeground,sw):void 0,i.selectionForeground===sw&&(i.selectionForeground=void 0),r9.isOpaque(i.selectionBackgroundTransparent)&&(i.selectionBackgroundTransparent=r9.opacity(i.selectionBackgroundTransparent,.3)),r9.isOpaque(i.selectionInactiveBackgroundTransparent)&&(i.selectionInactiveBackgroundTransparent=r9.opacity(i.selectionInactiveBackgroundTransparent,.3)),i.scrollbarSliderBackground=rM(e.scrollbarSliderBackground,r9.opacity(i.foreground,.2)),i.scrollbarSliderHoverBackground=rM(e.scrollbarSliderHoverBackground,r9.opacity(i.foreground,.4)),i.scrollbarSliderActiveBackground=rM(e.scrollbarSliderActiveBackground,r9.opacity(i.foreground,.5)),i.overviewRulerBorder=rM(e.overviewRulerBorder,rA),i.ansi=rk.slice(),i.ansi[0]=rM(e.black,rk[0]),i.ansi[1]=rM(e.red,rk[1]),i.ansi[2]=rM(e.green,rk[2]),i.ansi[3]=rM(e.yellow,rk[3]),i.ansi[4]=rM(e.blue,rk[4]),i.ansi[5]=rM(e.magenta,rk[5]),i.ansi[6]=rM(e.cyan,rk[6]),i.ansi[7]=rM(e.white,rk[7]),i.ansi[8]=rM(e.brightBlack,rk[8]),i.ansi[9]=rM(e.brightRed,rk[9]),i.ansi[10]=rM(e.brightGreen,rk[10]),i.ansi[11]=rM(e.brightYellow,rk[11]),i.ansi[12]=rM(e.brightBlue,rk[12]),i.ansi[13]=rM(e.brightMagenta,rk[13]),i.ansi[14]=rM(e.brightCyan,rk[14]),i.ansi[15]=rM(e.brightWhite,rk[15]),e.extendedAnsi){let s=Math.min(i.ansi.length-16,e.extendedAnsi.length);for(let r=0;r<s;r++)i.ansi[r+16]=rM(e.extendedAnsi[r],rk[r+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(e){this._restoreColor(e),this._onChangeColors.fire(this.colors)}_restoreColor(e){if(void 0===e){for(let e=0;e<this._restoreColors.ansi.length;++e)this._colors.ansi[e]=this._restoreColors.ansi[e];return}switch(e){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[e]=this._restoreColors.ansi[e]}}modifyColors(e){e(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function rM(e,i){if(void 0!==e)try{return r8.toColor(e)}catch{}return i}rB=eE([ek(0,eZ)],rB);var rI=class{constructor(...e){for(let[i,s]of(this._entries=new Map,e))this.set(i,s)}set(e,i){let s=this._entries.get(e);return this._entries.set(e,i),s}forEach(e){for(let[i,s]of this._entries.entries())e(i,s)}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}},rD=class{constructor(){this._services=new rI,this._services.set(eY,this)}setService(e,i){this._services.set(e,i)}getService(e){return this._services.get(e)}createInstance(e,...i){let s=(e[ez]||[]).sort((e,i)=>e.index-i.index),r=[];for(let i of s){let s=this._services.get(i.id);if(!s)throw Error(`[createInstance] ${e.name} depends on UNKNOWN service ${i.id._id}.`);r.push(s)}let n=s.length>0?s[0].index:i.length;if(i.length!==n)throw Error(`[createInstance] First service dependency of ${e.name} at position ${n+1} conflicts with ${i.length} static arguments`);return new e(...i,...r)}},rN={trace:0,debug:1,info:2,warn:3,error:4,off:5},rO=class extends tu{constructor(e){super(),this._optionsService=e,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel()))}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=rN[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let i=0;i<e.length;i++)"function"==typeof e[i]&&(e[i]=e[i]())}_log(e,i,s){this._evalLazyOptionalParams(s),e.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+i,...s)}trace(e,...i){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,e,i)}debug(e,...i){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,e,i)}info(e,...i){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,e,i)}warn(e,...i){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,e,i)}error(e,...i){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,e,i)}};rO=eE([ek(0,eZ)],rO);var rP=class extends tu{constructor(e){super(),this._maxLength=e,this.onDeleteEmitter=this._register(new tB),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this._register(new tB),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this._register(new tB),this.onTrim=this.onTrimEmitter.event,this._array=Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(e){if(this._maxLength===e)return;let i=Array(e);for(let s=0;s<Math.min(e,this.length);s++)i[s]=this._array[this._getCyclicIndex(s)];this._array=i,this._maxLength=e,this._startIndex=0}get length(){return this._length}set length(e){if(e>this._length)for(let i=this._length;i<e;i++)this._array[i]=void 0;this._length=e}get(e){return this._array[this._getCyclicIndex(e)]}set(e,i){this._array[this._getCyclicIndex(e)]=i}push(e){this._array[this._getCyclicIndex(this._length)]=e,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(e,i,...s){if(i){for(let s=e;s<this._length-i;s++)this._array[this._getCyclicIndex(s)]=this._array[this._getCyclicIndex(s+i)];this._length-=i,this.onDeleteEmitter.fire({index:e,amount:i})}for(let i=this._length-1;i>=e;i--)this._array[this._getCyclicIndex(i+s.length)]=this._array[this._getCyclicIndex(i)];for(let i=0;i<s.length;i++)this._array[this._getCyclicIndex(e+i)]=s[i];if(s.length&&this.onInsertEmitter.fire({index:e,amount:s.length}),this._length+s.length>this._maxLength){let e=this._length+s.length-this._maxLength;this._startIndex+=e,this._length=this._maxLength,this.onTrimEmitter.fire(e)}else this._length+=s.length}trimStart(e){e>this._length&&(e=this._length),this._startIndex+=e,this._length-=e,this.onTrimEmitter.fire(e)}shiftElements(e,i,s){if(!(i<=0)){if(e<0||e>=this._length)throw Error("start argument out of range");if(e+s<0)throw Error("Cannot shift elements in list beyond index 0");if(s>0){for(let r=i-1;r>=0;r--)this.set(e+r+s,this.get(e+r));let r=e+i+s-this._length;if(r>0)for(this._length+=r;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let r=0;r<i;r++)this.set(e+r+s,this.get(e+r))}}_getCyclicIndex(e){return(this._startIndex+e)%this._maxLength}},rF=Object.freeze(new eO),rW=0,rz=class e{constructor(e,i,s=!1){this.isWrapped=s,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*e);let r=i||eF.fromCharData([0,"",1,0]);for(let i=0;i<e;++i)this.setCell(i,r);this.length=e}get(e){let i=this._data[3*e+0],s=2097151&i;return[this._data[3*e+1],2097152&i?this._combined[e]:s?eM(s):"",i>>22,2097152&i?this._combined[e].charCodeAt(this._combined[e].length-1):s]}set(e,i){this._data[3*e+1]=i[0],i[1].length>1?(this._combined[e]=i[1],this._data[3*e+0]=2097152|e|i[2]<<22):this._data[3*e+0]=i[1].charCodeAt(0)|i[2]<<22}getWidth(e){return this._data[3*e+0]>>22}hasWidth(e){return 0xc00000&this._data[3*e+0]}getFg(e){return this._data[3*e+1]}getBg(e){return this._data[3*e+2]}hasContent(e){return 4194303&this._data[3*e+0]}getCodePoint(e){let i=this._data[3*e+0];return 2097152&i?this._combined[e].charCodeAt(this._combined[e].length-1):2097151&i}isCombined(e){return 2097152&this._data[3*e+0]}getString(e){let i=this._data[3*e+0];return 2097152&i?this._combined[e]:2097151&i?eM(2097151&i):""}isProtected(e){return 0x20000000&this._data[3*e+2]}loadCell(e,i){return rW=3*e,i.content=this._data[rW+0],i.fg=this._data[rW+1],i.bg=this._data[rW+2],2097152&i.content&&(i.combinedData=this._combined[e]),0x10000000&i.bg&&(i.extended=this._extendedAttrs[e]),i}setCell(e,i){2097152&i.content&&(this._combined[e]=i.combinedData),0x10000000&i.bg&&(this._extendedAttrs[e]=i.extended),this._data[3*e+0]=i.content,this._data[3*e+1]=i.fg,this._data[3*e+2]=i.bg}setCellFromCodepoint(e,i,s,r){0x10000000&r.bg&&(this._extendedAttrs[e]=r.extended),this._data[3*e+0]=i|s<<22,this._data[3*e+1]=r.fg,this._data[3*e+2]=r.bg}addCodepointToCell(e,i,s){let r=this._data[3*e+0];2097152&r?this._combined[e]+=eM(i):2097151&r?(this._combined[e]=eM(2097151&r)+eM(i),r&=-2097152,r|=2097152):r=4194304|i,s&&(r&=-0xc00001,r|=s<<22),this._data[3*e+0]=r}insertCells(e,i,s){if((e%=this.length)&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,s),i<this.length-e){let r=new eF;for(let s=this.length-e-i-1;s>=0;--s)this.setCell(e+i+s,this.loadCell(e+s,r));for(let r=0;r<i;++r)this.setCell(e+r,s)}else for(let i=e;i<this.length;++i)this.setCell(i,s);2===this.getWidth(this.length-1)&&this.setCellFromCodepoint(this.length-1,0,1,s)}deleteCells(e,i,s){if(e%=this.length,i<this.length-e){let r=new eF;for(let s=0;s<this.length-e-i;++s)this.setCell(e+s,this.loadCell(e+i+s,r));for(let e=this.length-i;e<this.length;++e)this.setCell(e,s)}else for(let i=e;i<this.length;++i)this.setCell(i,s);e&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,s),0!==this.getWidth(e)||this.hasContent(e)||this.setCellFromCodepoint(e,0,1,s)}replaceCells(e,i,s,r=!1){if(r){for(e&&2===this.getWidth(e-1)&&!this.isProtected(e-1)&&this.setCellFromCodepoint(e-1,0,1,s),i<this.length&&2===this.getWidth(i-1)&&!this.isProtected(i)&&this.setCellFromCodepoint(i,0,1,s);e<i&&e<this.length;)this.isProtected(e)||this.setCell(e,s),e++;return}for(e&&2===this.getWidth(e-1)&&this.setCellFromCodepoint(e-1,0,1,s),i<this.length&&2===this.getWidth(i-1)&&this.setCellFromCodepoint(i,0,1,s);e<i&&e<this.length;)this.setCell(e++,s)}resize(e,i){if(e===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;let s=3*e;if(e>this.length){if(this._data.buffer.byteLength>=4*s)this._data=new Uint32Array(this._data.buffer,0,s);else{let e=new Uint32Array(s);e.set(this._data),this._data=e}for(let s=this.length;s<e;++s)this.setCell(s,i)}else{this._data=this._data.subarray(0,s);let i=Object.keys(this._combined);for(let s=0;s<i.length;s++){let r=parseInt(i[s],10);r>=e&&delete this._combined[r]}let r=Object.keys(this._extendedAttrs);for(let i=0;i<r.length;i++){let s=parseInt(r[i],10);s>=e&&delete this._extendedAttrs[s]}}return this.length=e,4*s*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){let e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}fill(e,i=!1){if(i){for(let i=0;i<this.length;++i)this.isProtected(i)||this.setCell(i,e);return}this._combined={},this._extendedAttrs={};for(let i=0;i<this.length;++i)this.setCell(i,e)}copyFrom(e){for(let i in this.length!==e.length?this._data=new Uint32Array(e._data):this._data.set(e._data),this.length=e.length,this._combined={},e._combined)this._combined[i]=e._combined[i];for(let i in this._extendedAttrs={},e._extendedAttrs)this._extendedAttrs[i]=e._extendedAttrs[i];this.isWrapped=e.isWrapped}clone(){let i=new e(0);for(let e in i._data=new Uint32Array(this._data),i.length=this.length,this._combined)i._combined[e]=this._combined[e];for(let e in this._extendedAttrs)i._extendedAttrs[e]=this._extendedAttrs[e];return i.isWrapped=this.isWrapped,i}getTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0])return e+(this._data[3*e+0]>>22);return 0}getNoBgTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0]||0x3000000&this._data[3*e+2])return e+(this._data[3*e+0]>>22);return 0}copyCellsFrom(e,i,s,r,n){let o=e._data;if(n)for(let n=r-1;n>=0;n--){for(let e=0;e<3;e++)this._data[(s+n)*3+e]=o[(i+n)*3+e];0x10000000&o[(i+n)*3+2]&&(this._extendedAttrs[s+n]=e._extendedAttrs[i+n])}else for(let n=0;n<r;n++){for(let e=0;e<3;e++)this._data[(s+n)*3+e]=o[(i+n)*3+e];0x10000000&o[(i+n)*3+2]&&(this._extendedAttrs[s+n]=e._extendedAttrs[i+n])}let a=Object.keys(e._combined);for(let r=0;r<a.length;r++){let n=parseInt(a[r],10);n>=i&&(this._combined[n-i+s]=e._combined[n])}}translateToString(e,i,s,r){i=i??0,s=s??this.length,e&&(s=Math.min(s,this.getTrimmedLength())),r&&(r.length=0);let n="";for(;i<s;){let e=this._data[3*i+0],s=2097151&e,o=2097152&e?this._combined[i]:s?eM(s):" ";if(n+=o,r)for(let e=0;e<o.length;++e)r.push(i);i+=e>>22||1}return r&&r.push(i),n}};function rU(e,i,s){if(i===e.length-1)return e[i].getTrimmedLength();let r=!e[i].hasContent(s-1)&&1===e[i].getWidth(s-1),n=2===e[i+1].getWidth(0);return r&&n?s-1:s}var r$=class e{constructor(i){this.line=i,this.isDisposed=!1,this._disposables=[],this._id=e._nextId++,this._onDispose=this.register(new tB),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),tl(this._disposables),this._disposables.length=0)}register(e){return this._disposables.push(e),e}};r$._nextId=1;var rV={},rH=rV.B;rV[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""},rV.A={"#":""},rV.B=void 0,rV[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""},rV.C=rV[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},rV.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},rV.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},rV.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""},rV.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""},rV.E=rV[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},rV.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""},rV.H=rV[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""},rV["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""};var rK=class{constructor(e,i,s){this._hasScrollback=e,this._optionsService=i,this._bufferService=s,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=rF.clone(),this.savedCharset=rH,this.markers=[],this._nullCell=eF.fromCharData([0,"",1,0]),this._whitespaceCell=eF.fromCharData([0," ",1,32]),this._isClearing=!1,this._memoryCleanupQueue=new rd,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new rP(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new eP),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new eP),this._whitespaceCell}getBlankLine(e,i){return new rz(this._bufferService.cols,this.getNullCell(e),i)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;let i=e+this._optionsService.rawOptions.scrollback;return i>0xffffffff?0xffffffff:i}fillViewportRows(e){if(0===this.lines.length){void 0===e&&(e=rF);let i=this._rows;for(;i--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new rP(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,i){let s=this.getNullCell(rF),r=0,n=this._getCorrectBufferLength(i);if(n>this.lines.maxLength&&(this.lines.maxLength=n),this.lines.length>0){if(this._cols<e)for(let i=0;i<this.lines.length;i++)r+=+this.lines.get(i).resize(e,s);let o=0;if(this._rows<i)for(let r=this._rows;r<i;r++)this.lines.length<i+this.ybase&&(this._optionsService.rawOptions.windowsMode||void 0!==this._optionsService.rawOptions.windowsPty.backend||void 0!==this._optionsService.rawOptions.windowsPty.buildNumber?this.lines.push(new rz(e,s)):this.ybase>0&&this.lines.length<=this.ybase+this.y+o+1?(this.ybase--,o++,this.ydisp>0&&this.ydisp--):this.lines.push(new rz(e,s)));else for(let e=this._rows;e>i;e--)this.lines.length>i+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(n<this.lines.maxLength){let e=this.lines.length-n;e>0&&(this.lines.trimStart(e),this.ybase=Math.max(this.ybase-e,0),this.ydisp=Math.max(this.ydisp-e,0),this.savedY=Math.max(this.savedY-e,0)),this.lines.maxLength=n}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,i-1),o&&(this.y+=o),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=i-1,this._isReflowEnabled&&(this._reflow(e,i),this._cols>e))for(let i=0;i<this.lines.length;i++)r+=+this.lines.get(i).resize(e,s);this._cols=e,this._rows=i,this._memoryCleanupQueue.clear(),r>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let i=0;for(;this._memoryCleanupPosition<this.lines.length;)if((i+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory())>100)return!0;return e}get _isReflowEnabled(){let e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&"conpty"===e.backend&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,i){this._cols!==e&&(e>this._cols?this._reflowLarger(e,i):this._reflowSmaller(e,i))}_reflowLarger(e,i){let s=this._optionsService.rawOptions.reflowCursorLine,r=function(e,i,s,r,n,o){let a=[];for(let l=0;l<e.length-1;l++){let h=l,c=e.get(++h);if(!c.isWrapped)continue;let d=[e.get(l)];for(;h<e.length&&c.isWrapped;)d.push(c),c=e.get(++h);if(!o&&r>=l&&r<h){l+=d.length-1;continue}let u=0,_=rU(d,0,i),f=1,g=0;for(;f<d.length;){let e=rU(d,f,i),r=Math.min(e-g,s-_);d[u].copyCellsFrom(d[f],g,_,r,!1),(_+=r)===s&&(u++,_=0),(g+=r)===e&&(f++,g=0),0===_&&0!==u&&2===d[u-1].getWidth(s-1)&&(d[u].copyCellsFrom(d[u-1],s-1,_++,1,!1),d[u-1].setCell(s-1,n))}d[u].replaceCells(_,s,n);let p=0;for(let e=d.length-1;e>0&&(e>u||0===d[e].getTrimmedLength());e--)p++;p>0&&(a.push(l+d.length-p),a.push(p)),l+=d.length-1}return a}(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(rF),s);if(r.length>0){let s=function(e,i){let s=[],r=0,n=i[0],o=0;for(let a=0;a<e.length;a++)if(n===a){let s=i[++r];e.onDeleteEmitter.fire({index:a-o,amount:s}),a+=s-1,o+=s,n=i[++r]}else s.push(a);return{layout:s,countRemoved:o}}(this.lines,r);(function(e,i){let s=[];for(let r=0;r<i.length;r++)s.push(e.get(i[r]));for(let i=0;i<s.length;i++)e.set(i,s[i]);e.length=i.length})(this.lines,s.layout),this._reflowLargerAdjustViewport(e,i,s.countRemoved)}}_reflowLargerAdjustViewport(e,i,s){let r=this.getNullCell(rF),n=s;for(;n-- >0;)0===this.ybase?(this.y>0&&this.y--,this.lines.length<i&&this.lines.push(new rz(e,r))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-s,0)}_reflowSmaller(e,i){let s=this._optionsService.rawOptions.reflowCursorLine,r=this.getNullCell(rF),n=[],o=0;for(let a=this.lines.length-1;a>=0;a--){let l=this.lines.get(a);if(!l||!l.isWrapped&&l.getTrimmedLength()<=e)continue;let h=[l];for(;l.isWrapped&&a>0;)l=this.lines.get(--a),h.unshift(l);if(!s){let e=this.ybase+this.y;if(e>=a&&e<a+h.length)continue}let c=h[h.length-1].getTrimmedLength(),d=function(e,i,s){let r=[],n=e.map((s,r)=>rU(e,r,i)).reduce((e,i)=>e+i),o=0,a=0,l=0;for(;l<n;){if(n-l<s){r.push(n-l);break}o+=s;let h=rU(e,a,i);o>h&&(o-=h,a++);let c=2===e[a].getWidth(o-1);c&&o--;let d=c?s-1:s;r.push(d),l+=d}return r}(h,this._cols,e),u=d.length-h.length,_;_=0===this.ybase&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+u):Math.max(0,this.lines.length-this.lines.maxLength+u);let f=[];for(let e=0;e<u;e++){let e=this.getBlankLine(rF,!0);f.push(e)}f.length>0&&(n.push({start:a+h.length+o,newLines:f}),o+=f.length),h.push(...f);let g=d.length-1,p=d[g];0===p&&(p=d[--g]);let m=h.length-u-1,v=c;for(;m>=0;){let e=Math.min(v,p);if(void 0===h[g])break;h[g].copyCellsFrom(h[m],v-e,p-e,e,!0),0==(p-=e)&&(p=d[--g]),0==(v-=e)&&(v=rU(h,Math.max(--m,0),this._cols))}for(let i=0;i<h.length;i++)d[i]<e&&h[i].setCell(d[i],r);let b=u-_;for(;b-- >0;)0===this.ybase?this.y<i-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+o)-i&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+u,this.ybase+i-1)}if(n.length>0){let e=[],i=[];for(let e=0;e<this.lines.length;e++)i.push(this.lines.get(e));let s=this.lines.length,r=s-1,a=0,l=n[0];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+o);let h=0;for(let c=Math.min(this.lines.maxLength-1,s+o-1);c>=0;c--)if(l&&l.start>r+h){for(let e=l.newLines.length-1;e>=0;e--)this.lines.set(c--,l.newLines[e]);c++,e.push({index:r+1,amount:l.newLines.length}),h+=l.newLines.length,l=n[++a]}else this.lines.set(c,i[r--]);let c=0;for(let i=e.length-1;i>=0;i--)e[i].index+=c,this.lines.onInsertEmitter.fire(e[i]),c+=e[i].amount;let d=Math.max(0,s+o-this.lines.maxLength);d>0&&this.lines.onTrimEmitter.fire(d)}}translateBufferLineToString(e,i,s=0,r){let n=this.lines.get(e);return n?n.translateToString(i,s,r):""}getWrappedRangeForLine(e){let i=e,s=e;for(;i>0&&this.lines.get(i).isWrapped;)i--;for(;s+1<this.lines.length&&this.lines.get(s+1).isWrapped;)s++;return{first:i,last:s}}setupTabStops(e){for(null!=e?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(null==e&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(null==e&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let i=0;i<this.markers.length;i++)this.markers[i].line===e&&(this.markers[i].dispose(),this.markers.splice(i--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose();this.markers.length=0,this._isClearing=!1}addMarker(e){let i=new r$(e);return this.markers.push(i),i.register(this.lines.onTrim(e=>{i.line-=e,i.line<0&&i.dispose()})),i.register(this.lines.onInsert(e=>{i.line>=e.index&&(i.line+=e.amount)})),i.register(this.lines.onDelete(e=>{i.line>=e.index&&i.line<e.index+e.amount&&i.dispose(),i.line>e.index&&(i.line-=e.amount)})),i.register(i.onDispose(()=>this._removeMarker(i))),i}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}},rG=class extends tu{constructor(e,i){super(),this._optionsService=e,this._bufferService=i,this._onBufferActivate=this._register(new tB),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this._register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this._register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new rK(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new rK(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(e){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(e),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(e,i){this._normal.resize(e,i),this._alt.resize(e,i),this.setupTabStops(e)}setupTabStops(e){this._normal.setupTabStops(e),this._alt.setupTabStops(e)}},rY=class extends tu{constructor(e){super(),this.isUserScrolling=!1,this._onResize=this._register(new tB),this.onResize=this._onResize.event,this._onScroll=this._register(new tB),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,2),this.rows=Math.max(e.rawOptions.rows||0,1),this.buffers=this._register(new rG(e,this)),this._register(this.buffers.onBufferActivate(e=>{this._onScroll.fire(e.activeBuffer.ydisp)}))}get buffer(){return this.buffers.active}resize(e,i){let s=this.cols!==e,r=this.rows!==i;this.cols=e,this.rows=i,this.buffers.resize(e,i),this._onResize.fire({cols:e,rows:i,colsChanged:s,rowsChanged:r})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,i=!1){let s=this.buffer,r;(r=this._cachedBlankLine)&&r.length===this.cols&&r.getFg(0)===e.fg&&r.getBg(0)===e.bg||(r=s.getBlankLine(e,i),this._cachedBlankLine=r),r.isWrapped=i;let n=s.ybase+s.scrollTop,o=s.ybase+s.scrollBottom;if(0===s.scrollTop){let e=s.lines.isFull;o===s.lines.length-1?e?s.lines.recycle().copyFrom(r):s.lines.push(r.clone()):s.lines.splice(o+1,0,r.clone()),e?this.isUserScrolling&&(s.ydisp=Math.max(s.ydisp-1,0)):(s.ybase++,this.isUserScrolling||s.ydisp++)}else{let e=o-n+1;s.lines.shiftElements(n+1,e-1,-1),s.lines.set(o,r.clone())}this.isUserScrolling||(s.ydisp=s.ybase),this._onScroll.fire(s.ydisp)}scrollLines(e,i){let s=this.buffer;if(e<0){if(0===s.ydisp)return;this.isUserScrolling=!0}else e+s.ydisp>=s.ybase&&(this.isUserScrolling=!1);let r=s.ydisp;s.ydisp=Math.max(Math.min(s.ydisp+e,s.ybase),0),r!==s.ydisp&&(i||this._onScroll.fire(s.ydisp))}};rY=eE([ek(0,eZ)],rY);var rX={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:ri,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},rZ=["normal","bold","100","200","300","400","500","600","700","800","900"],rj=class extends tu{constructor(e){super(),this._onOptionChange=this._register(new tB),this.onOptionChange=this._onOptionChange.event;let i={...rX};for(let s in e)if(s in i)try{let r=e[s];i[s]=this._sanitizeAndValidateOption(s,r)}catch(e){console.error(e)}this.rawOptions=i,this.options={...i},this._setupOptions(),this._register(th(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(e,i){return this.onOptionChange(s=>{s===e&&i(this.rawOptions[e])})}onMultipleOptionChange(e,i){return this.onOptionChange(s=>{-1!==e.indexOf(s)&&i()})}_setupOptions(){let e=e=>{if(!(e in rX))throw Error(`No option with key "${e}"`);return this.rawOptions[e]},i=(e,i)=>{if(!(e in rX))throw Error(`No option with key "${e}"`);i=this._sanitizeAndValidateOption(e,i),this.rawOptions[e]!==i&&(this.rawOptions[e]=i,this._onOptionChange.fire(e))};for(let s in this.rawOptions){let r={get:e.bind(this,s),set:i.bind(this,s)};Object.defineProperty(this.options,s,r)}}_sanitizeAndValidateOption(e,i){switch(e){case"cursorStyle":var s;if(i||(i=rX[e]),"block"!==(s=i)&&"underline"!==s&&"bar"!==s)throw Error(`"${i}" is not a valid value for ${e}`);break;case"wordSeparator":i||(i=rX[e]);break;case"fontWeight":case"fontWeightBold":if("number"==typeof i&&1<=i&&i<=1e3)break;i=rZ.includes(i)?i:rX[e];break;case"cursorWidth":i=Math.floor(i);case"lineHeight":case"tabStopWidth":if(i<1)throw Error(`${e} cannot be less than 1, value: ${i}`);break;case"minimumContrastRatio":i=Math.max(1,Math.min(21,Math.round(10*i)/10));break;case"scrollback":if((i=Math.min(i,0xffffffff))<0)throw Error(`${e} cannot be less than 0, value: ${i}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(i<=0)throw Error(`${e} cannot be less than or equal to 0, value: ${i}`);break;case"rows":case"cols":if(!i&&0!==i)throw Error(`${e} must be numeric, value: ${i}`);break;case"windowsPty":i=i??{}}return i}};function rq(e,i=5){if("object"!=typeof e)return e;let s=Array.isArray(e)?[]:{};for(let r in e)s[r]=i<=1?e[r]:e[r]&&rq(e[r],i-1);return s}var rQ=Object.freeze({insertMode:!1}),rJ=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),r0=class extends tu{constructor(e,i,s){super(),this._bufferService=e,this._logService=i,this._optionsService=s,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this._register(new tB),this.onData=this._onData.event,this._onUserInput=this._register(new tB),this.onUserInput=this._onUserInput.event,this._onBinary=this._register(new tB),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this._register(new tB),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=rq(rQ),this.decPrivateModes=rq(rJ)}reset(){this.modes=rq(rQ),this.decPrivateModes=rq(rJ)}triggerDataEvent(e,i=!1){if(this._optionsService.rawOptions.disableStdin)return;let s=this._bufferService.buffer;i&&this._optionsService.rawOptions.scrollOnUserInput&&s.ybase!==s.ydisp&&this._onRequestScrollToBottom.fire(),i&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`),this._logService.trace("sending data (codes)",()=>e.split("").map(e=>e.charCodeAt(0))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`),this._logService.trace("sending binary (codes)",()=>e.split("").map(e=>e.charCodeAt(0))),this._onBinary.fire(e))}};r0=eE([ek(0,eV),ek(1,eX),ek(2,eZ)],r0);var r1={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:e=>4!==e.button&&1===e.action&&(e.ctrl=!1,e.alt=!1,e.shift=!1,!0)},VT200:{events:19,restrict:e=>32!==e.action},DRAG:{events:23,restrict:e=>32!==e.action||3!==e.button},ANY:{events:31,restrict:e=>!0}};function r2(e,i){let s=16*!!e.ctrl|4*!!e.shift|8*!!e.alt;return 4===e.button?(s|=64,s|=e.action):(s|=3&e.button,4&e.button&&(s|=64),8&e.button&&(s|=128),32===e.action?s|=32:0!==e.action||i||(s|=3)),s}var r5=String.fromCharCode,r3={DEFAULT:e=>{let i=[r2(e,!1)+32,e.col+32,e.row+32];return i[0]>255||i[1]>255||i[2]>255?"":`\x1b[M${r5(i[0])}${r5(i[1])}${r5(i[2])}`},SGR:e=>{let i=0===e.action&&4!==e.button?"m":"M";return`\x1b[<${r2(e,!0)};${e.col};${e.row}${i}`},SGR_PIXELS:e=>{let i=0===e.action&&4!==e.button?"m":"M";return`\x1b[<${r2(e,!0)};${e.x};${e.y}${i}`}},r6=class extends tu{constructor(e,i,s){for(let r of(super(),this._bufferService=e,this._coreService=i,this._optionsService=s,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._wheelPartialScroll=0,this._onProtocolChange=this._register(new tB),this.onProtocolChange=this._onProtocolChange.event,Object.keys(r1)))this.addProtocol(r,r1[r]);for(let e of Object.keys(r3))this.addEncoding(e,r3[e]);this.reset()}addProtocol(e,i){this._protocols[e]=i}addEncoding(e,i){this._encodings[e]=i}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return 0!==this._protocols[this._activeProtocol].events}set activeProtocol(e){if(!this._protocols[e])throw Error(`unknown protocol "${e}"`);this._activeProtocol=e,this._onProtocolChange.fire(this._protocols[e].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(e){if(!this._encodings[e])throw Error(`unknown encoding "${e}"`);this._activeEncoding=e}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}consumeWheelEvent(e,i,s){if(0===e.deltaY||e.shiftKey||void 0===i||void 0===s)return 0;let r=this._applyScrollModifier(e.deltaY,e);return e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(r/=i/s+0,50>Math.abs(e.deltaY)&&(r*=.3),this._wheelPartialScroll+=r,r=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):e.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(r*=this._bufferService.rows),r}_applyScrollModifier(e,i){return i.altKey||i.ctrlKey||i.shiftKey?e*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:e*this._optionsService.rawOptions.scrollSensitivity}triggerMouseEvent(e){if(e.col<0||e.col>=this._bufferService.cols||e.row<0||e.row>=this._bufferService.rows||4===e.button&&32===e.action||3===e.button&&32!==e.action||4!==e.button&&(2===e.action||3===e.action)||(e.col++,e.row++,32===e.action&&this._lastEvent&&this._equalEvents(this._lastEvent,e,"SGR_PIXELS"===this._activeEncoding))||!this._protocols[this._activeProtocol].restrict(e))return!1;let i=this._encodings[this._activeEncoding](e);return i&&("DEFAULT"===this._activeEncoding?this._coreService.triggerBinaryEvent(i):this._coreService.triggerDataEvent(i,!0)),this._lastEvent=e,!0}explainEvents(e){return{down:!!(1&e),up:!!(2&e),drag:!!(4&e),move:!!(8&e),wheel:!!(16&e)}}_equalEvents(e,i,s){if(s){if(e.x!==i.x||e.y!==i.y)return!1}else if(e.col!==i.col||e.row!==i.row)return!1;return e.button===i.button&&e.action===i.action&&e.ctrl===i.ctrl&&e.alt===i.alt&&e.shift===i.shift}};r6=eE([ek(0,eV),ek(1,eK),ek(2,eZ)],r6);var r4,r9,r8,r7,ne,nt,ni=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],ns=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],nr=class{constructor(){if(this.version="6",!nt){(nt=new Uint8Array(65536)).fill(1),nt[0]=0,nt.fill(0,1,32),nt.fill(0,127,160),nt.fill(2,4352,4448),nt[9001]=2,nt[9002]=2,nt.fill(2,11904,42192),nt[12351]=1,nt.fill(2,44032,55204),nt.fill(2,63744,64256),nt.fill(2,65040,65050),nt.fill(2,65072,65136),nt.fill(2,65280,65377),nt.fill(2,65504,65511);for(let e=0;e<ni.length;++e)nt.fill(0,ni[e][0],ni[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?nt[e]:!function(e,i){let s=0,r=i.length-1,n;if(e<i[0][0]||e>i[r][1])return!1;for(;r>=s;)if(e>i[n=s+r>>1][1])s=n+1;else{if(!(e<i[n][0]))return!0;r=n-1}return!1}(e,ns)?e>=131072&&e<=196605||e>=196608&&e<=262141?2:1:0}charProperties(e,i){let s=this.wcwidth(e),r=0===s&&0!==i;if(r){let e=nn.extractWidth(i);0===e?r=!1:e>s&&(s=e)}return nn.createPropertyValue(0,s,r)}},nn=class e{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new tB,this.onChange=this._onChange.event;let e=new nr;this.register(e),this._active=e.version,this._activeProvider=e}static extractShouldJoin(e){return(1&e)!=0}static extractWidth(e){return e>>1&3}static extractCharKind(e){return e>>3}static createPropertyValue(e,i,s=!1){return(0xffffff&e)<<3|(3&i)<<1|!!s}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(e){if(!this._providers[e])throw Error(`unknown Unicode version "${e}"`);this._active=e,this._activeProvider=this._providers[e],this._onChange.fire(e)}register(e){this._providers[e.version]=e}wcwidth(e){return this._activeProvider.wcwidth(e)}getStringCellWidth(i){let s=0,r=0,n=i.length;for(let o=0;o<n;++o){let a=i.charCodeAt(o);if(55296<=a&&a<=56319){if(++o>=n)return s+this.wcwidth(a);let e=i.charCodeAt(o);56320<=e&&e<=57343?a=(a-55296)*1024+e-56320+65536:s+=this.wcwidth(e)}let l=this.charProperties(a,r),h=e.extractWidth(l);e.extractShouldJoin(l)&&(h-=e.extractWidth(r)),s+=h,r=l}return s}charProperties(e,i){return this._activeProvider.charProperties(e,i)}},no=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(e){this.glevel=e,this.charset=this._charsets[e]}setgCharset(e,i){this._charsets[e]=i,this.glevel===e&&(this.charset=i)}};function na(e){let i=e.buffer.lines.get(e.buffer.ybase+e.buffer.y-1)?.get(e.cols-1),s=e.buffer.lines.get(e.buffer.ybase+e.buffer.y);s&&i&&(s.isWrapped=0!==i[3]&&32!==i[3])}var nl=class e{constructor(e=32,i=32){if(this.maxLength=e,this.maxSubParamsLength=i,i>256)throw Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(e),this.length=0,this._subParams=new Int32Array(i),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(e),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(i){let s=new e;if(!i.length)return s;for(let e=+!!Array.isArray(i[0]);e<i.length;++e){let r=i[e];if(Array.isArray(r))for(let e=0;e<r.length;++e)s.addSubParam(r[e]);else s.addParam(r)}return s}clone(){let i=new e(this.maxLength,this.maxSubParamsLength);return i.params.set(this.params),i.length=this.length,i._subParams.set(this._subParams),i._subParamsLength=this._subParamsLength,i._subParamsIdx.set(this._subParamsIdx),i._rejectDigits=this._rejectDigits,i._rejectSubDigits=this._rejectSubDigits,i._digitIsSub=this._digitIsSub,i}toArray(){let e=[];for(let i=0;i<this.length;++i){e.push(this.params[i]);let s=this._subParamsIdx[i]>>8,r=255&this._subParamsIdx[i];r-s>0&&e.push(Array.prototype.slice.call(this._subParams,s,r))}return e}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(e){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(e<-1)throw Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=e>0x7fffffff?0x7fffffff:e}addSubParam(e){if(this._digitIsSub=!0,this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(e<-1)throw Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=e>0x7fffffff?0x7fffffff:e,this._subParamsIdx[this.length-1]++}}hasSubParams(e){return(255&this._subParamsIdx[e])-(this._subParamsIdx[e]>>8)>0}getSubParams(e){let i=this._subParamsIdx[e]>>8,s=255&this._subParamsIdx[e];return s-i>0?this._subParams.subarray(i,s):null}getSubParamsAll(){let e={};for(let i=0;i<this.length;++i){let s=this._subParamsIdx[i]>>8,r=255&this._subParamsIdx[i];r-s>0&&(e[i]=this._subParams.slice(s,r))}return e}addDigit(e){let i;if(this._rejectDigits||!(i=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let s=this._digitIsSub?this._subParams:this.params,r=s[i-1];s[i-1]=~r?Math.min(10*r+e,0x7fffffff):e}},nh=[],nc=class{constructor(){this._state=0,this._active=nh,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(e,i){void 0===this._handlers[e]&&(this._handlers[e]=[]);let s=this._handlers[e];return s.push(i),{dispose:()=>{let e=s.indexOf(i);-1!==e&&s.splice(e,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=nh}reset(){if(2===this._state)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].end(!1);this._stack.paused=!1,this._active=nh,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||nh,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].start();else this._handlerFb(this._id,"START")}_put(e,i,s){if(this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].put(e,i,s);else this._handlerFb(this._id,"PUT",eI(e,i,s))}start(){this.reset(),this._state=1}put(e,i,s){if(3!==this._state){if(1===this._state)for(;i<s;){let s=e[i++];if(59===s){this._state=2,this._start();break}if(s<48||57<s){this._state=3;return}-1===this._id&&(this._id=0),this._id=10*this._id+s-48}2===this._state&&s-i>0&&this._put(e,i,s)}}end(e,i=!0){if(0!==this._state){if(3!==this._state)if(1===this._state&&this._start(),this._active.length){let s=!1,r=this._active.length-1,n=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,s=i,n=this._stack.fallThrough,this._stack.paused=!1),!n&&!1===s){for(;r>=0&&!0!==(s=this._active[r].end(e));r--)if(s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,s;r--}for(;r>=0;r--)if((s=this._active[r].end(!1))instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,s}else this._handlerFb(this._id,"END",e);this._active=nh,this._id=-1,this._state=0}}},nd=class{constructor(e){this._handler=e,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(e,i,s){this._hitLimit||(this._data+=eI(e,i,s),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}end(e){let i=!1;if(this._hitLimit)i=!1;else if(e&&(i=this._handler(this._data))instanceof Promise)return i.then(e=>(this._data="",this._hitLimit=!1,e));return this._data="",this._hitLimit=!1,i}},nu=[],n_=class{constructor(){this._handlers=Object.create(null),this._active=nu,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=nu}registerHandler(e,i){void 0===this._handlers[e]&&(this._handlers[e]=[]);let s=this._handlers[e];return s.push(i),{dispose:()=>{let e=s.indexOf(i);-1!==e&&s.splice(e,1)}}}clearHandler(e){this._handlers[e]&&delete this._handlers[e]}setHandlerFallback(e){this._handlerFb=e}reset(){if(this._active.length)for(let e=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;e>=0;--e)this._active[e].unhook(!1);this._stack.paused=!1,this._active=nu,this._ident=0}hook(e,i){if(this.reset(),this._ident=e,this._active=this._handlers[e]||nu,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].hook(i);else this._handlerFb(this._ident,"HOOK",i)}put(e,i,s){if(this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].put(e,i,s);else this._handlerFb(this._ident,"PUT",eI(e,i,s))}unhook(e,i=!0){if(this._active.length){let s=!1,r=this._active.length-1,n=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,s=i,n=this._stack.fallThrough,this._stack.paused=!1),!n&&!1===s){for(;r>=0&&!0!==(s=this._active[r].unhook(e));r--)if(s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,s;r--}for(;r>=0;r--)if((s=this._active[r].unhook(!1))instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,s}else this._handlerFb(this._ident,"UNHOOK",e);this._active=nu,this._ident=0}},nf=new nl;nf.addParam(0);var ng=class{constructor(e){this._handler=e,this._data="",this._params=nf,this._hitLimit=!1}hook(e){this._params=e.length>1||e.params[0]?e.clone():nf,this._data="",this._hitLimit=!1}put(e,i,s){this._hitLimit||(this._data+=eI(e,i,s),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}unhook(e){let i=!1;if(this._hitLimit)i=!1;else if(e&&(i=this._handler(this._data,this._params))instanceof Promise)return i.then(e=>(this._params=nf,this._data="",this._hitLimit=!1,e));return this._params=nf,this._data="",this._hitLimit=!1,i}},np=class{constructor(e){this.table=new Uint8Array(e)}setDefault(e,i){this.table.fill(e<<4|i)}add(e,i,s,r){this.table[i<<8|e]=s<<4|r}addMany(e,i,s,r){for(let n=0;n<e.length;n++)this.table[i<<8|e[n]]=s<<4|r}},nm=function(){let e=new np(4095),i=Array.apply(null,Array(256)).map((e,i)=>i),s=(e,s)=>i.slice(e,s),r=s(32,127),n=s(0,24);n.push(25),n.push.apply(n,s(28,32));let o=s(0,14),a;for(a in e.setDefault(1,0),e.addMany(r,0,2,0),o)e.addMany([24,26,153,154],a,3,0),e.addMany(s(128,144),a,3,0),e.addMany(s(144,152),a,3,0),e.add(156,a,0,0),e.add(27,a,11,1),e.add(157,a,4,8),e.addMany([152,158,159],a,0,7),e.add(155,a,11,3),e.add(144,a,11,9);return e.addMany(n,0,3,0),e.addMany(n,1,3,1),e.add(127,1,0,1),e.addMany(n,8,0,8),e.addMany(n,3,3,3),e.add(127,3,0,3),e.addMany(n,4,3,4),e.add(127,4,0,4),e.addMany(n,6,3,6),e.addMany(n,5,3,5),e.add(127,5,0,5),e.addMany(n,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(r,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(s(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(r,7,0,7),e.addMany(n,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(s(64,127),3,7,0),e.addMany(s(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(s(48,60),4,8,4),e.addMany(s(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(s(32,64),6,0,6),e.add(127,6,0,6),e.addMany(s(64,127),6,0,0),e.addMany(s(32,48),3,9,5),e.addMany(s(32,48),5,9,5),e.addMany(s(48,64),5,0,6),e.addMany(s(64,127),5,7,0),e.addMany(s(32,48),4,9,5),e.addMany(s(32,48),1,9,2),e.addMany(s(32,48),2,9,2),e.addMany(s(48,127),2,10,0),e.addMany(s(48,80),1,10,0),e.addMany(s(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(s(96,127),1,10,0),e.add(80,1,11,9),e.addMany(n,9,0,9),e.add(127,9,0,9),e.addMany(s(28,32),9,0,9),e.addMany(s(32,48),9,9,12),e.addMany(s(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(n,11,0,11),e.addMany(s(32,128),11,0,11),e.addMany(s(28,32),11,0,11),e.addMany(n,10,0,10),e.add(127,10,0,10),e.addMany(s(28,32),10,0,10),e.addMany(s(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(s(32,48),10,9,12),e.addMany(n,12,0,12),e.add(127,12,0,12),e.addMany(s(28,32),12,0,12),e.addMany(s(32,48),12,9,12),e.addMany(s(48,64),12,0,11),e.addMany(s(64,127),12,12,13),e.addMany(s(64,127),10,12,13),e.addMany(s(64,127),9,12,13),e.addMany(n,13,13,13),e.addMany(r,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(160,0,2,0),e.add(160,8,5,8),e.add(160,6,0,6),e.add(160,11,0,11),e.add(160,13,13,13),e}(),nv=class extends tu{constructor(e=nm){super(),this._transitions=e,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new nl,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(e,i,s)=>{},this._executeHandlerFb=e=>{},this._csiHandlerFb=(e,i)=>{},this._escHandlerFb=e=>{},this._errorHandlerFb=e=>e,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this._register(th(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this._register(new nc),this._dcsParser=this._register(new n_),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(e,i=[64,126]){let s=0;if(e.prefix){if(e.prefix.length>1)throw Error("only one byte as prefix supported");if((s=e.prefix.charCodeAt(0))&&60>s||s>63)throw Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw Error("only two bytes as intermediates are supported");for(let i=0;i<e.intermediates.length;++i){let r=e.intermediates.charCodeAt(i);if(32>r||r>47)throw Error("intermediate must be in range 0x20 .. 0x2f");s<<=8,s|=r}}if(1!==e.final.length)throw Error("final must be a single byte");let r=e.final.charCodeAt(0);if(i[0]>r||r>i[1])throw Error(`final must be in range ${i[0]} .. ${i[1]}`);return s<<=8,s|=r}identToString(e){let i=[];for(;e;)i.push(String.fromCharCode(255&e)),e>>=8;return i.reverse().join("")}setPrintHandler(e){this._printHandler=e}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(e,i){let s=this._identifier(e,[48,126]);void 0===this._escHandlers[s]&&(this._escHandlers[s]=[]);let r=this._escHandlers[s];return r.push(i),{dispose:()=>{let e=r.indexOf(i);-1!==e&&r.splice(e,1)}}}clearEscHandler(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}setEscHandlerFallback(e){this._escHandlerFb=e}setExecuteHandler(e,i){this._executeHandlers[e.charCodeAt(0)]=i}clearExecuteHandler(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}setExecuteHandlerFallback(e){this._executeHandlerFb=e}registerCsiHandler(e,i){let s=this._identifier(e);void 0===this._csiHandlers[s]&&(this._csiHandlers[s]=[]);let r=this._csiHandlers[s];return r.push(i),{dispose:()=>{let e=r.indexOf(i);-1!==e&&r.splice(e,1)}}}clearCsiHandler(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}setCsiHandlerFallback(e){this._csiHandlerFb=e}registerDcsHandler(e,i){return this._dcsParser.registerHandler(this._identifier(e),i)}clearDcsHandler(e){this._dcsParser.clearHandler(this._identifier(e))}setDcsHandlerFallback(e){this._dcsParser.setHandlerFallback(e)}registerOscHandler(e,i){return this._oscParser.registerHandler(e,i)}clearOscHandler(e){this._oscParser.clearHandler(e)}setOscHandlerFallback(e){this._oscParser.setHandlerFallback(e)}setErrorHandler(e){this._errorHandler=e}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,0!==this._parseStack.state&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(e,i,s,r,n){this._parseStack.state=e,this._parseStack.handlers=i,this._parseStack.handlerPos=s,this._parseStack.transition=r,this._parseStack.chunkPos=n}parse(e,i,s){let r=0,n=0,o=0,a;if(this._parseStack.state)if(2===this._parseStack.state)this._parseStack.state=0,o=this._parseStack.chunkPos+1;else{if(void 0===s||1===this._parseStack.state)throw this._parseStack.state=1,Error("improper continuation due to previous async handler, giving up parsing");let i=this._parseStack.handlers,n=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(!1===s&&n>-1){for(;n>=0&&!0!==(a=i[n](this._params));n--)if(a instanceof Promise)return this._parseStack.handlerPos=n,a}this._parseStack.handlers=[];break;case 4:if(!1===s&&n>-1){for(;n>=0&&!0!==(a=i[n]());n--)if(a instanceof Promise)return this._parseStack.handlerPos=n,a}this._parseStack.handlers=[];break;case 6:if(r=e[this._parseStack.chunkPos],a=this._dcsParser.unhook(24!==r&&26!==r,s))return a;27===r&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(r=e[this._parseStack.chunkPos],a=this._oscParser.end(24!==r&&26!==r,s))return a;27===r&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,o=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let s=o;s<i;++s){switch(r=e[s],(n=this._transitions.table[this.currentState<<8|(r<160?r:160)])>>4){case 2:for(let n=s+1;;++n)if(n>=i||(r=e[n])<32||r>126&&r<160||++n>=i||(r=e[n])<32||r>126&&r<160||++n>=i||(r=e[n])<32||r>126&&r<160||++n>=i||(r=e[n])<32||r>126&&r<160){this._printHandler(e,s,n),s=n-1;break}break;case 3:this._executeHandlers[r]?this._executeHandlers[r]():this._executeHandlerFb(r),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:s,code:r,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let o=this._csiHandlers[this._collect<<8|r],l=o?o.length-1:-1;for(;l>=0&&!0!==(a=o[l](this._params));l--)if(a instanceof Promise)return this._preserveStack(3,o,l,n,s),a;l<0&&this._csiHandlerFb(this._collect<<8|r,this._params),this.precedingJoinState=0;break;case 8:do switch(r){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(r-48)}while(++s<i&&(r=e[s])>47&&r<60)s--;break;case 9:this._collect<<=8,this._collect|=r;break;case 10:let h=this._escHandlers[this._collect<<8|r],c=h?h.length-1:-1;for(;c>=0&&!0!==(a=h[c]());c--)if(a instanceof Promise)return this._preserveStack(4,h,c,n,s),a;c<0&&this._escHandlerFb(this._collect<<8|r),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|r,this._params);break;case 13:for(let n=s+1;;++n)if(n>=i||24===(r=e[n])||26===r||27===r||r>127&&r<160){this._dcsParser.put(e,s,n),s=n-1;break}break;case 14:if(a=this._dcsParser.unhook(24!==r&&26!==r))return this._preserveStack(6,[],0,n,s),a;27===r&&(n|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let n=s+1;;n++)if(n>=i||(r=e[n])<32||r>127&&r<160){this._oscParser.put(e,s,n),s=n-1;break}break;case 6:if(a=this._oscParser.end(24!==r&&26!==r))return this._preserveStack(5,[],0,n,s),a;27===r&&(n|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&n}}},nb=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,nS=/^[\da-f]+$/;function nw(e){if(!e)return;let i=e.toLowerCase();if(0===i.indexOf("rgb:")){i=i.slice(4);let e=nb.exec(i);if(e){let i=e[1]?15:e[4]?255:e[7]?4095:65535;return[Math.round(parseInt(e[1]||e[4]||e[7]||e[10],16)/i*255),Math.round(parseInt(e[2]||e[5]||e[8]||e[11],16)/i*255),Math.round(parseInt(e[3]||e[6]||e[9]||e[12],16)/i*255)]}}else if(0===i.indexOf("#")&&(i=i.slice(1),nS.exec(i)&&[3,6,9,12].includes(i.length))){let e=i.length/3,s=[0,0,0];for(let r=0;r<3;++r){let n=parseInt(i.slice(e*r,e*r+e),16);s[r]=1===e?n<<4:2===e?n:3===e?n>>4:n>>8}return s}}function ny(e,i){let s=e.toString(16),r=s.length<2?"0"+s:s;switch(i){case 4:return s[0];case 8:return r;case 12:return(r+r).slice(0,3);default:return r+r}}var nC={"(":0,")":1,"*":2,"+":3,"-":1,".":2};function nx(e,i){if(e>24)return i.setWinLines||!1;switch(e){case 1:return!!i.restoreWin;case 2:return!!i.minimizeWin;case 3:return!!i.setWinPosition;case 4:return!!i.setWinSizePixels;case 5:return!!i.raiseWin;case 6:return!!i.lowerWin;case 7:return!!i.refreshWin;case 8:return!!i.setWinSizeChars;case 9:return!!i.maximizeWin;case 10:return!!i.fullscreenWin;case 11:return!!i.getWinState;case 13:return!!i.getWinPosition;case 14:return!!i.getWinSizePixels;case 15:return!!i.getScreenSizePixels;case 16:return!!i.getCellSizePixels;case 18:return!!i.getWinSizeChars;case 19:return!!i.getScreenSizeChars;case 20:return!!i.getIconTitle;case 21:return!!i.getWinTitle;case 22:return!!i.pushTitle;case 23:return!!i.popTitle;case 24:return!!i.setWinLines}return!1}var nE=0,nk=class extends tu{constructor(e,i,s,r,n,o,a,l,h=new nv){for(let c in super(),this._bufferService=e,this._charsetService=i,this._coreService=s,this._logService=r,this._optionsService=n,this._oscLinkService=o,this._coreMouseService=a,this._unicodeService=l,this._parser=h,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new eD,this._utf8Decoder=new eN,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=rF.clone(),this._eraseAttrDataInternal=rF.clone(),this._onRequestBell=this._register(new tB),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this._register(new tB),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this._register(new tB),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this._register(new tB),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this._register(new tB),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this._register(new tB),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this._register(new tB),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this._register(new tB),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this._register(new tB),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this._register(new tB),this.onLineFeed=this._onLineFeed.event,this._onScroll=this._register(new tB),this.onScroll=this._onScroll.event,this._onTitleChange=this._register(new tB),this.onTitleChange=this._onTitleChange.event,this._onColor=this._register(new tB),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this._register(this._parser),this._dirtyRowTracker=new nA(this._bufferService),this._activeBuffer=this._bufferService.buffer,this._register(this._bufferService.buffers.onBufferActivate(e=>this._activeBuffer=e.activeBuffer)),this._parser.setCsiHandlerFallback((e,i)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(e),params:i.toArray()})}),this._parser.setEscHandlerFallback(e=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(e)})}),this._parser.setExecuteHandlerFallback(e=>{this._logService.debug("Unknown EXECUTE code: ",{code:e})}),this._parser.setOscHandlerFallback((e,i,s)=>{this._logService.debug("Unknown OSC code: ",{identifier:e,action:i,data:s})}),this._parser.setDcsHandlerFallback((e,i,s)=>{"HOOK"===i&&(s=s.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(e),action:i,payload:s})}),this._parser.setPrintHandler((e,i,s)=>this.print(e,i,s)),this._parser.registerCsiHandler({final:"@"},e=>this.insertChars(e)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},e=>this.scrollLeft(e)),this._parser.registerCsiHandler({final:"A"},e=>this.cursorUp(e)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},e=>this.scrollRight(e)),this._parser.registerCsiHandler({final:"B"},e=>this.cursorDown(e)),this._parser.registerCsiHandler({final:"C"},e=>this.cursorForward(e)),this._parser.registerCsiHandler({final:"D"},e=>this.cursorBackward(e)),this._parser.registerCsiHandler({final:"E"},e=>this.cursorNextLine(e)),this._parser.registerCsiHandler({final:"F"},e=>this.cursorPrecedingLine(e)),this._parser.registerCsiHandler({final:"G"},e=>this.cursorCharAbsolute(e)),this._parser.registerCsiHandler({final:"H"},e=>this.cursorPosition(e)),this._parser.registerCsiHandler({final:"I"},e=>this.cursorForwardTab(e)),this._parser.registerCsiHandler({final:"J"},e=>this.eraseInDisplay(e,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},e=>this.eraseInDisplay(e,!0)),this._parser.registerCsiHandler({final:"K"},e=>this.eraseInLine(e,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},e=>this.eraseInLine(e,!0)),this._parser.registerCsiHandler({final:"L"},e=>this.insertLines(e)),this._parser.registerCsiHandler({final:"M"},e=>this.deleteLines(e)),this._parser.registerCsiHandler({final:"P"},e=>this.deleteChars(e)),this._parser.registerCsiHandler({final:"S"},e=>this.scrollUp(e)),this._parser.registerCsiHandler({final:"T"},e=>this.scrollDown(e)),this._parser.registerCsiHandler({final:"X"},e=>this.eraseChars(e)),this._parser.registerCsiHandler({final:"Z"},e=>this.cursorBackwardTab(e)),this._parser.registerCsiHandler({final:"`"},e=>this.charPosAbsolute(e)),this._parser.registerCsiHandler({final:"a"},e=>this.hPositionRelative(e)),this._parser.registerCsiHandler({final:"b"},e=>this.repeatPrecedingCharacter(e)),this._parser.registerCsiHandler({final:"c"},e=>this.sendDeviceAttributesPrimary(e)),this._parser.registerCsiHandler({prefix:">",final:"c"},e=>this.sendDeviceAttributesSecondary(e)),this._parser.registerCsiHandler({final:"d"},e=>this.linePosAbsolute(e)),this._parser.registerCsiHandler({final:"e"},e=>this.vPositionRelative(e)),this._parser.registerCsiHandler({final:"f"},e=>this.hVPosition(e)),this._parser.registerCsiHandler({final:"g"},e=>this.tabClear(e)),this._parser.registerCsiHandler({final:"h"},e=>this.setMode(e)),this._parser.registerCsiHandler({prefix:"?",final:"h"},e=>this.setModePrivate(e)),this._parser.registerCsiHandler({final:"l"},e=>this.resetMode(e)),this._parser.registerCsiHandler({prefix:"?",final:"l"},e=>this.resetModePrivate(e)),this._parser.registerCsiHandler({final:"m"},e=>this.charAttributes(e)),this._parser.registerCsiHandler({final:"n"},e=>this.deviceStatus(e)),this._parser.registerCsiHandler({prefix:"?",final:"n"},e=>this.deviceStatusPrivate(e)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},e=>this.softReset(e)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},e=>this.setCursorStyle(e)),this._parser.registerCsiHandler({final:"r"},e=>this.setScrollRegion(e)),this._parser.registerCsiHandler({final:"s"},e=>this.saveCursor(e)),this._parser.registerCsiHandler({final:"t"},e=>this.windowOptions(e)),this._parser.registerCsiHandler({final:"u"},e=>this.restoreCursor(e)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},e=>this.insertColumns(e)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},e=>this.deleteColumns(e)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},e=>this.selectProtected(e)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},e=>this.requestMode(e,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},e=>this.requestMode(e,!1)),this._parser.setExecuteHandler(s_.BEL,()=>this.bell()),this._parser.setExecuteHandler(s_.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(s_.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(s_.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(s_.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(s_.BS,()=>this.backspace()),this._parser.setExecuteHandler(s_.HT,()=>this.tab()),this._parser.setExecuteHandler(s_.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(s_.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(sf.IND,()=>this.index()),this._parser.setExecuteHandler(sf.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(sf.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new nd(e=>(this.setTitle(e),this.setIconName(e),!0))),this._parser.registerOscHandler(1,new nd(e=>this.setIconName(e))),this._parser.registerOscHandler(2,new nd(e=>this.setTitle(e))),this._parser.registerOscHandler(4,new nd(e=>this.setOrReportIndexedColor(e))),this._parser.registerOscHandler(8,new nd(e=>this.setHyperlink(e))),this._parser.registerOscHandler(10,new nd(e=>this.setOrReportFgColor(e))),this._parser.registerOscHandler(11,new nd(e=>this.setOrReportBgColor(e))),this._parser.registerOscHandler(12,new nd(e=>this.setOrReportCursorColor(e))),this._parser.registerOscHandler(104,new nd(e=>this.restoreIndexedColor(e))),this._parser.registerOscHandler(110,new nd(e=>this.restoreFgColor(e))),this._parser.registerOscHandler(111,new nd(e=>this.restoreBgColor(e))),this._parser.registerOscHandler(112,new nd(e=>this.restoreCursorColor(e))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset()),rV)this._parser.registerEscHandler({intermediates:"(",final:c},()=>this.selectCharset("("+c)),this._parser.registerEscHandler({intermediates:")",final:c},()=>this.selectCharset(")"+c)),this._parser.registerEscHandler({intermediates:"*",final:c},()=>this.selectCharset("*"+c)),this._parser.registerEscHandler({intermediates:"+",final:c},()=>this.selectCharset("+"+c)),this._parser.registerEscHandler({intermediates:"-",final:c},()=>this.selectCharset("-"+c)),this._parser.registerEscHandler({intermediates:".",final:c},()=>this.selectCharset("."+c)),this._parser.registerEscHandler({intermediates:"/",final:c},()=>this.selectCharset("/"+c));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(e=>(this._logService.error("Parsing error: ",e),e)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new ng((e,i)=>this.requestStatusString(e,i)))}getAttrData(){return this._curAttrData}_preserveStack(e,i,s,r){this._parseStack.paused=!0,this._parseStack.cursorStartX=e,this._parseStack.cursorStartY=i,this._parseStack.decodedLength=s,this._parseStack.position=r}_logSlowResolvingAsync(e){this._logService.logLevel<=3&&Promise.race([e,new Promise((e,i)=>setTimeout(()=>i("#SLOW_TIMEOUT"),5e3))]).catch(e=>{if("#SLOW_TIMEOUT"!==e)throw e;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(e,i){let s,r=this._activeBuffer.x,n=this._activeBuffer.y,o=0,a=this._parseStack.paused;if(a){if(s=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,i))return this._logSlowResolvingAsync(s),s;r=this._parseStack.cursorStartX,n=this._parseStack.cursorStartY,this._parseStack.paused=!1,e.length>131072&&(o=this._parseStack.position+131072)}if(this._logService.logLevel<=1&&this._logService.debug(`parsing data ${"string"==typeof e?` "${e}"`:` "${Array.prototype.map.call(e,e=>String.fromCharCode(e)).join("")}"`}`),0===this._logService.logLevel&&this._logService.trace("parsing data (codes)","string"==typeof e?e.split("").map(e=>e.charCodeAt(0)):e),this._parseBuffer.length<e.length&&this._parseBuffer.length<131072&&(this._parseBuffer=new Uint32Array(Math.min(e.length,131072))),a||this._dirtyRowTracker.clearRange(),e.length>131072)for(let i=o;i<e.length;i+=131072){let o=i+131072<e.length?i+131072:e.length,a="string"==typeof e?this._stringDecoder.decode(e.substring(i,o),this._parseBuffer):this._utf8Decoder.decode(e.subarray(i,o),this._parseBuffer);if(s=this._parser.parse(this._parseBuffer,a))return this._preserveStack(r,n,a,i),this._logSlowResolvingAsync(s),s}else if(!a){let i="string"==typeof e?this._stringDecoder.decode(e,this._parseBuffer):this._utf8Decoder.decode(e,this._parseBuffer);if(s=this._parser.parse(this._parseBuffer,i))return this._preserveStack(r,n,i,0),this._logSlowResolvingAsync(s),s}(this._activeBuffer.x!==r||this._activeBuffer.y!==n)&&this._onCursorMove.fire();let l=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),h=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);h<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(h,this._bufferService.rows-1),end:Math.min(l,this._bufferService.rows-1)})}print(e,i,s){let r,n,o=this._charsetService.charset,a=this._optionsService.rawOptions.screenReaderMode,l=this._bufferService.cols,h=this._coreService.decPrivateModes.wraparound,c=this._coreService.modes.insertMode,d=this._curAttrData,u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&s-i>0&&2===u.getWidth(this._activeBuffer.x-1)&&u.setCellFromCodepoint(this._activeBuffer.x-1,0,1,d);let _=this._parser.precedingJoinState;for(let f=i;f<s;++f){if((r=e[f])<127&&o){let e=o[String.fromCharCode(r)];e&&(r=e.charCodeAt(0))}let i=this._unicodeService.charProperties(r,_);n=nn.extractWidth(i);let s=nn.extractShouldJoin(i),g=s?nn.extractWidth(_):0;if(_=i,a&&this._onA11yChar.fire(eM(r)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+n-g>l){if(h){let e=u,i=this._activeBuffer.x-g;for(this._activeBuffer.x=g,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),u=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),g>0&&u instanceof rz&&u.copyCellsFrom(e,i,0,g,!1);i<l;)e.setCellFromCodepoint(i++,0,1,d)}else if(this._activeBuffer.x=l-1,2===n)continue}if(s&&this._activeBuffer.x){let e=u.getWidth(this._activeBuffer.x-1)?1:2;u.addCodepointToCell(this._activeBuffer.x-e,r,n);for(let e=n-g;--e>=0;)u.setCellFromCodepoint(this._activeBuffer.x++,0,0,d);continue}if(c&&(u.insertCells(this._activeBuffer.x,n-g,this._activeBuffer.getNullCell(d)),2===u.getWidth(l-1)&&u.setCellFromCodepoint(l-1,0,1,d)),u.setCellFromCodepoint(this._activeBuffer.x++,r,n,d),n>0)for(;--n;)u.setCellFromCodepoint(this._activeBuffer.x++,0,0,d)}this._parser.precedingJoinState=_,this._activeBuffer.x<l&&s-i>0&&0===u.getWidth(this._activeBuffer.x)&&!u.hasContent(this._activeBuffer.x)&&u.setCellFromCodepoint(this._activeBuffer.x,0,1,d),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(e,i){return"t"!==e.final||e.prefix||e.intermediates?this._parser.registerCsiHandler(e,i):this._parser.registerCsiHandler(e,e=>!nx(e.params[0],this._optionsService.rawOptions.windowOptions)||i(e))}registerDcsHandler(e,i){return this._parser.registerDcsHandler(e,new ng(i))}registerEscHandler(e,i){return this._parser.registerEscHandler(e,i)}registerOscHandler(e,i){return this._parser.registerOscHandler(e,new nd(i))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(0===this._activeBuffer.x&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let e=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);e.hasWidth(this._activeBuffer.x)&&!e.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let e=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-e),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(e=this._bufferService.cols-1){this._activeBuffer.x=Math.min(e,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(e,i){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=e,this._activeBuffer.y=this._activeBuffer.scrollTop+i):(this._activeBuffer.x=e,this._activeBuffer.y=i),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(e,i){this._restrictCursor(),this._setCursor(this._activeBuffer.x+e,this._activeBuffer.y+i)}cursorUp(e){let i=this._activeBuffer.y-this._activeBuffer.scrollTop;return i>=0?this._moveCursor(0,-Math.min(i,e.params[0]||1)):this._moveCursor(0,-(e.params[0]||1)),!0}cursorDown(e){let i=this._activeBuffer.scrollBottom-this._activeBuffer.y;return i>=0?this._moveCursor(0,Math.min(i,e.params[0]||1)):this._moveCursor(0,e.params[0]||1),!0}cursorForward(e){return this._moveCursor(e.params[0]||1,0),!0}cursorBackward(e){return this._moveCursor(-(e.params[0]||1),0),!0}cursorNextLine(e){return this.cursorDown(e),this._activeBuffer.x=0,!0}cursorPrecedingLine(e){return this.cursorUp(e),this._activeBuffer.x=0,!0}cursorCharAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(e){return this._setCursor(e.length>=2?(e.params[1]||1)-1:0,(e.params[0]||1)-1),!0}charPosAbsolute(e){return this._setCursor((e.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(e){return this._moveCursor(e.params[0]||1,0),!0}linePosAbsolute(e){return this._setCursor(this._activeBuffer.x,(e.params[0]||1)-1),!0}vPositionRelative(e){return this._moveCursor(0,e.params[0]||1),!0}hVPosition(e){return this.cursorPosition(e),!0}tabClear(e){let i=e.params[0];return 0===i?delete this._activeBuffer.tabs[this._activeBuffer.x]:3===i&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let i=e.params[0]||1;for(;i--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(e){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let i=e.params[0]||1;for(;i--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(e){let i=e.params[0];return 1===i&&(this._curAttrData.bg|=0x20000000),(2===i||0===i)&&(this._curAttrData.bg&=-0x20000001),!0}_eraseInBufferLine(e,i,s,r=!1,n=!1){let o=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);o.replaceCells(i,s,this._activeBuffer.getNullCell(this._eraseAttrData()),n),r&&(o.isWrapped=!1)}_resetBufferLine(e,i=!1){let s=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);s&&(s.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),i),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+e),s.isWrapped=!1)}eraseInDisplay(e,i=!1){let s;switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:for(s=this._activeBuffer.y,this._dirtyRowTracker.markDirty(s),this._eraseInBufferLine(s++,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,i);s<this._bufferService.rows;s++)this._resetBufferLine(s,i);this._dirtyRowTracker.markDirty(s);break;case 1:for(s=this._activeBuffer.y,this._dirtyRowTracker.markDirty(s),this._eraseInBufferLine(s,0,this._activeBuffer.x+1,!0,i),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(s+1).isWrapped=!1);s--;)this._resetBufferLine(s,i);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(s=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,s-1);s--&&!this._activeBuffer.lines.get(this._activeBuffer.ybase+s)?.getTrimmedLength(););for(;s>=0;s--)this._bufferService.scroll(this._eraseAttrData())}else{for(s=this._bufferService.rows,this._dirtyRowTracker.markDirty(s-1);s--;)this._resetBufferLine(s,i);this._dirtyRowTracker.markDirty(0)}break;case 3:let r=this._activeBuffer.lines.length-this._bufferService.rows;r>0&&(this._activeBuffer.lines.trimStart(r),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-r,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-r,0),this._onScroll.fire(0))}return!0}eraseInLine(e,i=!1){switch(this._restrictCursor(this._bufferService.cols),e.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,0===this._activeBuffer.x,i);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,i);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,i)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(e){this._restrictCursor();let i=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let s=this._activeBuffer.ybase+this._activeBuffer.y,r=this._bufferService.rows-1-this._activeBuffer.scrollBottom,n=this._bufferService.rows-1+this._activeBuffer.ybase-r+1;for(;i--;)this._activeBuffer.lines.splice(n-1,1),this._activeBuffer.lines.splice(s,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(e){this._restrictCursor();let i=e.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let s=this._activeBuffer.ybase+this._activeBuffer.y,r;for(r=this._bufferService.rows-1-this._activeBuffer.scrollBottom,r=this._bufferService.rows-1+this._activeBuffer.ybase-r;i--;)this._activeBuffer.lines.splice(s,1),this._activeBuffer.lines.splice(r,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(e){this._restrictCursor();let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return i&&(i.insertCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(e){this._restrictCursor();let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return i&&(i.deleteCells(this._activeBuffer.x,e.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(e){let i=e.params[0]||1;for(;i--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(e){let i=e.params[0]||1;for(;i--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(rF));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let i=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){let s=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);s.deleteCells(0,i,this._activeBuffer.getNullCell(this._eraseAttrData())),s.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let i=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){let s=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);s.insertCells(0,i,this._activeBuffer.getNullCell(this._eraseAttrData())),s.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let i=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){let s=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);s.insertCells(this._activeBuffer.x,i,this._activeBuffer.getNullCell(this._eraseAttrData())),s.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(e){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let i=e.params[0]||1;for(let e=this._activeBuffer.scrollTop;e<=this._activeBuffer.scrollBottom;++e){let s=this._activeBuffer.lines.get(this._activeBuffer.ybase+e);s.deleteCells(this._activeBuffer.x,i,this._activeBuffer.getNullCell(this._eraseAttrData())),s.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(e){this._restrictCursor();let i=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return i&&(i.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(e.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(e){let i=this._parser.precedingJoinState;if(!i)return!0;let s=e.params[0]||1,r=nn.extractWidth(i),n=this._activeBuffer.x-r,o=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(n),a=new Uint32Array(o.length*s),l=0;for(let e=0;e<o.length;){let i=o.codePointAt(e)||0;a[l++]=i,e+=i>65535?2:1}let h=l;for(let e=1;e<s;++e)a.copyWithin(h,0,l),h+=l;return this.print(a,0,h),!0}sendDeviceAttributesPrimary(e){return e.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(s_.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(s_.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(e){return e.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(s_.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(s_.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(e.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(s_.ESC+"[>83;40003;0c")),!0}_is(e){return 0===(this._optionsService.rawOptions.termName+"").indexOf(e)}setMode(e){for(let i=0;i<e.length;i++)switch(e.params[i]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(e){for(let i=0;i<e.length;i++)switch(e.params[i]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,rH),this._charsetService.setgCharset(1,rH),this._charsetService.setgCharset(2,rH),this._charsetService.setgCharset(3,rH);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0}return!0}resetMode(e){for(let i=0;i<e.length;i++)switch(e.params[i]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(e){for(let i=0;i<e.length;i++)switch(e.params[i]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),1049===e.params[i]&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0)}return!0}requestMode(e,i){let s,r,n,o;(r=s||={})[r.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",r[r.SET=1]="SET",r[r.RESET=2]="RESET",r[r.PERMANENTLY_SET=3]="PERMANENTLY_SET",r[r.PERMANENTLY_RESET=4]="PERMANENTLY_RESET";let a=this._coreService.decPrivateModes,{activeProtocol:l,activeEncoding:h}=this._coreMouseService,c=this._coreService,{buffers:d,cols:u}=this._bufferService,{active:_,alt:f}=d,g=this._optionsService.rawOptions,p=e=>e?1:2,m=e.params[0];return n=m,o=i?2===m?4:4===m?p(c.modes.insertMode):12===m?3:20===m?p(g.convertEol):0:1===m?p(a.applicationCursorKeys):3===m?g.windowOptions.setWinLines?80===u?2:+(132===u):0:6===m?p(a.origin):7===m?p(a.wraparound):8===m?3:9===m?p("X10"===l):12===m?p(g.cursorBlink):25===m?p(!c.isCursorHidden):45===m?p(a.reverseWraparound):66===m?p(a.applicationKeypad):67===m?4:1e3===m?p("VT200"===l):1002===m?p("DRAG"===l):1003===m?p("ANY"===l):1004===m?p(a.sendFocus):1005===m?4:1006===m?p("SGR"===h):1015===m?4:1016===m?p("SGR_PIXELS"===h):1048===m?1:47===m||1047===m||1049===m?p(_===f):2004===m?p(a.bracketedPasteMode):2026===m?p(a.synchronizedOutput):0,c.triggerDataEvent(`${s_.ESC}[${i?"":"?"}${n};${o}$y`),!0}_updateAttrColor(e,i,s,r,n){return 2===i?(e|=0x3000000,e&=-0x1000000,e|=eO.fromColorRGB([s,r,n])):5===i&&(e&=-0x3000100,e|=0x2000000|255&s),e}_extractColor(e,i,s){let r=[0,0,-1,0,0,0],n=0,o=0;do{if(r[o+n]=e.params[i+o],e.hasSubParams(i+o)){let s=e.getSubParams(i+o),a=0;do 5===r[1]&&(n=1),r[o+a+1+n]=s[a];while(++a<s.length&&a+o+1+n<r.length)break}if(5===r[1]&&o+n>=2||2===r[1]&&o+n>=5)break;r[1]&&(n=1)}while(++o+i<e.length&&o+n<r.length)for(let e=2;e<r.length;++e)-1===r[e]&&(r[e]=0);switch(r[0]){case 38:s.fg=this._updateAttrColor(s.fg,r[1],r[3],r[4],r[5]);break;case 48:s.bg=this._updateAttrColor(s.bg,r[1],r[3],r[4],r[5]);break;case 58:s.extended=s.extended.clone(),s.extended.underlineColor=this._updateAttrColor(s.extended.underlineColor,r[1],r[3],r[4],r[5])}return o}_processUnderline(e,i){i.extended=i.extended.clone(),(!~e||e>5)&&(e=1),i.extended.underlineStyle=e,i.fg|=0x10000000,0===e&&(i.fg&=-0x10000001),i.updateExtended()}_processSGR0(e){e.fg=rF.fg,e.bg=rF.bg,e.extended=e.extended.clone(),e.extended.underlineStyle=0,e.extended.underlineColor&=-0x4000000,e.updateExtended()}charAttributes(e){if(1===e.length&&0===e.params[0])return this._processSGR0(this._curAttrData),!0;let i=e.length,s,r=this._curAttrData;for(let n=0;n<i;n++)(s=e.params[n])>=30&&s<=37?(r.fg&=-0x3000100,r.fg|=0x1000000|s-30):s>=40&&s<=47?(r.bg&=-0x3000100,r.bg|=0x1000000|s-40):s>=90&&s<=97?(r.fg&=-0x3000100,r.fg|=0x1000000|s-90|8):s>=100&&s<=107?(r.bg&=-0x3000100,r.bg|=0x1000000|s-100|8):0===s?this._processSGR0(r):1===s?r.fg|=0x8000000:3===s?r.bg|=0x4000000:4===s?(r.fg|=0x10000000,this._processUnderline(e.hasSubParams(n)?e.getSubParams(n)[0]:1,r)):5===s?r.fg|=0x20000000:7===s?r.fg|=0x4000000:8===s?r.fg|=0x40000000:9===s?r.fg|=0x80000000:2===s?r.bg|=0x8000000:21===s?this._processUnderline(2,r):22===s?(r.fg&=-0x8000001,r.bg&=-0x8000001):23===s?r.bg&=-0x4000001:24===s?(r.fg&=-0x10000001,this._processUnderline(0,r)):25===s?r.fg&=-0x20000001:27===s?r.fg&=-0x4000001:28===s?r.fg&=-0x40000001:29===s?r.fg&=0x7fffffff:39===s?(r.fg&=-0x4000000,r.fg|=0xffffff&rF.fg):49===s?(r.bg&=-0x4000000,r.bg|=0xffffff&rF.bg):38===s||48===s||58===s?n+=this._extractColor(e,n,r):53===s?r.bg|=0x40000000:55===s?r.bg&=-0x40000001:59===s?(r.extended=r.extended.clone(),r.extended.underlineColor=-1,r.updateExtended()):100===s?(r.fg&=-0x4000000,r.fg|=0xffffff&rF.fg,r.bg&=-0x4000000,r.bg|=0xffffff&rF.bg):this._logService.debug("Unknown SGR attribute: %d.",s);return!0}deviceStatus(e){switch(e.params[0]){case 5:this._coreService.triggerDataEvent(`${s_.ESC}[0n`);break;case 6:let i=this._activeBuffer.y+1,s=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${s_.ESC}[${i};${s}R`)}return!0}deviceStatusPrivate(e){if(6===e.params[0]){let e=this._activeBuffer.y+1,i=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${s_.ESC}[?${e};${i}R`)}return!0}softReset(e){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=rF.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(e){let i=0===e.length?1:e.params[0];if(0===i)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(i){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar"}this._coreService.decPrivateModes.cursorBlink=i%2==1}return!0}setScrollRegion(e){let i=e.params[0]||1,s;return(e.length<2||(s=e.params[1])>this._bufferService.rows||0===s)&&(s=this._bufferService.rows),s>i&&(this._activeBuffer.scrollTop=i-1,this._activeBuffer.scrollBottom=s-1,this._setCursor(0,0)),!0}windowOptions(e){if(!nx(e.params[0],this._optionsService.rawOptions.windowOptions))return!0;let i=e.length>1?e.params[1]:0;switch(e.params[0]){case 14:2!==i&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${s_.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:(0===i||2===i)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),(0===i||1===i)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:(0===i||2===i)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(0===i||1===i)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(e){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(e){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(e){return this._windowTitle=e,this._onTitleChange.fire(e),!0}setIconName(e){return this._iconName=e,!0}setOrReportIndexedColor(e){let i=[],s=e.split(";");for(;s.length>1;){let e=s.shift(),r=s.shift();if(/^\d+$/.exec(e)){let s=parseInt(e);if(nR(s))if("?"===r)i.push({type:0,index:s});else{let e=nw(r);e&&i.push({type:1,index:s,color:e})}}}return i.length&&this._onColor.fire(i),!0}setHyperlink(e){let i=e.indexOf(";");if(-1===i)return!0;let s=e.slice(0,i).trim(),r=e.slice(i+1);return r?this._createHyperlink(s,r):!s.trim()&&this._finishHyperlink()}_createHyperlink(e,i){this._getCurrentLinkId()&&this._finishHyperlink();let s=e.split(":"),r,n=s.findIndex(e=>e.startsWith("id="));return -1!==n&&(r=s[n].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:r,uri:i}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(e,i){let s=e.split(";");for(let e=0;e<s.length&&!(i>=this._specialColors.length);++e,++i)if("?"===s[e])this._onColor.fire([{type:0,index:this._specialColors[i]}]);else{let r=nw(s[e]);r&&this._onColor.fire([{type:1,index:this._specialColors[i],color:r}])}return!0}setOrReportFgColor(e){return this._setOrReportSpecialColor(e,0)}setOrReportBgColor(e){return this._setOrReportSpecialColor(e,1)}setOrReportCursorColor(e){return this._setOrReportSpecialColor(e,2)}restoreIndexedColor(e){if(!e)return this._onColor.fire([{type:2}]),!0;let i=[],s=e.split(";");for(let e=0;e<s.length;++e)if(/^\d+$/.exec(s[e])){let r=parseInt(s[e]);nR(r)&&i.push({type:2,index:r})}return i.length&&this._onColor.fire(i),!0}restoreFgColor(e){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(e){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(e){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,rH),!0}selectCharset(e){return 2!==e.length?this.selectDefaultCharset():"/"===e[0]||this._charsetService.setgCharset(nC[e[0]],rV[e[1]]||rH),!0}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let e=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,e,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=rF.clone(),this._eraseAttrDataInternal=rF.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-0x4000000,this._eraseAttrDataInternal.bg|=0x3ffffff&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(e){return this._charsetService.setgLevel(e),!0}screenAlignmentPattern(){let e=new eF;e.content=4194373,e.fg=this._curAttrData.fg,e.bg=this._curAttrData.bg,this._setCursor(0,0);for(let i=0;i<this._bufferService.rows;++i){let s=this._activeBuffer.ybase+this._activeBuffer.y+i,r=this._activeBuffer.lines.get(s);r&&(r.fill(e),r.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(e,i){let s=e=>(this._coreService.triggerDataEvent(`${s_.ESC}${e}${s_.ESC}\\`),!0),r=this._bufferService.buffer,n=this._optionsService.rawOptions;return s('"q'===e?`P1$r${+!!this._curAttrData.isProtected()}"q`:'"p'===e?'P1$r61;1"p':"r"===e?`P1$r${r.scrollTop+1};${r.scrollBottom+1}r`:"m"===e?"P1$r0m":" q"===e?`P1$r${({block:2,underline:4,bar:6})[n.cursorStyle]-!!n.cursorBlink} q`:"P0$r")}markRangeDirty(e,i){this._dirtyRowTracker.markRangeDirty(e,i)}},nA=class{constructor(e){this._bufferService=e,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(e){e<this.start?this.start=e:e>this.end&&(this.end=e)}markRangeDirty(e,i){e>i&&(nE=e,e=i,i=nE),e<this.start&&(this.start=e),i>this.end&&(this.end=i)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function nR(e){return 0<=e&&e<256}nA=eE([ek(0,eV)],nA);var nL=class extends tu{constructor(e){super(),this._action=e,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this._register(new tB),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(e,i){let s;if(void 0!==i&&this._syncCalls>i){this._syncCalls=0;return}if(this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(void 0),this._syncCalls++,!this._isSyncWriting){for(this._isSyncWriting=!0;s=this._writeBuffer.shift();){this._action(s);let e=this._callbacks.shift();e&&e()}this._pendingData=0,this._bufferOffset=0x7fffffff,this._isSyncWriting=!1,this._syncCalls=0}}write(e,i){if(this._pendingData>5e7)throw Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(i),this._innerWrite();return}setTimeout(()=>this._innerWrite())}this._pendingData+=e.length,this._writeBuffer.push(e),this._callbacks.push(i)}_innerWrite(e=0,i=!0){let s=e||performance.now();for(;this._writeBuffer.length>this._bufferOffset;){let e=this._writeBuffer[this._bufferOffset],r=this._action(e,i);if(r){let e=e=>performance.now()-s>=12?setTimeout(()=>this._innerWrite(0,e)):this._innerWrite(s,e);r.catch(e=>(queueMicrotask(()=>{throw e}),Promise.resolve(!1))).then(e);return}let n=this._callbacks[this._bufferOffset];if(n&&n(),this._bufferOffset++,this._pendingData-=e.length,performance.now()-s>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}},nT=class{constructor(e){this._bufferService=e,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(e){let i=this._bufferService.buffer;if(void 0===e.id){let s=i.addMarker(i.ybase+i.y),r={data:e,id:this._nextId++,lines:[s]};return s.onDispose(()=>this._removeMarkerFromLink(r,s)),this._dataByLinkId.set(r.id,r),r.id}let s=this._getEntryIdKey(e),r=this._entriesWithId.get(s);if(r)return this.addLineToLink(r.id,i.ybase+i.y),r.id;let n=i.addMarker(i.ybase+i.y),o={id:this._nextId++,key:this._getEntryIdKey(e),data:e,lines:[n]};return n.onDispose(()=>this._removeMarkerFromLink(o,n)),this._entriesWithId.set(o.key,o),this._dataByLinkId.set(o.id,o),o.id}addLineToLink(e,i){let s=this._dataByLinkId.get(e);if(s&&s.lines.every(e=>e.line!==i)){let e=this._bufferService.buffer.addMarker(i);s.lines.push(e),e.onDispose(()=>this._removeMarkerFromLink(s,e))}}getLinkData(e){return this._dataByLinkId.get(e)?.data}_getEntryIdKey(e){return`${e.id};;${e.uri}`}_removeMarkerFromLink(e,i){let s=e.lines.indexOf(i);-1!==s&&(e.lines.splice(s,1),0===e.lines.length&&(void 0!==e.data.id&&this._entriesWithId.delete(e.key),this._dataByLinkId.delete(e.id)))}};nT=eE([ek(0,eV)],nT);var nB=!1,nM=class extends tu{constructor(e){super(),this._windowsWrappingHeuristics=this._register(new t_),this._onBinary=this._register(new tB),this.onBinary=this._onBinary.event,this._onData=this._register(new tB),this.onData=this._onData.event,this._onLineFeed=this._register(new tB),this.onLineFeed=this._onLineFeed.event,this._onResize=this._register(new tB),this.onResize=this._onResize.event,this._onWriteParsed=this._register(new tB),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this._register(new tB),this._instantiationService=new rD,this.optionsService=this._register(new rj(e)),this._instantiationService.setService(eZ,this.optionsService),this._bufferService=this._register(this._instantiationService.createInstance(rY)),this._instantiationService.setService(eV,this._bufferService),this._logService=this._register(this._instantiationService.createInstance(rO)),this._instantiationService.setService(eX,this._logService),this.coreService=this._register(this._instantiationService.createInstance(r0)),this._instantiationService.setService(eK,this.coreService),this.coreMouseService=this._register(this._instantiationService.createInstance(r6)),this._instantiationService.setService(eH,this.coreMouseService),this.unicodeService=this._register(this._instantiationService.createInstance(nn)),this._instantiationService.setService(eq,this.unicodeService),this._charsetService=this._instantiationService.createInstance(no),this._instantiationService.setService(eG,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(nT),this._instantiationService.setService(ej,this._oscLinkService),this._inputHandler=this._register(new nk(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this._register(tx.forward(this._inputHandler.onLineFeed,this._onLineFeed)),this._register(this._inputHandler),this._register(tx.forward(this._bufferService.onResize,this._onResize)),this._register(tx.forward(this.coreService.onData,this._onData)),this._register(tx.forward(this.coreService.onBinary,this._onBinary)),this._register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom(!0))),this._register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this._register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this._register(this._bufferService.onScroll(()=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this._register(new nL((e,i)=>this._inputHandler.parse(e,i))),this._register(tx.forward(this._writeBuffer.onWriteParsed,this._onWriteParsed))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this._register(new tB),this._onScroll.event(e=>{this._onScrollApi?.fire(e.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(e){for(let i in e)this.optionsService.options[i]=e[i]}write(e,i){this._writeBuffer.write(e,i)}writeSync(e,i){this._logService.logLevel<=3&&!nB&&(this._logService.warn("writeSync is unreliable and will be removed soon."),nB=!0),this._writeBuffer.writeSync(e,i)}input(e,i=!0){this.coreService.triggerDataEvent(e,i)}resize(e,i){isNaN(e)||isNaN(i)||(e=Math.max(e,2),i=Math.max(i,1),this._bufferService.resize(e,i))}scroll(e,i=!1){this._bufferService.scroll(e,i)}scrollLines(e,i){this._bufferService.scrollLines(e,i)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(e){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){let i=e-this._bufferService.buffer.ydisp;0!==i&&this.scrollLines(i)}registerEscHandler(e,i){return this._inputHandler.registerEscHandler(e,i)}registerDcsHandler(e,i){return this._inputHandler.registerDcsHandler(e,i)}registerCsiHandler(e,i){return this._inputHandler.registerCsiHandler(e,i)}registerOscHandler(e,i){return this._inputHandler.registerOscHandler(e,i)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let e=!1,i=this.optionsService.rawOptions.windowsPty;i&&void 0!==i.buildNumber&&void 0!==i.buildNumber?e="conpty"===i.backend&&i.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(e=!0),e?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let e=[];e.push(this.onLineFeed(na.bind(null,this._bufferService))),e.push(this.registerCsiHandler({final:"H"},()=>(na(this._bufferService),!1))),this._windowsWrappingHeuristics.value=th(()=>{for(let i of e)i.dispose()})}}},nI={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']},nD=0,nN=class{constructor(e){this._getKey=e,this._array=[],this._insertedValues=[],this._flushInsertedTask=new rd,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new rd,this._isFlushingDeleted=!1}clear(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}insert(e){this._flushCleanupDeleted(),0===this._insertedValues.length&&this._flushInsertedTask.enqueue(()=>this._flushInserted()),this._insertedValues.push(e)}_flushInserted(){let e=this._insertedValues.sort((e,i)=>this._getKey(e)-this._getKey(i)),i=0,s=0,r=Array(this._array.length+this._insertedValues.length);for(let n=0;n<r.length;n++)s>=this._array.length||this._getKey(e[i])<=this._getKey(this._array[s])?(r[n]=e[i],i++):r[n]=this._array[s++];this._array=r,this._insertedValues.length=0}_flushCleanupInserted(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}delete(e){if(this._flushCleanupInserted(),0===this._array.length)return!1;let i=this._getKey(e);if(void 0===i||-1===(nD=this._search(i))||this._getKey(this._array[nD])!==i)return!1;do if(this._array[nD]===e)return 0===this._deletedIndices.length&&this._flushDeletedTask.enqueue(()=>this._flushDeleted()),this._deletedIndices.push(nD),!0;while(++nD<this._array.length&&this._getKey(this._array[nD])===i)return!1}_flushDeleted(){this._isFlushingDeleted=!0;let e=this._deletedIndices.sort((e,i)=>e-i),i=0,s=Array(this._array.length-e.length),r=0;for(let n=0;n<this._array.length;n++)e[i]===n?i++:s[r++]=this._array[n];this._array=s,this._deletedIndices.length=0,this._isFlushingDeleted=!1}_flushCleanupDeleted(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}*getKeyIterator(e){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),0!==this._array.length&&!((nD=this._search(e))<0||nD>=this._array.length)&&this._getKey(this._array[nD])===e)do yield this._array[nD];while(++nD<this._array.length&&this._getKey(this._array[nD])===e)}forEachByKey(e,i){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),0!==this._array.length&&!((nD=this._search(e))<0||nD>=this._array.length)&&this._getKey(this._array[nD])===e)do i(this._array[nD]);while(++nD<this._array.length&&this._getKey(this._array[nD])===e)}values(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),[...this._array].values()}_search(e){let i=0,s=this._array.length-1;for(;s>=i;){let r=i+s>>1,n=this._getKey(this._array[r]);if(n>e)s=r-1;else if(n<e)i=r+1;else{for(;r>0&&this._getKey(this._array[r-1])===e;)r--;return r}}return i}},nO=0,nP=0,nF=class extends tu{constructor(){super(),this._decorations=new nN(e=>e?.marker.line),this._onDecorationRegistered=this._register(new tB),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this._register(new tB),this.onDecorationRemoved=this._onDecorationRemoved.event,this._register(th(()=>this.reset()))}get decorations(){return this._decorations.values()}registerDecoration(e){if(e.marker.isDisposed)return;let i=new nW(e);if(i){let e=i.marker.onDispose(()=>i.dispose()),s=i.onDispose(()=>{s.dispose(),i&&(this._decorations.delete(i)&&this._onDecorationRemoved.fire(i),e.dispose())});this._decorations.insert(i),this._onDecorationRegistered.fire(i)}return i}reset(){for(let e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,i,s){let r=0,n=0;for(let o of this._decorations.getKeyIterator(i))n=(r=o.options.x??0)+(o.options.width??1),e>=r&&e<n&&(!s||(o.options.layer??"bottom")===s)&&(yield o)}forEachDecorationAtCell(e,i,s,r){this._decorations.forEachByKey(i,i=>{nP=(nO=i.options.x??0)+(i.options.width??1),e>=nO&&e<nP&&(!s||(i.options.layer??"bottom")===s)&&r(i)})}},nW=class extends td{constructor(e){super(),this.options=e,this.onRenderEmitter=this.add(new tB),this.onRender=this.onRenderEmitter.event,this._onDispose=this.add(new tB),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return null===this._cachedBg&&(this.options.backgroundColor?this._cachedBg=r8.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return null===this._cachedFg&&(this.options.foregroundColor?this._cachedFg=r8.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}},nz=class{constructor(e,i=1e3){this._renderCallback=e,this._debounceThresholdMS=i,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(e,i,s){this._rowCount=s,e=void 0!==e?e:0,i=void 0!==i?i:this._rowCount-1,this._rowStart=void 0!==this._rowStart?Math.min(this._rowStart,e):e,this._rowEnd=void 0!==this._rowEnd?Math.max(this._rowEnd,i):i;let r=performance.now();if(r-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=r,this._innerRefresh();else if(!this._additionalRefreshRequested){let e=r-this._lastRefreshMs,i=this._debounceThresholdMS-e;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=performance.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},i)}}_innerRefresh(){if(void 0===this._rowStart||void 0===this._rowEnd||void 0===this._rowCount)return;let e=Math.max(this._rowStart,0),i=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(e,i)}},nU=class extends tu{constructor(e,i,s,r){super(),this._terminal=e,this._coreBrowserService=s,this._renderService=r,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="";let n=this._coreBrowserService.mainDocument;this._accessibilityContainer=n.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=n.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let e=0;e<this._terminal.rows;e++)this._rowElements[e]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[e]);if(this._topBoundaryFocusListener=e=>this._handleBoundaryFocus(e,0),this._bottomBoundaryFocusListener=e=>this._handleBoundaryFocus(e,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=n.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this._register(new nz(this._renderRows.bind(this))),!this._terminal.element)throw Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this._register(this._terminal.onResize(e=>this._handleResize(e.rows))),this._register(this._terminal.onRender(e=>this._refreshRows(e.start,e.end))),this._register(this._terminal.onScroll(()=>this._refreshRows())),this._register(this._terminal.onA11yChar(e=>this._handleChar(e))),this._register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this._register(this._terminal.onA11yTab(e=>this._handleTab(e))),this._register(this._terminal.onKey(e=>this._handleKey(e.key))),this._register(this._terminal.onBlur(()=>this._clearLiveRegion())),this._register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._register(iP(n,"selectionchange",()=>this._handleSelectionChange())),this._register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRowsDimensions(),this._refreshRows(),this._register(th(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(e){for(let i=0;i<e;i++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,e===`
`&&(this._liveRegionLineCount++,21===this._liveRegionLineCount&&(this._liveRegion.textContent+=eR)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),/\p{Control}/u.test(e)||this._charsToConsume.push(e)}_refreshRows(e,i){this._liveRegionDebouncer.refresh(e,i,this._terminal.rows)}_renderRows(e,i){let s=this._terminal.buffer,r=s.lines.length.toString();for(let n=e;n<=i;n++){let e=s.lines.get(s.ydisp+n),i=[],o=e?.translateToString(!0,void 0,void 0,i)||"",a=(s.ydisp+n+1).toString(),l=this._rowElements[n];l&&(0===o.length?(l.textContent="",this._rowColumns.set(l,[0,1])):(l.textContent=o,this._rowColumns.set(l,i)),l.setAttribute("aria-posinset",a),l.setAttribute("aria-setsize",r),this._alignRowWidth(l))}this._announceCharacters()}_announceCharacters(){0!==this._charsToAnnounce.length&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,i){let s,r,n=e.target,o=this._rowElements[0===i?1:this._rowElements.length-2];if(n.getAttribute("aria-posinset")!==(0===i?"1":`${this._terminal.buffer.lines.length}`)&&e.relatedTarget===o){if(0===i?(s=n,r=this._rowElements.pop(),this._rowContainer.removeChild(r)):(s=this._rowElements.shift(),r=n,this._rowContainer.removeChild(s)),s.removeEventListener("focus",this._topBoundaryFocusListener),r.removeEventListener("focus",this._bottomBoundaryFocusListener),0===i){let e=this._createAccessibilityTreeNode();this._rowElements.unshift(e),this._rowContainer.insertAdjacentElement("afterbegin",e)}else{let e=this._createAccessibilityTreeNode();this._rowElements.push(e),this._rowContainer.appendChild(e)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(0===i?-1:1),this._rowElements[0===i?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}}_handleSelectionChange(){if(0===this._rowElements.length)return;let e=this._coreBrowserService.mainDocument.getSelection();if(!e)return;if(e.isCollapsed){this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection();return}if(!e.anchorNode||!e.focusNode)return void console.error("anchorNode and/or focusNode are null");let i={node:e.anchorNode,offset:e.anchorOffset},s={node:e.focusNode,offset:e.focusOffset};if((i.node.compareDocumentPosition(s.node)&Node.DOCUMENT_POSITION_PRECEDING||i.node===s.node&&i.offset>s.offset)&&([i,s]=[s,i]),i.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(i={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(i.node))return;let r=this._rowElements.slice(-1)[0];if(s.node.compareDocumentPosition(r)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(s={node:r,offset:r.textContent?.length??0}),!this._rowContainer.contains(s.node))return;let n=({node:e,offset:i})=>{let s=e instanceof Text?e.parentNode:e,r=parseInt(s?.getAttribute("aria-posinset"),10)-1;if(isNaN(r))return console.warn("row is invalid. Race condition?"),null;let n=this._rowColumns.get(s);if(!n)return console.warn("columns is null. Race condition?"),null;let o=i<n.length?n[i]:n.slice(-1)[0]+1;return o>=this._terminal.cols&&(++r,o=0),{row:r,column:o}},o=n(i),a=n(s);if(!(!o||!a)){if(o.row>a.row||o.row===a.row&&o.column>=a.column)throw Error("invalid range");this._terminal.select(o.column,o.row,(a.row-o.row)*this._terminal.cols-o.column+a.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let e=this._rowContainer.children.length;e<this._terminal.rows;e++)this._rowElements[e]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[e]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:`${this._renderService.dimensions.css.canvas.width}px`,fontSize:`${this._terminal.options.fontSize}px`}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e]),this._alignRowWidth(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}_alignRowWidth(e){e.style.transform="";let i=e.getBoundingClientRect().width,s=this._rowColumns.get(e)?.slice(-1)?.[0];if(!s)return;let r=s*this._renderService.dimensions.css.cell.width;e.style.transform=`scaleX(${r/i})`}};nU=eE([ek(1,eY),ek(2,e1),ek(3,e5)],nU);var n$=class extends tu{constructor(e,i,s,r,n){super(),this._element=e,this._mouseService=i,this._renderService=s,this._bufferService=r,this._linkProviderService=n,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this._register(new tB),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this._register(new tB),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this._register(th(()=>{tl(this._linkCacheDisposables),this._linkCacheDisposables.length=0,this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()})),this._register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this._register(iP(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this._register(iP(this._element,"mousemove",this._handleMouseMove.bind(this))),this._register(iP(this._element,"mousedown",this._handleMouseDown.bind(this))),this._register(iP(this._element,"mouseup",this._handleMouseUp.bind(this)))}get currentLink(){return this._currentLink}_handleMouseMove(e){this._lastMouseEvent=e;let i=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!i)return;this._isMouseOut=!1;let s=e.composedPath();for(let e=0;e<s.length;e++){let i=s[e];if(i.classList.contains("xterm"))break;if(i.classList.contains("xterm-hover"))return}this._lastBufferCell&&i.x===this._lastBufferCell.x&&i.y===this._lastBufferCell.y||(this._handleHover(i),this._lastBufferCell=i)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized){this._clearCurrentLink(),this._askForLink(e,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,i){this._activeProviderReplies&&i||(this._activeProviderReplies?.forEach(e=>{e?.forEach(e=>{e.link.dispose&&e.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);let s=!1;for(let[r,n]of this._linkProviderService.linkProviders.entries())i?this._activeProviderReplies?.get(r)&&(s=this._checkLinkProviderResult(r,e,s)):n.provideLinks(e.y,i=>{if(this._isMouseOut)return;let n=i?.map(e=>({link:e}));this._activeProviderReplies?.set(r,n),s=this._checkLinkProviderResult(r,e,s),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,i){let s=new Set;for(let r=0;r<i.size;r++){let n=i.get(r);if(n)for(let i=0;i<n.length;i++){let r=n[i],o=r.link.range.start.y<e?0:r.link.range.start.x,a=r.link.range.end.y>e?this._bufferService.cols:r.link.range.end.x;for(let e=o;e<=a;e++){if(s.has(e)){n.splice(i--,1);break}s.add(e)}}}}_checkLinkProviderResult(e,i,s){if(!this._activeProviderReplies)return s;let r=this._activeProviderReplies.get(e),n=!1;for(let i=0;i<e;i++)(!this._activeProviderReplies.has(i)||this._activeProviderReplies.get(i))&&(n=!0);if(!n&&r){let e=r.find(e=>this._linkAtPosition(e.link,i));e&&(s=!0,this._handleNewLink(e))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!s)for(let e=0;e<this._activeProviderReplies.size;e++){let r=this._activeProviderReplies.get(e)?.find(e=>this._linkAtPosition(e.link,i));if(r){s=!0,this._handleNewLink(r);break}}return s}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){var i,s;if(!this._currentLink)return;let r=this._positionFromMouseEvent(e,this._element,this._mouseService);r&&this._mouseDownLink&&(i=this._mouseDownLink.link,s=this._currentLink.link,i.text===s.text&&i.range.start.x===s.range.start.x&&i.range.start.y===s.range.start.y&&i.range.end.x===s.range.end.x&&i.range.end.y===s.range.end.y)&&this._linkAtPosition(this._currentLink.link,r)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,i){this._currentLink&&this._lastMouseEvent&&(!e||!i||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=i)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,tl(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}_handleNewLink(e){if(!this._lastMouseEvent)return;let i=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);i&&this._linkAtPosition(e.link,i)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:void 0===e.link.decorations||e.link.decorations.underline,pointerCursor:void 0===e.link.decorations||e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:e=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==e&&(this._currentLink.state.decorations.pointerCursor=e,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",e))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:i=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==i&&(this._currentLink.state.decorations.underline=i,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,i))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(e=>{if(!this._currentLink)return;let i=0===e.start?0:e.start+1+this._bufferService.buffer.ydisp,s=this._bufferService.buffer.ydisp+1+e.end;if(this._currentLink.link.range.start.y>=i&&this._currentLink.link.range.end.y<=s&&(this._clearCurrentLink(i,s),this._lastMouseEvent)){let e=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);e&&this._askForLink(e,!1)}})))}_linkHover(e,i,s){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(i,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),i.hover&&i.hover(s,i.text)}_fireUnderlineEvent(e,i){let s=e.range,r=this._bufferService.buffer.ydisp,n=this._createLinkUnderlineEvent(s.start.x-1,s.start.y-r-1,s.end.x,s.end.y-r-1,void 0);(i?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(n)}_linkLeave(e,i,s){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(i,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),i.leave&&i.leave(s,i.text)}_linkAtPosition(e,i){let s=e.range.start.y*this._bufferService.cols+e.range.start.x,r=e.range.end.y*this._bufferService.cols+e.range.end.x,n=i.y*this._bufferService.cols+i.x;return s<=n&&n<=r}_positionFromMouseEvent(e,i,s){let r=s.getCoords(e,i,this._bufferService.cols,this._bufferService.rows);if(r)return{x:r[0],y:r[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,i,s,r,n){return{x1:e,y1:i,x2:s,y2:r,cols:this._bufferService.cols,fg:n}}};n$=eE([ek(1,e2),ek(2,e5),ek(3,eV),ek(4,e9)],n$);var nV=class extends nM{constructor(e={}){super(e),this._linkifier=this._register(new t_),this.browser=s2,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this._register(new t_),this._onCursorMove=this._register(new tB),this.onCursorMove=this._onCursorMove.event,this._onKey=this._register(new tB),this.onKey=this._onKey.event,this._onRender=this._register(new tB),this.onRender=this._onRender.event,this._onSelectionChange=this._register(new tB),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this._register(new tB),this.onTitleChange=this._onTitleChange.event,this._onBell=this._register(new tB),this.onBell=this._onBell.event,this._onFocus=this._register(new tB),this._onBlur=this._register(new tB),this._onA11yCharEmitter=this._register(new tB),this._onA11yTabEmitter=this._register(new tB),this._onWillOpen=this._register(new tB),this._setup(),this._decorationService=this._instantiationService.createInstance(nF),this._instantiationService.setService(eQ,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(sQ),this._instantiationService.setService(e9,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(eJ)),this._register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this._register(this._inputHandler.onRequestRefreshRows(e=>this.refresh(e?.start??0,e?.end??this.rows-1))),this._register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this._register(this._inputHandler.onRequestReset(()=>this.reset())),this._register(this._inputHandler.onRequestWindowsOptionsReport(e=>this._reportWindowsOptions(e))),this._register(this._inputHandler.onColor(e=>this._handleColorEvent(e))),this._register(tx.forward(this._inputHandler.onCursorMove,this._onCursorMove)),this._register(tx.forward(this._inputHandler.onTitleChange,this._onTitleChange)),this._register(tx.forward(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this._register(tx.forward(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this._register(this._bufferService.onResize(e=>this._afterResize(e.cols,e.rows))),this._register(th(()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)}))}get linkifier(){return this._linkifier.value}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(e){if(this._themeService)for(let i of e){let e,s="";switch(i.index){case 256:e="foreground",s="10";break;case 257:e="background",s="11";break;case 258:e="cursor",s="12";break;default:e="ansi",s="4;"+i.index}switch(i.type){case 0:let r=r9.toColorRGB("ansi"===e?this._themeService.colors.ansi[i.index]:this._themeService.colors[e]);this.coreService.triggerDataEvent(`${s_.ESC}]${s};${function(e,i=16){let[s,r,n]=e;return`rgb:${ny(s,i)}/${ny(r,i)}/${ny(n,i)}`}(r)}${sg.ST}`);break;case 1:if("ansi"===e)this._themeService.modifyColors(e=>e.ansi[i.index]=sp.toColor(...i.color));else{let s=e;this._themeService.modifyColors(e=>e[s]=sp.toColor(...i.color))}break;case 2:this._themeService.restoreColor(i.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(e){e?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(nU,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(e){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(s_.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(s_.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let e=this.buffer.ybase+this.buffer.y,i=this.buffer.lines.get(e);if(!i)return;let s=Math.min(this.buffer.x,this.cols-1),r=this._renderService.dimensions.css.cell.height,n=i.getWidth(s),o=this._renderService.dimensions.css.cell.width*n,a=this.buffer.y*this._renderService.dimensions.css.cell.height,l=s*this._renderService.dimensions.css.cell.width;this.textarea.style.left=l+"px",this.textarea.style.top=a+"px",this.textarea.style.width=o+"px",this.textarea.style.height=r+"px",this.textarea.style.lineHeight=r+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this._register(iP(this.element,"copy",e=>{var i;this.hasSelection()&&(i=this._selectionService,e.clipboardData&&e.clipboardData.setData("text/plain",i.selectionText),e.preventDefault())}));let e=e=>{var i,s,r;return i=this.textarea,s=this.coreService,r=this.optionsService,void(e.stopPropagation(),e.clipboardData&&eL(e.clipboardData.getData("text/plain"),i,s,r))};this._register(iP(this.textarea,"paste",e)),this._register(iP(this.element,"paste",e)),s8?this._register(iP(this.element,"mousedown",e=>{2===e.button&&eB(e,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this._register(iP(this.element,"contextmenu",e=>{eB(e,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),ro&&this._register(iP(this.element,"auxclick",e=>{1===e.button&&eT(e,this.textarea,this.screenElement)}))}_bindKeys(){this._register(iP(this.textarea,"keyup",e=>this._keyUp(e),!0)),this._register(iP(this.textarea,"keydown",e=>this._keyDown(e),!0)),this._register(iP(this.textarea,"keypress",e=>this._keyPress(e),!0)),this._register(iP(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this._register(iP(this.textarea,"compositionupdate",e=>this._compositionHelper.compositionupdate(e))),this._register(iP(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this._register(iP(this.textarea,"input",e=>this._inputEvent(e),!0)),this._register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(e){if(!e)throw Error("Terminal requires a parent element.");if(e.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=e.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),e.appendChild(this.element);let i=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),i.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register(iP(this.screenElement,"mousemove",e=>this.updateCursorStyle(e))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),i.appendChild(this.screenElement);let s=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",eA),ra||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",()=>s.readOnly=this.optionsService.rawOptions.disableStdin)),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(sj,this.textarea,e.ownerDocument.defaultView??window,this._document??"u">typeof window?window.document:null)),this._instantiationService.setService(e1,this._coreBrowserService),this._register(iP(this.textarea,"focus",e=>this._handleTextAreaFocus(e))),this._register(iP(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(sG,this._document,this._helperContainer),this._instantiationService.setService(e0,this._charSizeService),this._themeService=this._instantiationService.createInstance(rB),this._instantiationService.setService(e4,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(sM),this._instantiationService.setService(e6,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(r_,this.rows,this.screenElement)),this._instantiationService.setService(e5,this._renderService),this._register(this._renderService.onRenderedViewportChange(e=>this._onRender.fire(e))),this.onResize(e=>this._renderService.resize(e.cols,e.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(sa,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(s0),this._instantiationService.setService(e2,this._mouseService);let r=this._linkifier.value=this._register(this._instantiationService.createInstance(n$,this.screenElement));this.element.appendChild(i);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this._register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this._register(this.onBlur(()=>this._renderService.handleBlur())),this._register(this.onFocus(()=>this._renderService.handleFocus())),this._viewport=this._register(this._instantiationService.createInstance(se,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines(e=>{super.scrollLines(e,!1),this.refresh(0,this.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(rC,this.element,this.screenElement,r)),this._instantiationService.setService(e3,this._selectionService),this._register(this._selectionService.onRequestScrollLines(e=>this.scrollLines(e.amount,e.suppressScrollEvent))),this._register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this._register(this._selectionService.onRequestRedraw(e=>this._renderService.handleSelectionChanged(e.start,e.end,e.columnSelectMode))),this._register(this._selectionService.onLinuxMouseSelection(e=>{this.textarea.value=e,this.textarea.focus(),this.textarea.select()})),this._register(tx.any(this._onScroll.event,this._inputHandler.onScroll)(()=>{this._selectionService.refresh(),this._viewport?.queueSync()})),this._register(this._instantiationService.createInstance(st,this.screenElement)),this._register(iP(this.element,"mousedown",e=>this._selectionService.handleMouseDown(e))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(nU,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",e=>this._handleScreenReaderModeOptionChange(e))),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(so,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",e=>{!this._overviewRulerRenderer&&e&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(so,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(sK,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let e=this,i=this.element;function s(i){let s,r,n=e._mouseService.getMouseReportCoords(i,e.screenElement);if(!n)return!1;switch(i.overrideType||i.type){case"mousemove":r=32,void 0===i.buttons?(s=3,void 0!==i.button&&(s=i.button<3?i.button:3)):s=1&i.buttons?0:4&i.buttons?1:2&i.buttons?2:3;break;case"mouseup":r=0,s=i.button<3?i.button:3;break;case"mousedown":r=1,s=i.button<3?i.button:3;break;case"wheel":if(e._customWheelEventHandler&&!1===e._customWheelEventHandler(i))return!1;let o=i.deltaY;if(0===o||0===e.coreMouseService.consumeWheelEvent(i,e._renderService?.dimensions?.device?.cell?.height,e._coreBrowserService?.dpr))return!1;r=o<0?0:1,s=4;break;default:return!1}return void 0!==r&&void 0!==s&&!(s>4)&&e.coreMouseService.triggerMouseEvent({col:n.col,row:n.row,x:n.x,y:n.y,button:s,action:r,ctrl:i.ctrlKey,alt:i.altKey,shift:i.shiftKey})}let r={mouseup:null,wheel:null,mousedrag:null,mousemove:null},n=e=>(s(e),e.buttons||(this._document.removeEventListener("mouseup",r.mouseup),r.mousedrag&&this._document.removeEventListener("mousemove",r.mousedrag)),this.cancel(e)),o=e=>(s(e),this.cancel(e,!0)),a=e=>{e.buttons&&s(e)},l=e=>{e.buttons||s(e)};this._register(this.coreMouseService.onProtocolChange(e=>{e?("debug"===this.optionsService.rawOptions.logLevel&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(e)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&e?r.mousemove||(i.addEventListener("mousemove",l),r.mousemove=l):(i.removeEventListener("mousemove",r.mousemove),r.mousemove=null),16&e?r.wheel||(i.addEventListener("wheel",o,{passive:!1}),r.wheel=o):(i.removeEventListener("wheel",r.wheel),r.wheel=null),2&e?r.mouseup||(r.mouseup=n):(this._document.removeEventListener("mouseup",r.mouseup),r.mouseup=null),4&e?r.mousedrag||(r.mousedrag=a):(this._document.removeEventListener("mousemove",r.mousedrag),r.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register(iP(i,"mousedown",e=>{if(e.preventDefault(),this.focus(),!(!this.coreMouseService.areMouseEventsActive||this._selectionService.shouldForceSelection(e)))return s(e),r.mouseup&&this._document.addEventListener("mouseup",r.mouseup),r.mousedrag&&this._document.addEventListener("mousemove",r.mousedrag),this.cancel(e)})),this._register(iP(i,"wheel",i=>{if(!r.wheel){if(this._customWheelEventHandler&&!1===this._customWheelEventHandler(i))return!1;if(!this.buffer.hasScrollback){if(0===i.deltaY)return!1;if(0===e.coreMouseService.consumeWheelEvent(i,e._renderService?.dimensions?.device?.cell?.height,e._coreBrowserService?.dpr))return this.cancel(i,!0);let s=s_.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(i.deltaY<0?"A":"B");return this.coreService.triggerDataEvent(s,!0),this.cancel(i,!0)}}},{passive:!1}))}refresh(e,i){this._renderService?.refreshRows(e,i)}updateCursorStyle(e){this._selectionService?.shouldColumnSelect(e)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(e,i){this._viewport?this._viewport.scrollLines(e):super.scrollLines(e,i),this.refresh(0,this.rows-1)}scrollPages(e){this.scrollLines(e*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(e){e&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(e){let i=e-this._bufferService.buffer.ydisp;0!==i&&this.scrollLines(i)}paste(e){eL(e,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(e){this._customKeyEventHandler=e}attachCustomWheelEventHandler(e){this._customWheelEventHandler=e}registerLinkProvider(e){return this._linkProviderService.registerLinkProvider(e)}registerCharacterJoiner(e){if(!this._characterJoinerService)throw Error("Terminal must be opened first");let i=this._characterJoinerService.register(e);return this.refresh(0,this.rows-1),i}deregisterCharacterJoiner(e){if(!this._characterJoinerService)throw Error("Terminal must be opened first");this._characterJoinerService.deregister(e)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(e){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+e)}registerDecoration(e){return this._decorationService.registerDecoration(e)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(e,i,s){this._selectionService.setSelection(e,i,s)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(e,i){this._selectionService?.selectLines(e,i)}_keyDown(e){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&!1===this._customKeyEventHandler(e))return!1;let i=this.browser.isMac&&this.options.macOptionIsMeta&&e.altKey;if(!i&&!this._compositionHelper.keydown(e))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;i||"Dead"!==e.key&&"AltGraph"!==e.key||(this._unprocessedDeadKey=!0);let s=function(e,i,s,r){let n={type:0,cancel:!1,key:void 0},o=!!e.shiftKey|2*!!e.altKey|4*!!e.ctrlKey|8*!!e.metaKey;switch(e.keyCode){case 0:"UIKeyInputUpArrow"===e.key?i?n.key=s_.ESC+"OA":n.key=s_.ESC+"[A":"UIKeyInputLeftArrow"===e.key?i?n.key=s_.ESC+"OD":n.key=s_.ESC+"[D":"UIKeyInputRightArrow"===e.key?i?n.key=s_.ESC+"OC":n.key=s_.ESC+"[C":"UIKeyInputDownArrow"===e.key&&(i?n.key=s_.ESC+"OB":n.key=s_.ESC+"[B");break;case 8:n.key=e.ctrlKey?"\b":s_.DEL,e.altKey&&(n.key=s_.ESC+n.key);break;case 9:if(e.shiftKey){n.key=s_.ESC+"[Z";break}n.key=s_.HT,n.cancel=!0;break;case 13:n.key=e.altKey?s_.ESC+s_.CR:s_.CR,n.cancel=!0;break;case 27:n.key=s_.ESC,e.altKey&&(n.key=s_.ESC+s_.ESC),n.cancel=!0;break;case 37:if(e.metaKey)break;o?n.key=s_.ESC+"[1;"+(o+1)+"D":i?n.key=s_.ESC+"OD":n.key=s_.ESC+"[D";break;case 39:if(e.metaKey)break;o?n.key=s_.ESC+"[1;"+(o+1)+"C":i?n.key=s_.ESC+"OC":n.key=s_.ESC+"[C";break;case 38:if(e.metaKey)break;o?n.key=s_.ESC+"[1;"+(o+1)+"A":i?n.key=s_.ESC+"OA":n.key=s_.ESC+"[A";break;case 40:if(e.metaKey)break;o?n.key=s_.ESC+"[1;"+(o+1)+"B":i?n.key=s_.ESC+"OB":n.key=s_.ESC+"[B";break;case 45:e.shiftKey||e.ctrlKey||(n.key=s_.ESC+"[2~");break;case 46:o?n.key=s_.ESC+"[3;"+(o+1)+"~":n.key=s_.ESC+"[3~";break;case 36:o?n.key=s_.ESC+"[1;"+(o+1)+"H":i?n.key=s_.ESC+"OH":n.key=s_.ESC+"[H";break;case 35:o?n.key=s_.ESC+"[1;"+(o+1)+"F":i?n.key=s_.ESC+"OF":n.key=s_.ESC+"[F";break;case 33:e.shiftKey?n.type=2:e.ctrlKey?n.key=s_.ESC+"[5;"+(o+1)+"~":n.key=s_.ESC+"[5~";break;case 34:e.shiftKey?n.type=3:e.ctrlKey?n.key=s_.ESC+"[6;"+(o+1)+"~":n.key=s_.ESC+"[6~";break;case 112:o?n.key=s_.ESC+"[1;"+(o+1)+"P":n.key=s_.ESC+"OP";break;case 113:o?n.key=s_.ESC+"[1;"+(o+1)+"Q":n.key=s_.ESC+"OQ";break;case 114:o?n.key=s_.ESC+"[1;"+(o+1)+"R":n.key=s_.ESC+"OR";break;case 115:o?n.key=s_.ESC+"[1;"+(o+1)+"S":n.key=s_.ESC+"OS";break;case 116:o?n.key=s_.ESC+"[15;"+(o+1)+"~":n.key=s_.ESC+"[15~";break;case 117:o?n.key=s_.ESC+"[17;"+(o+1)+"~":n.key=s_.ESC+"[17~";break;case 118:o?n.key=s_.ESC+"[18;"+(o+1)+"~":n.key=s_.ESC+"[18~";break;case 119:o?n.key=s_.ESC+"[19;"+(o+1)+"~":n.key=s_.ESC+"[19~";break;case 120:o?n.key=s_.ESC+"[20;"+(o+1)+"~":n.key=s_.ESC+"[20~";break;case 121:o?n.key=s_.ESC+"[21;"+(o+1)+"~":n.key=s_.ESC+"[21~";break;case 122:o?n.key=s_.ESC+"[23;"+(o+1)+"~":n.key=s_.ESC+"[23~";break;case 123:o?n.key=s_.ESC+"[24;"+(o+1)+"~":n.key=s_.ESC+"[24~";break;default:if(!e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)if((!s||r)&&e.altKey&&!e.metaKey){let i=nI[e.keyCode]?.[+!!e.shiftKey];if(i)n.key=s_.ESC+i;else if(e.keyCode>=65&&e.keyCode<=90){let i=String.fromCharCode(e.ctrlKey?e.keyCode-64:e.keyCode+32);e.shiftKey&&(i=i.toUpperCase()),n.key=s_.ESC+i}else if(32===e.keyCode)n.key=s_.ESC+(e.ctrlKey?s_.NUL:" ");else if("Dead"===e.key&&e.code.startsWith("Key")){let i=e.code.slice(3,4);e.shiftKey||(i=i.toLowerCase()),n.key=s_.ESC+i,n.cancel=!0}}else!s||e.altKey||e.ctrlKey||e.shiftKey||!e.metaKey?!e.key||e.ctrlKey||e.altKey||e.metaKey||!(e.keyCode>=48)||1!==e.key.length?e.key&&e.ctrlKey&&("_"===e.key&&(n.key=s_.US),"@"===e.key&&(n.key=s_.NUL)):n.key=e.key:65===e.keyCode&&(n.type=1);else e.keyCode>=65&&e.keyCode<=90?n.key=String.fromCharCode(e.keyCode-64):32===e.keyCode?n.key=s_.NUL:e.keyCode>=51&&e.keyCode<=55?n.key=String.fromCharCode(e.keyCode-51+27):56===e.keyCode?n.key=s_.DEL:219===e.keyCode?n.key=s_.ESC:220===e.keyCode?n.key=s_.FS:221===e.keyCode&&(n.key=s_.GS)}return n}(e,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(e),3===s.type||2===s.type){let i=this.rows-1;return this.scrollLines(2===s.type?-i:i),this.cancel(e,!0)}return 1===s.type&&this.selectAll(),!!(this._isThirdLevelShift(this.browser,e)||(s.cancel&&this.cancel(e,!0),!s.key)||e.key&&!e.ctrlKey&&!e.altKey&&!e.metaKey&&1===e.key.length&&e.key.charCodeAt(0)>=65&&90>=e.key.charCodeAt(0))||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):((s.key===s_.ETX||s.key===s_.CR)&&(this.textarea.value=""),this._onKey.fire({key:s.key,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(s.key,!0),!this.optionsService.rawOptions.screenReaderMode||e.altKey||e.ctrlKey)?this.cancel(e,!0):void(this._keyDownHandled=!0))}_isThirdLevelShift(e,i){let s=e.isMac&&!this.options.macOptionIsMeta&&i.altKey&&!i.ctrlKey&&!i.metaKey||e.isWindows&&i.altKey&&i.ctrlKey&&!i.metaKey||e.isWindows&&i.getModifierState("AltGraph");return"keypress"===i.type?s:s&&(!i.keyCode||i.keyCode>47)}_keyUp(e){var i;this._keyDownSeen=!1,this._customKeyEventHandler&&!1===this._customKeyEventHandler(e)||(16===(i=e).keyCode||17===i.keyCode||18===i.keyCode||this.focus(),this.updateCursorStyle(e),this._keyPressHandled=!1)}_keyPress(e){let i;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&!1===this._customKeyEventHandler(e))return!1;if(this.cancel(e),e.charCode)i=e.charCode;else if(null===e.which||void 0===e.which)i=e.keyCode;else{if(0===e.which||0===e.charCode)return!1;i=e.which}return!!i&&(!e.altKey&&!e.ctrlKey&&!e.metaKey||!!this._isThirdLevelShift(this.browser,e))&&(i=String.fromCharCode(i),this._onKey.fire({key:i,domEvent:e}),this._showCursor(),this.coreService.triggerDataEvent(i,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}_inputEvent(e){if(e.data&&"insertText"===e.inputType&&(!e.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let i=e.data;return this.coreService.triggerDataEvent(i,!0),this.cancel(e),!0}return!1}resize(e,i){if(e===this.cols&&i===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}super.resize(e,i)}_afterResize(e,i){this._charSizeService?.measure()}clear(){if(0!==this.buffer.ybase||0!==this.buffer.y){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let e=1;e<this.rows;e++)this.buffer.lines.push(this.buffer.getBlankLine(rF));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;let e=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this._customKeyEventHandler=e,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(s_.ESC+"[I"):this.coreService.triggerDataEvent(s_.ESC+"[O")}_reportWindowsOptions(e){if(this._renderService)switch(e){case 0:let i=this._renderService.dimensions.css.canvas.width.toFixed(0),s=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${s_.ESC}[4;${s};${i}t`);break;case 1:let r=this._renderService.dimensions.css.cell.width.toFixed(0),n=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${s_.ESC}[6;${n};${r}t`)}}cancel(e,i){if(!(!this.options.cancelEvents&&!i))return e.preventDefault(),e.stopPropagation(),!1}},nH=class{constructor(){this._addons=[]}dispose(){for(let e=this._addons.length-1;e>=0;e--)this._addons[e].instance.dispose()}loadAddon(e,i){let s={instance:i,dispose:i.dispose,isDisposed:!1};this._addons.push(s),i.dispose=()=>this._wrappedAddonDispose(s),i.activate(e)}_wrappedAddonDispose(e){if(e.isDisposed)return;let i=-1;for(let s=0;s<this._addons.length;s++)if(this._addons[s]===e){i=s;break}if(-1===i)throw Error("Could not dispose an addon that has not been loaded");e.isDisposed=!0,e.dispose.apply(e.instance),this._addons.splice(i,1)}},nK=class{constructor(e){this._line=e}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(e,i){if(!(e<0||e>=this._line.length))return i?(this._line.loadCell(e,i),i):this._line.loadCell(e,new eF)}translateToString(e,i,s){return this._line.translateToString(e,i,s)}},nG=class{constructor(e,i){this._buffer=e,this.type=i}init(e){return this._buffer=e,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(e){let i=this._buffer.lines.get(e);if(i)return new nK(i)}getNullCell(){return new eF}},nY=class extends tu{constructor(e){super(),this._core=e,this._onBufferChange=this._register(new tB),this.onBufferChange=this._onBufferChange.event,this._normal=new nG(this._core.buffers.normal,"normal"),this._alternate=new nG(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}},nX=class{constructor(e){this._core=e}registerCsiHandler(e,i){return this._core.registerCsiHandler(e,e=>i(e.toArray()))}addCsiHandler(e,i){return this.registerCsiHandler(e,i)}registerDcsHandler(e,i){return this._core.registerDcsHandler(e,(e,s)=>i(e,s.toArray()))}addDcsHandler(e,i){return this.registerDcsHandler(e,i)}registerEscHandler(e,i){return this._core.registerEscHandler(e,i)}addEscHandler(e,i){return this.registerEscHandler(e,i)}registerOscHandler(e,i){return this._core.registerOscHandler(e,i)}addOscHandler(e,i){return this.registerOscHandler(e,i)}},nZ=class{constructor(e){this._core=e}register(e){this._core.unicodeService.register(e)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(e){this._core.unicodeService.activeVersion=e}},nj=["cols","rows"],nq=0,nQ=class extends tu{constructor(e){super(),this._core=this._register(new nV(e)),this._addonManager=this._register(new nH),this._publicOptions={...this._core.options};let i=e=>this._core.options[e],s=(e,i)=>{this._checkReadonlyOptions(e),this._core.options[e]=i};for(let e in this._core.options){let r={get:i.bind(this,e),set:s.bind(this,e)};Object.defineProperty(this._publicOptions,e,r)}}_checkReadonlyOptions(e){if(nj.includes(e))throw Error(`Option "${e}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new nX(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new nZ(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this._register(new nY(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let e=this._core.coreService.decPrivateModes,i="none";switch(this._core.coreMouseService.activeProtocol){case"X10":i="x10";break;case"VT200":i="vt200";break;case"DRAG":i="drag";break;case"ANY":i="any"}return{applicationCursorKeysMode:e.applicationCursorKeys,applicationKeypadMode:e.applicationKeypad,bracketedPasteMode:e.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:i,originMode:e.origin,reverseWraparoundMode:e.reverseWraparound,sendFocusMode:e.sendFocus,synchronizedOutputMode:e.synchronizedOutput,wraparoundMode:e.wraparound}}get options(){return this._publicOptions}set options(e){for(let i in e)this._publicOptions[i]=e[i]}blur(){this._core.blur()}focus(){this._core.focus()}input(e,i=!0){this._core.input(e,i)}resize(e,i){this._verifyIntegers(e,i),this._core.resize(e,i)}open(e){this._core.open(e)}attachCustomKeyEventHandler(e){this._core.attachCustomKeyEventHandler(e)}attachCustomWheelEventHandler(e){this._core.attachCustomWheelEventHandler(e)}registerLinkProvider(e){return this._core.registerLinkProvider(e)}registerCharacterJoiner(e){return this._checkProposedApi(),this._core.registerCharacterJoiner(e)}deregisterCharacterJoiner(e){this._checkProposedApi(),this._core.deregisterCharacterJoiner(e)}registerMarker(e=0){return this._verifyIntegers(e),this._core.registerMarker(e)}registerDecoration(e){return this._checkProposedApi(),this._verifyPositiveIntegers(e.x??0,e.width??0,e.height??0),this._core.registerDecoration(e)}hasSelection(){return this._core.hasSelection()}select(e,i,s){this._verifyIntegers(e,i,s),this._core.select(e,i,s)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(e,i){this._verifyIntegers(e,i),this._core.selectLines(e,i)}dispose(){super.dispose()}scrollLines(e){this._verifyIntegers(e),this._core.scrollLines(e)}scrollPages(e){this._verifyIntegers(e),this._core.scrollPages(e)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(e){this._verifyIntegers(e),this._core.scrollToLine(e)}clear(){this._core.clear()}write(e,i){this._core.write(e,i)}writeln(e,i){this._core.write(e),this._core.write(`\r
`,i)}paste(e){this._core.paste(e)}refresh(e,i){this._verifyIntegers(e,i),this._core.refresh(e,i)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(e){this._addonManager.loadAddon(this,e)}static get strings(){return{get promptLabel(){return eA},set promptLabel(t){eA=t},get tooMuchOutput(){return eR},set tooMuchOutput(t){eR=t}}}_verifyIntegers(...e){for(nq of e)if(nq===1/0||isNaN(nq)||nq%1!=0)throw Error("This API only accepts integers")}_verifyPositiveIntegers(...e){for(nq of e)if(nq&&(nq===1/0||isNaN(nq)||nq%1!=0||nq<0))throw Error("This API only accepts positive integers")}},nJ=class{activate(e){this._terminal=e}dispose(){}fit(){let e=this.proposeDimensions();if(!e||!this._terminal||isNaN(e.cols)||isNaN(e.rows))return;let i=this._terminal._core;(this._terminal.rows!==e.rows||this._terminal.cols!==e.cols)&&(i._renderService.clear(),this._terminal.resize(e.cols,e.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let e=this._terminal._core._renderService.dimensions;if(0===e.css.cell.width||0===e.css.cell.height)return;let i=0===this._terminal.options.scrollback?0:this._terminal.options.overviewRuler?.width||14,s=window.getComputedStyle(this._terminal.element.parentElement),r=parseInt(s.getPropertyValue("height")),n=Math.max(0,parseInt(s.getPropertyValue("width"))),o=window.getComputedStyle(this._terminal.element),a={top:parseInt(o.getPropertyValue("padding-top")),bottom:parseInt(o.getPropertyValue("padding-bottom")),right:parseInt(o.getPropertyValue("padding-right")),left:parseInt(o.getPropertyValue("padding-left"))},l=a.top+a.bottom;return{cols:Math.max(2,Math.floor((n-(a.right+a.left)-i)/e.css.cell.width)),rows:Math.max(1,Math.floor((r-l)/e.css.cell.height))}}},n0=Object.defineProperty,n1=Object.getOwnPropertyDescriptor,n2=new class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?n4.isErrorNoTelemetry(e)?new n4(e.message+`

`+e.stack):Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(i=>{i(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}};function n5(e){var i;(i=e)instanceof n6||i instanceof Error&&i.name===n3&&i.message===n3||n2.onUnexpectedError(e)}var n3="Canceled",n6=class extends Error{constructor(){super(n3),this.name=this.message}},n4=class e extends Error{constructor(e){super(e),this.name="CodeExpectedError"}static fromError(i){if(i instanceof e)return i;let s=new e;return s.message=i.message,s.stack=i.stack,s}static isErrorNoTelemetry(e){return"CodeExpectedError"===e.name}};(ou=o_||={}).isLessThan=function(e){return e<0},ou.isLessThanOrEqual=function(e){return e<=0},ou.isGreaterThan=function(e){return e>0},ou.isNeitherLessOrGreaterThan=function(e){return 0===e},ou.greaterThan=1,ou.lessThan=-1,ou.neitherLessOrGreaterThan=0;var n9=class e{constructor(e){this.iterate=e}forEach(e){this.iterate(i=>(e(i),!0))}toArray(){let e=[];return this.iterate(i=>(e.push(i),!0)),e}filter(i){return new e(e=>this.iterate(s=>!i(s)||e(s)))}map(i){return new e(e=>this.iterate(s=>e(i(s))))}some(e){let i=!1;return this.iterate(s=>!(i=e(s))),i}findFirst(e){let i;return this.iterate(s=>!e(s)||(i=s,!1)),i}findLast(e){let i;return this.iterate(s=>(e(s)&&(i=s),!0)),i}findLastMaxBy(e){let i,s=!0;return this.iterate(r=>((s||o_.isGreaterThan(e(r,i)))&&(s=!1,i=r),!0)),i}};n9.empty=new n9(e=>{});function n8(e){}function n7(e,i){}function oe(e){if(of.is(e)){let i=[];for(let s of e)if(s)try{s.dispose()}catch(e){i.push(e)}if(1===i.length)throw i[0];if(i.length>1)throw AggregateError(i,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}if(e)return e.dispose(),e}function ot(...e){let i=oi(()=>oe(e));return i}function oi(e){let i={dispose:function(e,i){let s=this,r=!1,n;return function(){if(r)return n;if(r=!0,i)try{n=e.apply(s,arguments)}finally{i()}else n=e.apply(s,arguments);return n}}(()=>{n8(i),e()})};return i}(e=>{function i(e){return e&&"object"==typeof e&&"function"==typeof e[Symbol.iterator]}e.is=i;let s=Object.freeze([]);function*r(e){yield e}e.empty=function(){return s},e.single=r,e.wrap=function(e){return i(e)?e:r(e)},e.from=function(e){return e||s},e.reverse=function*(e){for(let i=e.length-1;i>=0;i--)yield e[i]},e.isEmpty=function(e){return!e||!0===e[Symbol.iterator]().next().done},e.first=function(e){return e[Symbol.iterator]().next().value},e.some=function(e,i){let s=0;for(let r of e)if(i(r,s++))return!0;return!1},e.find=function(e,i){for(let s of e)if(i(s))return s},e.filter=function*(e,i){for(let s of e)i(s)&&(yield s)},e.map=function*(e,i){let s=0;for(let r of e)yield i(r,s++)},e.flatMap=function*(e,i){let s=0;for(let r of e)yield*i(r,s++)},e.concat=function*(...e){for(let i of e)yield*i},e.reduce=function(e,i,s){let r=s;for(let s of e)r=i(r,s);return r},e.slice=function*(e,i,s=e.length){for(i<0&&(i+=e.length),s<0?s+=e.length:s>e.length&&(s=e.length);i<s;i++)yield e[i]},e.consume=function(i,s=1/0){let r=[];if(0===s)return[r,i];let n=i[Symbol.iterator]();for(let i=0;i<s;i++){let i=n.next();if(i.done)return[r,e.empty()];r.push(i.value)}return[r,{[Symbol.iterator]:()=>n}]},e.asyncToArray=async function(e){let i=[];for await(let s of e)i.push(s);return Promise.resolve(i)}})(of||={});var os=class e{constructor(){var e;this._toDispose=new Set,this._isDisposed=!1,e=this}dispose(){this._isDisposed||(n8(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(0!==this._toDispose.size)try{oe(this._toDispose)}finally{this._toDispose.clear()}}add(i){if(!i)return i;if(i===this)throw Error("Cannot register a disposable on itself!");return n7(i,this),this._isDisposed?e.DISABLE_DISPOSED_WARNING||console.warn(Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(i),i}delete(e){if(e){if(e===this)throw Error("Cannot dispose a disposable on itself!");this._toDispose.delete(e),e.dispose()}}deleteAndLeak(e){e&&this._toDispose.has(e)&&(this._toDispose.delete(e),n7(e,null))}};os.DISABLE_DISPOSED_WARNING=!1;var or=class{constructor(){var e;this._store=new os,e=this,n7(this._store,this)}dispose(){n8(this),this._store.dispose()}_register(e){if(e===this)throw Error("Cannot register a disposable on itself!");return this._store.add(e)}};or.None=Object.freeze({dispose(){}});var on=class{constructor(){var e;this._isDisposed=!1,e=this}get value(){return this._isDisposed?void 0:this._value}set value(e){this._isDisposed||e===this._value||(this._value?.dispose(),e&&n7(e,this),this._value=e)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,n8(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let e=this._value;return this._value=void 0,e&&n7(e,null),e}},oo="u">typeof ey.default&&"title"in ey.default,oa=oo?"node":navigator.userAgent,ol=oo?"node":navigator.platform,oh=oa.includes("Firefox"),oc=oa.includes("Edge"),od=/^((?!chrome|android).)*safari/i.test(oa);["Macintosh","MacIntel","MacPPC","Mac68K"].includes(ol),["Windows","Win16","Win32","WinCE"].includes(ol),ol.indexOf("Linux"),/\bCrOS\b/.test(oa);var ou,o_,of,og,op=0,om=0,ov=0,ob=0,oS={css:"#00000000",rgba:0};(oD=og||={}).toCss=function(e,i,s,r){return void 0!==r?`#${oR(e)}${oR(i)}${oR(s)}${oR(r)}`:`#${oR(e)}${oR(i)}${oR(s)}`},oD.toRgba=function(e,i,s,r=255){return(e<<24|i<<16|s<<8|r)>>>0},oD.toColor=function(e,i,s,r){return{css:oD.toCss(e,i,s,r),rgba:oD.toRgba(e,i,s,r)}};var ow=oN||={};function oy(e,i){return ob=Math.round(255*i),[op,om,ov]=oF.toChannels(e.rgba),{css:og.toCss(op,om,ov,ob),rgba:og.toRgba(op,om,ov,ob)}}ow.blend=function(e,i){if(1==(ob=(255&i.rgba)/255))return{css:i.css,rgba:i.rgba};let s=i.rgba>>24&255,r=i.rgba>>16&255,n=i.rgba>>8&255,o=e.rgba>>24&255,a=e.rgba>>16&255,l=e.rgba>>8&255;return op=o+Math.round((s-o)*ob),om=a+Math.round((r-a)*ob),ov=l+Math.round((n-l)*ob),{css:og.toCss(op,om,ov),rgba:og.toRgba(op,om,ov)}},ow.isOpaque=function(e){return(255&e.rgba)==255},ow.ensureContrastRatio=function(e,i,s){let r=oF.ensureContrastRatio(e.rgba,i.rgba,s);if(r)return og.toColor(r>>24&255,r>>16&255,r>>8&255)},ow.opaque=function(e){let i=(255|e.rgba)>>>0;return[op,om,ov]=oF.toChannels(i),{css:og.toCss(op,om,ov),rgba:i}},ow.opacity=oy,ow.multiplyOpacity=function(e,i){return ob=255&e.rgba,oy(e,ob*i/255)},ow.toColorRGB=function(e){return[e.rgba>>24&255,e.rgba>>16&255,e.rgba>>8&255]},(e=>{let i,s;try{let e=document.createElement("canvas");e.width=1,e.height=1;let r=e.getContext("2d",{willReadFrequently:!0});r&&((i=r).globalCompositeOperation="copy",s=i.createLinearGradient(0,0,1,1))}catch{}e.toColor=function(e){if(e.match(/#[\da-f]{3,8}/i))switch(e.length){case 4:return op=parseInt(e.slice(1,2).repeat(2),16),om=parseInt(e.slice(2,3).repeat(2),16),ov=parseInt(e.slice(3,4).repeat(2),16),og.toColor(op,om,ov);case 5:return op=parseInt(e.slice(1,2).repeat(2),16),om=parseInt(e.slice(2,3).repeat(2),16),ov=parseInt(e.slice(3,4).repeat(2),16),ob=parseInt(e.slice(4,5).repeat(2),16),og.toColor(op,om,ov,ob);case 7:return{css:e,rgba:(parseInt(e.slice(1),16)<<8|255)>>>0};case 9:return{css:e,rgba:parseInt(e.slice(1),16)>>>0}}let r=e.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(r)return op=parseInt(r[1]),om=parseInt(r[2]),ov=parseInt(r[3]),ob=Math.round((void 0===r[5]?1:parseFloat(r[5]))*255),og.toColor(op,om,ov,ob);if(!i||!s||(i.fillStyle=s,i.fillStyle=e,"string"!=typeof i.fillStyle)||(i.fillRect(0,0,1,1),[op,om,ov,ob]=i.getImageData(0,0,1,1).data,255!==ob))throw Error("css.toColor: Unsupported css format");return{rgba:og.toRgba(op,om,ov,ob),css:e}}})(oO||={});var oC=oP||={};function ox(e,i,s){let r=e/255,n=i/255,o=s/255;return .2126*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))+.7152*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.0722*(o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4))}oC.relativeLuminance=function(e){return ox(e>>16&255,e>>8&255,255&e)},oC.relativeLuminance2=ox;var oE=oF||={};function ok(e,i,s){let r=e>>24&255,n=e>>16&255,o=e>>8&255,a=i>>24&255,l=i>>16&255,h=i>>8&255,c=oL(oP.relativeLuminance2(a,l,h),oP.relativeLuminance2(r,n,o));for(;c<s&&(a>0||l>0||h>0);)a-=Math.max(0,Math.ceil(.1*a)),l-=Math.max(0,Math.ceil(.1*l)),h-=Math.max(0,Math.ceil(.1*h)),c=oL(oP.relativeLuminance2(a,l,h),oP.relativeLuminance2(r,n,o));return(a<<24|l<<16|h<<8|255)>>>0}function oA(e,i,s){let r=e>>24&255,n=e>>16&255,o=e>>8&255,a=i>>24&255,l=i>>16&255,h=i>>8&255,c=oL(oP.relativeLuminance2(a,l,h),oP.relativeLuminance2(r,n,o));for(;c<s&&(a<255||l<255||h<255);)a=Math.min(255,a+Math.ceil((255-a)*.1)),l=Math.min(255,l+Math.ceil((255-l)*.1)),h=Math.min(255,h+Math.ceil((255-h)*.1)),c=oL(oP.relativeLuminance2(a,l,h),oP.relativeLuminance2(r,n,o));return(a<<24|l<<16|h<<8|255)>>>0}function oR(e){let i=e.toString(16);return i.length<2?"0"+i:i}function oL(e,i){return e<i?(i+.05)/(e+.05):(e+.05)/(i+.05)}function oT(e){if(!e)throw Error("value must not be falsy");return e}function oB(e){return 57508<=e&&e<=57558}function oM(e){return oB(e)||9472<=e&&e<=9631}function oI(){return{width:0,height:0}}oE.blend=function(e,i){if(1==(ob=(255&i)/255))return i;let s=e>>24&255,r=e>>16&255,n=e>>8&255;return op=s+Math.round(((i>>24&255)-s)*ob),om=r+Math.round(((i>>16&255)-r)*ob),ov=n+Math.round(((i>>8&255)-n)*ob),og.toRgba(op,om,ov)},oE.ensureContrastRatio=function(e,i,s){let r=oP.relativeLuminance(e>>8),n=oP.relativeLuminance(i>>8);if(oL(r,n)<s){if(n<r){let n=ok(e,i,s),o=oL(r,oP.relativeLuminance(n>>8));if(o<s){let a=oA(e,i,s);return o>oL(r,oP.relativeLuminance(a>>8))?n:a}return n}let o=oA(e,i,s),a=oL(r,oP.relativeLuminance(o>>8));if(a<s){let n=ok(e,i,s);return a>oL(r,oP.relativeLuminance(n>>8))?o:n}return o}},oE.reduceLuminance=ok,oE.increaseLuminance=oA,oE.toChannels=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]};var oD,oN,oO,oP,oF,oW,oz=0,oU=0,o$=!1,oV=!1,oH=!1,oK=0,oG=class{constructor(e,i,s,r,n,o){this._terminal=e,this._optionService=i,this._selectionRenderModel=s,this._decorationService=r,this._coreBrowserService=n,this._themeService=o,this.result={fg:0,bg:0,ext:0}}resolve(e,i,s,r){if(this.result.bg=e.bg,this.result.fg=e.fg,this.result.ext=0x10000000&e.bg?e.extended.ext:0,oU=0,oz=0,oV=!1,o$=!1,oH=!1,oW=this._themeService.colors,oK=0,0!==e.getCode()&&4===e.extended.underlineStyle&&(oK=i*r%(2*Math.round(Math.max(1,Math.floor(this._optionService.rawOptions.fontSize*this._coreBrowserService.dpr/15))))),this._decorationService.forEachDecorationAtCell(i,s,"bottom",e=>{e.backgroundColorRGB&&(oU=e.backgroundColorRGB.rgba>>8&0xffffff,oV=!0),e.foregroundColorRGB&&(oz=e.foregroundColorRGB.rgba>>8&0xffffff,o$=!0)}),oH=this._selectionRenderModel.isCellSelected(this._terminal,i,s)){if(0x4000000&this.result.fg||(0x3000000&this.result.bg)!=0){if(0x4000000&this.result.fg)switch(0x3000000&this.result.fg){case 0x1000000:case 0x2000000:oU=this._themeService.colors.ansi[255&this.result.fg].rgba;break;case 0x3000000:oU=(0xffffff&this.result.fg)<<8|255;break;default:oU=this._themeService.colors.foreground.rgba}else switch(0x3000000&this.result.bg){case 0x1000000:case 0x2000000:oU=this._themeService.colors.ansi[255&this.result.bg].rgba;break;case 0x3000000:oU=(0xffffff&this.result.bg)<<8|255}oU=oF.blend(oU,0xffffff00&(this._coreBrowserService.isFocused?oW.selectionBackgroundOpaque:oW.selectionInactiveBackgroundOpaque).rgba|128)>>8&0xffffff}else oU=(this._coreBrowserService.isFocused?oW.selectionBackgroundOpaque:oW.selectionInactiveBackgroundOpaque).rgba>>8&0xffffff;if(oV=!0,oW.selectionForeground&&(oz=oW.selectionForeground.rgba>>8&0xffffff,o$=!0),oM(e.getCode())){if(0x4000000&this.result.fg&&(0x3000000&this.result.bg)==0)oz=(this._coreBrowserService.isFocused?oW.selectionBackgroundOpaque:oW.selectionInactiveBackgroundOpaque).rgba>>8&0xffffff;else{if(0x4000000&this.result.fg)switch(0x3000000&this.result.bg){case 0x1000000:case 0x2000000:oz=this._themeService.colors.ansi[255&this.result.bg].rgba;break;case 0x3000000:oz=(0xffffff&this.result.bg)<<8|255}else switch(0x3000000&this.result.fg){case 0x1000000:case 0x2000000:oz=this._themeService.colors.ansi[255&this.result.fg].rgba;break;case 0x3000000:oz=(0xffffff&this.result.fg)<<8|255;break;default:oz=this._themeService.colors.foreground.rgba}oz=oF.blend(oz,0xffffff00&(this._coreBrowserService.isFocused?oW.selectionBackgroundOpaque:oW.selectionInactiveBackgroundOpaque).rgba|128)>>8&0xffffff}o$=!0}}this._decorationService.forEachDecorationAtCell(i,s,"top",e=>{e.backgroundColorRGB&&(oU=e.backgroundColorRGB.rgba>>8&0xffffff,oV=!0),e.foregroundColorRGB&&(oz=e.foregroundColorRGB.rgba>>8&0xffffff,o$=!0)}),oV&&(oU=oH?-0x1000000&e.bg&-0x8000001|oU|0x3000000:-0x1000000&e.bg|oU|0x3000000),o$&&(oz=-0x1000000&e.fg&-0x4000001|oz|0x3000000),0x4000000&this.result.fg&&(oV&&!o$&&(oz=(0x3000000&this.result.bg)==0?-0x8000000&this.result.fg|oW.background.rgba>>8&0xffffff|0x3000000:-0x8000000&this.result.fg|0x3ffffff&this.result.bg,o$=!0),!oV&&o$&&(oU=(0x3000000&this.result.fg)==0?-0x4000000&this.result.bg|oW.foreground.rgba>>8&0xffffff|0x3000000:-0x4000000&this.result.bg|0x3ffffff&this.result.fg,oV=!0)),oW=void 0,this.result.bg=oV?oU:this.result.bg,this.result.fg=o$?oz:this.result.fg,this.result.ext&=0x1fffffff,this.result.ext|=oK<<29&0xe0000000}},oY=oh||oc?"bottom":"ideographic",oX={"":[{x:0,y:0,w:8,h:4}],"":[{x:0,y:7,w:8,h:1}],"":[{x:0,y:6,w:8,h:2}],"":[{x:0,y:5,w:8,h:3}],"":[{x:0,y:4,w:8,h:4}],"":[{x:0,y:3,w:8,h:5}],"":[{x:0,y:2,w:8,h:6}],"":[{x:0,y:1,w:8,h:7}],"":[{x:0,y:0,w:8,h:8}],"":[{x:0,y:0,w:7,h:8}],"":[{x:0,y:0,w:6,h:8}],"":[{x:0,y:0,w:5,h:8}],"":[{x:0,y:0,w:4,h:8}],"":[{x:0,y:0,w:3,h:8}],"":[{x:0,y:0,w:2,h:8}],"":[{x:0,y:0,w:1,h:8}],"":[{x:4,y:0,w:4,h:8}],"":[{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8}],"":[{x:0,y:4,w:4,h:4}],"":[{x:4,y:4,w:4,h:4}],"":[{x:0,y:0,w:4,h:4}],"":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"":[{x:4,y:0,w:4,h:4}],"":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"":[{x:1,y:0,w:1,h:8}],"":[{x:2,y:0,w:1,h:8}],"":[{x:3,y:0,w:1,h:8}],"":[{x:4,y:0,w:1,h:8}],"":[{x:5,y:0,w:1,h:8}],"":[{x:6,y:0,w:1,h:8}],"":[{x:0,y:1,w:8,h:1}],"":[{x:0,y:2,w:8,h:1}],"":[{x:0,y:3,w:8,h:1}],"":[{x:0,y:4,w:8,h:1}],"":[{x:0,y:5,w:8,h:1}],"":[{x:0,y:6,w:8,h:1}],"":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"":[{x:0,y:0,w:8,h:2}],"":[{x:0,y:0,w:8,h:3}],"":[{x:0,y:0,w:8,h:5}],"":[{x:0,y:0,w:8,h:6}],"":[{x:0,y:0,w:8,h:7}],"":[{x:6,y:0,w:2,h:8}],"":[{x:5,y:0,w:3,h:8}],"":[{x:3,y:0,w:5,h:8}],"":[{x:2,y:0,w:6,h:8}],"":[{x:1,y:0,w:7,h:8}],"":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]},oZ={"":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"":[[1,0],[0,0],[0,1],[0,0]],"":[[0,1],[1,1],[1,0],[1,1]]},oj={"":{1:"M0,.5 L1,.5"},"":{3:"M0,.5 L1,.5"},"":{1:"M.5,0 L.5,1"},"":{3:"M.5,0 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5"},"":{3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M0,.5 L.5,.5 L.5,1"},"":{3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,0 L.5,.5 L1,.5"},"":{3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L0,.5"},"":{3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"":{1:"M.5,.5 L0,.5"},"":{3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,0"},"":{3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L1,.5"},"":{3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1"},"":{3:"M.5,.5 L.5,1"},"":{1:(e,i)=>`M0,${.5-i} L1,${.5-i} M0,${.5+i} L1,${.5+i}`},"":{1:(e,i)=>`M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1`},"":{1:(e,i)=>`M.5,1 L.5,${.5-i} L1,${.5-i} M.5,${.5+i} L1,${.5+i}`},"":{1:(e,i)=>`M${.5-e},1 L${.5-e},.5 L1,.5 M${.5+e},.5 L${.5+e},1`},"":{1:(e,i)=>`M1,${.5-i} L${.5-e},${.5-i} L${.5-e},1 M1,${.5+i} L${.5+e},${.5+i} L${.5+e},1`},"":{1:(e,i)=>`M0,${.5-i} L.5,${.5-i} L.5,1 M0,${.5+i} L.5,${.5+i}`},"":{1:(e,i)=>`M${.5+e},1 L${.5+e},.5 L0,.5 M${.5-e},.5 L${.5-e},1`},"":{1:(e,i)=>`M0,${.5+i} L${.5-e},${.5+i} L${.5-e},1 M0,${.5-i} L${.5+e},${.5-i} L${.5+e},1`},"":{1:(e,i)=>`M.5,0 L.5,${.5+i} L1,${.5+i} M.5,${.5-i} L1,${.5-i}`},"":{1:(e,i)=>`M1,.5 L${.5-e},.5 L${.5-e},0 M${.5+e},.5 L${.5+e},0`},"":{1:(e,i)=>`M1,${.5-i} L${.5+e},${.5-i} L${.5+e},0 M1,${.5+i} L${.5-e},${.5+i} L${.5-e},0`},"":{1:(e,i)=>`M0,${.5+i} L.5,${.5+i} L.5,0 M0,${.5-i} L.5,${.5-i}`},"":{1:(e,i)=>`M0,.5 L${.5+e},.5 L${.5+e},0 M${.5-e},.5 L${.5-e},0`},"":{1:(e,i)=>`M0,${.5-i} L${.5-e},${.5-i} L${.5-e},0 M0,${.5+i} L${.5+e},${.5+i} L${.5+e},0`},"":{1:(e,i)=>`M.5,0 L.5,1 M.5,${.5-i} L1,${.5-i} M.5,${.5+i} L1,${.5+i}`},"":{1:(e,i)=>`M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1 M${.5+e},.5 L1,.5`},"":{1:(e,i)=>`M${.5-e},0 L${.5-e},1 M1,${.5+i} L${.5+e},${.5+i} L${.5+e},1 M1,${.5-i} L${.5+e},${.5-i} L${.5+e},0`},"":{1:(e,i)=>`M.5,0 L.5,1 M0,${.5-i} L.5,${.5-i} M0,${.5+i} L.5,${.5+i}`},"":{1:(e,i)=>`M0,.5 L${.5-e},.5 M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1`},"":{1:(e,i)=>`M${.5+e},0 L${.5+e},1 M0,${.5+i} L${.5-e},${.5+i} L${.5-e},1 M0,${.5-i} L${.5-e},${.5-i} L${.5-e},0`},"":{1:(e,i)=>`M0,${.5-i} L1,${.5-i} M0,${.5+i} L1,${.5+i} M.5,${.5+i} L.5,1`},"":{1:(e,i)=>`M0,.5 L1,.5 M${.5-e},.5 L${.5-e},1 M${.5+e},.5 L${.5+e},1`},"":{1:(e,i)=>`M0,${.5-i} L1,${.5-i} M0,${.5+i} L${.5-e},${.5+i} L${.5-e},1 M1,${.5+i} L${.5+e},${.5+i} L${.5+e},1`},"":{1:(e,i)=>`M.5,0 L.5,${.5-i} M0,${.5-i} L1,${.5-i} M0,${.5+i} L1,${.5+i}`},"":{1:(e,i)=>`M0,.5 L1,.5 M${.5-e},.5 L${.5-e},0 M${.5+e},.5 L${.5+e},0`},"":{1:(e,i)=>`M0,${.5+i} L1,${.5+i} M0,${.5-i} L${.5-e},${.5-i} L${.5-e},0 M1,${.5-i} L${.5+e},${.5-i} L${.5+e},0`},"":{1:(e,i)=>`M.5,0 L.5,1 M0,${.5-i} L1,${.5-i} M0,${.5+i} L1,${.5+i}`},"":{1:(e,i)=>`M0,.5 L1,.5 M${.5-e},0 L${.5-e},1 M${.5+e},0 L${.5+e},1`},"":{1:(e,i)=>`M0,${.5+i} L${.5-e},${.5+i} L${.5-e},1 M1,${.5+i} L${.5+e},${.5+i} L${.5+e},1 M0,${.5-i} L${.5-e},${.5-i} L${.5-e},0 M1,${.5-i} L${.5+e},${.5-i} L${.5+e},0`},"":{1:"M1,0 L0,1"},"":{1:"M0,0 L1,1"},"":{1:"M1,0 L0,1 M0,0 L1,1"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"":{1:(e,i)=>`M.5,1 L.5,${.5+i/.15*.5} C.5,${.5+i/.15*.5},.5,.5,1,.5`},"":{1:(e,i)=>`M.5,1 L.5,${.5+i/.15*.5} C.5,${.5+i/.15*.5},.5,.5,0,.5`},"":{1:(e,i)=>`M.5,0 L.5,${.5-i/.15*.5} C.5,${.5-i/.15*.5},.5,.5,0,.5`},"":{1:(e,i)=>`M.5,0 L.5,${.5-i/.15*.5} C.5,${.5-i/.15*.5},.5,.5,1,.5`}},oq={"":{d:"M.3,1 L.03,1 L.03,.88 C.03,.82,.06,.78,.11,.73 C.15,.7,.2,.68,.28,.65 L.43,.6 C.49,.58,.53,.56,.56,.53 C.59,.5,.6,.47,.6,.43 L.6,.27 L.4,.27 L.69,.1 L.98,.27 L.78,.27 L.78,.46 C.78,.52,.76,.56,.72,.61 C.68,.66,.63,.67,.56,.7 L.48,.72 C.42,.74,.38,.76,.35,.78 C.32,.8,.31,.84,.31,.88 L.31,1 M.3,.5 L.03,.59 L.03,.09 L.3,.09 L.3,.655",type:0},"":{d:"M.7,.4 L.7,.47 L.2,.47 L.2,.03 L.355,.03 L.355,.4 L.705,.4 M.7,.5 L.86,.5 L.86,.95 L.69,.95 L.44,.66 L.46,.86 L.46,.95 L.3,.95 L.3,.49 L.46,.49 L.71,.78 L.69,.565 L.69,.5",type:0},"":{d:"M.25,.94 C.16,.94,.11,.92,.11,.87 L.11,.53 C.11,.48,.15,.455,.23,.45 L.23,.3 C.23,.25,.26,.22,.31,.19 C.36,.16,.43,.15,.51,.15 C.59,.15,.66,.16,.71,.19 C.77,.22,.79,.26,.79,.3 L.79,.45 C.87,.45,.91,.48,.91,.53 L.91,.87 C.91,.92,.86,.94,.77,.94 L.24,.94 M.53,.2 C.49,.2,.45,.21,.42,.23 C.39,.25,.38,.27,.38,.3 L.38,.45 L.68,.45 L.68,.3 C.68,.27,.67,.25,.64,.23 C.61,.21,.58,.2,.53,.2 M.58,.82 L.58,.66 C.63,.65,.65,.63,.65,.6 C.65,.58,.64,.57,.61,.56 C.58,.55,.56,.54,.52,.54 C.48,.54,.46,.55,.43,.56 C.4,.57,.39,.59,.39,.6 C.39,.63,.41,.64,.46,.66 L.46,.82 L.57,.82",type:0},"":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}};oq[""]=oq[""],oq[""]=oq[""];var oQ=new Map;function oJ(e,i,s=0){return Math.max(Math.min(e,i),s)}var o0={C:(e,i)=>e.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]),L:(e,i)=>e.lineTo(i[0],i[1]),M:(e,i)=>e.moveTo(i[0],i[1])};function o1(e,i,s,r,n,o,a,l=0,h=0){let c=e.map(e=>parseFloat(e)||parseInt(e));if(c.length<2)throw Error("Too few arguments for instruction");for(let e=0;e<c.length;e+=2)c[e]*=i-l*a-h*a,o&&0!==c[e]&&(c[e]=oJ(Math.round(c[e]+.5)-.5,i,0)),c[e]+=r+l*a;for(let e=1;e<c.length;e+=2)c[e]*=s,o&&0!==c[e]&&(c[e]=oJ(Math.round(c[e]+.5)-.5,s,0)),c[e]+=n;return c}var o2=class{constructor(){this._data={}}set(e,i,s){this._data[e]||(this._data[e]={}),this._data[e][i]=s}get(e,i){return this._data[e]?this._data[e][i]:void 0}clear(){this._data={}}},o5=class{constructor(){this._data=new o2}set(e,i,s,r,n){this._data.get(e,i)||this._data.set(e,i,new o2),this._data.get(e,i).set(s,r,n)}get(e,i,s,r){return this._data.get(e,i)?.get(s,r)}clear(){this._data.clear()}},o3=class{constructor(){this._tasks=[],this._i=0}enqueue(e){this._tasks.push(e),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(e){this._idleCallback=void 0;let i=0,s=0,r=e.timeRemaining(),n=0;for(;this._i<this._tasks.length;){if(i=performance.now(),this._tasks[this._i]()||this._i++,1.5*(s=Math.max(i=Math.max(1,performance.now()-i),s))>(n=e.timeRemaining())){r-i<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(r-i))}ms`),this._start();return}r=n}this.clear()}},o6=class extends o3{_requestCallback(e){return setTimeout(()=>e(this._createDeadline(16)))}_cancelCallback(e){clearTimeout(e)}_createDeadline(e){let i=performance.now()+e;return{timeRemaining:()=>Math.max(0,i-performance.now())}}},o4=class extends o3{_requestCallback(e){return requestIdleCallback(e)}_cancelCallback(e){cancelIdleCallback(e)}},o9=!oo&&"requestIdleCallback"in window?o4:o6,o8=class e{constructor(){this.fg=0,this.bg=0,this.extended=new o7}static toColorRGB(e){return[e>>>16&255,e>>>8&255,255&e]}static fromColorRGB(e){return(255&e[0])<<16|(255&e[1])<<8|255&e[2]}clone(){let i=new e;return i.fg=this.fg,i.bg=this.bg,i.extended=this.extended.clone(),i}isInverse(){return 0x4000000&this.fg}isBold(){return 0x8000000&this.fg}isUnderline(){return this.hasExtendedAttrs()&&0!==this.extended.underlineStyle?1:0x10000000&this.fg}isBlink(){return 0x20000000&this.fg}isInvisible(){return 0x40000000&this.fg}isItalic(){return 0x4000000&this.bg}isDim(){return 0x8000000&this.bg}isStrikethrough(){return 0x80000000&this.fg}isProtected(){return 0x20000000&this.bg}isOverline(){return 0x40000000&this.bg}getFgColorMode(){return 0x3000000&this.fg}getBgColorMode(){return 0x3000000&this.bg}isFgRGB(){return(0x3000000&this.fg)==0x3000000}isBgRGB(){return(0x3000000&this.bg)==0x3000000}isFgPalette(){return(0x3000000&this.fg)==0x1000000||(0x3000000&this.fg)==0x2000000}isBgPalette(){return(0x3000000&this.bg)==0x1000000||(0x3000000&this.bg)==0x2000000}isFgDefault(){return(0x3000000&this.fg)==0}isBgDefault(){return(0x3000000&this.bg)==0}isAttributeDefault(){return 0===this.fg&&0===this.bg}getFgColor(){switch(0x3000000&this.fg){case 0x1000000:case 0x2000000:return 255&this.fg;case 0x3000000:return 0xffffff&this.fg;default:return -1}}getBgColor(){switch(0x3000000&this.bg){case 0x1000000:case 0x2000000:return 255&this.bg;case 0x3000000:return 0xffffff&this.bg;default:return -1}}hasExtendedAttrs(){return 0x10000000&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-0x10000001:this.bg|=0x10000000}getUnderlineColor(){if(0x10000000&this.bg&&~this.extended.underlineColor)switch(0x3000000&this.extended.underlineColor){case 0x1000000:case 0x2000000:return 255&this.extended.underlineColor;case 0x3000000:return 0xffffff&this.extended.underlineColor}return this.getFgColor()}getUnderlineColorMode(){return 0x10000000&this.bg&&~this.extended.underlineColor?0x3000000&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 0x10000000&this.bg&&~this.extended.underlineColor?(0x3000000&this.extended.underlineColor)==0x3000000:this.isFgRGB()}isUnderlineColorPalette(){return 0x10000000&this.bg&&~this.extended.underlineColor?(0x3000000&this.extended.underlineColor)==0x1000000||(0x3000000&this.extended.underlineColor)==0x2000000:this.isFgPalette()}isUnderlineColorDefault(){return 0x10000000&this.bg&&~this.extended.underlineColor?(0x3000000&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 0x10000000&this.fg?0x10000000&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},o7=class e{constructor(e=0,i=0){this._ext=0,this._urlId=0,this._ext=e,this._urlId=i}get ext(){return this._urlId?-0x1c000001&this._ext|this.underlineStyle<<26:this._ext}set ext(e){this._ext=e}get underlineStyle(){return this._urlId?5:(0x1c000000&this._ext)>>26}set underlineStyle(e){this._ext&=-0x1c000001,this._ext|=e<<26&0x1c000000}get underlineColor(){return 0x3ffffff&this._ext}set underlineColor(e){this._ext&=-0x4000000,this._ext|=0x3ffffff&e}get urlId(){return this._urlId}set urlId(e){this._urlId=e}get underlineVariantOffset(){let e=(0xe0000000&this._ext)>>29;return e<0?0xfffffff8^e:e}set underlineVariantOffset(e){this._ext&=0x1fffffff,this._ext|=e<<29&0xe0000000}clone(){return new e(this._ext,this._urlId)}isEmpty(){return 0===this.underlineStyle&&0===this._urlId}},ae=class e{constructor(i){this.element=i,this.next=e.Undefined,this.prev=e.Undefined}};ae.Undefined=new ae(void 0);var at=globalThis.performance&&"function"==typeof globalThis.performance.now,ai=class e{static create(i){return new e(i)}constructor(e){this._now=at&&!1===e?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return -1!==this._stopTime?this._stopTime-this._startTime:this._now()-this._startTime}};(e=>{function i(e){}function s(e){return(i,s=null,r)=>{let n=!1,o;return o=e(e=>{if(!n)return o?o.dispose():n=!0,i.call(s,e)},null,r),n&&o.dispose(),o}}function r(e,i,s){return o((s,r=null,n)=>e(e=>s.call(r,i(e)),null,n),s)}function n(e,i,s){return o((s,r=null,n)=>e(e=>i(e)&&s.call(r,e),null,n),s)}function o(e,s){let r,n={onWillAddFirstListener(){r=e(o.fire,o)},onDidRemoveLastListener(){r?.dispose()}};s||i(n);let o=new a_(n);return s?.add(o),o.event}function a(e,s,r=100,n=!1,o=!1,l,h){let c,d,u,_=0,f,g={leakWarningThreshold:l,onWillAddFirstListener(){c=e(e=>{_++,d=s(d,e),n&&!u&&(p.fire(d),d=void 0),f=()=>{let e=d;d=void 0,u=void 0,(!n||_>1)&&p.fire(e),_=0},"number"==typeof r?(clearTimeout(u),u=setTimeout(f,r)):void 0===u&&(u=0,queueMicrotask(f))})},onWillRemoveListener(){o&&_>0&&f?.()},onDidRemoveLastListener(){f=void 0,c.dispose()}};h||i(g);let p=new a_(g);return h?.add(p),p.event}e.None=()=>or.None,e.defer=function(e,i){return a(e,()=>{},0,void 0,!0,void 0,i)},e.once=s,e.map=r,e.forEach=function(e,i,s){return o((s,r=null,n)=>e(e=>{i(e),s.call(r,e)},null,n),s)},e.filter=n,e.signal=function(e){return e},e.any=function(...e){return(i,s=null,r)=>{var n,o;return n=ot(...e.map(e=>e(e=>i.call(s,e)))),(o=r)instanceof Array?o.push(n):o&&o.add(n),n}},e.reduce=function(e,i,s,n){let o=s;return r(e,e=>o=i(o,e),n)},e.debounce=a,e.accumulate=function(i,s=0,r){return e.debounce(i,(e,i)=>e?(e.push(i),e):[i],s,void 0,!0,void 0,r)},e.latch=function(e,i=(e,i)=>e===i,s){let r=!0,o;return n(e,e=>{let s=r||!i(e,o);return r=!1,o=e,s},s)},e.split=function(i,s,r){return[e.filter(i,s,r),e.filter(i,e=>!s(e),r)]},e.buffer=function(e,i=!1,s=[],r){let n=s.slice(),o=e(e=>{n?n.push(e):l.fire(e)});r&&r.add(o);let a=()=>{n?.forEach(e=>l.fire(e)),n=null},l=new a_({onWillAddFirstListener(){o||(o=e(e=>l.fire(e)),r&&r.add(o))},onDidAddFirstListener(){n&&(i?setTimeout(a):a())},onDidRemoveLastListener(){o&&o.dispose(),o=null}});return r&&r.add(l),l.event},e.chain=function(e,i){return(s,r,n)=>{let o=i(new h);return e(function(e){let i=o.evaluate(e);i!==l&&s.call(r,i)},void 0,n)}};let l=Symbol("HaltChainable");class h{constructor(){this.steps=[]}map(e){return this.steps.push(e),this}forEach(e){return this.steps.push(i=>(e(i),i)),this}filter(e){return this.steps.push(i=>e(i)?i:l),this}reduce(e,i){let s=i;return this.steps.push(i=>s=e(s,i)),this}latch(e=(e,i)=>e===i){let i=!0,s;return this.steps.push(r=>{let n=i||!e(r,s);return i=!1,s=r,n?r:l}),this}evaluate(e){for(let i of this.steps)if((e=i(e))===l)break;return e}}e.fromNodeEventEmitter=function(e,i,s=e=>e){let r=(...e)=>n.fire(s(...e)),n=new a_({onWillAddFirstListener:()=>e.on(i,r),onDidRemoveLastListener:()=>e.removeListener(i,r)});return n.event},e.fromDOMEventEmitter=function(e,i,s=e=>e){let r=(...e)=>n.fire(s(...e)),n=new a_({onWillAddFirstListener:()=>e.addEventListener(i,r),onDidRemoveLastListener:()=>e.removeEventListener(i,r)});return n.event},e.toPromise=function(e){return new Promise(i=>s(e)(i))},e.fromPromise=function(e){let i=new a_;return e.then(e=>{i.fire(e)},()=>{i.fire(void 0)}).finally(()=>{i.dispose()}),i.event},e.forward=function(e,i){return e(e=>i.fire(e))},e.runAndSubscribe=function(e,i,s){return i(s),e(e=>i(e))};class c{constructor(e,s){this._observable=e,this._counter=0,this._hasChanged=!1;let r={onWillAddFirstListener:()=>{e.addObserver(this)},onDidRemoveLastListener:()=>{e.removeObserver(this)}};s||i(r),this.emitter=new a_(r),s&&s.add(this.emitter)}beginUpdate(e){this._counter++}handlePossibleChange(e){}handleChange(e,i){this._hasChanged=!0}endUpdate(e){this._counter--,0===this._counter&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}e.fromObservable=function(e,i){return new c(e,i).emitter.event},e.fromObservableLight=function(e){return(i,s,r)=>{let n=0,o=!1,a={beginUpdate(){n++},endUpdate(){0==--n&&(e.reportChanges(),o&&(o=!1,i.call(s)))},handlePossibleChange(){},handleChange(){o=!0}};e.addObserver(a),e.reportChanges();let l={dispose(){e.removeObserver(a)}};return r instanceof os?r.add(l):Array.isArray(r)&&r.push(l),l}}})(an||={});var as=class e{constructor(i){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${i}_${e._idPool++}`,e.all.add(this)}start(e){this._stopWatch=new ai,this.listenerCount=e}stop(){if(this._stopWatch){let e=this._stopWatch.elapsed();this.durations.push(e),this.elapsedOverall+=e,this.invocationCount+=1,this._stopWatch=void 0}}};as.all=new Set,as._idPool=0;var ar=class e{constructor(i,s,r=(e._idPool++).toString(16).padStart(3,"0")){this._errorHandler=i,this.threshold=s,this.name=r,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(e,i){let s=this.threshold;if(s<=0||i<s)return;this._stacks||(this._stacks=new Map);let r=this._stacks.get(e.value)||0;if(this._stacks.set(e.value,r+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=.5*s;let[e,r]=this.getMostFrequentStack(),n=`[${this.name}] potential listener LEAK detected, having ${i} listeners already. MOST frequent listener (${r}):`;console.warn(n),console.warn(e);let o=new ah(n,e);this._errorHandler(o)}return()=>{let i=this._stacks.get(e.value)||0;this._stacks.set(e.value,i-1)}}getMostFrequentStack(){if(!this._stacks)return;let e,i=0;for(let[s,r]of this._stacks)(!e||i<r)&&(e=[s,r],i=r);return e}};ar._idPool=1;var an,ao,aa,al=class e{constructor(e){this.value=e}static create(){return new e(Error().stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},ah=class extends Error{constructor(e,i){super(e),this.name="ListenerLeakError",this.stack=i}},ac=class extends Error{constructor(e,i){super(e),this.name="ListenerRefusalError",this.stack=i}},ad=0,au=class{constructor(e){this.value=e,this.id=ad++}},a_=class{constructor(e){this._size=0,this._options=e,this._leakageMon=this._options?.leakWarningThreshold?new ar(e?.onListenerError??n5,this._options?.leakWarningThreshold??-1):void 0,this._perfMon=this._options?._profName?new as(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){this._disposed||(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners&&(this._listeners=void 0,this._size=0),this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose())}get event(){return this._event??=(e,i,s)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let e=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(e);let i=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],s=new ac(`${e}. HINT: Stack shows most frequent listener (${i[1]}-times)`,i[0]);return(this._options?.onListenerError||n5)(s),or.None}if(this._disposed)return or.None;i&&(e=e.bind(i));let r=new au(e),n;this._leakageMon&&this._size>=Math.ceil(.2*this._leakageMon.threshold)&&(r.stack=al.create(),n=this._leakageMon.check(r.stack,this._size+1)),this._listeners?this._listeners instanceof au?(this._deliveryQueue??=new af,this._listeners=[this._listeners,r]):this._listeners.push(r):(this._options?.onWillAddFirstListener?.(this),this._listeners=r,this._options?.onDidAddFirstListener?.(this)),this._size++;let o=oi(()=>{ao?.unregister(o),n?.(),this._removeListener(r)});if(s instanceof os?s.add(o):Array.isArray(s)&&s.push(o),ao){let e=Error().stack.split(`
`).slice(2,3).join(`
`).trim(),i=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(e);ao.register(o,i?.[2]??e,o)}return o},this._event}_removeListener(e){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(1===this._size){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let i=this._listeners,s=i.indexOf(e);if(-1===s)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),Error("Attempted to dispose unknown listener");this._size--,i[s]=void 0;let r=this._deliveryQueue.current===this;if(2*this._size<=i.length){let e=0;for(let s=0;s<i.length;s++)i[s]?i[e++]=i[s]:r&&(this._deliveryQueue.end--,e<this._deliveryQueue.i&&this._deliveryQueue.i--);i.length=e}}_deliver(e,i){if(!e)return;let s=this._options?.onListenerError||n5;try{e.value(i)}catch(e){s(e)}}_deliverQueue(e){let i=e.current._listeners;for(;e.i<e.end;)this._deliver(i[e.i++],e.value);e.reset()}fire(e){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof au)this._deliver(this._listeners,e);else{let i=this._deliveryQueue;i.enqueue(this,e,this._listeners.length),this._deliverQueue(i)}this._perfMon?.stop()}hasListeners(){return this._size>0}},af=class{constructor(){this.i=-1,this.end=0}enqueue(e,i,s){this.i=0,this.end=s,this.current=e,this.value=i}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},ag={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}},ap=class e{constructor(e,i,s){this._document=e,this._config=i,this._unicodeService=s,this._didWarmUp=!1,this._cacheMap=new o5,this._cacheMapCombined=new o5,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new o8,this._textureSize=512,this._onAddTextureAtlasCanvas=new a_,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new a_,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=ab(e,4*this._config.deviceCellWidth+4,this._config.deviceCellHeight+4),this._tmpCtx=oT(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}get pages(){return this._pages}dispose(){for(let e of(this._tmpCanvas.remove(),this.pages))e.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){let e=new o9;for(let i=33;i<126;i++)e.enqueue(()=>{if(!this._cacheMap.get(i,0,0,0)){let e=this._drawToCache(i,0,0,0,!1,void 0);this._cacheMap.set(i,0,0,0,e)}})}beginFrame(){return this._requestClearModel}clearTexture(){if(0!==this._pages[0].currentRow.x||0!==this._pages[0].currentRow.y){for(let e of this._pages)e.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if(e.maxAtlasPages&&this._pages.length>=Math.max(4,e.maxAtlasPages)){let i=this._pages.filter(i=>2*i.canvas.width<=(e.maxTextureSize||4096)).sort((e,i)=>i.canvas.width!==e.canvas.width?i.canvas.width-e.canvas.width:i.percentageUsed-e.percentageUsed),s=-1,r=0;for(let e=0;e<i.length;e++)if(i[e].canvas.width!==r)s=e,r=i[e].canvas.width;else if(e-s==3)break;let n=i.slice(s,s+4),o=n.map(e=>e.glyphs[0].texturePage).sort((e,i)=>e>i?1:-1),a=this.pages.length-n.length,l=this._mergePages(n,a);l.version++;for(let e=o.length-1;e>=0;e--)this._deletePage(o[e]);this.pages.push(l),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(l.canvas)}let i=new am(this._document,this._textureSize);return this._pages.push(i),this._activePages.push(i),this._onAddTextureAtlasCanvas.fire(i.canvas),i}_mergePages(e,i){let s=2*e[0].canvas.width,r=new am(this._document,s,e);for(let[n,o]of e.entries()){let e=n*o.canvas.width%s,a=Math.floor(n/2)*o.canvas.height;for(let n of(r.ctx.drawImage(o.canvas,e,a),o.glyphs))n.texturePage=i,n.sizeClipSpace.x=n.size.x/s,n.sizeClipSpace.y=n.size.y/s,n.texturePosition.x+=e,n.texturePosition.y+=a,n.texturePositionClipSpace.x=n.texturePosition.x/s,n.texturePositionClipSpace.y=n.texturePosition.y/s;this._onRemoveTextureAtlasCanvas.fire(o.canvas);let l=this._activePages.indexOf(o);-1!==l&&this._activePages.splice(l,1)}return r}_deletePage(e){this._pages.splice(e,1);for(let i=e;i<this._pages.length;i++){let e=this._pages[i];for(let i of e.glyphs)i.texturePage--;e.version++}}getRasterizedGlyphCombinedChar(e,i,s,r,n,o){return this._getFromCacheMap(this._cacheMapCombined,e,i,s,r,n,o)}getRasterizedGlyph(e,i,s,r,n,o){return this._getFromCacheMap(this._cacheMap,e,i,s,r,n,o)}_getFromCacheMap(e,i,s,r,n,o,a){return(aa=e.get(i,s,r,n))||(aa=this._drawToCache(i,s,r,n,o,a),e.set(i,s,r,n,aa)),aa}_getColorFromAnsiIndex(e){if(e>=this._config.colors.ansi.length)throw Error("No color found for idx "+e);return this._config.colors.ansi[e]}_getBackgroundColor(e,i,s,r){let n;if(this._config.allowTransparency)return oS;switch(e){case 0x1000000:case 0x2000000:n=this._getColorFromAnsiIndex(i);break;case 0x3000000:let o=o8.toColorRGB(i);n=og.toColor(o[0],o[1],o[2]);break;default:n=s?oN.opaque(this._config.colors.foreground):this._config.colors.background}return this._config.allowTransparency||(n=oN.opaque(n)),n}_getForegroundColor(e,i,s,r,n,o,a,l,h,c){let d,u=this._getMinimumContrastColor(e,i,s,r,n,o,a,h,l,c);if(u)return u;switch(n){case 0x1000000:case 0x2000000:this._config.drawBoldTextInBrightColors&&h&&o<8&&(o+=8),d=this._getColorFromAnsiIndex(o);break;case 0x3000000:let _=o8.toColorRGB(o);d=og.toColor(_[0],_[1],_[2]);break;default:d=a?this._config.colors.background:this._config.colors.foreground}return this._config.allowTransparency&&(d=oN.opaque(d)),l&&(d=oN.multiplyOpacity(d,.5)),d}_resolveBackgroundRgba(e,i,s){switch(e){case 0x1000000:case 0x2000000:return this._getColorFromAnsiIndex(i).rgba;case 0x3000000:return i<<8;default:return s?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(e,i,s,r){switch(e){case 0x1000000:case 0x2000000:return this._config.drawBoldTextInBrightColors&&r&&i<8&&(i+=8),this._getColorFromAnsiIndex(i).rgba;case 0x3000000:return i<<8;default:return s?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(e,i,s,r,n,o,a,l,h,c){if(1===this._config.minimumContrastRatio||c)return;let d=this._getContrastCache(h),u=d.getColor(e,r);if(void 0!==u)return u||void 0;let _=this._resolveBackgroundRgba(i,s,a),f=this._resolveForegroundRgba(n,o,a,l),g=oF.ensureContrastRatio(_,f,this._config.minimumContrastRatio/(h?2:1));if(!g)return void d.setColor(e,r,null);let p=og.toColor(g>>24&255,g>>16&255,g>>8&255);return d.setColor(e,r,p),p}_getContrastCache(e){return e?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(i,s,r,n,o,a){var l;let h="number"==typeof i?String.fromCharCode(i):i;a&&this._tmpCanvas.parentElement!==a&&(this._tmpCanvas.style.display="none",a.append(this._tmpCanvas));let c=Math.min(this._config.deviceCellWidth*Math.max(h.length,2)+4,this._config.deviceMaxTextureSize);this._tmpCanvas.width<c&&(this._tmpCanvas.width=c);let d=Math.min(this._config.deviceCellHeight+8,this._textureSize);if(this._tmpCanvas.height<d&&(this._tmpCanvas.height=d),this._tmpCtx.save(),this._workAttributeData.fg=r,this._workAttributeData.bg=s,this._workAttributeData.extended.ext=n,this._workAttributeData.isInvisible())return ag;let u=!!this._workAttributeData.isBold(),_=!!this._workAttributeData.isInverse(),f=!!this._workAttributeData.isDim(),g=!!this._workAttributeData.isItalic(),p=!!this._workAttributeData.isUnderline(),m=!!this._workAttributeData.isStrikethrough(),v=!!this._workAttributeData.isOverline(),b=this._workAttributeData.getFgColor(),S=this._workAttributeData.getFgColorMode(),w=this._workAttributeData.getBgColor(),y=this._workAttributeData.getBgColorMode();if(_){let e=b;b=w,w=e;let i=S;S=y,y=i}let C=this._getBackgroundColor(y,w,_,f);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=C.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";let x=u?this._config.fontWeightBold:this._config.fontWeight;this._tmpCtx.font=`${g?"italic":""} ${x} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=oY;let E=1===h.length&&oB(h.charCodeAt(0)),k=1===h.length&&57520<=(l=h.charCodeAt(0))&&l<=57527,A=this._getForegroundColor(s,y,w,r,S,b,_,f,u,oM(h.charCodeAt(0)));this._tmpCtx.fillStyle=A.css;let R=4*!k,L=!1;!1!==this._config.customGlyphs&&(L=function(e,i,s,r,n,o,a,l){let h=oX[i];if(h)return function(e,i,s,r,n,o){for(let a=0;a<i.length;a++){let l=i[a],h=n/8,c=o/8;e.fillRect(s+l.x*h,r+l.y*c,l.w*h,l.h*c)}}(e,h,s,r,n,o),!0;let c=oZ[i];if(c)return function(e,i,s,r,n,o){let a=oQ.get(i);a||(a=new Map,oQ.set(i,a));let l=e.fillStyle;if("string"!=typeof l)throw Error(`Unexpected fillStyle type "${l}"`);let h=a.get(l);if(!h){let s=i[0].length,r=i.length,n=e.canvas.ownerDocument.createElement("canvas");n.width=s,n.height=r;let o=oT(n.getContext("2d")),c=new ImageData(s,r),d,u,_,f;if(l.startsWith("#"))d=parseInt(l.slice(1,3),16),u=parseInt(l.slice(3,5),16),_=parseInt(l.slice(5,7),16),f=l.length>7&&parseInt(l.slice(7,9),16)||1;else if(l.startsWith("rgba"))[d,u,_,f]=l.substring(5,l.length-1).split(",").map(e=>parseFloat(e));else throw Error(`Unexpected fillStyle color format "${l}" when drawing pattern glyph`);for(let e=0;e<r;e++)for(let r=0;r<s;r++)c.data[(e*s+r)*4]=d,c.data[(e*s+r)*4+1]=u,c.data[(e*s+r)*4+2]=_,c.data[(e*s+r)*4+3]=i[e][r]*(255*f);o.putImageData(c,0,0),h=oT(e.createPattern(n,null)),a.set(l,h)}e.fillStyle=h,e.fillRect(s,r,n,o)}(e,c,s,r,n,o),!0;let d=oj[i];if(d)return function(e,i,s,r,n,o,a){for(let[l,h]of(e.strokeStyle=e.fillStyle,Object.entries(i))){for(let i of(e.beginPath(),e.lineWidth=a*Number.parseInt(l),("function"==typeof h?h(.15,.15/o*n):h).split(" "))){let l=i[0],h=o0[l];if(!h){console.error(`Could not find drawing instructions for "${l}"`);continue}let c=i.substring(1).split(",");c[0]&&c[1]&&h(e,o1(c,n,o,s,r,!0,a))}e.stroke(),e.closePath()}}(e,d,s,r,n,o,l),!0;let u=oq[i];return!!u&&(function(e,i,s,r,n,o,a,l){let h=new Path2D;h.rect(s,r,n,o),e.clip(h),e.beginPath();let c=a/12;for(let a of(e.lineWidth=l*c,i.d.split(" "))){let h=a[0],d=o0[h];if(!d){console.error(`Could not find drawing instructions for "${h}"`);continue}let u=a.substring(1).split(",");u[0]&&u[1]&&d(e,o1(u,n,o,s,r,!1,l,(i.leftPadding??0)*(c/2),(i.rightPadding??0)*(c/2)))}1===i.type?(e.strokeStyle=e.fillStyle,e.stroke()):e.fill(),e.closePath()}(e,u,s,r,n,o,a,l),!0)}(this._tmpCtx,h,R,R,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let T=!E,B;if(B="number"==typeof i?this._unicodeService.wcwidth(i):this._unicodeService.getStringCellWidth(i),p){this._tmpCtx.save();let e=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),i=.5*(e%2==1);if(this._tmpCtx.lineWidth=e,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())T=!1,this._tmpCtx.strokeStyle=`rgb(${o8.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{T=!1;let e=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&e<8&&(e+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(e).css}this._tmpCtx.beginPath();let s=Math.ceil(R+this._config.deviceCharHeight)-i-(o?2*e:0),r=s+e,n=s+2*e,a=this._workAttributeData.getUnderlineVariantOffset();for(let o=0;o<B;o++){this._tmpCtx.save();let l=R+o*this._config.deviceCellWidth,h=R+(o+1)*this._config.deviceCellWidth,c=l+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(l,s),this._tmpCtx.lineTo(h,s),this._tmpCtx.moveTo(l,n),this._tmpCtx.lineTo(h,n);break;case 3:let d=e<=1?n:Math.ceil(R+this._config.deviceCharHeight-e/2)-i,u=e<=1?s:Math.ceil(R+this._config.deviceCharHeight+e/2)-i,_=new Path2D;_.rect(l,s,this._config.deviceCellWidth,n-s),this._tmpCtx.clip(_),this._tmpCtx.moveTo(l-this._config.deviceCellWidth/2,r),this._tmpCtx.bezierCurveTo(l-this._config.deviceCellWidth/2,u,l,u,l,r),this._tmpCtx.bezierCurveTo(l,d,c,d,c,r),this._tmpCtx.bezierCurveTo(c,u,h,u,h,r),this._tmpCtx.bezierCurveTo(h,d,h+this._config.deviceCellWidth/2,d,h+this._config.deviceCellWidth/2,r);break;case 4:let f=0===a?0:a>=e?2*e-a:e-a;!(a>=e)==!1||0===f?(this._tmpCtx.setLineDash([Math.round(e),Math.round(e)]),this._tmpCtx.moveTo(l+f,s)):(this._tmpCtx.setLineDash([Math.round(e),Math.round(e)]),this._tmpCtx.moveTo(l,s),this._tmpCtx.lineTo(l+f,s),this._tmpCtx.moveTo(l+f+e,s)),this._tmpCtx.lineTo(h,s),a=function(e,i,s=0){return(e-(2*Math.round(i)-s))%(2*Math.round(i))}(h-l,e,a);break;case 5:let g=h-l,p=Math.floor(.6*g),m=Math.floor(.3*g),v=g-p-m;this._tmpCtx.setLineDash([p,m,v]),this._tmpCtx.moveTo(l,s),this._tmpCtx.lineTo(h,s);break;default:this._tmpCtx.moveTo(l,s),this._tmpCtx.lineTo(h,s)}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!L&&this._config.fontSize>=12&&!this._config.allowTransparency&&" "!==h){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";let i=this._tmpCtx.measureText(h);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in i&&i.actualBoundingBoxDescent>0){this._tmpCtx.save();let i=new Path2D;i.rect(R,s-Math.ceil(e/2),this._config.deviceCellWidth*B,n-s+Math.ceil(e/2)),this._tmpCtx.clip(i),this._tmpCtx.lineWidth=3*this._config.devicePixelRatio,this._tmpCtx.strokeStyle=C.css,this._tmpCtx.strokeText(h,R,R+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(v){let e=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),i=.5*(e%2==1);this._tmpCtx.lineWidth=e,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(R,R+i),this._tmpCtx.lineTo(R+this._config.deviceCharWidth*B,R+i),this._tmpCtx.stroke()}if(L||this._tmpCtx.fillText(h,R,R+this._config.deviceCharHeight),"_"===h&&!this._config.allowTransparency){let e=av(this._tmpCtx.getImageData(R,R,this._config.deviceCellWidth,this._config.deviceCellHeight),C,A,T);if(e)for(let i=1;i<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=C.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(h,R,R+this._config.deviceCharHeight-i),e=av(this._tmpCtx.getImageData(R,R,this._config.deviceCellWidth,this._config.deviceCellHeight),C,A,T));i++);}if(m){let e=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),i=.5*(this._tmpCtx.lineWidth%2==1);this._tmpCtx.lineWidth=e,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(R,R+Math.floor(this._config.deviceCharHeight/2)-i),this._tmpCtx.lineTo(R+this._config.deviceCharWidth*B,R+Math.floor(this._config.deviceCharHeight/2)-i),this._tmpCtx.stroke()}this._tmpCtx.restore();let M=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height);if(this._config.allowTransparency?function(e){for(let i=0;i<e.data.length;i+=4)if(e.data[i+3]>0)return!1;return!0}(M):av(M,C,A,T))return ag;let I=this._findGlyphBoundingBox(M,this._workBoundingBox,c,k,L,R),D,N;for(;;){if(0===this._activePages.length){let e=this._createNewPage();D=e,(N=e.currentRow).height=I.size.y;break}for(let e of(N=(D=this._activePages[this._activePages.length-1]).currentRow,this._activePages))I.size.y<=e.currentRow.height&&(D=e,N=e.currentRow);for(let e=this._activePages.length-1;e>=0;e--)for(let i of this._activePages[e].fixedRows)i.height<=N.height&&I.size.y<=i.height&&(D=this._activePages[e],N=i);if(I.size.x>this._textureSize){this._overflowSizePage||(this._overflowSizePage=new am(this._document,this._config.deviceMaxTextureSize),this.pages.push(this._overflowSizePage),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(this._overflowSizePage.canvas)),D=this._overflowSizePage,(N=this._overflowSizePage.currentRow).x+I.size.x>=D.canvas.width&&(N.x=0,N.y+=N.height,N.height=0);break}if(N.y+I.size.y>=D.canvas.height||N.height>I.size.y+2){let i=!1;if(D.currentRow.y+D.currentRow.height+I.size.y>=D.canvas.height){let s;for(let e of this._activePages)if(e.currentRow.y+e.currentRow.height+I.size.y<e.canvas.height){s=e;break}if(s)D=s;else if(e.maxAtlasPages&&this._pages.length>=e.maxAtlasPages&&N.y+I.size.y<=D.canvas.height&&N.height>=I.size.y&&N.x+I.size.x<=D.canvas.width)i=!0;else{let e=this._createNewPage();D=e,(N=e.currentRow).height=I.size.y,i=!0}}i||(D.currentRow.height>0&&D.fixedRows.push(D.currentRow),N={x:0,y:D.currentRow.y+D.currentRow.height,height:I.size.y},D.fixedRows.push(N),D.currentRow={x:0,y:N.y+N.height,height:0})}if(N.x+I.size.x<=D.canvas.width)break;N===D.currentRow?(N.x=0,N.y+=N.height,N.height=0):D.fixedRows.splice(D.fixedRows.indexOf(N),1)}return I.texturePage=this._pages.indexOf(D),I.texturePosition.x=N.x,I.texturePosition.y=N.y,I.texturePositionClipSpace.x=N.x/D.canvas.width,I.texturePositionClipSpace.y=N.y/D.canvas.height,I.sizeClipSpace.x/=D.canvas.width,I.sizeClipSpace.y/=D.canvas.height,N.height=Math.max(N.height,I.size.y),N.x+=I.size.x,D.ctx.putImageData(M,I.texturePosition.x-this._workBoundingBox.left,I.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,I.size.x,I.size.y),D.addGlyph(I),D.version++,I}_findGlyphBoundingBox(e,i,s,r,n,o){i.top=0;let a=r?this._config.deviceCellHeight:this._tmpCanvas.height,l=r?this._config.deviceCellWidth:s,h=!1;for(let s=0;s<a;s++){for(let r=0;r<l;r++){let n=s*this._tmpCanvas.width*4+4*r+3;if(0!==e.data[n]){i.top=s,h=!0;break}}if(h)break}i.left=0,h=!1;for(let s=0;s<o+l;s++){for(let r=0;r<a;r++){let n=r*this._tmpCanvas.width*4+4*s+3;if(0!==e.data[n]){i.left=s,h=!0;break}}if(h)break}i.right=l,h=!1;for(let s=o+l-1;s>=o;s--){for(let r=0;r<a;r++){let n=r*this._tmpCanvas.width*4+4*s+3;if(0!==e.data[n]){i.right=s,h=!0;break}}if(h)break}i.bottom=a,h=!1;for(let s=a-1;s>=0;s--){for(let r=0;r<l;r++){let n=s*this._tmpCanvas.width*4+4*r+3;if(0!==e.data[n]){i.bottom=s,h=!0;break}}if(h)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:i.right-i.left+1,y:i.bottom-i.top+1},sizeClipSpace:{x:i.right-i.left+1,y:i.bottom-i.top+1},offset:{x:-i.left+o+(r||n?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-i.top+o+(r||n?1===this._config.lineHeight?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}},am=class{constructor(e,i,s){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],s)for(let e of s)this._glyphs.push(...e.glyphs),this._usedPixels+=e._usedPixels;this.canvas=ab(e,i,i),this.ctx=oT(this.canvas.getContext("2d",{alpha:!0}))}get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(e){this._glyphs.push(e),this._usedPixels+=e.size.x*e.size.y}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}};function av(e,i,s,r){let n=i.rgba>>>24,o=i.rgba>>>16&255,a=i.rgba>>>8&255,l=Math.floor((Math.abs(n-(s.rgba>>>24))+Math.abs(o-(s.rgba>>>16&255))+Math.abs(a-(s.rgba>>>8&255)))/12),h=!0;for(let i=0;i<e.data.length;i+=4)e.data[i]===n&&e.data[i+1]===o&&e.data[i+2]===a||r&&Math.abs(e.data[i]-n)+Math.abs(e.data[i+1]-o)+Math.abs(e.data[i+2]-a)<l?e.data[i+3]=0:h=!1;return h}function ab(e,i,s){let r=e.createElement("canvas");return r.width=i,r.height=s,r}function aS(e,i){for(let s=0;s<e.colors.ansi.length;s++)if(e.colors.ansi[s].rgba!==i.colors.ansi[s].rgba)return!1;return e.devicePixelRatio===i.devicePixelRatio&&e.customGlyphs===i.customGlyphs&&e.lineHeight===i.lineHeight&&e.letterSpacing===i.letterSpacing&&e.fontFamily===i.fontFamily&&e.fontSize===i.fontSize&&e.fontWeight===i.fontWeight&&e.fontWeightBold===i.fontWeightBold&&e.allowTransparency===i.allowTransparency&&e.deviceCharWidth===i.deviceCharWidth&&e.deviceCharHeight===i.deviceCharHeight&&e.drawBoldTextInBrightColors===i.drawBoldTextInBrightColors&&e.minimumContrastRatio===i.minimumContrastRatio&&e.colors.foreground.rgba===i.colors.foreground.rgba&&e.colors.background.rgba===i.colors.background.rgba}var aw=[];function ay(e,i,s,r,n,o,a,l,h){let c,d=(c={foreground:s.foreground,background:s.background,cursor:oS,cursorAccent:oS,selectionForeground:oS,selectionBackgroundTransparent:oS,selectionBackgroundOpaque:oS,selectionInactiveBackgroundTransparent:oS,selectionInactiveBackgroundOpaque:oS,overviewRulerBorder:oS,scrollbarSliderBackground:oS,scrollbarSliderHoverBackground:oS,scrollbarSliderActiveBackground:oS,ansi:s.ansi.slice(),contrastCache:s.contrastCache,halfContrastCache:s.halfContrastCache},{customGlyphs:i.customGlyphs,devicePixelRatio:l,deviceMaxTextureSize:h,letterSpacing:i.letterSpacing,lineHeight:i.lineHeight,deviceCellWidth:r,deviceCellHeight:n,deviceCharWidth:o,deviceCharHeight:a,fontFamily:i.fontFamily,fontSize:i.fontSize,fontWeight:i.fontWeight,fontWeightBold:i.fontWeightBold,allowTransparency:i.allowTransparency,drawBoldTextInBrightColors:i.drawBoldTextInBrightColors,minimumContrastRatio:i.minimumContrastRatio,colors:c});for(let i=0;i<aw.length;i++){let s=aw[i],r=s.ownedBy.indexOf(e);if(r>=0){if(aS(s.config,d))return s.atlas;1===s.ownedBy.length?(s.atlas.dispose(),aw.splice(i,1)):s.ownedBy.splice(r,1);break}}for(let i=0;i<aw.length;i++){let s=aw[i];if(aS(s.config,d))return s.ownedBy.push(e),s.atlas}let u={atlas:new ap(document,d,e._core.unicodeService),config:d,ownedBy:[e]};return aw.push(u),u.atlas}function aC(e){for(let i=0;i<aw.length;i++){let s=aw[i].ownedBy.indexOf(e);if(-1!==s){1===aw[i].ownedBy.length?(aw[i].atlas.dispose(),aw.splice(i,1)):aw[i].ownedBy.splice(s,1);break}}}var ax=class{constructor(e,i){this._renderCallback=e,this._coreBrowserService=i,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval(e=600){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout(()=>{if(this._animationTimeRestarted){let e=600-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,e>0)return void this._restartInterval(e)}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=this._coreBrowserService.window.setInterval(()=>{if(this._animationTimeRestarted){let e=600-(Date.now()-this._animationTimeRestarted);this._animationTimeRestarted=void 0,this._restartInterval(e);return}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},600)},e)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}};function aE(e,i,s){let r=new i.ResizeObserver(i=>{let n=i.find(i=>i.target===e);if(!n)return;if(!("devicePixelContentBoxSize"in n)){r?.disconnect(),r=void 0;return}let o=n.devicePixelContentBoxSize[0].inlineSize,a=n.devicePixelContentBoxSize[0].blockSize;o>0&&a>0&&s(o,a)});try{r.observe(e,{box:["device-pixel-content-box"]})}catch{r.disconnect(),r=void 0}return oi(()=>r?.disconnect())}var ak=class e extends o8{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new o7,this.combinedData=""}static fromCharData(i){let s=new e;return s.setFromCharData(i),s}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){var e;return 2097152&this.content?this.combinedData:2097151&this.content?(e=2097151&this.content)>65535?String.fromCharCode(((e-=65536)>>10)+55296)+String.fromCharCode(e%1024+56320):String.fromCharCode(e):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(e){this.fg=e[0],this.bg=0;let i=!1;if(e[1].length>2)i=!0;else if(2===e[1].length){let s=e[1].charCodeAt(0);if(55296<=s&&s<=56319){let r=e[1].charCodeAt(1);56320<=r&&r<=57343?this.content=(s-55296)*1024+r-56320+65536|e[2]<<22:i=!0}else i=!0}else this.content=e[1].charCodeAt(0)|e[2]<<22;i&&(this.combinedData=e[1],this.content=2097152|e[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},aA=new Float32Array([2,0,0,0,0,-2,0,0,0,0,1,0,-1,1,0,1]);function aR(e,i,s){let r=oT(e.createProgram());if(e.attachShader(r,oT(aL(e,e.VERTEX_SHADER,i))),e.attachShader(r,oT(aL(e,e.FRAGMENT_SHADER,s))),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS))return r;console.error(e.getProgramInfoLog(r)),e.deleteProgram(r)}function aL(e,i,s){let r=oT(e.createShader(i));if(e.shaderSource(r,s),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))return r;console.error(e.getShaderInfoLog(r)),e.deleteShader(r)}var aT,aB=class{constructor(e){this.texture=e,this.version=-1}},aM=`#version 300 es
layout (location = 0) in vec2 a_unitquad;
layout (location = 1) in vec2 a_cellpos;
layout (location = 2) in vec2 a_offset;
layout (location = 3) in vec2 a_size;
layout (location = 4) in float a_texpage;
layout (location = 5) in vec2 a_texcoord;
layout (location = 6) in vec2 a_texsize;

uniform mat4 u_projection;
uniform vec2 u_resolution;

out vec2 v_texcoord;
flat out int v_texpage;

void main() {
  vec2 zeroToOne = (a_offset / u_resolution) + a_cellpos + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_texpage = int(a_texpage);
  v_texcoord = a_texcoord + a_unitquad * a_texsize;
}`,aI=11*Float32Array.BYTES_PER_ELEMENT,aD=0,aN=0,aO=0,aP=class extends or{constructor(e,i,s,r){super(),this._terminal=e,this._gl=i,this._dimensions=s,this._optionsService=r,this._activeBuffer=0,this._vertices={count:0,attributes:new Float32Array(0),attributesBuffers:[new Float32Array(0),new Float32Array(0)]};let n=this._gl;void 0===ap.maxAtlasPages&&(ap.maxAtlasPages=Math.min(32,oT(n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS))),ap.maxTextureSize=oT(n.getParameter(n.MAX_TEXTURE_SIZE))),this._program=oT(aR(n,aM,function(e){let i="";for(let s=1;s<e;s++)i+=` else if (v_texpage == ${s}) { outColor = texture(u_texture[${s}], v_texcoord); }`;return`#version 300 es
precision lowp float;

in vec2 v_texcoord;
flat in int v_texpage;

uniform sampler2D u_texture[${e}];

out vec4 outColor;

void main() {
  if (v_texpage == 0) {
    outColor = texture(u_texture[0], v_texcoord);
  } ${i}
}`}(ap.maxAtlasPages))),this._register(oi(()=>n.deleteProgram(this._program))),this._projectionLocation=oT(n.getUniformLocation(this._program,"u_projection")),this._resolutionLocation=oT(n.getUniformLocation(this._program,"u_resolution")),this._textureLocation=oT(n.getUniformLocation(this._program,"u_texture")),this._vertexArrayObject=n.createVertexArray(),n.bindVertexArray(this._vertexArrayObject);let o=new Float32Array([0,0,1,0,0,1,1,1]),a=n.createBuffer();this._register(oi(()=>n.deleteBuffer(a))),n.bindBuffer(n.ARRAY_BUFFER,a),n.bufferData(n.ARRAY_BUFFER,o,n.STATIC_DRAW),n.enableVertexAttribArray(0),n.vertexAttribPointer(0,2,this._gl.FLOAT,!1,0,0);let l=new Uint8Array([0,1,2,3]),h=n.createBuffer();this._register(oi(()=>n.deleteBuffer(h))),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,h),n.bufferData(n.ELEMENT_ARRAY_BUFFER,l,n.STATIC_DRAW),this._attributesBuffer=oT(n.createBuffer()),this._register(oi(()=>n.deleteBuffer(this._attributesBuffer))),n.bindBuffer(n.ARRAY_BUFFER,this._attributesBuffer),n.enableVertexAttribArray(2),n.vertexAttribPointer(2,2,n.FLOAT,!1,aI,0),n.vertexAttribDivisor(2,1),n.enableVertexAttribArray(3),n.vertexAttribPointer(3,2,n.FLOAT,!1,aI,2*Float32Array.BYTES_PER_ELEMENT),n.vertexAttribDivisor(3,1),n.enableVertexAttribArray(4),n.vertexAttribPointer(4,1,n.FLOAT,!1,aI,4*Float32Array.BYTES_PER_ELEMENT),n.vertexAttribDivisor(4,1),n.enableVertexAttribArray(5),n.vertexAttribPointer(5,2,n.FLOAT,!1,aI,5*Float32Array.BYTES_PER_ELEMENT),n.vertexAttribDivisor(5,1),n.enableVertexAttribArray(6),n.vertexAttribPointer(6,2,n.FLOAT,!1,aI,7*Float32Array.BYTES_PER_ELEMENT),n.vertexAttribDivisor(6,1),n.enableVertexAttribArray(1),n.vertexAttribPointer(1,2,n.FLOAT,!1,aI,9*Float32Array.BYTES_PER_ELEMENT),n.vertexAttribDivisor(1,1),n.useProgram(this._program);let c=new Int32Array(ap.maxAtlasPages);for(let e=0;e<ap.maxAtlasPages;e++)c[e]=e;n.uniform1iv(this._textureLocation,c),n.uniformMatrix4fv(this._projectionLocation,!1,aA),this._atlasTextures=[];for(let e=0;e<ap.maxAtlasPages;e++){let i=new aB(oT(n.createTexture()));this._register(oi(()=>n.deleteTexture(i.texture))),n.activeTexture(n.TEXTURE0+e),n.bindTexture(n.TEXTURE_2D,i.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,new Uint8Array([255,0,0,255])),this._atlasTextures[e]=i}n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.handleResize()}beginFrame(){return!this._atlas||this._atlas.beginFrame()}updateCell(e,i,s,r,n,o,a,l,h){this._updateCell(this._vertices.attributes,e,i,s,r,n,o,a,l,h)}_updateCell(e,i,s,r,n,o,a,l,h,c){var d,u;(aD=(s*this._terminal.cols+i)*11,0===r||void 0===r)?e.fill(0,aD,aD+11-1-2):this._atlas&&(aT=l&&l.length>1?this._atlas.getRasterizedGlyphCombinedChar(l,n,o,a,!1,this._terminal.element):this._atlas.getRasterizedGlyph(r,n,o,a,!1,this._terminal.element),aN=Math.floor((this._dimensions.device.cell.width-this._dimensions.device.char.width)/2),n!==c&&aT.offset.x>aN?(aO=aT.offset.x-aN,e[aD]=-(aT.offset.x-aO)+this._dimensions.device.char.left,e[aD+1]=-aT.offset.y+this._dimensions.device.char.top,e[aD+2]=(aT.size.x-aO)/this._dimensions.device.canvas.width,e[aD+3]=aT.size.y/this._dimensions.device.canvas.height,e[aD+4]=aT.texturePage,e[aD+5]=aT.texturePositionClipSpace.x+aO/this._atlas.pages[aT.texturePage].canvas.width,e[aD+6]=aT.texturePositionClipSpace.y,e[aD+7]=aT.sizeClipSpace.x-aO/this._atlas.pages[aT.texturePage].canvas.width):(e[aD]=-aT.offset.x+this._dimensions.device.char.left,e[aD+1]=-aT.offset.y+this._dimensions.device.char.top,e[aD+2]=aT.size.x/this._dimensions.device.canvas.width,e[aD+3]=aT.size.y/this._dimensions.device.canvas.height,e[aD+4]=aT.texturePage,e[aD+5]=aT.texturePositionClipSpace.x,e[aD+6]=aT.texturePositionClipSpace.y,e[aD+7]=aT.sizeClipSpace.x),e[aD+8]=aT.sizeClipSpace.y,this._optionsService.rawOptions.rescaleOverlappingGlyphs&&(d=aT.size.x,u=this._dimensions.device.cell.width,1===h&&d>Math.ceil(1.5*u)&&void 0!==r&&r>255&&!(r>=128512&&r<=128591||r>=127744&&r<=128511||r>=128640&&r<=128767||r>=9728&&r<=9983||r>=9984&&r<=10175||r>=65024&&r<=65039||r>=129280&&r<=129535||r>=127462&&r<=127487)&&!oB(r)&&!(57344<=r&&r<=63743))&&(e[aD+2]=(this._dimensions.device.cell.width-1)/this._dimensions.device.canvas.width))}clear(){let e=this._terminal,i=e.cols*e.rows*11;this._vertices.count!==i?this._vertices.attributes=new Float32Array(i):this._vertices.attributes.fill(0);let s=0;for(;s<this._vertices.attributesBuffers.length;s++)this._vertices.count!==i?this._vertices.attributesBuffers[s]=new Float32Array(i):this._vertices.attributesBuffers[s].fill(0);this._vertices.count=i,s=0;for(let i=0;i<e.rows;i++)for(let r=0;r<e.cols;r++)this._vertices.attributes[s+9]=r/e.cols,this._vertices.attributes[s+10]=i/e.rows,s+=11}handleResize(){let e=this._gl;e.useProgram(this._program),e.viewport(0,0,e.canvas.width,e.canvas.height),e.uniform2f(this._resolutionLocation,e.canvas.width,e.canvas.height),this.clear()}render(e){if(!this._atlas)return;let i=this._gl;i.useProgram(this._program),i.bindVertexArray(this._vertexArrayObject),this._activeBuffer=(this._activeBuffer+1)%2;let s=this._vertices.attributesBuffers[this._activeBuffer],r=0;for(let i=0;i<e.lineLengths.length;i++){let n=i*this._terminal.cols*11,o=this._vertices.attributes.subarray(n,n+11*e.lineLengths[i]);s.set(o,r),r+=o.length}i.bindBuffer(i.ARRAY_BUFFER,this._attributesBuffer),i.bufferData(i.ARRAY_BUFFER,s.subarray(0,r),i.STREAM_DRAW);for(let e=0;e<this._atlas.pages.length;e++)this._atlas.pages[e].version!==this._atlasTextures[e].version&&this._bindAtlasPageTexture(i,this._atlas,e);i.drawElementsInstanced(i.TRIANGLE_STRIP,4,i.UNSIGNED_BYTE,0,r/11)}setAtlas(e){for(let i of(this._atlas=e,this._atlasTextures))i.version=-1}_bindAtlasPageTexture(e,i,s){e.activeTexture(e.TEXTURE0+s),e.bindTexture(e.TEXTURE_2D,this._atlasTextures[s].texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i.pages[s].canvas),e.generateMipmap(e.TEXTURE_2D),this._atlasTextures[s].version=i.pages[s].version}setDimensions(e){this._dimensions=e}},aF=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(e,i,s,r=!1){if(this.selectionStart=i,this.selectionEnd=s,!i||!s||i[0]===s[0]&&i[1]===s[1])return void this.clear();let n=e.buffers.active.ydisp,o=i[1]-n,a=s[1]-n,l=Math.max(o,0),h=Math.min(a,e.rows-1);l>=e.rows||h<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=r,this.viewportStartRow=o,this.viewportEndRow=a,this.viewportCappedStartRow=l,this.viewportCappedEndRow=h,this.startCol=i[0],this.endCol=s[0])}isCellSelected(e,i,s){return!!this.hasSelection&&(s-=e.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?i>=this.startCol&&s>=this.viewportCappedStartRow&&i<this.endCol&&s<=this.viewportCappedEndRow:i<this.startCol&&s>=this.viewportCappedStartRow&&i>=this.endCol&&s<=this.viewportCappedEndRow:s>this.viewportStartRow&&s<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&s===this.viewportStartRow&&i>=this.startCol&&i<this.endCol||this.viewportStartRow<this.viewportEndRow&&s===this.viewportEndRow&&i<this.endCol||this.viewportStartRow<this.viewportEndRow&&s===this.viewportStartRow&&i>=this.startCol)}},aW=class{constructor(){this.cells=new Uint32Array(0),this.lineLengths=new Uint32Array(0),this.selection=new aF}resize(e,i){let s=e*i*4;s!==this.cells.length&&(this.cells=new Uint32Array(s),this.lineLengths=new Uint32Array(i))}clear(){this.cells.fill(0,0),this.lineLengths.fill(0,0)}},az=`#version 300 es
layout (location = 0) in vec2 a_position;
layout (location = 1) in vec2 a_size;
layout (location = 2) in vec4 a_color;
layout (location = 3) in vec2 a_unitquad;

uniform mat4 u_projection;

out vec4 v_color;

void main() {
  vec2 zeroToOne = a_position + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_color = a_color;
}`,aU=`#version 300 es
precision lowp float;

in vec4 v_color;

out vec4 outColor;

void main() {
  outColor = v_color;
}`,a$=8*Float32Array.BYTES_PER_ELEMENT,aV=class{constructor(){this.attributes=new Float32Array(160),this.count=0}},aH=0,aK=0,aG=0,aY=0,aX=0,aZ=0,aj=0,aq=class extends or{constructor(e,i,s,r){super(),this._terminal=e,this._gl=i,this._dimensions=s,this._themeService=r,this._vertices=new aV,this._verticesCursor=new aV;let n=this._gl;this._program=oT(aR(n,az,aU)),this._register(oi(()=>n.deleteProgram(this._program))),this._projectionLocation=oT(n.getUniformLocation(this._program,"u_projection")),this._vertexArrayObject=n.createVertexArray(),n.bindVertexArray(this._vertexArrayObject);let o=new Float32Array([0,0,1,0,0,1,1,1]),a=n.createBuffer();this._register(oi(()=>n.deleteBuffer(a))),n.bindBuffer(n.ARRAY_BUFFER,a),n.bufferData(n.ARRAY_BUFFER,o,n.STATIC_DRAW),n.enableVertexAttribArray(3),n.vertexAttribPointer(3,2,this._gl.FLOAT,!1,0,0);let l=new Uint8Array([0,1,2,3]),h=n.createBuffer();this._register(oi(()=>n.deleteBuffer(h))),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,h),n.bufferData(n.ELEMENT_ARRAY_BUFFER,l,n.STATIC_DRAW),this._attributesBuffer=oT(n.createBuffer()),this._register(oi(()=>n.deleteBuffer(this._attributesBuffer))),n.bindBuffer(n.ARRAY_BUFFER,this._attributesBuffer),n.enableVertexAttribArray(0),n.vertexAttribPointer(0,2,n.FLOAT,!1,a$,0),n.vertexAttribDivisor(0,1),n.enableVertexAttribArray(1),n.vertexAttribPointer(1,2,n.FLOAT,!1,a$,2*Float32Array.BYTES_PER_ELEMENT),n.vertexAttribDivisor(1,1),n.enableVertexAttribArray(2),n.vertexAttribPointer(2,4,n.FLOAT,!1,a$,4*Float32Array.BYTES_PER_ELEMENT),n.vertexAttribDivisor(2,1),this._updateCachedColors(r.colors),this._register(this._themeService.onChangeColors(e=>{this._updateCachedColors(e),this._updateViewportRectangle()}))}renderBackgrounds(){this._renderVertices(this._vertices)}renderCursor(){this._renderVertices(this._verticesCursor)}_renderVertices(e){let i=this._gl;i.useProgram(this._program),i.bindVertexArray(this._vertexArrayObject),i.uniformMatrix4fv(this._projectionLocation,!1,aA),i.bindBuffer(i.ARRAY_BUFFER,this._attributesBuffer),i.bufferData(i.ARRAY_BUFFER,e.attributes,i.DYNAMIC_DRAW),i.drawElementsInstanced(this._gl.TRIANGLE_STRIP,4,i.UNSIGNED_BYTE,0,e.count)}handleResize(){this._updateViewportRectangle()}setDimensions(e){this._dimensions=e}_updateCachedColors(e){this._bgFloat=this._colorToFloat32Array(e.background),this._cursorFloat=this._colorToFloat32Array(e.cursor)}_updateViewportRectangle(){this._addRectangleFloat(this._vertices.attributes,0,0,0,this._terminal.cols*this._dimensions.device.cell.width,this._terminal.rows*this._dimensions.device.cell.height,this._bgFloat)}updateBackgrounds(e){let i=this._terminal,s=this._vertices,r=1,n,o,a,l,h,c,d,u,_,f,g;for(n=0;n<i.rows;n++){for(a=-1,l=0,h=0,c=!1,o=0;o<i.cols;o++)d=(n*i.cols+o)*4,u=e.cells[d+1],f=!!(0x4000000&(_=e.cells[d+2])),(u!==l||_!==h&&(c||f))&&((0!==l||c&&0!==h)&&(g=8*r++,this._updateRectangle(s,g,h,l,a,o,n)),a=o,l=u,h=_,c=f);(0!==l||c&&0!==h)&&(g=8*r++,this._updateRectangle(s,g,h,l,a,i.cols,n))}s.count=r}updateCursor(e){let i=this._verticesCursor,s=e.cursor;if(!s||"block"===s.style){i.count=0;return}let r,n=0;("bar"===s.style||"outline"===s.style)&&(r=8*n++,this._addRectangleFloat(i.attributes,r,s.x*this._dimensions.device.cell.width,s.y*this._dimensions.device.cell.height,"bar"===s.style?s.dpr*s.cursorWidth:s.dpr,this._dimensions.device.cell.height,this._cursorFloat)),("underline"===s.style||"outline"===s.style)&&(r=8*n++,this._addRectangleFloat(i.attributes,r,s.x*this._dimensions.device.cell.width,(s.y+1)*this._dimensions.device.cell.height-s.dpr,s.width*this._dimensions.device.cell.width,s.dpr,this._cursorFloat)),"outline"===s.style&&(r=8*n++,this._addRectangleFloat(i.attributes,r,s.x*this._dimensions.device.cell.width,s.y*this._dimensions.device.cell.height,s.width*this._dimensions.device.cell.width,s.dpr,this._cursorFloat),r=8*n++,this._addRectangleFloat(i.attributes,r,(s.x+s.width)*this._dimensions.device.cell.width-s.dpr,s.y*this._dimensions.device.cell.height,s.dpr,this._dimensions.device.cell.height,this._cursorFloat)),i.count=n}_updateRectangle(e,i,s,r,n,o,a){if(0x4000000&s)switch(0x3000000&s){case 0x1000000:case 0x2000000:aH=this._themeService.colors.ansi[255&s].rgba;break;case 0x3000000:aH=(0xffffff&s)<<8;break;default:aH=this._themeService.colors.foreground.rgba}else switch(0x3000000&r){case 0x1000000:case 0x2000000:aH=this._themeService.colors.ansi[255&r].rgba;break;case 0x3000000:aH=(0xffffff&r)<<8;break;default:aH=this._themeService.colors.background.rgba}e.attributes.length<i+4&&(e.attributes=function(e,i){let s=new Float32Array(Math.min(2*e.length,i));for(let i=0;i<e.length;i++)s[i]=e[i];return s}(e.attributes,this._terminal.rows*this._terminal.cols*8)),aK=n*this._dimensions.device.cell.width,aG=a*this._dimensions.device.cell.height,aY=(aH>>24&255)/255,aX=(aH>>16&255)/255,aZ=(aH>>8&255)/255,aj=1,this._addRectangle(e.attributes,i,aK,aG,(o-n)*this._dimensions.device.cell.width,this._dimensions.device.cell.height,aY,aX,aZ,aj)}_addRectangle(e,i,s,r,n,o,a,l,h,c){e[i]=s/this._dimensions.device.canvas.width,e[i+1]=r/this._dimensions.device.canvas.height,e[i+2]=n/this._dimensions.device.canvas.width,e[i+3]=o/this._dimensions.device.canvas.height,e[i+4]=a,e[i+5]=l,e[i+6]=h,e[i+7]=c}_addRectangleFloat(e,i,s,r,n,o,a){e[i]=s/this._dimensions.device.canvas.width,e[i+1]=r/this._dimensions.device.canvas.height,e[i+2]=n/this._dimensions.device.canvas.width,e[i+3]=o/this._dimensions.device.canvas.height,e[i+4]=a[0],e[i+5]=a[1],e[i+6]=a[2],e[i+7]=a[3]}_colorToFloat32Array(e){return new Float32Array([(e.rgba>>24&255)/255,(e.rgba>>16&255)/255,(e.rgba>>8&255)/255,(255&e.rgba)/255])}},aQ=class extends or{constructor(e,i,s,r,n,o,a,l){super(),this._container=i,this._alpha=n,this._coreBrowserService=o,this._optionsService=a,this._themeService=l,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add(`xterm-${s}-layer`),this._canvas.style.zIndex=r.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this._register(this._themeService.onChangeColors(i=>{this._refreshCharAtlas(e,i),this.reset(e)})),this._register(oi(()=>{this._canvas.remove()}))}_initCanvas(){this._ctx=oT(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(e){}handleFocus(e){}handleCursorMove(e){}handleGridChanged(e,i,s){}handleSelectionChanged(e,i,s,r=!1){}_setTransparency(e,i){if(i===this._alpha)return;let s=this._canvas;this._alpha=i,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,s),this._refreshCharAtlas(e,this._themeService.colors),this.handleGridChanged(e,0,e.rows-1)}_refreshCharAtlas(e,i){this._deviceCharWidth<=0&&this._deviceCharHeight<=0||(this._charAtlas=ay(e,this._optionsService.rawOptions,i,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr,2048),this._charAtlas.warmUp())}resize(e,i){this._deviceCellWidth=i.device.cell.width,this._deviceCellHeight=i.device.cell.height,this._deviceCharWidth=i.device.char.width,this._deviceCharHeight=i.device.char.height,this._deviceCharLeft=i.device.char.left,this._deviceCharTop=i.device.char.top,this._canvas.width=i.device.canvas.width,this._canvas.height=i.device.canvas.height,this._canvas.style.width=`${i.css.canvas.width}px`,this._canvas.style.height=`${i.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(e,this._themeService.colors)}_fillBottomLineAtCells(e,i,s=1){this._ctx.fillRect(e*this._deviceCellWidth,(i+1)*this._deviceCellHeight-this._coreBrowserService.dpr-1,s*this._deviceCellWidth,this._coreBrowserService.dpr)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(e,i,s,r){this._alpha?this._ctx.clearRect(e*this._deviceCellWidth,i*this._deviceCellHeight,s*this._deviceCellWidth,r*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(e*this._deviceCellWidth,i*this._deviceCellHeight,s*this._deviceCellWidth,r*this._deviceCellHeight))}_fillCharTrueColor(e,i,s,r){this._ctx.font=this._getFont(e,!1,!1),this._ctx.textBaseline=oY,this._clipCell(s,r,i.getWidth()),this._ctx.fillText(i.getChars(),s*this._deviceCellWidth+this._deviceCharLeft,r*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_clipCell(e,i,s){this._ctx.beginPath(),this._ctx.rect(e*this._deviceCellWidth,i*this._deviceCellHeight,s*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(e,i,s){let r=i?e.options.fontWeightBold:e.options.fontWeight;return`${s?"italic":""} ${r} ${e.options.fontSize*this._coreBrowserService.dpr}px ${e.options.fontFamily}`}},aJ=class extends aQ{constructor(e,i,s,r,n,o,a){super(s,e,"link",i,!0,n,o,a),this._register(r.onShowLinkUnderline(e=>this._handleShowLinkUnderline(e))),this._register(r.onHideLinkUnderline(e=>this._handleHideLinkUnderline(e)))}resize(e,i){super.resize(e,i),this._state=void 0}reset(e){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);let e=this._state.y2-this._state.y1-1;e>0&&this._clearCells(0,this._state.y1+1,this._state.cols,e),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(e){var i;if(257===e.fg?this._ctx.fillStyle=this._themeService.colors.background.css:void 0!==e.fg&&((0x3000000&(i=e.fg))==0x1000000||(0x3000000&i)==0x2000000)?this._ctx.fillStyle=this._themeService.colors.ansi[e.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,e.y1===e.y2)this._fillBottomLineAtCells(e.x1,e.y1,e.x2-e.x1);else{this._fillBottomLineAtCells(e.x1,e.y1,e.cols-e.x1);for(let i=e.y1+1;i<e.y2;i++)this._fillBottomLineAtCells(0,i,e.cols);this._fillBottomLineAtCells(0,e.y2,e.x2)}this._state=e}_handleHideLinkUnderline(e){this._clearCurrentLink()}},a0="object"==typeof window?window:globalThis,a1=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new a_,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new a_,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(e){return this.mapWindowIdToZoomLevel.get(this.getWindowId(e))??0}setZoomLevel(e,i){if(this.getZoomLevel(i)===e)return;let s=this.getWindowId(i);this.mapWindowIdToZoomLevel.set(s,e),this._onDidChangeZoomLevel.fire(s)}getZoomFactor(e){return this.mapWindowIdToZoomFactor.get(this.getWindowId(e))??1}setZoomFactor(e,i){this.mapWindowIdToZoomFactor.set(this.getWindowId(i),e)}setFullscreen(e,i){if(this.isFullscreen(i)===e)return;let s=this.getWindowId(i);this.mapWindowIdToFullScreen.set(s,e),this._onDidChangeFullscreen.fire(s)}isFullscreen(e){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(e))}getWindowId(e){return e.vscodeWindowId}};a1.INSTANCE=new a1,a1.INSTANCE.onDidChangeZoomLevel,a1.INSTANCE.onDidChangeFullscreen;var a2="object"==typeof navigator?navigator.userAgent:"";a2.indexOf("Firefox"),a2.indexOf("AppleWebKit"),a2.indexOf("Chrome")>=0||a2.indexOf("Safari"),a2.indexOf("Electron/"),a2.indexOf("Android");var a5=!1;if("function"==typeof a0.matchMedia){let e=a0.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),i=a0.matchMedia("(display-mode: fullscreen)");a5=e.matches,a3=e,"string"==typeof a3&&(a3=a0.matchMedia(a3)),a3.addEventListener("change",({matches:e})=>{a5&&i.matches||(a5=e)})}var a3,a6,a4,a9=!1,a8=!1,a7="en",le=globalThis;"u">typeof le.vscode&&"u">typeof le.vscode.process?a4=le.vscode.process:"u">typeof ey.default&&"string"==typeof ey.default?.versions?.node&&(a4=ey.default);var lt="string"==typeof a4?.versions?.electron&&a4?.type==="renderer";if("object"==typeof a4){a4.platform,a4.platform,"linux"===a4.platform&&a4.env.SNAP&&a4.env.SNAP_REVISION,a4.env.CI||a4.env.BUILD_ARTIFACTSTAGINGDIRECTORY,a7="en";let e=a4.env.VSCODE_NLS_CONFIG;if(e)try{let i=JSON.parse(e);i.userLocale,i.osLocale,a7=i.resolvedLanguage||"en",i.languagePack?.translationsConfigFile}catch{}a9=!0}else"object"!=typeof navigator||lt?console.error("Unable to resolve platform."):((a6=navigator.userAgent).indexOf("Windows"),a6.indexOf("Macintosh"),(a6.indexOf("Macintosh")>=0||a6.indexOf("iPad")>=0||a6.indexOf("iPhone")>=0)&&navigator.maxTouchPoints&&navigator.maxTouchPoints,a6.indexOf("Linux"),a6?.indexOf("Mobi"),a8=!0,a7=globalThis._VSCODE_NLS_LANGUAGE||"en",navigator.language.toLowerCase());var li=a9;a8&&"function"==typeof le.importScripts&&le.origin;var ls,lr=a6,ln=a7;(lf=ls||={}).value=function(){return ln},lf.isDefaultVariant=function(){return 2===ln.length?"en"===ln:ln.length>=3&&"e"===ln[0]&&"n"===ln[1]&&"-"===ln[2]},lf.isDefault=function(){return"en"===ln};var lo="function"==typeof le.postMessage&&!le.importScripts,la=(()=>{if(lo){let e=[];le.addEventListener("message",i=>{if(i.data&&i.data.vscodeScheduleAsyncWork)for(let s=0,r=e.length;s<r;s++){let r=e[s];if(r.id===i.data.vscodeScheduleAsyncWork){e.splice(s,1),r.callback();return}}});let i=0;return s=>{let r=++i;e.push({id:r,callback:s}),le.postMessage({vscodeScheduleAsyncWork:r},"*")}}return e=>setTimeout(e)})(),ll=!!(lr&&lr.indexOf("Chrome")>=0);lr&&lr.indexOf("Firefox"),!ll&&lr&&lr.indexOf("Safari"),lr&&lr.indexOf("Edg/"),lr&&lr.indexOf("Android");var lh="object"==typeof navigator?navigator:{};li||document.queryCommandSupported&&document.queryCommandSupported("copy")||lh&&lh.clipboard&&lh.clipboard.writeText,li||lh&&lh.clipboard&&lh.clipboard.readText,li||a5||lh.keyboard,"ontouchstart"in a0||lh.maxTouchPoints,a0.PointerEvent&&("ontouchstart"in a0||navigator.maxTouchPoints);var lc=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(e,i){this._keyCodeToStr[e]=i,this._strToKeyCode[i.toLowerCase()]=e}keyCodeToStr(e){return this._keyCodeToStr[e]}strToKeyCode(e){return this._strToKeyCode[e.toLowerCase()]||0}},ld=new lc,lu=new lc,l_=new lc;(lg=lp||={}).toString=function(e){return ld.keyCodeToStr(e)},lg.fromString=function(e){return ld.strToKeyCode(e)},lg.toUserSettingsUS=function(e){return lu.keyCodeToStr(e)},lg.toUserSettingsGeneral=function(e){return l_.keyCodeToStr(e)},lg.fromUserSettings=function(e){return lu.strToKeyCode(e)||l_.strToKeyCode(e)},lg.toElectronAccelerator=function(e){if(e>=98&&e<=113)return null;switch(e){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return ld.keyCodeToStr(e)};var lf,lg,lp,lm,lv=Object.freeze(function(e,i){let s=setTimeout(e.bind(i),0);return{dispose(){clearTimeout(s)}}});(lQ=lm||={}).isCancellationToken=function(e){return e===lQ.None||e===lQ.Cancelled||e instanceof lb||!!e&&"object"==typeof e&&"boolean"==typeof e.isCancellationRequested&&"function"==typeof e.onCancellationRequested},lQ.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:an.None}),lQ.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:lv});var lb=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?lv:(this._emitter||(this._emitter=new a_),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}};Symbol("MicrotaskDelay"),(lJ=l0||={}).settled=async function(e){let i,s=await Promise.all(e.map(e=>e.then(e=>e,e=>{i||(i=e)})));if("u">typeof i)throw i;return s},lJ.withAsyncBody=function(e){return new Promise(async(i,s)=>{try{await e(i,s)}catch(e){s(e)}})};var lS=class e{static fromArray(i){return new e(e=>{e.emitMany(i)})}static fromPromise(i){return new e(async e=>{e.emitMany(await i)})}static fromPromises(i){return new e(async e=>{await Promise.all(i.map(async i=>e.emitOne(await i)))})}static merge(i){return new e(async e=>{await Promise.all(i.map(async i=>{for await(let s of i)e.emitOne(s)}))})}constructor(e,i){this._state=0,this._results=[],this._error=null,this._onReturn=i,this._onStateChanged=new a_,queueMicrotask(async()=>{let i={emitOne:e=>this.emitOne(e),emitMany:e=>this.emitMany(e),reject:e=>this.reject(e)};try{await Promise.resolve(e(i)),this.resolve()}catch(e){this.reject(e)}finally{i.emitOne=void 0,i.emitMany=void 0,i.reject=void 0}})}[Symbol.asyncIterator](){let e=0;return{next:async()=>{for(;;){if(2===this._state)throw this._error;if(e<this._results.length)return{done:!1,value:this._results[e++]};if(1===this._state)return{done:!0,value:void 0};await an.toPromise(this._onStateChanged.event)}},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(i,s){return new e(async e=>{for await(let r of i)e.emitOne(s(r))})}map(i){return e.map(this,i)}static filter(i,s){return new e(async e=>{for await(let r of i)s(r)&&e.emitOne(r)})}filter(i){return e.filter(this,i)}static coalesce(i){return e.filter(i,e=>!!e)}coalesce(){return e.coalesce(this)}static async toPromise(e){let i=[];for await(let s of e)i.push(s);return i}toPromise(){return e.toPromise(this)}emitOne(e){0===this._state&&(this._results.push(e),this._onStateChanged.fire())}emitMany(e){0===this._state&&(this._results=this._results.concat(e),this._onStateChanged.fire())}resolve(){0===this._state&&(this._state=1,this._onStateChanged.fire())}reject(e){0===this._state&&(this._state=2,this._error=e,this._onStateChanged.fire())}};lS.EMPTY=lS.fromArray([]);function lw(e,i){return(i<<5)-i+e|0}function ly(e,i){i=lw(149417,i);for(let s=0,r=e.length;s<r;s++)i=lw(e.charCodeAt(s),i);return i}new DataView(new ArrayBuffer(320));var{registerWindow:lC,getWindow:lx,getDocument:lE,getWindows:lk,getWindowsCount:lA,getWindowId:lR,getWindowById:lL,hasWindow:lT,onDidRegisterWindow:lB,onWillUnregisterWindow:lM,onDidUnregisterWindow:lI}=(w=new Map,y={window:a0,disposables:new os},w.set(a0.vscodeWindowId,y),C=new a_,x=new a_,E=new a_,{onDidRegisterWindow:C.event,onWillUnregisterWindow:E.event,onDidUnregisterWindow:x.event,registerWindow(e){var i,s;if(w.has(e.vscodeWindowId))return or.None;let r=new os,n={window:e,disposables:r.add(new os)};return w.set(e.vscodeWindowId,n),r.add(oi(()=>{w.delete(e.vscodeWindowId),x.fire(e)})),r.add((i=e,s=lO.BEFORE_UNLOAD,new lD(i,s,()=>{E.fire(e)},void 0))),C.fire(n),r},getWindows:()=>w.values(),getWindowsCount:()=>w.size,getWindowId:e=>e.vscodeWindowId,hasWindow:e=>w.has(e),getWindowById:function(e,i){return("number"==typeof e?w.get(e):void 0)??(i?y:void 0)},getWindow:e=>e?.ownerDocument?.defaultView?e.ownerDocument.defaultView.window:e?.view?e.view.window:a0,getDocument:e=>lx(e).document}),lD=class{constructor(e,i,s,r){this._node=e,this._type=i,this._handler=s,this._options=r||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}},lN=class e{constructor(e,i){this.width=e,this.height=i}with(i=this.width,s=this.height){return i!==this.width||s!==this.height?new e(i,s):this}static is(e){return"object"==typeof e&&"number"==typeof e.height&&"number"==typeof e.width}static lift(i){return i instanceof e?i:new e(i.width,i.height)}static equals(e,i){return e===i||!!e&&!!i&&e.width===i.width&&e.height===i.height}};lN.None=new lN(0,0),new class{constructor(){this.mutationObservers=new Map}observe(e,i,s){let r=this.mutationObservers.get(e);r||(r=new Map,this.mutationObservers.set(e,r));let n=function e(i,s){switch(typeof i){case"object":var r,n,o,a;return null===i?lw(349,s):Array.isArray(i)?(r=i,n=lw(104579,n=s),r.reduce((i,s)=>e(s,i),n)):(o=i,a=lw(181387,a=s),Object.keys(o).sort().reduce((i,s)=>(i=ly(s,i),e(o[s],i)),a));case"string":return ly(i,s);case"boolean":return lw(i?433:863,s);case"number":return lw(i,s);case"undefined":return lw(937,s);default:return lw(617,s)}}(s,0),o=r.get(n);if(o)o.users+=1;else{let a=new a_,l=new MutationObserver(e=>a.fire(e));l.observe(e,s);let h=o={users:1,observer:l,onDidMutate:a.event};i.add(oi(()=>{h.users-=1,0===h.users&&(a.dispose(),l.disconnect(),r?.delete(n),r?.size===0&&this.mutationObservers.delete(e))})),r.set(n,o)}return o.onDidMutate}};var lO={BEFORE_UNLOAD:"beforeunload"},lP=class extends or{constructor(e,i,s,r,n,o,a,l,h){if(super(),this._terminal=e,this._characterJoinerService=i,this._charSizeService=s,this._coreBrowserService=r,this._coreService=n,this._decorationService=o,this._optionsService=a,this._themeService=l,this._cursorBlinkStateManager=new on,this._charAtlasDisposable=this._register(new on),this._observerDisposable=this._register(new on),this._model=new aW,this._workCell=new ak,this._workCell2=new ak,this._rectangleRenderer=this._register(new on),this._glyphRenderer=this._register(new on),this._onChangeTextureAtlas=this._register(new a_),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this._register(new a_),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this._register(new a_),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onRequestRedraw=this._register(new a_),this.onRequestRedraw=this._onRequestRedraw.event,this._onContextLoss=this._register(new a_),this.onContextLoss=this._onContextLoss.event,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._gl=this._canvas.getContext("webgl2",{antialias:!1,depth:!1,preserveDrawingBuffer:h}),!this._gl)throw Error("WebGL2 not supported "+this._gl);this._register(this._themeService.onChangeColors(()=>this._handleColorChange())),this._cellColorResolver=new oG(this._terminal,this._optionsService,this._model.selection,this._decorationService,this._coreBrowserService,this._themeService),this._core=this._terminal._core,this._renderLayers=[new aJ(this._core.screenElement,2,this._terminal,this._core.linkifier,this._coreBrowserService,a,this._themeService)],this.dimensions={css:{canvas:oI(),cell:oI()},device:{canvas:oI(),cell:oI(),char:{width:0,height:0,left:0,top:0}}},this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._updateCursorBlink(),this._register(a.onOptionChange(()=>this._handleOptionsChanged())),this._deviceMaxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._register(function(e,i,s,r){return new lD(e,i,s,void 0)}(this._canvas,"webglcontextlost",e=>{console.log("webglcontextlost event received"),e.preventDefault(),this._contextRestorationTimeout=setTimeout(()=>{this._contextRestorationTimeout=void 0,console.warn("webgl context not restored; firing onContextLoss"),this._onContextLoss.fire(e)},3e3)})),this._register(function(e,i,s,r){return new lD(e,i,s,void 0)}(this._canvas,"webglcontextrestored",e=>{console.warn("webglcontextrestored event received"),clearTimeout(this._contextRestorationTimeout),this._contextRestorationTimeout=void 0,aC(this._terminal),this._initializeWebGLState(),this._requestRedrawViewport()})),this._observerDisposable.value=aE(this._canvas,this._coreBrowserService.window,(e,i)=>this._setCanvasDevicePixelDimensions(e,i)),this._register(this._coreBrowserService.onWindowChange(e=>{this._observerDisposable.value=aE(this._canvas,e,(e,i)=>this._setCanvasDevicePixelDimensions(e,i))})),this._core.screenElement.appendChild(this._canvas),[this._rectangleRenderer.value,this._glyphRenderer.value]=this._initializeWebGLState(),this._isAttached=this._core.screenElement.isConnected,this._register(oi(()=>{for(let e of this._renderLayers)e.dispose();this._canvas.parentElement?.removeChild(this._canvas),aC(this._terminal)}))}get textureAtlas(){return this._charAtlas?.pages[0].canvas}_handleColorChange(){this._refreshCharAtlas(),this._clearModel(!0)}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._terminal.cols,this._terminal.rows))}handleResize(e,i){for(let e of(this._updateDimensions(),this._model.resize(this._terminal.cols,this._terminal.rows),this._renderLayers))e.resize(this._terminal,this.dimensions);this._canvas.width=this.dimensions.device.canvas.width,this._canvas.height=this.dimensions.device.canvas.height,this._canvas.style.width=`${this.dimensions.css.canvas.width}px`,this._canvas.style.height=`${this.dimensions.css.canvas.height}px`,this._core.screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._core.screenElement.style.height=`${this.dimensions.css.canvas.height}px`,this._rectangleRenderer.value?.setDimensions(this.dimensions),this._rectangleRenderer.value?.handleResize(),this._glyphRenderer.value?.setDimensions(this.dimensions),this._glyphRenderer.value?.handleResize(),this._refreshCharAtlas(),this._clearModel(!1)}handleCharSizeChanged(){this.handleResize(this._terminal.cols,this._terminal.rows)}handleBlur(){for(let e of this._renderLayers)e.handleBlur(this._terminal);this._cursorBlinkStateManager.value?.pause(),this._requestRedrawViewport()}handleFocus(){for(let e of this._renderLayers)e.handleFocus(this._terminal);this._cursorBlinkStateManager.value?.resume(),this._requestRedrawViewport()}handleSelectionChanged(e,i,s){for(let r of this._renderLayers)r.handleSelectionChanged(this._terminal,e,i,s);this._model.selection.update(this._core,e,i,s),this._requestRedrawViewport()}handleCursorMove(){for(let e of this._renderLayers)e.handleCursorMove(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation()}_handleOptionsChanged(){this._updateDimensions(),this._refreshCharAtlas(),this._updateCursorBlink()}_initializeWebGLState(){return this._rectangleRenderer.value=new aq(this._terminal,this._gl,this.dimensions,this._themeService),this._glyphRenderer.value=new aP(this._terminal,this._gl,this.dimensions,this._optionsService),this.handleCharSizeChanged(),[this._rectangleRenderer.value,this._glyphRenderer.value]}_refreshCharAtlas(){if(this.dimensions.device.char.width<=0&&this.dimensions.device.char.height<=0){this._isAttached=!1;return}let e=ay(this._terminal,this._optionsService.rawOptions,this._themeService.colors,this.dimensions.device.cell.width,this.dimensions.device.cell.height,this.dimensions.device.char.width,this.dimensions.device.char.height,this._coreBrowserService.dpr,this._deviceMaxTextureSize);this._charAtlas!==e&&(this._onChangeTextureAtlas.fire(e.pages[0].canvas),this._charAtlasDisposable.value=ot(an.forward(e.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),an.forward(e.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas))),this._charAtlas=e,this._charAtlas.warmUp(),this._glyphRenderer.value?.setAtlas(this._charAtlas)}_clearModel(e){this._model.clear(),e&&this._glyphRenderer.value?.clear()}clearTextureAtlas(){this._charAtlas?.clearTexture(),this._clearModel(!0),this._requestRedrawViewport()}clear(){for(let e of(this._clearModel(!0),this._renderLayers))e.reset(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation(),this._updateCursorBlink()}renderRows(e,i){if(!this._isAttached)if(!this._core.screenElement?.isConnected||!this._charSizeService.width||!this._charSizeService.height)return;else this._updateDimensions(),this._refreshCharAtlas(),this._isAttached=!0;for(let s of this._renderLayers)s.handleGridChanged(this._terminal,e,i);this._glyphRenderer.value&&this._rectangleRenderer.value&&(this._glyphRenderer.value.beginFrame()?(this._clearModel(!0),this._updateModel(0,this._terminal.rows-1)):this._updateModel(e,i),this._rectangleRenderer.value.renderBackgrounds(),this._glyphRenderer.value.render(this._model),(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible)&&this._rectangleRenderer.value.renderCursor())}_updateCursorBlink(){this._coreService.decPrivateModes.cursorBlink??this._terminal.options.cursorBlink?this._cursorBlinkStateManager.value=new ax(()=>{this._requestRedrawCursor()},this._coreBrowserService):this._cursorBlinkStateManager.clear(),this._requestRedrawCursor()}_updateModel(e,i){let s=this._core,r=this._workCell,n,o,a,l,h,c,d=0,u=!0,_,f,g,p,m,v,b,S,w;e=lW(e,s.rows-1,0),i=lW(i,s.rows-1,0);let y=this._coreService.decPrivateModes.cursorStyle??s.options.cursorStyle??"block",C=this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY,x=C-s.buffer.ydisp,E=Math.min(this._terminal.buffer.active.cursorX,s.cols-1),k=-1,A=this._coreService.isCursorInitialized&&!this._coreService.isCursorHidden&&(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible);this._model.cursor=void 0;let R=!1;for(o=e;o<=i;o++)for(a=o+s.buffer.ydisp,l=s.buffer.lines.get(a),this._model.lineLengths[o]=0,g=C===a,d=0,h=this._characterJoinerService.getJoinedCharacters(a),S=0;S<s.cols;S++){if(n=this._cellColorResolver.result.bg,l.loadCell(S,r),0===S&&(n=this._cellColorResolver.result.bg),c=!1,u=S>=d,_=S,h.length>0&&S===h[0][0]&&u){f=h.shift();let e=this._model.selection.isCellSelected(this._terminal,f[0],a);for(b=f[0]+1;b<f[1];b++)u&&=e===this._model.selection.isCellSelected(this._terminal,b,a);(u&&=!g||E<f[0]||E>=f[1])?(c=!0,r=new lF(r,l.translateToString(!0,f[0],f[1]),f[1]-f[0]),_=f[1]-1):d=f[1]}if(p=r.getChars(),m=r.getCode(),b=(o*s.cols+S)*4,this._cellColorResolver.resolve(r,S,a,this.dimensions.device.cell.width),A&&a===C&&(S===E&&(this._model.cursor={x:E,y:x,width:r.getWidth(),style:this._coreBrowserService.isFocused?y:s.options.cursorInactiveStyle,cursorWidth:s.options.cursorWidth,dpr:this._devicePixelRatio},k=E+r.getWidth()-1),S>=E&&S<=k&&(this._coreBrowserService.isFocused&&"block"===y||!1===this._coreBrowserService.isFocused&&"block"===s.options.cursorInactiveStyle)&&(this._cellColorResolver.result.fg=0x3000000|this._themeService.colors.cursorAccent.rgba>>8&0xffffff,this._cellColorResolver.result.bg=0x3000000|this._themeService.colors.cursor.rgba>>8&0xffffff)),0!==m&&(this._model.lineLengths[o]=S+1),(this._model.cells[b]!==m||this._model.cells[b+1]!==this._cellColorResolver.result.bg||this._model.cells[b+2]!==this._cellColorResolver.result.fg||this._model.cells[b+3]!==this._cellColorResolver.result.ext)&&(R=!0,p.length>1&&(m|=0x80000000),this._model.cells[b]=m,this._model.cells[b+1]=this._cellColorResolver.result.bg,this._model.cells[b+2]=this._cellColorResolver.result.fg,this._model.cells[b+3]=this._cellColorResolver.result.ext,v=r.getWidth(),this._glyphRenderer.value.updateCell(S,o,m,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,p,v,n),c)){for(r=this._workCell,S++;S<=_;S++)w=(o*s.cols+S)*4,this._glyphRenderer.value.updateCell(S,o,0,0,0,0,"",0,0),this._model.cells[w]=0,this._model.cells[w+1]=this._cellColorResolver.result.bg,this._model.cells[w+2]=this._cellColorResolver.result.fg,this._model.cells[w+3]=this._cellColorResolver.result.ext;S--}}R&&this._rectangleRenderer.value.updateBackgrounds(this._model),this._rectangleRenderer.value.updateCursor(this._model)}_updateDimensions(){this._charSizeService.width&&this._charSizeService.height&&(this.dimensions.device.char.width=Math.floor(this._charSizeService.width*this._devicePixelRatio),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*this._devicePixelRatio),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=1===this._optionsService.rawOptions.lineHeight?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._terminal.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._terminal.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/this._devicePixelRatio),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/this._devicePixelRatio),this.dimensions.css.cell.height=this.dimensions.device.cell.height/this._devicePixelRatio,this.dimensions.css.cell.width=this.dimensions.device.cell.width/this._devicePixelRatio)}_setCanvasDevicePixelDimensions(e,i){this._canvas.width===e&&this._canvas.height===i||(this._canvas.width=e,this._canvas.height=i,this._requestRedrawViewport())}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._terminal.rows-1})}_requestRedrawCursor(){let e=this._terminal.buffer.active.cursorY;this._onRequestRedraw.fire({start:e,end:e})}},lF=class extends o8{constructor(e,i,s){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=i,this._width=s}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}};function lW(e,i,s=0){return Math.max(Math.min(e,i),s)}var lz="di$target",lU="di$dependencies",l$=new Map;function lV(e){if(l$.has(e))return l$.get(e);let i=function(e,s,r){var n,o,a;if(3!=arguments.length)throw Error("@IServiceName-decorator can only be used to decorate a parameter");n=i,o=e,a=r,o[lz]===o?o[lU].push({id:n,index:a}):(o[lU]=[{id:n,index:a}],o[lz]=o)};return i._id=e,l$.set(e,i),i}lV("BufferService"),lV("CoreMouseService"),lV("CoreService"),lV("CharsetService"),lV("InstantiationService"),lV("LogService");var lH=lV("OptionsService");lV("OscLinkService"),lV("UnicodeService"),lV("DecorationService");var lK={trace:0,debug:1,info:2,warn:3,error:4,off:5},lG=class extends or{constructor(e){super(),this._optionsService=e,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel()))}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=lK[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let i=0;i<e.length;i++)"function"==typeof e[i]&&(e[i]=e[i]())}_log(e,i,s){this._evalLazyOptionalParams(s),e.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+i,...s)}trace(e,...i){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,e,i)}debug(e,...i){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,e,i)}info(e,...i){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,e,i)}warn(e,...i){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,e,i)}error(e,...i){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,e,i)}};lG=((e,i,s,r)=>{for(var n,o=r>1?void 0:r?n1(i,s):i,a=e.length-1;a>=0;a--)(n=e[a])&&(o=(r?n(i,s,o):n(o))||o);return r&&o&&n0(i,s,o),o})([(e,i)=>lH(e,i,0)],lG);var lY=class extends or{constructor(e){if(od&&16>function(){if(!od)return 0;let e=oa.match(/Version\/(\d+)/);return null===e||e.length<2?0:parseInt(e[1])}()&&!document.createElement("canvas").getContext("webgl2",{antialias:!1,depth:!1,preserveDrawingBuffer:!0}))throw Error("Webgl2 is only supported on Safari 16 and above");super(),this._preserveDrawingBuffer=e,this._onChangeTextureAtlas=this._register(new a_),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this._register(new a_),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this._register(new a_),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onContextLoss=this._register(new a_),this.onContextLoss=this._onContextLoss.event}activate(e){let i=e._core;if(!e.element)return void this._register(i.onWillOpen(()=>this.activate(e)));this._terminal=e;let s=i.coreService,r=i.optionsService,n=i._renderService,o=i._characterJoinerService,a=i._charSizeService,l=i._coreBrowserService,h=i._decorationService,c=i._logService,d=i._themeService;this._renderer=this._register(new lP(e,o,a,l,s,h,r,d,this._preserveDrawingBuffer)),this._register(an.forward(this._renderer.onContextLoss,this._onContextLoss)),this._register(an.forward(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this._register(an.forward(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),this._register(an.forward(this._renderer.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)),n.setRenderer(this._renderer),this._register(oi(()=>{if(this._terminal._core._store._isDisposed)return;let i=this._terminal._core._renderService;i.setRenderer(this._terminal._core._createRenderer()),i.handleResize(e.cols,e.rows)}))}get textureAtlas(){return this._renderer?.textureAtlas}clearTextureAtlas(){this._renderer?.clearTextureAtlas()}},lX=class{constructor(e,i,s,r={}){this._terminal=e,this._regex=i,this._handler=s,this._options=r}provideLinks(e,i){let s=lZ.computeLink(e,this._regex,this._terminal,this._handler);i(this._addCallbacks(s))}_addCallbacks(e){return e.map(e=>(e.leave=this._options.leave,e.hover=(i,s)=>{if(this._options.hover){let{range:r}=e;this._options.hover(i,s,r)}},e))}},lZ=class e{static computeLink(i,s,r,n){let o=RegExp(s.source,(s.flags||"")+"g"),[a,l]=e._getWindowedLineStrings(i-1,r),h=a.join(""),c,d=[];for(;c=o.exec(h);){let i=c[0];if(!function(e){try{let i=new URL(e),s=i.password&&i.username?`${i.protocol}//${i.username}:${i.password}@${i.host}`:i.username?`${i.protocol}//${i.username}@${i.host}`:`${i.protocol}//${i.host}`;return e.toLocaleLowerCase().startsWith(s.toLocaleLowerCase())}catch{return!1}}(i))continue;let[s,o]=e._mapStrIdx(r,l,0,c.index),[a,h]=e._mapStrIdx(r,s,o,i.length);if(-1===s||-1===o||-1===a||-1===h)continue;let u={start:{x:o+1,y:s+1},end:{x:h,y:a+1}};d.push({range:u,text:i,activate:n})}return d}static _getWindowedLineStrings(e,i){let s,r=e,n=e,o=0,a="",l=[];if(s=i.buffer.active.getLine(e)){let e=s.translateToString(!0);if(s.isWrapped&&" "!==e[0]){for(o=0;(s=i.buffer.active.getLine(--r))&&o<2048&&(o+=(a=s.translateToString(!0)).length,l.push(a),!(!s.isWrapped||-1!==a.indexOf(" "))););l.reverse()}for(l.push(e),o=0;(s=i.buffer.active.getLine(++n))&&s.isWrapped&&o<2048&&(o+=(a=s.translateToString(!0)).length,l.push(a),-1===a.indexOf(" ")););}return[l,r]}static _mapStrIdx(e,i,s,r){let n=e.buffer.active,o=n.getNullCell(),a=s;for(;r;){let e=n.getLine(i);if(!e)return[-1,-1];for(let s=a;s<e.length;++s){e.getCell(s,o);let a=o.getChars();if(o.getWidth()&&(r-=a.length||1,s===e.length-1&&""===a)){let e=n.getLine(i+1);e&&e.isWrapped&&(e.getCell(0,o),2===o.getWidth()&&(r+=1))}if(r<0)return[i,s]}i++,a=0}return[i,a]}},lj=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function lq(e,i){let s=window.open();if(s){try{s.opener=null}catch{}s.location.href=i}else console.warn("Opening link blocked as opener could not be cleared")}var lQ,lJ,l0,l1,l2=class{constructor(e=lq,i={}){this._handler=e,this._options=i}activate(e){this._terminal=e;let i=this._options,s=i.urlRegex||lj;this._linkProvider=this._terminal.registerLinkProvider(new lX(this._terminal,s,this._handler,i))}dispose(){this._linkProvider?.dispose()}},l5=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],l3=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],l6=class{constructor(){if(this.version="6",!l1){(l1=new Uint8Array(65536)).fill(1),l1[0]=0,l1.fill(0,1,32),l1.fill(0,127,160),l1.fill(2,4352,4448),l1[9001]=2,l1[9002]=2,l1.fill(2,11904,42192),l1[12351]=1,l1.fill(2,44032,55204),l1.fill(2,63744,64256),l1.fill(2,65040,65050),l1.fill(2,65072,65136),l1.fill(2,65280,65377),l1.fill(2,65504,65511);for(let e=0;e<l5.length;++e)l1.fill(0,l5[e][0],l5[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?l1[e]:!function(e,i){let s=0,r=i.length-1,n;if(e<i[0][0]||e>i[r][1])return!1;for(;r>=s;)if(e>i[n=s+r>>1][1])s=n+1;else{if(!(e<i[n][0]))return!0;r=n-1}return!1}(e,l3)?e>=131072&&e<=196605||e>=196608&&e<=262141?2:1:0}charProperties(e,i){let s=this.wcwidth(e),r=0===s&&0!==i;if(r){let e=hk.extractWidth(i);0===e?r=!1:e>s&&(s=e)}return hk.createPropertyValue(0,s,r)}},l4=new class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?he.isErrorNoTelemetry(e)?new he(e.message+`

`+e.stack):Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(i=>{i(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}};function l9(e){var i;(i=e)instanceof l7||i instanceof Error&&i.name===l8&&i.message===l8||l4.onUnexpectedError(e)}var l8="Canceled",l7=class extends Error{constructor(){super(l8),this.name=this.message}},he=class e extends Error{constructor(e){super(e),this.name="CodeExpectedError"}static fromError(i){if(i instanceof e)return i;let s=new e;return s.message=i.message,s.stack=i.stack,s}static isErrorNoTelemetry(e){return"CodeExpectedError"===e.name}};(h_=hf||={}).isLessThan=function(e){return e<0},h_.isLessThanOrEqual=function(e){return e<=0},h_.isGreaterThan=function(e){return e>0},h_.isNeitherLessOrGreaterThan=function(e){return 0===e},h_.greaterThan=1,h_.lessThan=-1,h_.neitherLessOrGreaterThan=0;var ht=class e{constructor(e){this.iterate=e}forEach(e){this.iterate(i=>(e(i),!0))}toArray(){let e=[];return this.iterate(i=>(e.push(i),!0)),e}filter(i){return new e(e=>this.iterate(s=>!i(s)||e(s)))}map(i){return new e(e=>this.iterate(s=>e(i(s))))}some(e){let i=!1;return this.iterate(s=>!(i=e(s))),i}findFirst(e){let i;return this.iterate(s=>!e(s)||(i=s,!1)),i}findLast(e){let i;return this.iterate(s=>(e(s)&&(i=s),!0)),i}findLastMaxBy(e){let i,s=!0;return this.iterate(r=>((s||hf.isGreaterThan(e(r,i)))&&(s=!1,i=r),!0)),i}};ht.empty=new ht(e=>{});function hi(e){}function hs(e,i){}function hr(e){if(hg.is(e)){let i=[];for(let s of e)if(s)try{s.dispose()}catch(e){i.push(e)}if(1===i.length)throw i[0];if(i.length>1)throw AggregateError(i,"Encountered errors while disposing of store");return Array.isArray(e)?[]:e}if(e)return e.dispose(),e}function hn(e){let i={dispose:function(e,i){let s=this,r=!1,n;return function(){if(r)return n;if(r=!0,i)try{n=e.apply(s,arguments)}finally{i()}else n=e.apply(s,arguments);return n}}(()=>{hi(i),e()})};return i}(e=>{function i(e){return e&&"object"==typeof e&&"function"==typeof e[Symbol.iterator]}e.is=i;let s=Object.freeze([]);function*r(e){yield e}e.empty=function(){return s},e.single=r,e.wrap=function(e){return i(e)?e:r(e)},e.from=function(e){return e||s},e.reverse=function*(e){for(let i=e.length-1;i>=0;i--)yield e[i]},e.isEmpty=function(e){return!e||!0===e[Symbol.iterator]().next().done},e.first=function(e){return e[Symbol.iterator]().next().value},e.some=function(e,i){let s=0;for(let r of e)if(i(r,s++))return!0;return!1},e.find=function(e,i){for(let s of e)if(i(s))return s},e.filter=function*(e,i){for(let s of e)i(s)&&(yield s)},e.map=function*(e,i){let s=0;for(let r of e)yield i(r,s++)},e.flatMap=function*(e,i){let s=0;for(let r of e)yield*i(r,s++)},e.concat=function*(...e){for(let i of e)yield*i},e.reduce=function(e,i,s){let r=s;for(let s of e)r=i(r,s);return r},e.slice=function*(e,i,s=e.length){for(i<0&&(i+=e.length),s<0?s+=e.length:s>e.length&&(s=e.length);i<s;i++)yield e[i]},e.consume=function(i,s=1/0){let r=[];if(0===s)return[r,i];let n=i[Symbol.iterator]();for(let i=0;i<s;i++){let i=n.next();if(i.done)return[r,e.empty()];r.push(i.value)}return[r,{[Symbol.iterator]:()=>n}]},e.asyncToArray=async function(e){let i=[];for await(let s of e)i.push(s);return Promise.resolve(i)}})(hg||={});var ho=class e{constructor(){var e;this._toDispose=new Set,this._isDisposed=!1,e=this}dispose(){this._isDisposed||(hi(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(0!==this._toDispose.size)try{hr(this._toDispose)}finally{this._toDispose.clear()}}add(i){if(!i)return i;if(i===this)throw Error("Cannot register a disposable on itself!");return hs(i,this),this._isDisposed?e.DISABLE_DISPOSED_WARNING||console.warn(Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(i),i}delete(e){if(e){if(e===this)throw Error("Cannot dispose a disposable on itself!");this._toDispose.delete(e),e.dispose()}}deleteAndLeak(e){e&&this._toDispose.has(e)&&(this._toDispose.delete(e),hs(e,null))}};ho.DISABLE_DISPOSED_WARNING=!1;var ha=class{constructor(){var e;this._store=new ho,e=this,hs(this._store,this)}dispose(){hi(this),this._store.dispose()}_register(e){if(e===this)throw Error("Cannot register a disposable on itself!");return this._store.add(e)}};ha.None=Object.freeze({dispose(){}});var hl=class e{constructor(i){this.element=i,this.next=e.Undefined,this.prev=e.Undefined}};hl.Undefined=new hl(void 0);var hh=globalThis.performance&&"function"==typeof globalThis.performance.now,hc=class e{static create(i){return new e(i)}constructor(e){this._now=hh&&!1===e?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return -1!==this._stopTime?this._stopTime-this._startTime:this._now()-this._startTime}};(e=>{function i(e){}function s(e){return(i,s=null,r)=>{let n=!1,o;return o=e(e=>{if(!n)return o?o.dispose():n=!0,i.call(s,e)},null,r),n&&o.dispose(),o}}function r(e,i,s){return o((s,r=null,n)=>e(e=>s.call(r,i(e)),null,n),s)}function n(e,i,s){return o((s,r=null,n)=>e(e=>i(e)&&s.call(r,e),null,n),s)}function o(e,s){let r,n={onWillAddFirstListener(){r=e(o.fire,o)},onDidRemoveLastListener(){r?.dispose()}};s||i(n);let o=new hx(n);return s?.add(o),o.event}function a(e,s,r=100,n=!1,o=!1,l,h){let c,d,u,_=0,f,g={leakWarningThreshold:l,onWillAddFirstListener(){c=e(e=>{_++,d=s(d,e),n&&!u&&(p.fire(d),d=void 0),f=()=>{let e=d;d=void 0,u=void 0,(!n||_>1)&&p.fire(e),_=0},"number"==typeof r?(clearTimeout(u),u=setTimeout(f,r)):void 0===u&&(u=0,queueMicrotask(f))})},onWillRemoveListener(){o&&_>0&&f?.()},onDidRemoveLastListener(){f=void 0,c.dispose()}};h||i(g);let p=new hx(g);return h?.add(p),p.event}e.None=()=>ha.None,e.defer=function(e,i){return a(e,()=>{},0,void 0,!0,void 0,i)},e.once=s,e.map=r,e.forEach=function(e,i,s){return o((s,r=null,n)=>e(e=>{i(e),s.call(r,e)},null,n),s)},e.filter=n,e.signal=function(e){return e},e.any=function(...e){return(i,s=null,r)=>{var n,o;return n=function(...e){var i,s;let r=hn(()=>hr(e));return i=0,s=0,r}(...e.map(e=>e(e=>i.call(s,e)))),(o=r)instanceof Array?o.push(n):o&&o.add(n),n}},e.reduce=function(e,i,s,n){let o=s;return r(e,e=>o=i(o,e),n)},e.debounce=a,e.accumulate=function(i,s=0,r){return e.debounce(i,(e,i)=>e?(e.push(i),e):[i],s,void 0,!0,void 0,r)},e.latch=function(e,i=(e,i)=>e===i,s){let r=!0,o;return n(e,e=>{let s=r||!i(e,o);return r=!1,o=e,s},s)},e.split=function(i,s,r){return[e.filter(i,s,r),e.filter(i,e=>!s(e),r)]},e.buffer=function(e,i=!1,s=[],r){let n=s.slice(),o=e(e=>{n?n.push(e):l.fire(e)});r&&r.add(o);let a=()=>{n?.forEach(e=>l.fire(e)),n=null},l=new hx({onWillAddFirstListener(){o||(o=e(e=>l.fire(e)),r&&r.add(o))},onDidAddFirstListener(){n&&(i?setTimeout(a):a())},onDidRemoveLastListener(){o&&o.dispose(),o=null}});return r&&r.add(l),l.event},e.chain=function(e,i){return(s,r,n)=>{let o=i(new h);return e(function(e){let i=o.evaluate(e);i!==l&&s.call(r,i)},void 0,n)}};let l=Symbol("HaltChainable");class h{constructor(){this.steps=[]}map(e){return this.steps.push(e),this}forEach(e){return this.steps.push(i=>(e(i),i)),this}filter(e){return this.steps.push(i=>e(i)?i:l),this}reduce(e,i){let s=i;return this.steps.push(i=>s=e(s,i)),this}latch(e=(e,i)=>e===i){let i=!0,s;return this.steps.push(r=>{let n=i||!e(r,s);return i=!1,s=r,n?r:l}),this}evaluate(e){for(let i of this.steps)if((e=i(e))===l)break;return e}}e.fromNodeEventEmitter=function(e,i,s=e=>e){let r=(...e)=>n.fire(s(...e)),n=new hx({onWillAddFirstListener:()=>e.on(i,r),onDidRemoveLastListener:()=>e.removeListener(i,r)});return n.event},e.fromDOMEventEmitter=function(e,i,s=e=>e){let r=(...e)=>n.fire(s(...e)),n=new hx({onWillAddFirstListener:()=>e.addEventListener(i,r),onDidRemoveLastListener:()=>e.removeEventListener(i,r)});return n.event},e.toPromise=function(e){return new Promise(i=>s(e)(i))},e.fromPromise=function(e){let i=new hx;return e.then(e=>{i.fire(e)},()=>{i.fire(void 0)}).finally(()=>{i.dispose()}),i.event},e.forward=function(e,i){return e(e=>i.fire(e))},e.runAndSubscribe=function(e,i,s){return i(s),e(e=>i(e))};class c{constructor(e,s){this._observable=e,this._counter=0,this._hasChanged=!1;let r={onWillAddFirstListener:()=>{e.addObserver(this)},onDidRemoveLastListener:()=>{e.removeObserver(this)}};s||i(r),this.emitter=new hx(r),s&&s.add(this.emitter)}beginUpdate(e){this._counter++}handlePossibleChange(e){}handleChange(e,i){this._hasChanged=!0}endUpdate(e){this._counter--,0===this._counter&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}e.fromObservable=function(e,i){return new c(e,i).emitter.event},e.fromObservableLight=function(e){return(i,s,r)=>{let n=0,o=!1,a={beginUpdate(){n++},endUpdate(){0==--n&&(e.reportChanges(),o&&(o=!1,i.call(s)))},handlePossibleChange(){},handleChange(){o=!0}};e.addObserver(a),e.reportChanges();let l={dispose(){e.removeObserver(a)}};return r instanceof ho?r.add(l):Array.isArray(r)&&r.push(l),l}}})(hp||={});var hd=class e{constructor(i){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${i}_${e._idPool++}`,e.all.add(this)}start(e){this._stopWatch=new hc,this.listenerCount=e}stop(){if(this._stopWatch){let e=this._stopWatch.elapsed();this.durations.push(e),this.elapsedOverall+=e,this.invocationCount+=1,this._stopWatch=void 0}}};hd.all=new Set,hd._idPool=0;var hu=class e{constructor(i,s,r=(e._idPool++).toString(16).padStart(3,"0")){this._errorHandler=i,this.threshold=s,this.name=r,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(e,i){let s=this.threshold;if(s<=0||i<s)return;this._stacks||(this._stacks=new Map);let r=this._stacks.get(e.value)||0;if(this._stacks.set(e.value,r+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=.5*s;let[e,r]=this.getMostFrequentStack(),n=`[${this.name}] potential listener LEAK detected, having ${i} listeners already. MOST frequent listener (${r}):`;console.warn(n),console.warn(e);let o=new hS(n,e);this._errorHandler(o)}return()=>{let i=this._stacks.get(e.value)||0;this._stacks.set(e.value,i-1)}}getMostFrequentStack(){if(!this._stacks)return;let e,i=0;for(let[s,r]of this._stacks)(!e||i<r)&&(e=[s,r],i=r);return e}};hu._idPool=1;var h_,hf,hg,hp,hm,hv,hb=class e{constructor(e){this.value=e}static create(){return new e(Error().stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},hS=class extends Error{constructor(e,i){super(e),this.name="ListenerLeakError",this.stack=i}},hw=class extends Error{constructor(e,i){super(e),this.name="ListenerRefusalError",this.stack=i}},hy=0,hC=class{constructor(e){this.value=e,this.id=hy++}},hx=class{constructor(e){this._size=0,this._options=e,this._leakageMon=this._options?.leakWarningThreshold?new hu(e?.onListenerError??l9,this._options?.leakWarningThreshold??-1):void 0,this._perfMon=this._options?._profName?new hd(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){this._disposed||(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners&&(this._listeners=void 0,this._size=0),this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose())}get event(){return this._event??=(e,i,s)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let e=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(e);let i=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],s=new hw(`${e}. HINT: Stack shows most frequent listener (${i[1]}-times)`,i[0]);return(this._options?.onListenerError||l9)(s),ha.None}if(this._disposed)return ha.None;i&&(e=e.bind(i));let r=new hC(e),n;this._leakageMon&&this._size>=Math.ceil(.2*this._leakageMon.threshold)&&(r.stack=hb.create(),n=this._leakageMon.check(r.stack,this._size+1)),this._listeners?this._listeners instanceof hC?(this._deliveryQueue??=new hE,this._listeners=[this._listeners,r]):this._listeners.push(r):(this._options?.onWillAddFirstListener?.(this),this._listeners=r,this._options?.onDidAddFirstListener?.(this)),this._size++;let o=hn(()=>{hm?.unregister(o),n?.(),this._removeListener(r)});if(s instanceof ho?s.add(o):Array.isArray(s)&&s.push(o),hm){let e=Error().stack.split(`
`).slice(2,3).join(`
`).trim(),i=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(e);hm.register(o,i?.[2]??e,o)}return o},this._event}_removeListener(e){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(1===this._size){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let i=this._listeners,s=i.indexOf(e);if(-1===s)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),Error("Attempted to dispose unknown listener");this._size--,i[s]=void 0;let r=this._deliveryQueue.current===this;if(2*this._size<=i.length){let e=0;for(let s=0;s<i.length;s++)i[s]?i[e++]=i[s]:r&&(this._deliveryQueue.end--,e<this._deliveryQueue.i&&this._deliveryQueue.i--);i.length=e}}_deliver(e,i){if(!e)return;let s=this._options?.onListenerError||l9;try{e.value(i)}catch(e){s(e)}}_deliverQueue(e){let i=e.current._listeners;for(;e.i<e.end;)this._deliver(i[e.i++],e.value);e.reset()}fire(e){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof hC)this._deliver(this._listeners,e);else{let i=this._deliveryQueue;i.enqueue(this,e,this._listeners.length),this._deliverQueue(i)}this._perfMon?.stop()}hasListeners(){return this._size>0}},hE=class{constructor(){this.i=-1,this.end=0}enqueue(e,i,s){this.i=0,this.end=s,this.current=e,this.value=i}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},hk=class e{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new hx,this.onChange=this._onChange.event;let e=new l6;this.register(e),this._active=e.version,this._activeProvider=e}static extractShouldJoin(e){return(1&e)!=0}static extractWidth(e){return e>>1&3}static extractCharKind(e){return e>>3}static createPropertyValue(e,i,s=!1){return(0xffffff&e)<<3|(3&i)<<1|!!s}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(e){if(!this._providers[e])throw Error(`unknown Unicode version "${e}"`);this._active=e,this._activeProvider=this._providers[e],this._onChange.fire(e)}register(e){this._providers[e.version]=e}wcwidth(e){return this._activeProvider.wcwidth(e)}getStringCellWidth(i){let s=0,r=0,n=i.length;for(let o=0;o<n;++o){let a=i.charCodeAt(o);if(55296<=a&&a<=56319){if(++o>=n)return s+this.wcwidth(a);let e=i.charCodeAt(o);56320<=e&&e<=57343?a=(a-55296)*1024+e-56320+65536:s+=this.wcwidth(e)}let l=this.charProperties(a,r),h=e.extractWidth(l);e.extractShouldJoin(l)&&(h-=e.extractWidth(r)),s+=h,r=l}return s}charProperties(e,i){return this._activeProvider.charProperties(e,i)}},hA=[[768,879],[1155,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1541],[1552,1562],[1564,1564],[1611,1631],[1648,1648],[1750,1757],[1759,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2045,2045],[2070,2073],[2075,2083],[2085,2087],[2089,2093],[2137,2139],[2259,2306],[2362,2362],[2364,2364],[2369,2376],[2381,2381],[2385,2391],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2558,2558],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2641,2641],[2672,2673],[2677,2677],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2810,2815],[2817,2817],[2876,2876],[2879,2879],[2881,2884],[2893,2893],[2902,2902],[2914,2915],[2946,2946],[3008,3008],[3021,3021],[3072,3072],[3076,3076],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3170,3171],[3201,3201],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3328,3329],[3387,3388],[3393,3396],[3405,3405],[3426,3427],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3981,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4151],[4153,4154],[4157,4158],[4184,4185],[4190,4192],[4209,4212],[4226,4226],[4229,4230],[4237,4237],[4253,4253],[4448,4607],[4957,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6158],[6277,6278],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6683,6683],[6742,6742],[6744,6750],[6752,6752],[6754,6754],[6757,6764],[6771,6780],[6783,6783],[6832,6846],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7040,7041],[7074,7077],[7080,7081],[7083,7085],[7142,7142],[7144,7145],[7149,7149],[7151,7153],[7212,7219],[7222,7223],[7376,7378],[7380,7392],[7394,7400],[7405,7405],[7412,7412],[7416,7417],[7616,7673],[7675,7679],[8203,8207],[8234,8238],[8288,8292],[8294,8303],[8400,8432],[11503,11505],[11647,11647],[11744,11775],[12330,12333],[12441,12442],[42607,42610],[42612,42621],[42654,42655],[42736,42737],[43010,43010],[43014,43014],[43019,43019],[43045,43046],[43204,43205],[43232,43249],[43263,43263],[43302,43309],[43335,43345],[43392,43394],[43443,43443],[43446,43449],[43452,43453],[43493,43493],[43561,43566],[43569,43570],[43573,43574],[43587,43587],[43596,43596],[43644,43644],[43696,43696],[43698,43700],[43703,43704],[43710,43711],[43713,43713],[43756,43757],[43766,43766],[44005,44005],[44008,44008],[44013,44013],[64286,64286],[65024,65039],[65056,65071],[65279,65279],[65529,65531]],hR=[[66045,66045],[66272,66272],[66422,66426],[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[68325,68326],[68900,68903],[69446,69456],[69633,69633],[69688,69702],[69759,69761],[69811,69814],[69817,69818],[69821,69821],[69837,69837],[69888,69890],[69927,69931],[69933,69940],[70003,70003],[70016,70017],[70070,70078],[70089,70092],[70191,70193],[70196,70196],[70198,70199],[70206,70206],[70367,70367],[70371,70378],[70400,70401],[70459,70460],[70464,70464],[70502,70508],[70512,70516],[70712,70719],[70722,70724],[70726,70726],[70750,70750],[70835,70840],[70842,70842],[70847,70848],[70850,70851],[71090,71093],[71100,71101],[71103,71104],[71132,71133],[71219,71226],[71229,71229],[71231,71232],[71339,71339],[71341,71341],[71344,71349],[71351,71351],[71453,71455],[71458,71461],[71463,71467],[71727,71735],[71737,71738],[72148,72151],[72154,72155],[72160,72160],[72193,72202],[72243,72248],[72251,72254],[72263,72263],[72273,72278],[72281,72283],[72330,72342],[72344,72345],[72752,72758],[72760,72765],[72767,72767],[72850,72871],[72874,72880],[72882,72883],[72885,72886],[73009,73014],[73018,73018],[73020,73021],[73023,73029],[73031,73031],[73104,73105],[73109,73109],[73111,73111],[73459,73460],[78896,78904],[92912,92916],[92976,92982],[94031,94031],[94095,94098],[113821,113822],[113824,113827],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[121344,121398],[121403,121452],[121461,121461],[121476,121476],[121499,121503],[121505,121519],[122880,122886],[122888,122904],[122907,122913],[122915,122916],[122918,122922],[123184,123190],[123628,123631],[125136,125142],[125252,125258],[917505,917505],[917536,917631],[917760,917999]],hL=[[4352,4447],[8986,8987],[9001,9002],[9193,9196],[9200,9200],[9203,9203],[9725,9726],[9748,9749],[9800,9811],[9855,9855],[9875,9875],[9889,9889],[9898,9899],[9917,9918],[9924,9925],[9934,9934],[9940,9940],[9962,9962],[9970,9971],[9973,9973],[9978,9978],[9981,9981],[9989,9989],[9994,9995],[10024,10024],[10060,10060],[10062,10062],[10067,10069],[10071,10071],[10133,10135],[10160,10160],[10175,10175],[11035,11036],[11088,11088],[11093,11093],[11904,11929],[11931,12019],[12032,12245],[12272,12283],[12288,12329],[12334,12350],[12353,12438],[12443,12543],[12549,12591],[12593,12686],[12688,12730],[12736,12771],[12784,12830],[12832,12871],[12880,19903],[19968,42124],[42128,42182],[43360,43388],[44032,55203],[63744,64255],[65040,65049],[65072,65106],[65108,65126],[65128,65131],[65281,65376],[65504,65510]],hT=[[94176,94179],[94208,100343],[100352,101106],[110592,110878],[110928,110930],[110948,110951],[110960,111355],[126980,126980],[127183,127183],[127374,127374],[127377,127386],[127488,127490],[127504,127547],[127552,127560],[127568,127569],[127584,127589],[127744,127776],[127789,127797],[127799,127868],[127870,127891],[127904,127946],[127951,127955],[127968,127984],[127988,127988],[127992,128062],[128064,128064],[128066,128252],[128255,128317],[128331,128334],[128336,128359],[128378,128378],[128405,128406],[128420,128420],[128507,128591],[128640,128709],[128716,128716],[128720,128722],[128725,128725],[128747,128748],[128756,128762],[128992,129003],[129293,129393],[129395,129398],[129402,129442],[129445,129450],[129454,129482],[129485,129535],[129648,129651],[129656,129658],[129664,129666],[129680,129685],[131072,196605],[196608,262141]];function hB(e,i){let s=0,r=i.length-1,n;if(e<i[0][0]||e>i[r][1])return!1;for(;r>=s;)if(e>i[n=s+r>>1][1])s=n+1;else{if(!(e<i[n][0]))return!0;r=n-1}return!1}var hM=class{constructor(){if(this.version="11",!hv){(hv=new Uint8Array(65536)).fill(1),hv[0]=0,hv.fill(0,1,32),hv.fill(0,127,160);for(let e=0;e<hA.length;++e)hv.fill(0,hA[e][0],hA[e][1]+1);for(let e=0;e<hL.length;++e)hv.fill(2,hL[e][0],hL[e][1]+1)}}wcwidth(e){return e<32?0:e<127?1:e<65536?hv[e]:hB(e,hR)?0:hB(e,hT)?2:1}charProperties(e,i){let s=this.wcwidth(e),r=0===s&&0!==i;if(r){let e=hk.extractWidth(i);0===e?r=!1:e>s&&(s=e)}return hk.createPropertyValue(0,s,r)}},hI=class{activate(e){e.unicode.register(new hM)}dispose(){}};function hD(e,i){return!!(null!==e&&"object"==typeof e&&"$typeName"in e&&"string"==typeof e.$typeName)&&(void 0===i||i.typeName===e.$typeName)}function hN(){let e=0,i=0;for(let s=0;s<28;s+=7){let r=this.buf[this.pos++];if(e|=(127&r)<<s,(128&r)==0)return this.assertBounds(),[e,i]}let s=this.buf[this.pos++];if(e|=(15&s)<<28,i=(112&s)>>4,(128&s)==0)return this.assertBounds(),[e,i];for(let s=3;s<=31;s+=7){let r=this.buf[this.pos++];if(i|=(127&r)<<s,(128&r)==0)return this.assertBounds(),[e,i]}throw Error("invalid varint")}function hO(e,i,s){for(let r=0;r<28;r+=7){let n=e>>>r,o=n>>>7!=0||0!=i,a=(o?128|n:n)&255;if(s.push(a),!o)return}let r=e>>>28&15|(7&i)<<4,n=i>>3!=0;if(s.push((n?128|r:r)&255),n){for(let e=3;e<31;e+=7){let r=i>>>e,n=r>>>7!=0,o=(n?128|r:r)&255;if(s.push(o),!n)return}s.push(i>>>31&1)}}function hP(e){let i="-"===e[0];i&&(e=e.slice(1));let s=0,r=0;function n(i,n){let o=Number(e.slice(i,n));r*=1e6,(s=1e6*s+o)>=0x100000000&&(r+=s/0x100000000|0,s%=0x100000000)}return n(-24,-18),n(-18,-12),n(-12,-6),n(-6),i?hz(s,r):hW(s,r)}function hF(e,i){if({lo:e,hi:i}={lo:e>>>0,hi:i>>>0},i<=2097151)return String(0x100000000*i+e);let s=0xffffff&e,r=(e>>>24|i<<8)&0xffffff,n=i>>16&65535,o=s+6777216*r+6710656*n,a=r+8147497*n,l=2*n;return o>=1e7&&(a+=Math.floor(o/1e7),o%=1e7),a>=1e7&&(l+=Math.floor(a/1e7),a%=1e7),l.toString()+hU(a)+hU(o)}function hW(e,i){return{lo:0|e,hi:0|i}}function hz(e,i){return i=~i,e?e=~e+1:i+=1,hW(e,i)}(L=Q||(Q={}))[L.DOUBLE=1]="DOUBLE",L[L.FLOAT=2]="FLOAT",L[L.INT64=3]="INT64",L[L.UINT64=4]="UINT64",L[L.INT32=5]="INT32",L[L.FIXED64=6]="FIXED64",L[L.FIXED32=7]="FIXED32",L[L.BOOL=8]="BOOL",L[L.STRING=9]="STRING",L[L.BYTES=12]="BYTES",L[L.UINT32=13]="UINT32",L[L.SFIXED32=15]="SFIXED32",L[L.SFIXED64=16]="SFIXED64",L[L.SINT32=17]="SINT32",L[L.SINT64=18]="SINT64";let hU=e=>{let i=String(e);return"0000000".slice(i.length)+i};function h$(e,i){if(e>=0){for(;e>127;)i.push(127&e|128),e>>>=7;i.push(e)}else{for(let s=0;s<9;s++)i.push(127&e|128),e>>=7;i.push(1)}}function hV(){let e=this.buf[this.pos++],i=127&e;if((128&e)==0||(i|=(127&(e=this.buf[this.pos++]))<<7,(128&e)==0)||(i|=(127&(e=this.buf[this.pos++]))<<14,(128&e)==0)||(i|=(127&(e=this.buf[this.pos++]))<<21,(128&e)==0))return this.assertBounds(),i;i|=(15&(e=this.buf[this.pos++]))<<28;for(let i=5;(128&e)!=0&&i<10;i++)e=this.buf[this.pos++];if((128&e)!=0)throw Error("invalid varint");return this.assertBounds(),i>>>0}let hH=function(){let e=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof e.getBigInt64&&"function"==typeof e.getBigUint64&&"function"==typeof e.setBigInt64&&"function"==typeof e.setBigUint64&&(globalThis.Deno||"object"!=typeof ey.default||"object"!=typeof ey.default.env||"1"!==ey.default.env.BUF_BIGINT_DISABLE)){let i=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),r=BigInt("0"),n=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(e){let r="bigint"==typeof e?e:BigInt(e);if(r>s||r<i)throw Error(`invalid int64: ${e}`);return r},uParse(e){let i="bigint"==typeof e?e:BigInt(e);if(i>n||i<r)throw Error(`invalid uint64: ${e}`);return i},enc(i){return e.setBigInt64(0,this.parse(i),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},uEnc(i){return e.setBigInt64(0,this.uParse(i),!0),{lo:e.getInt32(0,!0),hi:e.getInt32(4,!0)}},dec:(i,s)=>(e.setInt32(0,i,!0),e.setInt32(4,s,!0),e.getBigInt64(0,!0)),uDec:(i,s)=>(e.setInt32(0,i,!0),e.setInt32(4,s,!0),e.getBigUint64(0,!0))}}return{zero:"0",supported:!1,parse:e=>("string"!=typeof e&&(e=e.toString()),hK(e),e),uParse:e=>("string"!=typeof e&&(e=e.toString()),hG(e),e),enc:e=>("string"!=typeof e&&(e=e.toString()),hK(e),hP(e)),uEnc:e=>("string"!=typeof e&&(e=e.toString()),hG(e),hP(e)),dec:(e,i)=>{let s,r,n;return(r=0x80000000&(s=hW(e,i)).hi)&&(s=hz(s.lo,s.hi)),n=hF(s.lo,s.hi),r?"-"+n:n},uDec:(e,i)=>hF(e,i)}}();function hK(e){if(!/^-?[0-9]+$/.test(e))throw Error("invalid int64: "+e)}function hG(e){if(!/^[0-9]+$/.test(e))throw Error("invalid uint64: "+e)}function hY(e,i){switch(e){case Q.STRING:return"";case Q.BOOL:return!1;case Q.DOUBLE:case Q.FLOAT:return 0;case Q.INT64:case Q.UINT64:case Q.SFIXED64:case Q.FIXED64:case Q.SINT64:return i?"0":hH.zero;case Q.BYTES:return new Uint8Array(0);default:return 0}}let hX=Symbol.for("reflect unsafe local");function hZ(e,i){let s=e[i.localName].case;return void 0===s?s:i.fields.find(e=>e.localName===s)}function hj(e,i){return Object.prototype.hasOwnProperty.call(e,i)&&void 0!==e[i]}function hq(e,i){if(i.oneof){let s=e[i.oneof.localName];return s.case===i.localName?s.value:void 0}return e[i.localName]}function hQ(e,i,s){i.oneof?e[i.oneof.localName]={case:i.localName,value:s}:e[i.localName]=s}function hJ(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}function h0(e,i){var s,r,n,o;if(hJ(e)&&hX in e&&"add"in e&&"field"in e&&"function"==typeof e.field){if(void 0!==i){let a=e.field();return i.listKind==a.listKind&&i.scalar===a.scalar&&(null==(s=i.message)?void 0:s.typeName)===(null==(r=a.message)?void 0:r.typeName)&&(null==(n=i.enum)?void 0:n.typeName)===(null==(o=a.enum)?void 0:o.typeName)}return!0}return!1}function h1(e,i){var s,r,n,o;if(hJ(e)&&hX in e&&"has"in e&&"field"in e&&"function"==typeof e.field){if(void 0!==i){let a=e.field();return i.mapKey===a.mapKey&&i.mapKind==a.mapKind&&i.scalar===a.scalar&&(null==(s=i.message)?void 0:s.typeName)===(null==(r=a.message)?void 0:r.typeName)&&(null==(n=i.enum)?void 0:n.typeName)===(null==(o=a.enum)?void 0:o.typeName)}return!0}return!1}function h2(e,i){return hJ(e)&&hX in e&&"desc"in e&&hJ(e.desc)&&"message"===e.desc.kind&&(void 0===i||e.desc.typeName==i.typeName)}function h5(e){let i=e.fields[0];return h3(e.typeName)&&void 0!==i&&"scalar"==i.fieldKind&&"value"==i.name&&1==i.number}function h3(e){return e.startsWith("google.protobuf.")&&["DoubleValue","FloatValue","Int64Value","UInt64Value","Int32Value","UInt32Value","BoolValue","StringValue","BytesValue"].includes(e.substring(16))}function h6(e,i){if(hD(i,e))return i;let s=function(e){let i;if(function(e){switch(e.file.edition){case 999:return!1;case 998:return!0;default:return e.fields.some(e=>2!=e.presence&&"message"!=e.fieldKind&&!e.oneof)}}(e)){let s,r,n=ct.get(e);if(n)({prototype:s,members:r}=n);else{for(let i of(s={},r=new Set,e.members))"oneof"!=i.kind&&("scalar"==i.fieldKind||"enum"==i.fieldKind)&&2!=i.presence&&(r.add(i),s[i.localName]=ci(i));ct.set(e,{prototype:s,members:r})}for(let n of((i=Object.create(s)).$typeName=e.typeName,e.members))if(!r.has(n)){if("field"==n.kind&&("message"==n.fieldKind||("scalar"==n.fieldKind||"enum"==n.fieldKind)&&2!=n.presence))continue;i[n.localName]=ci(n)}}else for(let s of(i={$typeName:e.typeName},e.members))("oneof"==s.kind||2==s.presence)&&(i[s.localName]=ci(s));return i}(e);return void 0!==i&&function(e,i,s){for(let r of e.members){let e,n=s[r.localName];if(null!=n){if("oneof"==r.kind){let i=hZ(s,r);if(!i)continue;e=i,n=hq(s,i)}else e=r;switch(e.fieldKind){case"message":n=h9(e,n);break;case"scalar":n=h4(e,n);break;case"list":n=function(e,i){if(Array.isArray(i)){if(e.scalar==Q.BYTES)return i.map(h8);if("message"==e.listKind)return i.map(i=>h9(e,i))}return i}(e,n);break;case"map":n=function(e,i){if(hJ(i)){if(e.scalar==Q.BYTES)return h7(i,h8);if("message"==e.mapKind)return h7(i,i=>h9(e,i))}return i}(e,n)}hQ(i,e,n)}}}(e,s,i),s}function h4(e,i){return e.scalar==Q.BYTES?h8(i):i}function h9(e,i){if("message"==e.fieldKind&&!e.oneof&&h5(e.message))return h4(e.message.fields[0],i);if(hJ(i)){if("google.protobuf.Struct"==e.message.typeName&&"google.protobuf.Value"!==e.parent.typeName)return i;if(!hD(i,e.message))return h6(e.message,i)}return i}function h8(e){return Array.isArray(e)?new Uint8Array(e):e}function h7(e,i){let s={};for(let r of Object.entries(e))s[r[0]]=i(r[1]);return s}let ce=Symbol(),ct=new WeakMap;function ci(e){if("oneof"==e.kind)return{case:void 0};if("list"==e.fieldKind)return[];if("map"==e.fieldKind)return{};if("message"==e.fieldKind)return ce;let i=e.getDefaultValue();return void 0!==i?"scalar"==e.fieldKind&&e.longAsString?i.toString():i:"scalar"==e.fieldKind?hY(e.scalar,e.longAsString):e.enum.values[0].number}class cs extends Error{constructor(e,i,s="FieldValueInvalidError"){super(i),this.name=s,this.field=()=>e}}let cr=Symbol.for("@bufbuild/protobuf/text-encoding");function cn(){if(void 0==globalThis[cr]){let e=new globalThis.TextEncoder,i=new globalThis.TextDecoder;globalThis[cr]={encodeUtf8:i=>e.encode(i),decodeUtf8:e=>i.decode(e),checkUtf8(e){try{return encodeURIComponent(e),!0}catch(e){return!1}}}}return globalThis[cr]}(T=J||(J={}))[T.Varint=0]="Varint",T[T.Bit64=1]="Bit64",T[T.LengthDelimited=2]="LengthDelimited",T[T.StartGroup=3]="StartGroup",T[T.EndGroup=4]="EndGroup",T[T.Bit32=5]="Bit32";class co{constructor(e=cn().encodeUtf8){this.encodeUtf8=e,this.stack=[],this.chunks=[],this.buf=[]}finish(){this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]);let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let i=new Uint8Array(e),s=0;for(let e=0;e<this.chunks.length;e++)i.set(this.chunks[e],s),s+=this.chunks[e].length;return this.chunks=[],i}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),i=this.stack.pop();if(!i)throw Error("invalid state, fork stack empty");return this.chunks=i.chunks,this.buf=i.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,i){return this.uint32((e<<3|i)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(ch(e);e>127;)this.buf.push(127&e|128),e>>>=7;return this.buf.push(e),this}int32(e){return cl(e),h$(e,this.buf),this}bool(e){return this.buf.push(+!!e),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let i=this.encodeUtf8(e);return this.uint32(i.byteLength),this.raw(i)}float(e){var i=e;if("string"==typeof i){let e=i;if(Number.isNaN(i=Number(i))&&"NaN"!==e)throw Error("invalid float32: "+e)}else if("number"!=typeof i)throw Error("invalid float32: "+typeof i);if(Number.isFinite(i)&&(i>34028234663852886e22||i<-34028234663852886e22))throw Error("invalid float32: "+i);let s=new Uint8Array(4);return new DataView(s.buffer).setFloat32(0,e,!0),this.raw(s)}double(e){let i=new Uint8Array(8);return new DataView(i.buffer).setFloat64(0,e,!0),this.raw(i)}fixed32(e){ch(e);let i=new Uint8Array(4);return new DataView(i.buffer).setUint32(0,e,!0),this.raw(i)}sfixed32(e){cl(e);let i=new Uint8Array(4);return new DataView(i.buffer).setInt32(0,e,!0),this.raw(i)}sint32(e){return cl(e),h$(e=(e<<1^e>>31)>>>0,this.buf),this}sfixed64(e){let i=new Uint8Array(8),s=new DataView(i.buffer),r=hH.enc(e);return s.setInt32(0,r.lo,!0),s.setInt32(4,r.hi,!0),this.raw(i)}fixed64(e){let i=new Uint8Array(8),s=new DataView(i.buffer),r=hH.uEnc(e);return s.setInt32(0,r.lo,!0),s.setInt32(4,r.hi,!0),this.raw(i)}int64(e){let i=hH.enc(e);return hO(i.lo,i.hi,this.buf),this}sint64(e){let i=hH.enc(e),s=i.hi>>31;return hO(i.lo<<1^s,(i.hi<<1|i.lo>>>31)^s,this.buf),this}uint64(e){let i=hH.uEnc(e);return hO(i.lo,i.hi,this.buf),this}}class ca{constructor(e,i=cn().decodeUtf8){this.decodeUtf8=i,this.varint64=hN,this.uint32=hV,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength)}tag(){let e=this.uint32(),i=e>>>3,s=7&e;if(i<=0||s<0||s>5)throw Error("illegal tag: field no "+i+" wire type "+s);return[i,s]}skip(e,i){let s=this.pos;switch(e){case J.Varint:for(;128&this.buf[this.pos++];);break;case J.Bit64:this.pos+=4;case J.Bit32:this.pos+=4;break;case J.LengthDelimited:let r=this.uint32();this.pos+=r;break;case J.StartGroup:for(;;){let[e,s]=this.tag();if(s===J.EndGroup){if(void 0!==i&&e!==i)throw Error("invalid end group tag");break}this.skip(s,e)}break;default:throw Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(s,this.pos)}assertBounds(){if(this.pos>this.len)throw RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let e=this.uint32();return e>>>1^-(1&e)}int64(){return hH.dec(...this.varint64())}uint64(){return hH.uDec(...this.varint64())}sint64(){let[e,i]=this.varint64(),s=-(1&e);return e=(e>>>1|(1&i)<<31)^s,i=i>>>1^s,hH.dec(e,i)}bool(){let[e,i]=this.varint64();return 0!==e||0!==i}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return hH.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return hH.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),i=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(i,i+e)}string(){return this.decodeUtf8(this.bytes())}}function cl(e){if("string"==typeof e)e=Number(e);else if("number"!=typeof e)throw Error("invalid int32: "+typeof e);if(!Number.isInteger(e)||e>0x7fffffff||e<-0x80000000)throw Error("invalid int32: "+e)}function ch(e){if("string"==typeof e)e=Number(e);else if("number"!=typeof e)throw Error("invalid uint32: "+typeof e);if(!Number.isInteger(e)||e>0xffffffff||e<0)throw Error("invalid uint32: "+e)}function cc(e,i,s){let r=cd(e,s);if(!0!==r)return new cs(e,`list item #${i+1}: ${c_(e,s,r)}`)}function cd(e,i){return void 0!==e.scalar?cu(i,e.scalar):void 0!==e.enum?e.enum.open?Number.isInteger(i):e.enum.values.some(e=>e.number===i):h2(i,e.message)}function cu(e,i){switch(i){case Q.DOUBLE:return"number"==typeof e;case Q.FLOAT:if("number"!=typeof e)return!1;if(Number.isNaN(e)||!Number.isFinite(e))return!0;if(e>34028234663852886e22||e<-34028234663852886e22)return`${e.toFixed()} out of range`;return!0;case Q.INT32:case Q.SFIXED32:case Q.SINT32:if("number"!=typeof e||!Number.isInteger(e))return!1;if(e>0x7fffffff||e<-0x80000000)return`${e.toFixed()} out of range`;return!0;case Q.FIXED32:case Q.UINT32:if("number"!=typeof e||!Number.isInteger(e))return!1;if(e>0xffffffff||e<0)return`${e.toFixed()} out of range`;return!0;case Q.BOOL:return"boolean"==typeof e;case Q.STRING:if("string"!=typeof e)return!1;return cn().checkUtf8(e)||"invalid UTF8";case Q.BYTES:return e instanceof Uint8Array;case Q.INT64:case Q.SFIXED64:case Q.SINT64:if("bigint"==typeof e||"number"==typeof e||"string"==typeof e&&e.length>0)try{return hH.parse(e),!0}catch(i){return`${e} out of range`}return!1;case Q.FIXED64:case Q.UINT64:if("bigint"==typeof e||"number"==typeof e||"string"==typeof e&&e.length>0)try{return hH.uParse(e),!0}catch(i){return`${e} out of range`}return!1}}function c_(e,i,s){return(s="string"==typeof s?`: ${s}`:`, got ${cf(i)}`,void 0!==e.scalar)?`expected ${function(e){switch(e){case Q.STRING:return"string";case Q.BOOL:return"boolean";case Q.INT64:case Q.SINT64:case Q.SFIXED64:return"bigint (int64)";case Q.UINT64:case Q.FIXED64:return"bigint (uint64)";case Q.BYTES:return"Uint8Array";case Q.DOUBLE:return"number (float64)";case Q.FLOAT:return"number (float32)";case Q.FIXED32:case Q.UINT32:return"number (uint32)";case Q.INT32:case Q.SFIXED32:case Q.SINT32:return"number (int32)"}}(e.scalar)}`+s:void 0!==e.enum?`expected ${e.enum.toString()}`+s:`expected ${cg(e.message)}`+s}function cf(e){switch(typeof e){case"object":if(null===e)return"null";if(e instanceof Uint8Array)return`Uint8Array(${e.length})`;if(Array.isArray(e))return`Array(${e.length})`;if(h0(e))return cp(e.field());if(h1(e))return cm(e.field());if(h2(e))return cg(e.desc);if(hD(e))return`message ${e.$typeName}`;return"object";case"string":return e.length>30?"string":`"${e.split('"').join('\\"')}"`;case"boolean":case"number":return String(e);case"bigint":return String(e)+"n";default:return typeof e}}function cg(e){return`ReflectMessage (${e.typeName})`}function cp(e){switch(e.listKind){case"message":return`ReflectList (${e.message.toString()})`;case"enum":return`ReflectList (${e.enum.toString()})`;case"scalar":return`ReflectList (${Q[e.scalar]})`}}function cm(e){switch(e.mapKind){case"message":return`ReflectMap (${Q[e.mapKey]}, ${e.message.toString()})`;case"enum":return`ReflectMap (${Q[e.mapKey]}, ${e.enum.toString()})`;case"scalar":return`ReflectMap (${Q[e.mapKey]}, ${Q[e.scalar]})`}}function cv(e,i,s=!0){return new cS(e,i,s)}let cb=new WeakMap;class cS{get sortedFields(){let e=cb.get(this.desc);if(e)return e;let i=this.desc.fields.concat().sort((e,i)=>e.number-i.number);return cb.set(this.desc,i),i}constructor(e,i,s=!0){this.lists=new Map,this.maps=new Map,this.check=s,this.desc=e,this.message=this[hX]=null!=i?i:h6(e),this.fields=e.fields,this.oneofs=e.oneofs,this.members=e.members}findNumber(e){return this._fieldsByNumber||(this._fieldsByNumber=new Map(this.desc.fields.map(e=>[e.number,e]))),this._fieldsByNumber.get(e)}oneofCase(e){return cw(this.message,e),hZ(this.message,e)}isSet(e){cw(this.message,e);var i=this.message;let s=e.localName;if(e.oneof)return i[e.oneof.localName].case===s;if(2!=e.presence)return void 0!==i[s]&&Object.prototype.hasOwnProperty.call(i,s);switch(e.fieldKind){case"list":return i[s].length>0;case"map":return Object.keys(i[s]).length>0;case"scalar":return!function(e,i){switch(e){case Q.BOOL:return!1===i;case Q.STRING:return""===i;case Q.BYTES:return i instanceof Uint8Array&&!i.byteLength;default:return 0==i}}(e.scalar,i[s]);case"enum":return i[s]!==e.enum.values[0].number}throw Error("message field with implicit presence")}clear(e){cw(this.message,e);var i=this.message;let s=e.localName;if(e.oneof){let r=e.oneof.localName;i[r].case===s&&(i[r]={case:void 0})}else if(2!=e.presence)delete i[s];else switch(e.fieldKind){case"map":i[s]={};break;case"list":i[s]=[];break;case"enum":i[s]=e.enum.values[0].number;break;case"scalar":i[s]=hY(e.scalar,e.longAsString)}}get(e){cw(this.message,e);let i=hq(this.message,e);switch(e.fieldKind){case"list":let s=this.lists.get(e);return s&&s[hX]===i||this.lists.set(e,s=new cy(e,i,this.check)),s;case"map":let r=this.maps.get(e);return r&&r[hX]===i||this.maps.set(e,r=new cC(e,i,this.check)),r;case"message":return cE(e,i,this.check);case"scalar":return void 0===i?hY(e.scalar,!1):cB(e,i);case"enum":return null!=i?i:e.enum.values[0].number}}set(e,i){let s;if(cw(this.message,e),this.check){let s=function(e,i){let s,r="list"==e.fieldKind?h0(i,e):"map"==e.fieldKind?h1(i,e):cd(e,i);if(!0!==r){switch(e.fieldKind){case"list":s=`expected ${cp(e)}, got ${cf(i)}`;break;case"map":s=`expected ${cm(e)}, got ${cf(i)}`;break;default:s=c_(e,i,r)}return new cs(e,s)}}(e,i);if(s)throw s}s="message"==e.fieldKind?cx(e,i):h1(i)||h0(i)?i[hX]:cM(e,i),hQ(this.message,e,s)}getUnknown(){return this.message.$unknown}setUnknown(e){this.message.$unknown=e}}function cw(e,i){if(i.parent.typeName!==e.$typeName)throw new cs(i,`cannot use ${i.toString()} with message ${e.$typeName}`,"ForeignFieldError")}class cy{field(){return this._field}get size(){return this._arr.length}constructor(e,i,s){this._field=e,this._arr=this[hX]=i,this.check=s}get(e){let i=this._arr[e];return void 0===i?void 0:cA(this._field,i,this.check)}set(e,i){if(e<0||e>=this._arr.length)throw new cs(this._field,`list item #${e+1}: out of range`);if(this.check){let s=cc(this._field,e,i);if(s)throw s}this._arr[e]=ck(this._field,i)}add(e){if(this.check){let i=cc(this._field,this._arr.length,e);if(i)throw i}this._arr.push(ck(this._field,e))}clear(){this._arr.splice(0,this._arr.length)}[Symbol.iterator](){return this.values()}keys(){return this._arr.keys()}*values(){for(let e of this._arr)yield cA(this._field,e,this.check)}*entries(){for(let e=0;e<this._arr.length;e++)yield[e,cA(this._field,this._arr[e],this.check)]}}class cC{constructor(e,i,s=!0){this.obj=this[hX]=null!=i?i:{},this.check=s,this._field=e}field(){return this._field}set(e,i){var s,r;if(this.check){let s=function(e,i,s){let r=cu(i,e.mapKey);if(!0!==r)return new cs(e,`invalid map key: ${c_({scalar:e.mapKey},i,r)}`);let n=cd(e,s);if(!0!==n)return new cs(e,`map entry ${cf(i)}: ${c_(e,s,n)}`)}(this._field,e,i);if(s)throw s}return this.obj[cL(e)]=(s=this._field,r=i,"message"==s.mapKind?cx(s,r):cM(s,r)),this}delete(e){let i=cL(e),s=Object.prototype.hasOwnProperty.call(this.obj,i);return s&&delete this.obj[i],s}clear(){for(let e of Object.keys(this.obj))delete this.obj[e]}get(e){let i=this.obj[cL(e)];return void 0!==i&&(i=cR(this._field,i,this.check)),i}has(e){return Object.prototype.hasOwnProperty.call(this.obj,cL(e))}*keys(){for(let e of Object.keys(this.obj))yield cT(e,this._field.mapKey)}*entries(){for(let e of Object.entries(this.obj))yield[cT(e[0],this._field.mapKey),cR(this._field,e[1],this.check)]}[Symbol.iterator](){return this.entries()}get size(){return Object.keys(this.obj).length}*values(){for(let e of Object.values(this.obj))yield cR(this._field,e,this.check)}forEach(e,i){for(let s of this.entries())e.call(i,s[1],s[0],this)}}function cx(e,i){return h2(i)?h3(i.message.$typeName)&&!e.oneof&&"message"==e.fieldKind?i.message.value:"google.protobuf.Struct"==i.desc.typeName&&"google.protobuf.Value"!=e.parent.typeName?function e(i){let s={};for(let[r,n]of Object.entries(i.fields))s[r]=function i(s){switch(s.kind.case){case"structValue":return e(s.kind.value);case"listValue":return s.kind.value.values.map(i);case"nullValue":case void 0:return null;default:return s.kind.value}}(n);return s}(i.message):i.message:i}function cE(e,i,s){return void 0!==i&&(h5(e.message)&&!e.oneof&&"message"==e.fieldKind?i={$typeName:e.message.typeName,value:cB(e.message.fields[0],i)}:"google.protobuf.Struct"==e.message.typeName&&"google.protobuf.Value"!=e.parent.typeName&&hJ(i)&&(i=function e(i){let s={$typeName:"google.protobuf.Struct",fields:{}};if(hJ(i))for(let[r,n]of Object.entries(i))s.fields[r]=function i(s){let r={$typeName:"google.protobuf.Value",kind:{case:void 0}};switch(typeof s){case"number":r.kind={case:"numberValue",value:s};break;case"string":r.kind={case:"stringValue",value:s};break;case"boolean":r.kind={case:"boolValue",value:s};break;case"object":if(null===s)r.kind={case:"nullValue",value:0};else if(Array.isArray(s)){let e={$typeName:"google.protobuf.ListValue",values:[]};if(Array.isArray(s))for(let r of s)e.values.push(i(r));r.kind={case:"listValue",value:e}}else r.kind={case:"structValue",value:e(s)}}return r}(n);return s}(i))),new cS(e.message,i,s)}function ck(e,i){return"message"==e.listKind?cx(e,i):cM(e,i)}function cA(e,i,s){return"message"==e.listKind?cE(e,i,s):cB(e,i)}function cR(e,i,s){return"message"==e.mapKind?cE(e,i,s):i}function cL(e){return"string"==typeof e||"number"==typeof e?e:String(e)}function cT(e,i){switch(i){case Q.STRING:break;case Q.INT32:case Q.FIXED32:case Q.UINT32:case Q.SFIXED32:case Q.SINT32:{let i=Number.parseInt(e);if(Number.isFinite(i))return i;break}case Q.BOOL:switch(e){case"true":return!0;case"false":return!1}break;case Q.UINT64:case Q.FIXED64:try{return hH.uParse(e)}catch(e){}break;default:try{return hH.parse(e)}catch(e){}}return e}function cB(e,i){switch(e.scalar){case Q.INT64:case Q.SFIXED64:case Q.SINT64:"longAsString"in e&&e.longAsString&&"string"==typeof i&&(i=hH.parse(i));break;case Q.FIXED64:case Q.UINT64:"longAsString"in e&&e.longAsString&&"string"==typeof i&&(i=hH.uParse(i))}return i}function cM(e,i){switch(e.scalar){case Q.INT64:case Q.SFIXED64:case Q.SINT64:"longAsString"in e&&e.longAsString?i=String(i):("string"==typeof i||"number"==typeof i)&&(i=hH.parse(i));break;case Q.FIXED64:case Q.UINT64:"longAsString"in e&&e.longAsString?i=String(i):("string"==typeof i||"number"==typeof i)&&(i=hH.uParse(i))}return i}let cI={writeUnknownFields:!0};function cD(e,i,s){var r;for(let r of s.sortedFields){if(!s.isSet(r)){if(3==r.presence)throw Error(`cannot encode ${r} to binary: required field not set`);continue}!function(e,i,s,r){var n;switch(r.fieldKind){case"scalar":case"enum":cN(e,s.desc.typeName,r.name,null!=(n=r.scalar)?n:Q.INT32,r.number,s.get(r));break;case"list":!function(e,i,s,r){var n;if("message"==s.listKind){for(let n of r)cO(e,i,s,n);return}let o=null!=(n=s.scalar)?n:Q.INT32;if(s.packed){if(!r.size)return;for(let i of(e.tag(s.number,J.LengthDelimited).fork(),r))cP(e,s.parent.typeName,s.name,o,i);e.join();return}for(let i of r)cN(e,s.parent.typeName,s.name,o,s.number,i)}(e,i,r,s.get(r));break;case"message":cO(e,i,r,s.get(r));break;case"map":for(let[n,o]of s.get(r))!function(e,i,s,r,n){var o;switch(e.tag(s.number,J.LengthDelimited).fork(),cN(e,s.parent.typeName,s.name,s.mapKey,1,r),s.mapKind){case"scalar":case"enum":cN(e,s.parent.typeName,s.name,null!=(o=s.scalar)?o:Q.INT32,2,n);break;case"message":cD(e.tag(2,J.LengthDelimited).fork(),i,n).join()}e.join()}(e,i,r,n,o)}}(e,i,s,r)}if(i.writeUnknownFields)for(let{no:i,wireType:n,data:o}of null!=(r=s.getUnknown())?r:[])e.tag(i,n).raw(o);return e}function cN(e,i,s,r,n,o){cP(e.tag(n,function(e){switch(e){case Q.BYTES:case Q.STRING:return J.LengthDelimited;case Q.DOUBLE:case Q.FIXED64:case Q.SFIXED64:return J.Bit64;case Q.FIXED32:case Q.SFIXED32:case Q.FLOAT:return J.Bit32;default:return J.Varint}}(r)),i,s,r,o)}function cO(e,i,s,r){s.delimitedEncoding?cD(e.tag(s.number,J.StartGroup),i,r).tag(s.number,J.EndGroup):cD(e.tag(s.number,J.LengthDelimited).fork(),i,r).join()}function cP(e,i,s,r,n){try{switch(r){case Q.STRING:e.string(n);break;case Q.BOOL:e.bool(n);break;case Q.DOUBLE:e.double(n);break;case Q.FLOAT:e.float(n);break;case Q.INT32:e.int32(n);break;case Q.INT64:e.int64(n);break;case Q.UINT64:e.uint64(n);break;case Q.FIXED64:e.fixed64(n);break;case Q.BYTES:e.bytes(n);break;case Q.FIXED32:e.fixed32(n);break;case Q.SFIXED32:e.sfixed32(n);break;case Q.SFIXED64:e.sfixed64(n);break;case Q.SINT64:e.sint64(n);break;case Q.UINT32:e.uint32(n);break;case Q.SINT32:e.sint32(n)}}catch(e){if(e instanceof Error)throw Error(`cannot encode field ${i}.${s} to binary: ${e.message}`);throw e}}let cF={readUnknownFields:!0};function cW(e,i,s){let r=cv(e,void 0,!1);return cz(r,new ca(i),s?Object.assign(Object.assign({},cF),s):cF,!1,i.byteLength),r.message}function cz(e,i,s,r,n){var o;let a,l,h=r?i.len:i.pos+n,c=null!=(o=e.getUnknown())?o:[];for(;i.pos<h&&([a,l]=i.tag(),!r||l!=J.EndGroup);){let r=e.findNumber(a);if(!r){let e=i.skip(l,a);s.readUnknownFields&&c.push({no:a,wireType:l,data:e});continue}!function(e,i,s,r,n){var o;switch(s.fieldKind){case"scalar":e.set(s,c$(i,s.scalar));break;case"enum":let a=c$(i,Q.INT32);if(s.enum.open)e.set(s,a);else if(s.enum.values.some(e=>e.number===a))e.set(s,a);else if(n.readUnknownFields){let i=[];h$(a,i);let n=null!=(o=e.getUnknown())?o:[];n.push({no:s.number,wireType:r,data:new Uint8Array(i)}),e.setUnknown(n)}break;case"message":e.set(s,cU(i,n,s,e.get(s)));break;case"list":!function(e,i,s,r){var n;let o=s.field();if("message"===o.listKind)return s.add(cU(e,r,o));let a=null!=(n=o.scalar)?n:Q.INT32;if(i!=J.LengthDelimited||a==Q.STRING||a==Q.BYTES)return s.add(c$(e,a));let l=e.uint32()+e.pos;for(;e.pos<l;)s.add(c$(e,a))}(i,r,e.get(s),n);break;case"map":!function(e,i,s){let r,n,o=i.field(),a=e.uint32(),l=e.pos+a;for(;e.pos<l;){let[i]=e.tag();switch(i){case 1:r=c$(e,o.mapKey);break;case 2:switch(o.mapKind){case"scalar":n=c$(e,o.scalar);break;case"enum":n=e.int32();break;case"message":n=cU(e,s,o)}}}if(void 0===r&&(r=hY(o.mapKey,!1)),void 0===n)switch(o.mapKind){case"scalar":n=hY(o.scalar,!1);break;case"enum":n=o.enum.values[0].number;break;case"message":n=cv(o.message,void 0,!1)}i.set(r,n)}(i,e.get(s),n)}}(e,i,r,l,s)}if(r&&(l!=J.EndGroup||a!==n))throw Error("invalid end group tag");c.length>0&&e.setUnknown(c)}function cU(e,i,s,r){let n=s.delimitedEncoding,o=null!=r?r:cv(s.message,void 0,!1);return cz(o,e,i,n,n?s.number:e.uint32()),o}function c$(e,i){switch(i){case Q.STRING:return e.string();case Q.BOOL:return e.bool();case Q.DOUBLE:return e.double();case Q.FLOAT:return e.float();case Q.INT32:return e.int32();case Q.INT64:return e.int64();case Q.UINT64:return e.uint64();case Q.FIXED64:return e.fixed64();case Q.BYTES:return e.bytes();case Q.FIXED32:return e.fixed32();case Q.SFIXED32:return e.sfixed32();case Q.SFIXED64:return e.sfixed64();case Q.SINT64:return e.sint64();case Q.UINT32:return e.uint32();case Q.SINT32:return e.sint32()}}function cV(e){let i=!1,s=[];for(let r=0;r<e.length;r++){let n=e.charAt(r);switch(n){case"_":i=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":s.push(n),i=!1;break;default:i&&(i=!1,n=n.toUpperCase()),s.push(n)}}return s.join("")}let cH=new Set(["constructor","toString","toJSON","valueOf"]);function cK(e){return cH.has(e)?e+"$":e}function cG(e){for(let i of e.field)hj(i,"jsonName")||(i.jsonName=cV(i.name));e.nestedType.forEach(cG)}function cY(...e){let i,s,r,n=(i=new Map,s=new Map,r=new Map,{kind:"registry",types:i,extendees:s,[Symbol.iterator]:()=>i.values(),get files(){return r.values()},addFile(e,i,s){if(r.set(e.proto.name,e),!i)for(let i of function* e(i){switch(i.kind){case"file":for(let s of i.messages)yield s,yield*e(s);yield*i.enums,yield*i.services,yield*i.extensions;break;case"message":for(let s of i.nestedMessages)yield s,yield*e(s);yield*i.nestedEnums,yield*i.nestedExtensions}}(e))this.add(i);if(s)for(let r of e.dependencies)this.addFile(r,i,s)},add(e){if("extension"==e.kind){let i=s.get(e.extendee.typeName);i||s.set(e.extendee.typeName,i=new Map),i.set(e.number,e)}i.set(e.typeName,e)},get:e=>i.get(e),getFile:e=>r.get(e),getMessage(e){let s=i.get(e);return(null==s?void 0:s.kind)=="message"?s:void 0},getEnum(e){let s=i.get(e);return(null==s?void 0:s.kind)=="enum"?s:void 0},getExtension(e){let s=i.get(e);return(null==s?void 0:s.kind)=="extension"?s:void 0},getExtensionFor(e,i){var r;return null==(r=s.get(e.typeName))?void 0:r.get(i)},getService(e){let s=i.get(e);return(null==s?void 0:s.kind)=="service"?s:void 0}});if(!e.length)return n;if("$typeName"in e[0]&&"google.protobuf.FileDescriptorSet"==e[0].$typeName){for(let i of e[0].file)cZ(i,n);return n}if("$typeName"in e[0]){let i=e[0],s=e[1],r=new Set;for(let e of[i,...function e(i){let o=[];for(let e of i.dependency){if(void 0!=n.getFile(e)||r.has(e))continue;let a=s(e);if(!a)throw Error(`Unable to resolve ${e}, imported by ${i.name}`);"kind"in a?n.addFile(a,!1,!0):(r.add(a.name),o.push(a))}return o.concat(...o.map(e))}(i)].reverse())cZ(e,n)}else for(let i of e)for(let e of i.files)n.addFile(e);return n}let cX={998:{fieldPresence:1,enumType:2,repeatedFieldEncoding:2,utf8Validation:3,messageEncoding:1,jsonFormat:2,enforceNamingStyle:2,defaultSymbolVisibility:1},999:{fieldPresence:2,enumType:1,repeatedFieldEncoding:1,utf8Validation:2,messageEncoding:1,jsonFormat:1,enforceNamingStyle:2,defaultSymbolVisibility:1},1e3:{fieldPresence:1,enumType:1,repeatedFieldEncoding:1,utf8Validation:2,messageEncoding:1,jsonFormat:1,enforceNamingStyle:2,defaultSymbolVisibility:1},1001:{fieldPresence:1,enumType:1,repeatedFieldEncoding:1,utf8Validation:2,messageEncoding:1,jsonFormat:1,enforceNamingStyle:1,defaultSymbolVisibility:2}};function cZ(e,i){var s,r,n,o;let a={kind:"file",proto:e,deprecated:null!=(r=null==(s=e.options)?void 0:s.deprecated)&&r,edition:function(e){switch(e.syntax){case"":case"proto2":return 998;case"proto3":return 999;case"editions":if(e.edition in cX)return e.edition;throw Error(`${e.name}: unsupported edition`);default:throw Error(`${e.name}: unsupported syntax "${e.syntax}"`)}}(e),name:e.name.replace(/\.proto$/,""),dependencies:(n=e,o=i,n.dependency.map(e=>{let i=o.getFile(e);if(!i)throw Error(`Cannot find ${e}, imported by ${n.name}`);return i})),enums:[],messages:[],extensions:[],services:[],toString:()=>`file ${e.name}`},l=new Map,h={get:e=>l.get(e),add(e){var i;c3((null==(i=e.proto.options)?void 0:i.mapEntry)===!0),l.set(e.typeName,e)}};for(let s of e.enumType)cQ(s,a,void 0,i);for(let s of e.messageType)!function e(i,s,r,n,o){var a,l,h,c;let d={kind:"message",proto:i,deprecated:null!=(l=null==(a=i.options)?void 0:a.deprecated)&&l,file:s,parent:r,name:i.name,typeName:c0(i,r,s),fields:[],field:{},oneofs:[],members:[],nestedEnums:[],nestedMessages:[],nestedExtensions:[],toString(){return`message ${this.typeName}`}};for(let e of((null==(h=i.options)?void 0:h.mapEntry)===!0?o.add(d):((null!=(c=null==r?void 0:r.nestedMessages)?c:s.messages).push(d),n.add(d)),i.enumType))cQ(e,s,d,n);for(let r of i.nestedType)e(r,s,d,n,o)}(s,a,void 0,i,h);for(let s of e.service)!function(e,i,s){var r,n;let o={kind:"service",proto:e,deprecated:null!=(n=null==(r=e.options)?void 0:r.deprecated)&&n,file:i,name:e.name,typeName:c0(e,void 0,i),methods:[],method:{},toString(){return`service ${this.typeName}`}};for(let r of(i.services.push(o),s.add(o),e.method)){let e=function(e,i,s){var r,n,o,a;let l;l=e.clientStreaming&&e.serverStreaming?"bidi_streaming":e.clientStreaming?"client_streaming":e.serverStreaming?"server_streaming":"unary";let h=s.getMessage(c1(e.inputType)),c=s.getMessage(c1(e.outputType));c3(h,`invalid MethodDescriptorProto: input_type ${e.inputType} not found`),c3(c,`invalid MethodDescriptorProto: output_type ${e.inputType} not found`);let d=e.name;return{kind:"rpc",proto:e,deprecated:null!=(n=null==(r=e.options)?void 0:r.deprecated)&&n,parent:i,name:d,localName:cK(d.length?cK(d[0].toLowerCase()+d.substring(1)):d),methodKind:l,input:h,output:c,idempotency:null!=(a=null==(o=e.options)?void 0:o.idempotencyLevel)?a:0,toString:()=>`rpc ${i.typeName}.${d}`}}(r,o,s);o.methods.push(e),o.method[e.localName]=e}}(s,a,i);for(let e of(cj(a,i),l.values()))cq(e,i,h);for(let e of a.messages)cq(e,i,h),cj(e,i);i.addFile(a,!0)}function cj(e,i){switch(e.kind){case"file":for(let s of e.proto.extension){let r=cJ(s,e,i);e.extensions.push(r),i.add(r)}break;case"message":for(let s of e.proto.extension){let r=cJ(s,e,i);e.nestedExtensions.push(r),i.add(r)}for(let s of e.nestedMessages)cj(s,i)}}function cq(e,i,s){let r=e.proto.oneofDecl.map(i=>{var s,r;return s=i,{kind:"oneof",proto:s,deprecated:!1,parent:r=e,fields:[],name:s.name,localName:cK(cV(s.name)),toString(){return`oneof ${r.typeName}.${this.name}`}}}),n=new Set;for(let o of e.proto.field){let a=function(e,i){if(!hj(e,"oneofIndex")||e.proto3Optional)return;let s=i[e.oneofIndex];return c3(s,`invalid FieldDescriptorProto: oneof #${e.oneofIndex} for field #${e.number} not found`),s}(o,r),l=cJ(o,e,i,a,s);e.fields.push(l),e.field[l.localName]=l,void 0===a?e.members.push(l):(a.fields.push(l),n.has(a)||(n.add(a),e.members.push(a)))}for(let i of r.filter(e=>n.has(e)))e.oneofs.push(i);for(let r of e.nestedMessages)cq(r,i,s)}function cQ(e,i,s,r){var n,o,a,l,h,c,d;let u=function(e,i){var s;let r=((s=e).substring(0,1)+s.substring(1).replace(/[A-Z]/g,e=>"_"+e)).toLowerCase()+"_";for(let e of i){if(!e.name.toLowerCase().startsWith(r))return;let i=e.name.substring(r.length);if(0==i.length||/^\d/.test(i))return}return r}(e.name,e.value),_={kind:"enum",proto:e,deprecated:null!=(o=null==(n=e.options)?void 0:n.deprecated)&&o,file:i,parent:s,open:!0,name:e.name,typeName:c0(e,s,i),value:{},values:[],sharedPrefix:u,toString(){return`enum ${this.typeName}`}};for(let i of(_.open=1==c5("enumType",{proto:(c=_).proto,parent:null!=(d=c.parent)?d:c.file}),r.add(_),e.value)){let e=i.name;_.values.push(_.value[i.number]={kind:"enum_value",proto:i,deprecated:null!=(l=null==(a=i.options)?void 0:a.deprecated)&&l,parent:_,name:e,localName:cK(void 0==u?e:e.substring(u.length)),number:i.number,toString:()=>`enum value ${_.typeName}.${e}`})}(null!=(h=null==s?void 0:s.nestedEnums)?h:i.enums).push(_)}function cJ(e,i,s,r,n){var o,a,l,h;let c=void 0===n,d={kind:"field",proto:e,deprecated:null!=(a=null==(o=e.options)?void 0:o.deprecated)&&a,name:e.name,number:e.number,scalar:void 0,message:void 0,enum:void 0,presence:function(e,i,s,r){if(2==e.label)return 3;if(3==e.label)return 2;if(i||e.proto3Optional||s)return 1;let n=c5("fieldPresence",{proto:e,parent:r});return 2==n&&(11==e.type||10==e.type)?1:n}(e,r,c,i),listKind:void 0,mapKind:void 0,mapKey:void 0,delimitedEncoding:void 0,packed:void 0,longAsString:!1,getDefaultValue:void 0};if(c){let r="file"==i.kind?i:i.file,n="file"==i.kind?void 0:i,o=c0(e,n,r);d.kind="extension",d.file=r,d.parent=n,d.oneof=void 0,d.typeName=o,d.jsonName=`[${o}]`,d.toString=()=>`extension ${o}`;let a=s.getMessage(c1(e.extendee));c3(a,`invalid FieldDescriptorProto: extendee ${e.extendee} not found`),d.extendee=a}else c3("message"==i.kind),d.parent=i,d.oneof=r,d.localName=r?cV(e.name):cK(cV(e.name)),d.jsonName=e.jsonName,d.toString=()=>`field ${i.typeName}.${e.name}`;let u=e.label,_=e.type,f=null==(l=e.options)?void 0:l.jstype;if(3===u){let r=11==_?null==n?void 0:n.get(c1(e.typeName)):void 0;if(r){let e,i;d.fieldKind="map";let{key:s,value:n}=(e=(h=r).fields.find(e=>1===e.number),i=h.fields.find(e=>2===e.number),c3(e&&"scalar"==e.fieldKind&&e.scalar!=Q.BYTES&&e.scalar!=Q.FLOAT&&e.scalar!=Q.DOUBLE&&i&&"list"!=i.fieldKind&&"map"!=i.fieldKind),{key:e,value:i});return d.mapKey=s.scalar,d.mapKind=n.fieldKind,d.message=n.message,d.delimitedEncoding=!1,d.enum=n.enum,d.scalar=n.scalar,d}switch(d.fieldKind="list",_){case 11:case 10:d.listKind="message",d.message=s.getMessage(c1(e.typeName)),c3(d.message),d.delimitedEncoding=c2(e,i);break;case 14:d.listKind="enum",d.enum=s.getEnum(c1(e.typeName)),c3(d.enum);break;default:d.listKind="scalar",d.scalar=_,d.longAsString=1==f}return d.packed=function(e,i){if(3!=e.label)return!1;switch(e.type){case 9:case 12:case 10:case 11:return!1}let s=e.options;return s&&hj(s,"packed")?s.packed:1==c5("repeatedFieldEncoding",{proto:e,parent:i})}(e,i),d}switch(_){case 11:case 10:d.fieldKind="message",d.message=s.getMessage(c1(e.typeName)),c3(d.message,`invalid FieldDescriptorProto: type_name ${e.typeName} not found`),d.delimitedEncoding=c2(e,i),d.getDefaultValue=()=>void 0;break;case 14:{let i=s.getEnum(c1(e.typeName));c3(void 0!==i,`invalid FieldDescriptorProto: type_name ${e.typeName} not found`),d.fieldKind="enum",d.enum=s.getEnum(c1(e.typeName)),d.getDefaultValue=()=>hj(e,"defaultValue")?function(e,i){let s=e.values.find(e=>e.name===i);if(!s)throw Error(`cannot parse ${e} default value: ${i}`);return s.number}(i,e.defaultValue):void 0;break}default:d.fieldKind="scalar",d.scalar=_,d.longAsString=1==f,d.getDefaultValue=()=>hj(e,"defaultValue")?function(e,i){switch(e){case Q.STRING:return i;case Q.BYTES:{let s=function(e){let i=[],s={tail:e,c:"",next(){return 0!=this.tail.length&&(this.c=this.tail[0],this.tail=this.tail.substring(1),!0)},take(e){if(this.tail.length>=e){let i=this.tail.substring(0,e);return this.tail=this.tail.substring(e),i}return!1}};for(;s.next();)if("\\"===s.c){if(s.next())switch(s.c){case"\\":i.push(s.c.charCodeAt(0));break;case"b":i.push(8);break;case"f":i.push(12);break;case"n":i.push(10);break;case"r":i.push(13);break;case"t":i.push(9);break;case"v":i.push(11);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":{let e=s.c,r=s.take(2);if(!1===r)return!1;let n=parseInt(e+r,8);if(Number.isNaN(n))return!1;i.push(n);break}case"x":{let e=s.c,r=s.take(2);if(!1===r)return!1;let n=parseInt(e+r,16);if(Number.isNaN(n))return!1;i.push(n);break}case"u":{let e=s.c,r=s.take(4);if(!1===r)return!1;let n=parseInt(e+r,16);if(Number.isNaN(n))return!1;let o=new Uint8Array(4);new DataView(o.buffer).setInt32(0,n,!0),i.push(o[0],o[1],o[2],o[3]);break}case"U":{let e=s.c,r=s.take(8);if(!1===r)return!1;let n=hH.uEnc(e+r),o=new Uint8Array(8),a=new DataView(o.buffer);a.setInt32(0,n.lo,!0),a.setInt32(4,n.hi,!0),i.push(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7])}}}else i.push(s.c.charCodeAt(0));return new Uint8Array(i)}(i);if(!1===s)throw Error(`cannot parse ${Q[e]} default value: ${i}`);return s}case Q.INT64:case Q.SFIXED64:case Q.SINT64:return hH.parse(i);case Q.UINT64:case Q.FIXED64:return hH.uParse(i);case Q.DOUBLE:case Q.FLOAT:switch(i){case"inf":return 1/0;case"-inf":return-1/0;case"nan":return NaN;default:return parseFloat(i)}case Q.BOOL:return"true"===i;case Q.INT32:case Q.UINT32:case Q.SINT32:case Q.FIXED32:case Q.SFIXED32:return parseInt(i,10)}}(_,e.defaultValue):void 0}return d}function c0(e,i,s){return i?`${i.typeName}.${e.name}`:s.proto.package.length>0?`${s.proto.package}.${e.name}`:`${e.name}`}function c1(e){return e.startsWith(".")?e.substring(1):e}function c2(e,i){return 10==e.type||2==c5("messageEncoding",{proto:e,parent:i})}function c5(e,i){var s,r;let n=null==(s=i.proto.options)?void 0:s.features;if(n){let i=n[e];if(0!=i)return i}if("kind"in i){if("message"==i.kind)return c5(e,null!=(r=i.parent)?r:i.file);let s=cX[i.edition];if(!s)throw Error(`feature default for edition ${i.edition} not found`);return s[e]}return c5(e,i.parent)}function c3(e,i){if(!e)throw Error(i)}function c6(e){var i,s,r,n,o,a,l,h;return Object.assign(Object.create({visibility:0}),{$typeName:"google.protobuf.DescriptorProto",name:e.name,field:null!=(s=null==(i=e.field)?void 0:i.map(c4))?s:[],extension:[],nestedType:null!=(n=null==(r=e.nestedType)?void 0:r.map(c6))?n:[],enumType:null!=(a=null==(o=e.enumType)?void 0:o.map(c9))?a:[],extensionRange:null!=(h=null==(l=e.extensionRange)?void 0:l.map(e=>Object.assign({$typeName:"google.protobuf.DescriptorProto.ExtensionRange"},e)))?h:[],oneofDecl:[],reservedRange:[],reservedName:[]})}function c4(e){var i,s,r,n;return Object.assign(Object.create({label:1,typeName:"",extendee:"",defaultValue:"",oneofIndex:0,jsonName:"",proto3Optional:!1}),Object.assign(Object.assign({$typeName:"google.protobuf.FieldDescriptorProto"},e),{options:e.options?(i=e.options,Object.assign(Object.create({ctype:0,packed:!1,jstype:0,lazy:!1,unverifiedLazy:!1,deprecated:!1,weak:!1,debugRedact:!1,retention:0}),Object.assign(Object.assign({$typeName:"google.protobuf.FieldOptions"},i),{targets:null!=(s=i.targets)?s:[],editionDefaults:null!=(n=null==(r=i.editionDefaults)?void 0:r.map(e=>Object.assign({$typeName:"google.protobuf.FieldOptions.EditionDefault"},e)))?n:[],uninterpretedOption:[]}))):void 0}))}function c9(e){return Object.assign(Object.create({visibility:0}),{$typeName:"google.protobuf.EnumDescriptorProto",name:e.name,reservedName:[],reservedRange:[],value:e.value.map(e=>Object.assign({$typeName:"google.protobuf.EnumValueDescriptorProto"},e))})}function c8(e,i,...s){return s.reduce((e,i)=>e.nestedMessages[i],e.messages[i])}let c7=c8((R={name:"google/protobuf/descriptor.proto",package:"google.protobuf",messageType:[{name:"FileDescriptorSet",field:[{name:"file",number:1,type:11,label:3,typeName:".google.protobuf.FileDescriptorProto"}],extensionRange:[{start:536e6,end:0x1ff2b601}]},{name:"FileDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"package",number:2,type:9,label:1},{name:"dependency",number:3,type:9,label:3},{name:"public_dependency",number:10,type:5,label:3},{name:"weak_dependency",number:11,type:5,label:3},{name:"option_dependency",number:15,type:9,label:3},{name:"message_type",number:4,type:11,label:3,typeName:".google.protobuf.DescriptorProto"},{name:"enum_type",number:5,type:11,label:3,typeName:".google.protobuf.EnumDescriptorProto"},{name:"service",number:6,type:11,label:3,typeName:".google.protobuf.ServiceDescriptorProto"},{name:"extension",number:7,type:11,label:3,typeName:".google.protobuf.FieldDescriptorProto"},{name:"options",number:8,type:11,label:1,typeName:".google.protobuf.FileOptions"},{name:"source_code_info",number:9,type:11,label:1,typeName:".google.protobuf.SourceCodeInfo"},{name:"syntax",number:12,type:9,label:1},{name:"edition",number:14,type:14,label:1,typeName:".google.protobuf.Edition"}]},{name:"DescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"field",number:2,type:11,label:3,typeName:".google.protobuf.FieldDescriptorProto"},{name:"extension",number:6,type:11,label:3,typeName:".google.protobuf.FieldDescriptorProto"},{name:"nested_type",number:3,type:11,label:3,typeName:".google.protobuf.DescriptorProto"},{name:"enum_type",number:4,type:11,label:3,typeName:".google.protobuf.EnumDescriptorProto"},{name:"extension_range",number:5,type:11,label:3,typeName:".google.protobuf.DescriptorProto.ExtensionRange"},{name:"oneof_decl",number:8,type:11,label:3,typeName:".google.protobuf.OneofDescriptorProto"},{name:"options",number:7,type:11,label:1,typeName:".google.protobuf.MessageOptions"},{name:"reserved_range",number:9,type:11,label:3,typeName:".google.protobuf.DescriptorProto.ReservedRange"},{name:"reserved_name",number:10,type:9,label:3},{name:"visibility",number:11,type:14,label:1,typeName:".google.protobuf.SymbolVisibility"}],nestedType:[{name:"ExtensionRange",field:[{name:"start",number:1,type:5,label:1},{name:"end",number:2,type:5,label:1},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.ExtensionRangeOptions"}]},{name:"ReservedRange",field:[{name:"start",number:1,type:5,label:1},{name:"end",number:2,type:5,label:1}]}]},{name:"ExtensionRangeOptions",field:[{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"},{name:"declaration",number:2,type:11,label:3,typeName:".google.protobuf.ExtensionRangeOptions.Declaration",options:{retention:2}},{name:"features",number:50,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"verification",number:3,type:14,label:1,typeName:".google.protobuf.ExtensionRangeOptions.VerificationState",defaultValue:"UNVERIFIED",options:{retention:2}}],nestedType:[{name:"Declaration",field:[{name:"number",number:1,type:5,label:1},{name:"full_name",number:2,type:9,label:1},{name:"type",number:3,type:9,label:1},{name:"reserved",number:5,type:8,label:1},{name:"repeated",number:6,type:8,label:1}]}],enumType:[{name:"VerificationState",value:[{name:"DECLARATION",number:0},{name:"UNVERIFIED",number:1}]}],extensionRange:[{start:1e3,end:0x20000000}]},{name:"FieldDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"number",number:3,type:5,label:1},{name:"label",number:4,type:14,label:1,typeName:".google.protobuf.FieldDescriptorProto.Label"},{name:"type",number:5,type:14,label:1,typeName:".google.protobuf.FieldDescriptorProto.Type"},{name:"type_name",number:6,type:9,label:1},{name:"extendee",number:2,type:9,label:1},{name:"default_value",number:7,type:9,label:1},{name:"oneof_index",number:9,type:5,label:1},{name:"json_name",number:10,type:9,label:1},{name:"options",number:8,type:11,label:1,typeName:".google.protobuf.FieldOptions"},{name:"proto3_optional",number:17,type:8,label:1}],enumType:[{name:"Type",value:[{name:"TYPE_DOUBLE",number:1},{name:"TYPE_FLOAT",number:2},{name:"TYPE_INT64",number:3},{name:"TYPE_UINT64",number:4},{name:"TYPE_INT32",number:5},{name:"TYPE_FIXED64",number:6},{name:"TYPE_FIXED32",number:7},{name:"TYPE_BOOL",number:8},{name:"TYPE_STRING",number:9},{name:"TYPE_GROUP",number:10},{name:"TYPE_MESSAGE",number:11},{name:"TYPE_BYTES",number:12},{name:"TYPE_UINT32",number:13},{name:"TYPE_ENUM",number:14},{name:"TYPE_SFIXED32",number:15},{name:"TYPE_SFIXED64",number:16},{name:"TYPE_SINT32",number:17},{name:"TYPE_SINT64",number:18}]},{name:"Label",value:[{name:"LABEL_OPTIONAL",number:1},{name:"LABEL_REPEATED",number:3},{name:"LABEL_REQUIRED",number:2}]}]},{name:"OneofDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"options",number:2,type:11,label:1,typeName:".google.protobuf.OneofOptions"}]},{name:"EnumDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"value",number:2,type:11,label:3,typeName:".google.protobuf.EnumValueDescriptorProto"},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.EnumOptions"},{name:"reserved_range",number:4,type:11,label:3,typeName:".google.protobuf.EnumDescriptorProto.EnumReservedRange"},{name:"reserved_name",number:5,type:9,label:3},{name:"visibility",number:6,type:14,label:1,typeName:".google.protobuf.SymbolVisibility"}],nestedType:[{name:"EnumReservedRange",field:[{name:"start",number:1,type:5,label:1},{name:"end",number:2,type:5,label:1}]}]},{name:"EnumValueDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"number",number:2,type:5,label:1},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.EnumValueOptions"}]},{name:"ServiceDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"method",number:2,type:11,label:3,typeName:".google.protobuf.MethodDescriptorProto"},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.ServiceOptions"}]},{name:"MethodDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"input_type",number:2,type:9,label:1},{name:"output_type",number:3,type:9,label:1},{name:"options",number:4,type:11,label:1,typeName:".google.protobuf.MethodOptions"},{name:"client_streaming",number:5,type:8,label:1,defaultValue:"false"},{name:"server_streaming",number:6,type:8,label:1,defaultValue:"false"}]},{name:"FileOptions",field:[{name:"java_package",number:1,type:9,label:1},{name:"java_outer_classname",number:8,type:9,label:1},{name:"java_multiple_files",number:10,type:8,label:1,defaultValue:"false"},{name:"java_generate_equals_and_hash",number:20,type:8,label:1,options:{deprecated:!0}},{name:"java_string_check_utf8",number:27,type:8,label:1,defaultValue:"false"},{name:"optimize_for",number:9,type:14,label:1,typeName:".google.protobuf.FileOptions.OptimizeMode",defaultValue:"SPEED"},{name:"go_package",number:11,type:9,label:1},{name:"cc_generic_services",number:16,type:8,label:1,defaultValue:"false"},{name:"java_generic_services",number:17,type:8,label:1,defaultValue:"false"},{name:"py_generic_services",number:18,type:8,label:1,defaultValue:"false"},{name:"deprecated",number:23,type:8,label:1,defaultValue:"false"},{name:"cc_enable_arenas",number:31,type:8,label:1,defaultValue:"true"},{name:"objc_class_prefix",number:36,type:9,label:1},{name:"csharp_namespace",number:37,type:9,label:1},{name:"swift_prefix",number:39,type:9,label:1},{name:"php_class_prefix",number:40,type:9,label:1},{name:"php_namespace",number:41,type:9,label:1},{name:"php_metadata_namespace",number:44,type:9,label:1},{name:"ruby_package",number:45,type:9,label:1},{name:"features",number:50,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],enumType:[{name:"OptimizeMode",value:[{name:"SPEED",number:1},{name:"CODE_SIZE",number:2},{name:"LITE_RUNTIME",number:3}]}],extensionRange:[{start:1e3,end:0x20000000}]},{name:"MessageOptions",field:[{name:"message_set_wire_format",number:1,type:8,label:1,defaultValue:"false"},{name:"no_standard_descriptor_accessor",number:2,type:8,label:1,defaultValue:"false"},{name:"deprecated",number:3,type:8,label:1,defaultValue:"false"},{name:"map_entry",number:7,type:8,label:1},{name:"deprecated_legacy_json_field_conflicts",number:11,type:8,label:1,options:{deprecated:!0}},{name:"features",number:12,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:0x20000000}]},{name:"FieldOptions",field:[{name:"ctype",number:1,type:14,label:1,typeName:".google.protobuf.FieldOptions.CType",defaultValue:"STRING"},{name:"packed",number:2,type:8,label:1},{name:"jstype",number:6,type:14,label:1,typeName:".google.protobuf.FieldOptions.JSType",defaultValue:"JS_NORMAL"},{name:"lazy",number:5,type:8,label:1,defaultValue:"false"},{name:"unverified_lazy",number:15,type:8,label:1,defaultValue:"false"},{name:"deprecated",number:3,type:8,label:1,defaultValue:"false"},{name:"weak",number:10,type:8,label:1,defaultValue:"false",options:{deprecated:!0}},{name:"debug_redact",number:16,type:8,label:1,defaultValue:"false"},{name:"retention",number:17,type:14,label:1,typeName:".google.protobuf.FieldOptions.OptionRetention"},{name:"targets",number:19,type:14,label:3,typeName:".google.protobuf.FieldOptions.OptionTargetType"},{name:"edition_defaults",number:20,type:11,label:3,typeName:".google.protobuf.FieldOptions.EditionDefault"},{name:"features",number:21,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"feature_support",number:22,type:11,label:1,typeName:".google.protobuf.FieldOptions.FeatureSupport"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],nestedType:[{name:"EditionDefault",field:[{name:"edition",number:3,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"value",number:2,type:9,label:1}]},{name:"FeatureSupport",field:[{name:"edition_introduced",number:1,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"edition_deprecated",number:2,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"deprecation_warning",number:3,type:9,label:1},{name:"edition_removed",number:4,type:14,label:1,typeName:".google.protobuf.Edition"}]}],enumType:[{name:"CType",value:[{name:"STRING",number:0},{name:"CORD",number:1},{name:"STRING_PIECE",number:2}]},{name:"JSType",value:[{name:"JS_NORMAL",number:0},{name:"JS_STRING",number:1},{name:"JS_NUMBER",number:2}]},{name:"OptionRetention",value:[{name:"RETENTION_UNKNOWN",number:0},{name:"RETENTION_RUNTIME",number:1},{name:"RETENTION_SOURCE",number:2}]},{name:"OptionTargetType",value:[{name:"TARGET_TYPE_UNKNOWN",number:0},{name:"TARGET_TYPE_FILE",number:1},{name:"TARGET_TYPE_EXTENSION_RANGE",number:2},{name:"TARGET_TYPE_MESSAGE",number:3},{name:"TARGET_TYPE_FIELD",number:4},{name:"TARGET_TYPE_ONEOF",number:5},{name:"TARGET_TYPE_ENUM",number:6},{name:"TARGET_TYPE_ENUM_ENTRY",number:7},{name:"TARGET_TYPE_SERVICE",number:8},{name:"TARGET_TYPE_METHOD",number:9}]}],extensionRange:[{start:1e3,end:0x20000000}]},{name:"OneofOptions",field:[{name:"features",number:1,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:0x20000000}]},{name:"EnumOptions",field:[{name:"allow_alias",number:2,type:8,label:1},{name:"deprecated",number:3,type:8,label:1,defaultValue:"false"},{name:"deprecated_legacy_json_field_conflicts",number:6,type:8,label:1,options:{deprecated:!0}},{name:"features",number:7,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:0x20000000}]},{name:"EnumValueOptions",field:[{name:"deprecated",number:1,type:8,label:1,defaultValue:"false"},{name:"features",number:2,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"debug_redact",number:3,type:8,label:1,defaultValue:"false"},{name:"feature_support",number:4,type:11,label:1,typeName:".google.protobuf.FieldOptions.FeatureSupport"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:0x20000000}]},{name:"ServiceOptions",field:[{name:"features",number:34,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"deprecated",number:33,type:8,label:1,defaultValue:"false"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:0x20000000}]},{name:"MethodOptions",field:[{name:"deprecated",number:33,type:8,label:1,defaultValue:"false"},{name:"idempotency_level",number:34,type:14,label:1,typeName:".google.protobuf.MethodOptions.IdempotencyLevel",defaultValue:"IDEMPOTENCY_UNKNOWN"},{name:"features",number:35,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],enumType:[{name:"IdempotencyLevel",value:[{name:"IDEMPOTENCY_UNKNOWN",number:0},{name:"NO_SIDE_EFFECTS",number:1},{name:"IDEMPOTENT",number:2}]}],extensionRange:[{start:1e3,end:0x20000000}]},{name:"UninterpretedOption",field:[{name:"name",number:2,type:11,label:3,typeName:".google.protobuf.UninterpretedOption.NamePart"},{name:"identifier_value",number:3,type:9,label:1},{name:"positive_int_value",number:4,type:4,label:1},{name:"negative_int_value",number:5,type:3,label:1},{name:"double_value",number:6,type:1,label:1},{name:"string_value",number:7,type:12,label:1},{name:"aggregate_value",number:8,type:9,label:1}],nestedType:[{name:"NamePart",field:[{name:"name_part",number:1,type:9,label:2},{name:"is_extension",number:2,type:8,label:2}]}]},{name:"FeatureSet",field:[{name:"field_presence",number:1,type:14,label:1,typeName:".google.protobuf.FeatureSet.FieldPresence",options:{retention:1,targets:[4,1],editionDefaults:[{value:"EXPLICIT",edition:900},{value:"IMPLICIT",edition:999},{value:"EXPLICIT",edition:1e3}]}},{name:"enum_type",number:2,type:14,label:1,typeName:".google.protobuf.FeatureSet.EnumType",options:{retention:1,targets:[6,1],editionDefaults:[{value:"CLOSED",edition:900},{value:"OPEN",edition:999}]}},{name:"repeated_field_encoding",number:3,type:14,label:1,typeName:".google.protobuf.FeatureSet.RepeatedFieldEncoding",options:{retention:1,targets:[4,1],editionDefaults:[{value:"EXPANDED",edition:900},{value:"PACKED",edition:999}]}},{name:"utf8_validation",number:4,type:14,label:1,typeName:".google.protobuf.FeatureSet.Utf8Validation",options:{retention:1,targets:[4,1],editionDefaults:[{value:"NONE",edition:900},{value:"VERIFY",edition:999}]}},{name:"message_encoding",number:5,type:14,label:1,typeName:".google.protobuf.FeatureSet.MessageEncoding",options:{retention:1,targets:[4,1],editionDefaults:[{value:"LENGTH_PREFIXED",edition:900}]}},{name:"json_format",number:6,type:14,label:1,typeName:".google.protobuf.FeatureSet.JsonFormat",options:{retention:1,targets:[3,6,1],editionDefaults:[{value:"LEGACY_BEST_EFFORT",edition:900},{value:"ALLOW",edition:999}]}},{name:"enforce_naming_style",number:7,type:14,label:1,typeName:".google.protobuf.FeatureSet.EnforceNamingStyle",options:{retention:2,targets:[1,2,3,4,5,6,7,8,9],editionDefaults:[{value:"STYLE_LEGACY",edition:900},{value:"STYLE2024",edition:1001}]}},{name:"default_symbol_visibility",number:8,type:14,label:1,typeName:".google.protobuf.FeatureSet.VisibilityFeature.DefaultSymbolVisibility",options:{retention:2,targets:[1],editionDefaults:[{value:"EXPORT_ALL",edition:900},{value:"EXPORT_TOP_LEVEL",edition:1001}]}}],nestedType:[{name:"VisibilityFeature",enumType:[{name:"DefaultSymbolVisibility",value:[{name:"DEFAULT_SYMBOL_VISIBILITY_UNKNOWN",number:0},{name:"EXPORT_ALL",number:1},{name:"EXPORT_TOP_LEVEL",number:2},{name:"LOCAL_ALL",number:3},{name:"STRICT",number:4}]}]}],enumType:[{name:"FieldPresence",value:[{name:"FIELD_PRESENCE_UNKNOWN",number:0},{name:"EXPLICIT",number:1},{name:"IMPLICIT",number:2},{name:"LEGACY_REQUIRED",number:3}]},{name:"EnumType",value:[{name:"ENUM_TYPE_UNKNOWN",number:0},{name:"OPEN",number:1},{name:"CLOSED",number:2}]},{name:"RepeatedFieldEncoding",value:[{name:"REPEATED_FIELD_ENCODING_UNKNOWN",number:0},{name:"PACKED",number:1},{name:"EXPANDED",number:2}]},{name:"Utf8Validation",value:[{name:"UTF8_VALIDATION_UNKNOWN",number:0},{name:"VERIFY",number:2},{name:"NONE",number:3}]},{name:"MessageEncoding",value:[{name:"MESSAGE_ENCODING_UNKNOWN",number:0},{name:"LENGTH_PREFIXED",number:1},{name:"DELIMITED",number:2}]},{name:"JsonFormat",value:[{name:"JSON_FORMAT_UNKNOWN",number:0},{name:"ALLOW",number:1},{name:"LEGACY_BEST_EFFORT",number:2}]},{name:"EnforceNamingStyle",value:[{name:"ENFORCE_NAMING_STYLE_UNKNOWN",number:0},{name:"STYLE2024",number:1},{name:"STYLE_LEGACY",number:2}]}],extensionRange:[{start:1e3,end:9995},{start:9995,end:1e4},{start:1e4,end:10001}]},{name:"FeatureSetDefaults",field:[{name:"defaults",number:1,type:11,label:3,typeName:".google.protobuf.FeatureSetDefaults.FeatureSetEditionDefault"},{name:"minimum_edition",number:4,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"maximum_edition",number:5,type:14,label:1,typeName:".google.protobuf.Edition"}],nestedType:[{name:"FeatureSetEditionDefault",field:[{name:"edition",number:3,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"overridable_features",number:4,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"fixed_features",number:5,type:11,label:1,typeName:".google.protobuf.FeatureSet"}]}]},{name:"SourceCodeInfo",field:[{name:"location",number:1,type:11,label:3,typeName:".google.protobuf.SourceCodeInfo.Location"}],nestedType:[{name:"Location",field:[{name:"path",number:1,type:5,label:3,options:{packed:!0}},{name:"span",number:2,type:5,label:3,options:{packed:!0}},{name:"leading_comments",number:3,type:9,label:1},{name:"trailing_comments",number:4,type:9,label:1},{name:"leading_detached_comments",number:6,type:9,label:3}]}],extensionRange:[{start:536e6,end:0x1ff2b601}]},{name:"GeneratedCodeInfo",field:[{name:"annotation",number:1,type:11,label:3,typeName:".google.protobuf.GeneratedCodeInfo.Annotation"}],nestedType:[{name:"Annotation",field:[{name:"path",number:1,type:5,label:3,options:{packed:!0}},{name:"source_file",number:2,type:9,label:1},{name:"begin",number:3,type:5,label:1},{name:"end",number:4,type:5,label:1},{name:"semantic",number:5,type:14,label:1,typeName:".google.protobuf.GeneratedCodeInfo.Annotation.Semantic"}],enumType:[{name:"Semantic",value:[{name:"NONE",number:0},{name:"SET",number:1},{name:"ALIAS",number:2}]}]}]}],enumType:[{name:"Edition",value:[{name:"EDITION_UNKNOWN",number:0},{name:"EDITION_LEGACY",number:900},{name:"EDITION_PROTO2",number:998},{name:"EDITION_PROTO3",number:999},{name:"EDITION_2023",number:1e3},{name:"EDITION_2024",number:1001},{name:"EDITION_UNSTABLE",number:9999},{name:"EDITION_1_TEST_ONLY",number:1},{name:"EDITION_2_TEST_ONLY",number:2},{name:"EDITION_99997_TEST_ONLY",number:99997},{name:"EDITION_99998_TEST_ONLY",number:99998},{name:"EDITION_99999_TEST_ONLY",number:99999},{name:"EDITION_MAX",number:0x7fffffff}]},{name:"SymbolVisibility",value:[{name:"VISIBILITY_UNSET",number:0},{name:"VISIBILITY_LOCAL",number:1},{name:"VISIBILITY_EXPORT",number:2}]}]},(k=Object.assign(Object.create({syntax:"",edition:0}),Object.assign(Object.assign({$typeName:"google.protobuf.FileDescriptorProto",dependency:[],publicDependency:[],weakDependency:[],optionDependency:[],service:[],extension:[]},R),{messageType:R.messageType.map(c6),enumType:R.enumType.map(c9)}))).messageType.forEach(cG),cY(k,()=>void 0).getFile(k.name)),1);(B=ee||(ee={}))[B.DECLARATION=0]="DECLARATION",B[B.UNVERIFIED=1]="UNVERIFIED",(M=et||(et={}))[M.DOUBLE=1]="DOUBLE",M[M.FLOAT=2]="FLOAT",M[M.INT64=3]="INT64",M[M.UINT64=4]="UINT64",M[M.INT32=5]="INT32",M[M.FIXED64=6]="FIXED64",M[M.FIXED32=7]="FIXED32",M[M.BOOL=8]="BOOL",M[M.STRING=9]="STRING",M[M.GROUP=10]="GROUP",M[M.MESSAGE=11]="MESSAGE",M[M.BYTES=12]="BYTES",M[M.UINT32=13]="UINT32",M[M.ENUM=14]="ENUM",M[M.SFIXED32=15]="SFIXED32",M[M.SFIXED64=16]="SFIXED64",M[M.SINT32=17]="SINT32",M[M.SINT64=18]="SINT64",(I=ei||(ei={}))[I.OPTIONAL=1]="OPTIONAL",I[I.REPEATED=3]="REPEATED",I[I.REQUIRED=2]="REQUIRED",(D=es||(es={}))[D.SPEED=1]="SPEED",D[D.CODE_SIZE=2]="CODE_SIZE",D[D.LITE_RUNTIME=3]="LITE_RUNTIME",(N=er||(er={}))[N.STRING=0]="STRING",N[N.CORD=1]="CORD",N[N.STRING_PIECE=2]="STRING_PIECE",(O=en||(en={}))[O.JS_NORMAL=0]="JS_NORMAL",O[O.JS_STRING=1]="JS_STRING",O[O.JS_NUMBER=2]="JS_NUMBER",(P=eo||(eo={}))[P.RETENTION_UNKNOWN=0]="RETENTION_UNKNOWN",P[P.RETENTION_RUNTIME=1]="RETENTION_RUNTIME",P[P.RETENTION_SOURCE=2]="RETENTION_SOURCE",(F=ea||(ea={}))[F.TARGET_TYPE_UNKNOWN=0]="TARGET_TYPE_UNKNOWN",F[F.TARGET_TYPE_FILE=1]="TARGET_TYPE_FILE",F[F.TARGET_TYPE_EXTENSION_RANGE=2]="TARGET_TYPE_EXTENSION_RANGE",F[F.TARGET_TYPE_MESSAGE=3]="TARGET_TYPE_MESSAGE",F[F.TARGET_TYPE_FIELD=4]="TARGET_TYPE_FIELD",F[F.TARGET_TYPE_ONEOF=5]="TARGET_TYPE_ONEOF",F[F.TARGET_TYPE_ENUM=6]="TARGET_TYPE_ENUM",F[F.TARGET_TYPE_ENUM_ENTRY=7]="TARGET_TYPE_ENUM_ENTRY",F[F.TARGET_TYPE_SERVICE=8]="TARGET_TYPE_SERVICE",F[F.TARGET_TYPE_METHOD=9]="TARGET_TYPE_METHOD",(W=el||(el={}))[W.IDEMPOTENCY_UNKNOWN=0]="IDEMPOTENCY_UNKNOWN",W[W.NO_SIDE_EFFECTS=1]="NO_SIDE_EFFECTS",W[W.IDEMPOTENT=2]="IDEMPOTENT",(z=eh||(eh={}))[z.DEFAULT_SYMBOL_VISIBILITY_UNKNOWN=0]="DEFAULT_SYMBOL_VISIBILITY_UNKNOWN",z[z.EXPORT_ALL=1]="EXPORT_ALL",z[z.EXPORT_TOP_LEVEL=2]="EXPORT_TOP_LEVEL",z[z.LOCAL_ALL=3]="LOCAL_ALL",z[z.STRICT=4]="STRICT",(U=ec||(ec={}))[U.FIELD_PRESENCE_UNKNOWN=0]="FIELD_PRESENCE_UNKNOWN",U[U.EXPLICIT=1]="EXPLICIT",U[U.IMPLICIT=2]="IMPLICIT",U[U.LEGACY_REQUIRED=3]="LEGACY_REQUIRED",($=ed||(ed={}))[$.ENUM_TYPE_UNKNOWN=0]="ENUM_TYPE_UNKNOWN",$[$.OPEN=1]="OPEN",$[$.CLOSED=2]="CLOSED",(V=eu||(eu={}))[V.REPEATED_FIELD_ENCODING_UNKNOWN=0]="REPEATED_FIELD_ENCODING_UNKNOWN",V[V.PACKED=1]="PACKED",V[V.EXPANDED=2]="EXPANDED",(H=e_||(e_={}))[H.UTF8_VALIDATION_UNKNOWN=0]="UTF8_VALIDATION_UNKNOWN",H[H.VERIFY=2]="VERIFY",H[H.NONE=3]="NONE",(K=ef||(ef={}))[K.MESSAGE_ENCODING_UNKNOWN=0]="MESSAGE_ENCODING_UNKNOWN",K[K.LENGTH_PREFIXED=1]="LENGTH_PREFIXED",K[K.DELIMITED=2]="DELIMITED",(G=eg||(eg={}))[G.JSON_FORMAT_UNKNOWN=0]="JSON_FORMAT_UNKNOWN",G[G.ALLOW=1]="ALLOW",G[G.LEGACY_BEST_EFFORT=2]="LEGACY_BEST_EFFORT",(Y=ep||(ep={}))[Y.ENFORCE_NAMING_STYLE_UNKNOWN=0]="ENFORCE_NAMING_STYLE_UNKNOWN",Y[Y.STYLE2024=1]="STYLE2024",Y[Y.STYLE_LEGACY=2]="STYLE_LEGACY",(X=em||(em={}))[X.NONE=0]="NONE",X[X.SET=1]="SET",X[X.ALIAS=2]="ALIAS",(Z=ev||(ev={}))[Z.EDITION_UNKNOWN=0]="EDITION_UNKNOWN",Z[Z.EDITION_LEGACY=900]="EDITION_LEGACY",Z[Z.EDITION_PROTO2=998]="EDITION_PROTO2",Z[Z.EDITION_PROTO3=999]="EDITION_PROTO3",Z[Z.EDITION_2023=1e3]="EDITION_2023",Z[Z.EDITION_2024=1001]="EDITION_2024",Z[Z.EDITION_UNSTABLE=9999]="EDITION_UNSTABLE",Z[Z.EDITION_1_TEST_ONLY=1]="EDITION_1_TEST_ONLY",Z[Z.EDITION_2_TEST_ONLY=2]="EDITION_2_TEST_ONLY",Z[Z.EDITION_99997_TEST_ONLY=99997]="EDITION_99997_TEST_ONLY",Z[Z.EDITION_99998_TEST_ONLY=99998]="EDITION_99998_TEST_ONLY",Z[Z.EDITION_99999_TEST_ONLY=99999]="EDITION_99999_TEST_ONLY",Z[Z.EDITION_MAX=0x7fffffff]="EDITION_MAX",(j=eb||(eb={}))[j.VISIBILITY_UNSET=0]="VISIBILITY_UNSET",j[j.VISIBILITY_LOCAL=1]="VISIBILITY_LOCAL",j[j.VISIBILITY_EXPORT=2]="VISIBILITY_EXPORT";let de=((A=cW(c7,function(e){let r=function(){if(!s){s=[];let e=(i||(i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("")).slice(0,-2).concat("-","_"),i);for(let i=0;i<e.length;i++)s[e[i].charCodeAt(0)]=i;s[45]=e.indexOf("+"),s[95]=e.indexOf("/")}return s}(),n=3*e.length/4;"="==e[e.length-2]?n-=2:"="==e[e.length-1]&&(n-=1);let o=new Uint8Array(n),a=0,l=0,h,c=0;for(let i=0;i<e.length;i++){if(void 0===(h=r[e.charCodeAt(i)]))switch(e[i]){case"=":l=0;case"\n":case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string")}switch(l){case 0:c=h,l=1;break;case 1:o[a++]=c<<2|(48&h)>>4,c=h,l=2;break;case 2:o[a++]=(15&c)<<4|(60&h)>>2,c=h,l=3;break;case 3:o[a++]=(3&c)<<6|h,l=0}}if(1==l)throw Error("invalid base64 string");return o.subarray(0,a)}("Cg50ZXJtaW5hbC5wcm90bxIIdGVybWluYWwiKAoFQ29sb3ISCQoBchgBIAEoDRIJCgFnGAIgASgNEgkKAWIYAyABKA0ipQEKCVRoZW1lSW5mbxIMCgRuYW1lGAEgASgJEiMKCmJhY2tncm91bmQYAiABKAsyDy50ZXJtaW5hbC5Db2xvchIjCgpmb3JlZ3JvdW5kGAMgASgLMg8udGVybWluYWwuQ29sb3ISHwoGbm9ybWFsGAQgAygLMg8udGVybWluYWwuQ29sb3ISHwoGYnJpZ2h0GAUgAygLMg8udGVybWluYWwuQ29sb3Ii9gsKDVNlcnZlck1lc3NhZ2USIgoGb3V0cHV0GAEgASgLMhAudGVybWluYWwuT3V0cHV0SAASIgoGcmVzaXplGAIgASgLMhAudGVybWluYWwuUmVzaXplSAASIAoFdGl0bGUYAyABKAsyDy50ZXJtaW5hbC5UaXRsZUgAEigKCWNvbm5lY3RlZBgEIAEoCzITLnRlcm1pbmFsLkNvbm5lY3RlZEgAEiQKB3JlZnJlc2gYBSABKAsyES50ZXJtaW5hbC5SZWZyZXNoSAASKgoGY3Vyc29yGAYgASgLMhgudGVybWluYWwuQ3Vyc29yUG9zaXRpb25IABIeCgRiZWxsGAcgASgLMg4udGVybWluYWwuQmVsbEgAEiAKBWVycm9yGAggASgLMg8udGVybWluYWwuRXJyb3JIABImCghzaHV0ZG93bhgJIAEoCzISLnRlcm1pbmFsLlNodXRkb3duSAASHgoEcG9uZxgKIAEoCzIOLnRlcm1pbmFsLlBvbmdIABIrCgtjd2RfY2hhbmdlZBgLIAEoCzIULnRlcm1pbmFsLkN3ZENoYW5nZWRIABIzCg90cmlnZ2VyX21hdGNoZWQYDCABKAsyGC50ZXJtaW5hbC5UcmlnZ2VyTWF0Y2hlZEgAEi8KDWFjdGlvbl9ub3RpZnkYDSABKAsyFi50ZXJtaW5hbC5BY3Rpb25Ob3RpZnlIABI0ChBhY3Rpb25fbWFya19saW5lGA4gASgLMhgudGVybWluYWwuQWN0aW9uTWFya0xpbmVIABItCgxtb2RlX2NoYW5nZWQYDyABKAsyFS50ZXJtaW5hbC5Nb2RlQ2hhbmdlZEgAEjEKDmdyYXBoaWNzX2FkZGVkGBAgASgLMhcudGVybWluYWwuR3JhcGhpY3NBZGRlZEgAEjMKD2h5cGVybGlua19hZGRlZBgRIAEoCzIYLnRlcm1pbmFsLkh5cGVybGlua0FkZGVkSAASNAoQdXNlcl92YXJfY2hhbmdlZBgSIAEoCzIYLnRlcm1pbmFsLlVzZXJWYXJDaGFuZ2VkSAASPAoUcHJvZ3Jlc3NfYmFyX2NoYW5nZWQYEyABKAsyHC50ZXJtaW5hbC5Qcm9ncmVzc0JhckNoYW5nZWRIABIvCg1iYWRnZV9jaGFuZ2VkGBQgASgLMhYudGVybWluYWwuQmFkZ2VDaGFuZ2VkSAASNwoRc2VsZWN0aW9uX2NoYW5nZWQYFSABKAsyGi50ZXJtaW5hbC5TZWxlY3Rpb25DaGFuZ2VkSAASMQoOY2xpcGJvYXJkX3N5bmMYFiABKAsyFy50ZXJtaW5hbC5DbGlwYm9hcmRTeW5jSAASQgoXc2hlbGxfaW50ZWdyYXRpb25fZXZlbnQYFyABKAsyHy50ZXJtaW5hbC5TaGVsbEludGVncmF0aW9uRXZlbnRIABItCgxzeXN0ZW1fc3RhdHMYGCABKAsyFS50ZXJtaW5hbC5TeXN0ZW1TdGF0c0gAEisKC3pvbmVfb3BlbmVkGBkgASgLMhQudGVybWluYWwuWm9uZU9wZW5lZEgAEisKC3pvbmVfY2xvc2VkGBogASgLMhQudGVybWluYWwuWm9uZUNsb3NlZEgAEjYKEXpvbmVfc2Nyb2xsZWRfb3V0GBsgASgLMhkudGVybWluYWwuWm9uZVNjcm9sbGVkT3V0SAASOwoTZW52aXJvbm1lbnRfY2hhbmdlZBgcIAEoCzIcLnRlcm1pbmFsLkVudmlyb25tZW50Q2hhbmdlZEgAEkAKFnJlbW90ZV9ob3N0X3RyYW5zaXRpb24YHSABKAsyHi50ZXJtaW5hbC5SZW1vdGVIb3N0VHJhbnNpdGlvbkgAEjgKEnN1Yl9zaGVsbF9kZXRlY3RlZBgeIAEoCzIaLnRlcm1pbmFsLlN1YlNoZWxsRGV0ZWN0ZWRIABI7ChFzZW1hbnRpY19zbmFwc2hvdBgfIAEoCzIeLnRlcm1pbmFsLlNlbWFudGljU25hcHNob3REYXRhSABCCQoHbWVzc2FnZSI8CgZPdXRwdXQSDAoEZGF0YRgBIAEoDBIWCgl0aW1lc3RhbXAYAiABKARIAIgBAUIMCgpfdGltZXN0YW1wIiQKBlJlc2l6ZRIMCgRjb2xzGAEgASgNEgwKBHJvd3MYAiABKA0iFgoFVGl0bGUSDQoFdGl0bGUYASABKAkiigMKCUNvbm5lY3RlZBIMCgRjb2xzGAEgASgNEgwKBHJvd3MYAiABKA0SGwoOaW5pdGlhbF9zY3JlZW4YAyABKAxIAIgBARISCgpzZXNzaW9uX2lkGAQgASgJEicKBXRoZW1lGAUgASgLMhMudGVybWluYWwuVGhlbWVJbmZvSAGIAQESEgoFYmFkZ2UYBiABKAlIAogBARIdChBmYWludF90ZXh0X2FscGhhGAcgASgCSAOIAQESEAoDY3dkGAggASgJSASIAQESHgoRbW9kaWZ5X290aGVyX2tleXMYCSABKA1IBYgBARIWCgljbGllbnRfaWQYCiABKAlIBogBARIVCghyZWFkb25seRgLIAEoCEgHiAEBQhEKD19pbml0aWFsX3NjcmVlbkIICgZfdGhlbWVCCAoGX2JhZGdlQhMKEV9mYWludF90ZXh0X2FscGhhQgYKBF9jd2RCFAoSX21vZGlmeV9vdGhlcl9rZXlzQgwKCl9jbGllbnRfaWRCCwoJX3JlYWRvbmx5Ij0KB1JlZnJlc2gSDAoEY29scxgBIAEoDRIMCgRyb3dzGAIgASgNEhYKDnNjcmVlbl9jb250ZW50GAMgASgMIjsKDkN1cnNvclBvc2l0aW9uEgsKA2NvbBgBIAEoDRILCgNyb3cYAiABKA0SDwoHdmlzaWJsZRgDIAEoCCIGCgRCZWxsIq0BCgpDd2RDaGFuZ2VkEhQKB29sZF9jd2QYASABKAlIAIgBARIPCgduZXdfY3dkGAIgASgJEhUKCGhvc3RuYW1lGAMgASgJSAGIAQESFQoIdXNlcm5hbWUYBCABKAlIAogBARIWCgl0aW1lc3RhbXAYBSABKARIA4gBAUIKCghfb2xkX2N3ZEILCglfaG9zdG5hbWVCCwoJX3VzZXJuYW1lQgwKCl90aW1lc3RhbXAiggEKDlRyaWdnZXJNYXRjaGVkEhIKCnRyaWdnZXJfaWQYASABKAQSCwoDcm93GAIgASgNEgsKA2NvbBgDIAEoDRIPCgdlbmRfY29sGAQgASgNEgwKBHRleHQYBSABKAkSEAoIY2FwdHVyZXMYBiADKAkSEQoJdGltZXN0YW1wGAcgASgEIkIKDEFjdGlvbk5vdGlmeRISCgp0cmlnZ2VyX2lkGAEgASgEEg0KBXRpdGxlGAIgASgJEg8KB21lc3NhZ2UYAyABKAkifgoOQWN0aW9uTWFya0xpbmUSEgoKdHJpZ2dlcl9pZBgBIAEoBBILCgNyb3cYAiABKA0SEgoFbGFiZWwYAyABKAlIAIgBARIjCgVjb2xvchgEIAEoCzIPLnRlcm1pbmFsLkNvbG9ySAGIAQFCCAoGX2xhYmVsQggKBl9jb2xvciI0CgVFcnJvchIPCgdtZXNzYWdlGAEgASgJEhEKBGNvZGUYAiABKAlIAIgBAUIHCgVfY29kZSIaCghTaHV0ZG93bhIOCgZyZWFzb24YASABKAkiBgoEUG9uZyIsCgtNb2RlQ2hhbmdlZBIMCgRtb2RlGAEgASgJEg8KB2VuYWJsZWQYAiABKAgiPAoNR3JhcGhpY3NBZGRlZBILCgNyb3cYASABKA0SEwoGZm9ybWF0GAIgASgJSACIAQFCCQoHX2Zvcm1hdCJPCg5IeXBlcmxpbmtBZGRlZBILCgN1cmwYASABKAkSCwoDcm93GAIgASgNEgsKA2NvbBgDIAEoDRIPCgJpZBgEIAEoCUgAiAEBQgUKA19pZCJTCg5Vc2VyVmFyQ2hhbmdlZBIMCgRuYW1lGAEgASgJEg0KBXZhbHVlGAIgASgJEhYKCW9sZF92YWx1ZRgDIAEoCUgAiAEBQgwKCl9vbGRfdmFsdWUijgEKElByb2dyZXNzQmFyQ2hhbmdlZBIOCgZhY3Rpb24YASABKAkSCgoCaWQYAiABKAkSEgoFc3RhdGUYAyABKAlIAIgBARIUCgdwZXJjZW50GAQgASgNSAGIAQESEgoFbGFiZWwYBSABKAlIAogBAUIICgZfc3RhdGVCCgoIX3BlcmNlbnRCCAoGX2xhYmVsIiwKDEJhZGdlQ2hhbmdlZBISCgViYWRnZRgBIAEoCUgAiAEBQggKBl9iYWRnZSLdAQoQU2VsZWN0aW9uQ2hhbmdlZBIWCglzdGFydF9jb2wYASABKA1IAIgBARIWCglzdGFydF9yb3cYAiABKA1IAYgBARIUCgdlbmRfY29sGAMgASgNSAKIAQESFAoHZW5kX3JvdxgEIAEoDUgDiAEBEhEKBHRleHQYBSABKAlIBIgBARIMCgRtb2RlGAYgASgJEg8KB2NsZWFyZWQYByABKAhCDAoKX3N0YXJ0X2NvbEIMCgpfc3RhcnRfcm93QgoKCF9lbmRfY29sQgoKCF9lbmRfcm93QgcKBV90ZXh0IlMKDUNsaXBib2FyZFN5bmMSEQoJb3BlcmF0aW9uGAEgASgJEg8KB2NvbnRlbnQYAiABKAkSEwoGdGFyZ2V0GAMgASgJSACIAQFCCQoHX3RhcmdldCLDAQoVU2hlbGxJbnRlZ3JhdGlvbkV2ZW50EhIKCmV2ZW50X3R5cGUYASABKAkSFAoHY29tbWFuZBgCIAEoCUgAiAEBEhYKCWV4aXRfY29kZRgDIAEoBUgBiAEBEhYKCXRpbWVzdGFtcBgEIAEoBEgCiAEBEhgKC2N1cnNvcl9saW5lGAUgASgESAOIAQFCCgoIX2NvbW1hbmRCDAoKX2V4aXRfY29kZUIMCgpfdGltZXN0YW1wQg4KDF9jdXJzb3JfbGluZSKyAQoIQ3B1U3RhdHMSHQoVb3ZlcmFsbF91c2FnZV9wZXJjZW50GAEgASgBEhsKE3BoeXNpY2FsX2NvcmVfY291bnQYAiABKA0SHgoWcGVyX2NvcmVfdXNhZ2VfcGVyY2VudBgDIAMoARISCgVicmFuZBgEIAEoCUgAiAEBEhoKDWZyZXF1ZW5jeV9taHoYBSABKARIAYgBAUIICgZfYnJhbmRCEAoOX2ZyZXF1ZW5jeV9taHoiggEKC01lbW9yeVN0YXRzEhMKC3RvdGFsX2J5dGVzGAEgASgEEhIKCnVzZWRfYnl0ZXMYAiABKAQSFwoPYXZhaWxhYmxlX2J5dGVzGAMgASgEEhgKEHN3YXBfdG90YWxfYnl0ZXMYBCABKAQSFwoPc3dhcF91c2VkX2J5dGVzGAUgASgEIpUBCglEaXNrU3RhdHMSDAoEbmFtZRgBIAEoCRITCgttb3VudF9wb2ludBgCIAEoCRITCgt0b3RhbF9ieXRlcxgDIAEoBBIXCg9hdmFpbGFibGVfYnl0ZXMYBCABKAQSDAoEa2luZBgFIAEoCRITCgtmaWxlX3N5c3RlbRgGIAEoCRIUCgxpc19yZW1vdmFibGUYByABKAgigwIKFU5ldHdvcmtJbnRlcmZhY2VTdGF0cxIMCgRuYW1lGAEgASgJEhYKDnJlY2VpdmVkX2J5dGVzGAIgASgEEhkKEXRyYW5zbWl0dGVkX2J5dGVzGAMgASgEEhwKFHRvdGFsX3JlY2VpdmVkX2J5dGVzGAQgASgEEh8KF3RvdGFsX3RyYW5zbWl0dGVkX2J5dGVzGAUgASgEEhgKEHBhY2tldHNfcmVjZWl2ZWQYBiABKAQSGwoTcGFja2V0c190cmFuc21pdHRlZBgHIAEoBBIXCg9lcnJvcnNfcmVjZWl2ZWQYCCABKAQSGgoSZXJyb3JzX3RyYW5zbWl0dGVkGAkgASgEIlAKC0xvYWRBdmVyYWdlEhIKCm9uZV9taW51dGUYASABKAESFAoMZml2ZV9taW51dGVzGAIgASgBEhcKD2ZpZnRlZW5fbWludXRlcxgDIAEoASL6AwoLU3lzdGVtU3RhdHMSJAoDY3B1GAEgASgLMhIudGVybWluYWwuQ3B1U3RhdHNIAIgBARIqCgZtZW1vcnkYAiABKAsyFS50ZXJtaW5hbC5NZW1vcnlTdGF0c0gBiAEBEiIKBWRpc2tzGAMgAygLMhMudGVybWluYWwuRGlza1N0YXRzEjEKCG5ldHdvcmtzGAQgAygLMh8udGVybWluYWwuTmV0d29ya0ludGVyZmFjZVN0YXRzEjAKDGxvYWRfYXZlcmFnZRgFIAEoCzIVLnRlcm1pbmFsLkxvYWRBdmVyYWdlSAKIAQESFQoIaG9zdG5hbWUYBiABKAlIA4gBARIUCgdvc19uYW1lGAcgASgJSASIAQESFwoKb3NfdmVyc2lvbhgIIAEoCUgFiAEBEhsKDmtlcm5lbF92ZXJzaW9uGAkgASgJSAaIAQESGAoLdXB0aW1lX3NlY3MYCiABKARIB4gBARIWCgl0aW1lc3RhbXAYCyABKARICIgBAUIGCgRfY3B1QgkKB19tZW1vcnlCDwoNX2xvYWRfYXZlcmFnZUILCglfaG9zdG5hbWVCCgoIX29zX25hbWVCDQoLX29zX3ZlcnNpb25CEQoPX2tlcm5lbF92ZXJzaW9uQg4KDF91cHRpbWVfc2Vjc0IMCgpfdGltZXN0YW1wIkcKClpvbmVPcGVuZWQSDwoHem9uZV9pZBgBIAEoBBIRCgl6b25lX3R5cGUYAiABKAkSFQoNYWJzX3Jvd19zdGFydBgDIAEoBCKCAQoKWm9uZUNsb3NlZBIPCgd6b25lX2lkGAEgASgEEhEKCXpvbmVfdHlwZRgCIAEoCRIVCg1hYnNfcm93X3N0YXJ0GAMgASgEEhMKC2Fic19yb3dfZW5kGAQgASgEEhYKCWV4aXRfY29kZRgFIAEoBUgAiAEBQgwKCl9leGl0X2NvZGUiNQoPWm9uZVNjcm9sbGVkT3V0Eg8KB3pvbmVfaWQYASABKAQSEQoJem9uZV90eXBlGAIgASgJIlYKEkVudmlyb25tZW50Q2hhbmdlZBILCgNrZXkYASABKAkSDQoFdmFsdWUYAiABKAkSFgoJb2xkX3ZhbHVlGAMgASgJSACIAQFCDAoKX29sZF92YWx1ZSKkAQoUUmVtb3RlSG9zdFRyYW5zaXRpb24SEAoIaG9zdG5hbWUYASABKAkSFQoIdXNlcm5hbWUYAiABKAlIAIgBARIZCgxvbGRfaG9zdG5hbWUYAyABKAlIAYgBARIZCgxvbGRfdXNlcm5hbWUYBCABKAlIAogBAUILCglfdXNlcm5hbWVCDwoNX29sZF9ob3N0bmFtZUIPCg1fb2xkX3VzZXJuYW1lIkkKEFN1YlNoZWxsRGV0ZWN0ZWQSDQoFZGVwdGgYASABKAQSFwoKc2hlbGxfdHlwZRgCIAEoCUgAiAEBQg0KC19zaGVsbF90eXBlIi0KFFNlbWFudGljU25hcHNob3REYXRhEhUKDXNuYXBzaG90X2pzb24YASABKAkiTAoPU25hcHNob3RSZXF1ZXN0Eg0KBXNjb3BlGAEgASgJEhkKDG1heF9jb21tYW5kcxgCIAEoDUgAiAEBQg8KDV9tYXhfY29tbWFuZHMi7AMKDUNsaWVudE1lc3NhZ2USIAoFaW5wdXQYASABKAsyDy50ZXJtaW5hbC5JbnB1dEgAEigKBnJlc2l6ZRgCIAEoCzIWLnRlcm1pbmFsLkNsaWVudFJlc2l6ZUgAEh4KBHBpbmcYAyABKAsyDi50ZXJtaW5hbC5QaW5nSAASKwoHcmVmcmVzaBgEIAEoCzIYLnRlcm1pbmFsLlJlcXVlc3RSZWZyZXNoSAASKAoJc3Vic2NyaWJlGAUgASgLMhMudGVybWluYWwuU3Vic2NyaWJlSAASJQoFbW91c2UYBiABKAsyFC50ZXJtaW5hbC5Nb3VzZUlucHV0SAASJgoFZm9jdXMYByABKAsyFS50ZXJtaW5hbC5Gb2N1c0NoYW5nZUgAEiUKBXBhc3RlGAggASgLMhQudGVybWluYWwuUGFzdGVJbnB1dEgAEi8KCXNlbGVjdGlvbhgJIAEoCzIaLnRlcm1pbmFsLlNlbGVjdGlvblJlcXVlc3RIABIvCgljbGlwYm9hcmQYCiABKAsyGi50ZXJtaW5hbC5DbGlwYm9hcmRSZXF1ZXN0SAASNQoQc25hcHNob3RfcmVxdWVzdBgLIAEoCzIZLnRlcm1pbmFsLlNuYXBzaG90UmVxdWVzdEgAQgkKB21lc3NhZ2UiFQoFSW5wdXQSDAoEZGF0YRgBIAEoDCIqCgxDbGllbnRSZXNpemUSDAoEY29scxgBIAEoDRIMCgRyb3dzGAIgASgNIgYKBFBpbmciEAoOUmVxdWVzdFJlZnJlc2giMAoJU3Vic2NyaWJlEiMKBmV2ZW50cxgBIAMoDjITLnRlcm1pbmFsLkV2ZW50VHlwZSJ0CgpNb3VzZUlucHV0EgsKA2NvbBgBIAEoDRILCgNyb3cYAiABKA0SDgoGYnV0dG9uGAMgASgNEg0KBXNoaWZ0GAQgASgIEgwKBGN0cmwYBSABKAgSCwoDYWx0GAYgASgIEhIKCmV2ZW50X3R5cGUYByABKAkiHgoLRm9jdXNDaGFuZ2USDwoHZm9jdXNlZBgBIAEoCCIdCgpQYXN0ZUlucHV0Eg8KB2NvbnRlbnQYASABKAkiaAoQU2VsZWN0aW9uUmVxdWVzdBIRCglzdGFydF9jb2wYASABKA0SEQoJc3RhcnRfcm93GAIgASgNEg8KB2VuZF9jb2wYAyABKA0SDwoHZW5kX3JvdxgEIAEoDRIMCgRtb2RlGAUgASgJImcKEENsaXBib2FyZFJlcXVlc3QSEQoJb3BlcmF0aW9uGAEgASgJEhQKB2NvbnRlbnQYAiABKAlIAIgBARITCgZ0YXJnZXQYAyABKAlIAYgBAUIKCghfY29udGVudEIJCgdfdGFyZ2V0KtUECglFdmVudFR5cGUSGgoWRVZFTlRfVFlQRV9VTlNQRUNJRklFRBAAEhUKEUVWRU5UX1RZUEVfT1VUUFVUEAESFQoRRVZFTlRfVFlQRV9DVVJTT1IQAhITCg9FVkVOVF9UWVBFX0JFTEwQAxIUChBFVkVOVF9UWVBFX1RJVExFEAQSFQoRRVZFTlRfVFlQRV9SRVNJWkUQBRISCg5FVkVOVF9UWVBFX0NXRBAGEhYKEkVWRU5UX1RZUEVfVFJJR0dFUhAHEhUKEUVWRU5UX1RZUEVfQUNUSU9OEAgSEwoPRVZFTlRfVFlQRV9NT0RFEAkSFwoTRVZFTlRfVFlQRV9HUkFQSElDUxAKEhgKFEVWRU5UX1RZUEVfSFlQRVJMSU5LEAsSFwoTRVZFTlRfVFlQRV9VU0VSX1ZBUhAMEhsKF0VWRU5UX1RZUEVfUFJPR1JFU1NfQkFSEA0SFAoQRVZFTlRfVFlQRV9CQURHRRAOEhgKFEVWRU5UX1RZUEVfU0VMRUNUSU9OEA8SGAoURVZFTlRfVFlQRV9DTElQQk9BUkQQEBIUChBFVkVOVF9UWVBFX1NIRUxMEBESGwoXRVZFTlRfVFlQRV9TWVNURU1fU1RBVFMQEhITCg9FVkVOVF9UWVBFX1pPTkUQExIaChZFVkVOVF9UWVBFX0VOVklST05NRU5UEBQSGgoWRVZFTlRfVFlQRV9SRU1PVEVfSE9TVBAVEhgKFEVWRU5UX1RZUEVfU1VCX1NIRUxMEBYSFwoTRVZFTlRfVFlQRV9TTkFQU0hPVBAXYgZwcm90bzM"))).messageType.forEach(cG),A.dependency=[],cY(A,e=>void 0).getFile(A.name)),dt=c8(de,2),di=c8(de,40),ds=c8(de,41),dr=c8(de,42),dn=c8(de,43),da=c8(de,44),dl=c8(de,46),dh=c8(de,47),dc=c8(de,48);function dd(e){let i=e.length;for(;--i>=0;)e[i]=0}(q={})[q.UNSPECIFIED=0]="UNSPECIFIED",q[q.OUTPUT=1]="OUTPUT",q[q.CURSOR=2]="CURSOR",q[q.BELL=3]="BELL",q[q.TITLE=4]="TITLE",q[q.RESIZE=5]="RESIZE",q[q.CWD=6]="CWD",q[q.TRIGGER=7]="TRIGGER",q[q.ACTION=8]="ACTION",q[q.MODE=9]="MODE",q[q.GRAPHICS=10]="GRAPHICS",q[q.HYPERLINK=11]="HYPERLINK",q[q.USER_VAR=12]="USER_VAR",q[q.PROGRESS_BAR=13]="PROGRESS_BAR",q[q.BADGE=14]="BADGE",q[q.SELECTION=15]="SELECTION",q[q.CLIPBOARD=16]="CLIPBOARD",q[q.SHELL=17]="SHELL",q[q.SYSTEM_STATS=18]="SYSTEM_STATS",q[q.ZONE=19]="ZONE",q[q.ENVIRONMENT=20]="ENVIRONMENT",q[q.REMOTE_HOST=21]="REMOTE_HOST",q[q.SUB_SHELL=22]="SUB_SHELL",q[q.SNAPSHOT=23]="SNAPSHOT";let du=573,d_=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),df=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),dg=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),dp=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),dm=Array(576);dd(dm);let dv=Array(60);dd(dv);let db=Array(512);dd(db);let dS=Array(256);dd(dS);let dw=Array(29);dd(dw);let dy=Array(30);function dC(e,i,s,r,n){this.static_tree=e,this.extra_bits=i,this.extra_base=s,this.elems=r,this.max_length=n,this.has_stree=e&&e.length}function dx(e,i){this.dyn_tree=e,this.max_code=0,this.stat_desc=i}dd(dy);let dE=e=>e<256?db[e]:db[256+(e>>>7)],dk=(e,i)=>{e.pending_buf[e.pending++]=255&i,e.pending_buf[e.pending++]=i>>>8&255},dA=(e,i,s)=>{e.bi_valid>16-s?(e.bi_buf|=i<<e.bi_valid&65535,dk(e,e.bi_buf),e.bi_buf=i>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=i<<e.bi_valid&65535,e.bi_valid+=s)},dR=(e,i,s)=>{dA(e,s[2*i],s[2*i+1])},dL=(e,i)=>{let s=0;do s|=1&e,e>>>=1,s<<=1;while(--i>0)return s>>>1},dT=(e,i,s)=>{let r,n,o=Array(16),a=0;for(r=1;r<=15;r++)a=a+s[r-1]<<1,o[r]=a;for(n=0;n<=i;n++){let i=e[2*n+1];0!==i&&(e[2*n]=dL(o[i]++,i))}},dB=e=>{let i;for(i=0;i<286;i++)e.dyn_ltree[2*i]=0;for(i=0;i<30;i++)e.dyn_dtree[2*i]=0;for(i=0;i<19;i++)e.bl_tree[2*i]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},dM=e=>{e.bi_valid>8?dk(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},dI=(e,i,s,r)=>{let n=2*i,o=2*s;return e[n]<e[o]||e[n]===e[o]&&r[i]<=r[s]},dD=(e,i,s)=>{let r=e.heap[s],n=s<<1;for(;n<=e.heap_len&&(n<e.heap_len&&dI(i,e.heap[n+1],e.heap[n],e.depth)&&n++,!dI(i,r,e.heap[n],e.depth));)e.heap[s]=e.heap[n],s=n,n<<=1;e.heap[s]=r},dN=(e,i,s)=>{let r,n,o,a,l=0;if(0!==e.sym_next)do r=(255&e.pending_buf[e.sym_buf+l++])+((255&e.pending_buf[e.sym_buf+l++])<<8),n=e.pending_buf[e.sym_buf+l++],0===r?dR(e,n,i):(dR(e,(o=dS[n])+256+1,i),0!==(a=d_[o])&&dA(e,n-=dw[o],a),dR(e,o=dE(--r),s),0!==(a=df[o])&&dA(e,r-=dy[o],a));while(l<e.sym_next)dR(e,256,i)},dO=(e,i)=>{let s,r,n,o=i.dyn_tree,a=i.stat_desc.static_tree,l=i.stat_desc.has_stree,h=i.stat_desc.elems,c=-1;for(s=0,e.heap_len=0,e.heap_max=du;s<h;s++)0!==o[2*s]?(e.heap[++e.heap_len]=c=s,e.depth[s]=0):o[2*s+1]=0;for(;e.heap_len<2;)o[2*(n=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[n]=0,e.opt_len--,l&&(e.static_len-=a[2*n+1]);for(i.max_code=c,s=e.heap_len>>1;s>=1;s--)dD(e,o,s);n=h;do s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],dD(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=r,o[2*n]=o[2*s]+o[2*r],e.depth[n]=(e.depth[s]>=e.depth[r]?e.depth[s]:e.depth[r])+1,o[2*s+1]=o[2*r+1]=n,e.heap[1]=n++,dD(e,o,1);while(e.heap_len>=2)e.heap[--e.heap_max]=e.heap[1],((e,i)=>{let s,r,n,o,a,l,h=i.dyn_tree,c=i.max_code,d=i.stat_desc.static_tree,u=i.stat_desc.has_stree,_=i.stat_desc.extra_bits,f=i.stat_desc.extra_base,g=i.stat_desc.max_length,p=0;for(o=0;o<=15;o++)e.bl_count[o]=0;for(h[2*e.heap[e.heap_max]+1]=0,s=e.heap_max+1;s<du;s++)(o=h[2*h[2*(r=e.heap[s])+1]+1]+1)>g&&(o=g,p++),h[2*r+1]=o,!(r>c)&&(e.bl_count[o]++,a=0,r>=f&&(a=_[r-f]),l=h[2*r],e.opt_len+=l*(o+a),u&&(e.static_len+=l*(d[2*r+1]+a)));if(0!==p){do{for(o=g-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[g]--,p-=2}while(p>0)for(o=g;0!==o;o--)for(r=e.bl_count[o];0!==r;)!((n=e.heap[--s])>c)&&(h[2*n+1]!==o&&(e.opt_len+=(o-h[2*n+1])*h[2*n],h[2*n+1]=o),r--)}})(e,i),dT(o,c,e.bl_count)},dP=(e,i,s)=>{let r,n,o=-1,a=i[1],l=0,h=7,c=4;for(0===a&&(h=138,c=3),i[(s+1)*2+1]=65535,r=0;r<=s;r++)n=a,a=i[(r+1)*2+1],++l<h&&n===a||(l<c?e.bl_tree[2*n]+=l:0!==n?(n!==o&&e.bl_tree[2*n]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,o=n,0===a?(h=138,c=3):n===a?(h=6,c=3):(h=7,c=4))},dF=(e,i,s)=>{let r,n,o=-1,a=i[1],l=0,h=7,c=4;for(0===a&&(h=138,c=3),r=0;r<=s;r++)if(n=a,a=i[(r+1)*2+1],!(++l<h)||n!==a){if(l<c)do dR(e,n,e.bl_tree);while(0!=--l)else 0!==n?(n!==o&&(dR(e,n,e.bl_tree),l--),dR(e,16,e.bl_tree),dA(e,l-3,2)):l<=10?(dR(e,17,e.bl_tree),dA(e,l-3,3)):(dR(e,18,e.bl_tree),dA(e,l-11,7));l=0,o=n,0===a?(h=138,c=3):n===a?(h=6,c=3):(h=7,c=4)}},dW=!1,dz=(e,i,s,r)=>{dA(e,0+ +!!r,3),dM(e),dk(e,s),dk(e,~s),s&&e.pending_buf.set(e.window.subarray(i,i+s),e.pending),e.pending+=s};var dU={_tr_init:e=>{dW||((()=>{let e,i,s,a,l,h=Array(16);for(a=0,s=0;a<28;a++)for(e=0,dw[a]=s;e<1<<d_[a];e++)dS[s++]=a;for(dS[s-1]=a,l=0,a=0;a<16;a++)for(e=0,dy[a]=l;e<1<<df[a];e++)db[l++]=a;for(l>>=7;a<30;a++)for(e=0,dy[a]=l<<7;e<1<<df[a]-7;e++)db[256+l++]=a;for(i=0;i<=15;i++)h[i]=0;for(e=0;e<=143;)dm[2*e+1]=8,e++,h[8]++;for(;e<=255;)dm[2*e+1]=9,e++,h[9]++;for(;e<=279;)dm[2*e+1]=7,e++,h[7]++;for(;e<=287;)dm[2*e+1]=8,e++,h[8]++;for(dT(dm,287,h),e=0;e<30;e++)dv[2*e+1]=5,dv[2*e]=dL(e,5);r=new dC(dm,d_,257,286,15),n=new dC(dv,df,0,30,15),o=new dC([],dg,0,19,7)})(),dW=!0),e.l_desc=new dx(e.dyn_ltree,r),e.d_desc=new dx(e.dyn_dtree,n),e.bl_desc=new dx(e.bl_tree,o),e.bi_buf=0,e.bi_valid=0,dB(e)},_tr_stored_block:dz,_tr_flush_block:(e,i,s,r)=>{let n,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let i,s=0xf3ffc07f;for(i=0;i<=31;i++,s>>>=1)if(1&s&&0!==e.dyn_ltree[2*i])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(i=32;i<256;i++)if(0!==e.dyn_ltree[2*i])return 1;return 0})(e)),dO(e,e.l_desc),dO(e,e.d_desc),a=(e=>{let i;for(dP(e,e.dyn_ltree,e.l_desc.max_code),dP(e,e.dyn_dtree,e.d_desc.max_code),dO(e,e.bl_desc),i=18;i>=3&&0===e.bl_tree[2*dp[i]+1];i--);return e.opt_len+=3*(i+1)+5+5+4,i})(e),n=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=n&&(n=o)):n=o=s+5,s+4<=n&&-1!==i?dz(e,i,s,r):4===e.strategy||o===n?(dA(e,2+ +!!r,3),dN(e,dm,dv)):(dA(e,4+ +!!r,3),((e,i,s,r)=>{let n;for(dA(e,i-257,5),dA(e,s-1,5),dA(e,r-4,4),n=0;n<r;n++)dA(e,e.bl_tree[2*dp[n]+1],3);dF(e,e.dyn_ltree,i-1),dF(e,e.dyn_dtree,s-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),dN(e,e.dyn_ltree,e.dyn_dtree)),dB(e),r&&dM(e)},_tr_tally:(e,i,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=i,e.pending_buf[e.sym_buf+e.sym_next++]=i>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,0===i?e.dyn_ltree[2*s]++:(e.matches++,i--,e.dyn_ltree[(dS[s]+256+1)*2]++,e.dyn_dtree[2*dE(i)]++),e.sym_next===e.sym_end),_tr_align:e=>{dA(e,2,3),dR(e,256,dm),16===e.bi_valid?(dk(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}},d$=(e,i,s,r)=>{let n=65535&e,o=e>>>16&65535,a=0;for(;0!==s;){a=s>2e3?2e3:s,s-=a;do o=o+(n=n+i[r++]|0)|0;while(--a)n%=65521,o%=65521}return n|o<<16};let dV=new Uint32Array((()=>{let e,i=[];for(var s=0;s<256;s++){e=s;for(var r=0;r<8;r++)e=1&e?0xedb88320^e>>>1:e>>>1;i[s]=e}return i})());var dH=(e,i,s,r)=>{let n=r+s;e^=-1;for(let s=r;s<n;s++)e=e>>>8^dV[(e^i[s])&255];return -1^e},dK={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},dG={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:dY,_tr_stored_block:dX,_tr_flush_block:dZ,_tr_tally:dj,_tr_align:dq}=dU,{Z_NO_FLUSH:dQ,Z_PARTIAL_FLUSH:dJ,Z_FULL_FLUSH:d0,Z_FINISH:d1,Z_BLOCK:d2,Z_OK:d5,Z_STREAM_END:d3,Z_STREAM_ERROR:d6,Z_DATA_ERROR:d4,Z_BUF_ERROR:d9,Z_DEFAULT_COMPRESSION:d8,Z_FILTERED:d7,Z_HUFFMAN_ONLY:ue,Z_RLE:ut,Z_FIXED:ui,Z_DEFAULT_STRATEGY:us,Z_UNKNOWN:ur,Z_DEFLATED:un}=dG,uo=573,ua=(e,i)=>(e.msg=dK[i],i),ul=e=>2*e-9*(e>4),uh=e=>{let i=e.length;for(;--i>=0;)e[i]=0},uc=e=>{let i,s,r,n=e.w_size;r=i=e.hash_size;do s=e.head[--r],e.head[r]=s>=n?s-n:0;while(--i)r=i=n;do s=e.prev[--r],e.prev[r]=s>=n?s-n:0;while(--i)},ud=(e,i,s)=>(i<<e.hash_shift^s)&e.hash_mask,uu=e=>{let i=e.state,s=i.pending;s>e.avail_out&&(s=e.avail_out),0!==s&&(e.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+s),e.next_out),e.next_out+=s,i.pending_out+=s,e.total_out+=s,e.avail_out-=s,i.pending-=s,0===i.pending&&(i.pending_out=0))},u_=(e,i)=>{dZ(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,i),e.block_start=e.strstart,uu(e.strm)},uf=(e,i)=>{e.pending_buf[e.pending++]=i},ug=(e,i)=>{e.pending_buf[e.pending++]=i>>>8&255,e.pending_buf[e.pending++]=255&i},up=(e,i,s,r)=>{let n=e.avail_in;return(n>r&&(n=r),0===n)?0:(e.avail_in-=n,i.set(e.input.subarray(e.next_in,e.next_in+n),s),1===e.state.wrap?e.adler=d$(e.adler,i,n,s):2===e.state.wrap&&(e.adler=dH(e.adler,i,n,s)),e.next_in+=n,e.total_in+=n,n)},um=(e,i)=>{let s,r,n=e.max_chain_length,o=e.strstart,a=e.prev_length,l=e.nice_match,h=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,c=e.window,d=e.w_mask,u=e.prev,_=e.strstart+258,f=c[o+a-1],g=c[o+a];e.prev_length>=e.good_match&&(n>>=2),l>e.lookahead&&(l=e.lookahead);do{if(c[(s=i)+a]!==g||c[s+a-1]!==f||c[s]!==c[o]||c[++s]!==c[o+1])continue;o+=2,s++;do;while(c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&o<_)if(r=258-(_-o),o=_-258,r>a){if(e.match_start=i,a=r,r>=l)break;f=c[o+a-1],g=c[o+a]}}while((i=u[i&d])>h&&0!=--n)return a<=e.lookahead?a:e.lookahead},uv=e=>{let i,s,r,n=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=n+(n-262)&&(e.window.set(e.window.subarray(n,n+n-s),0),e.match_start-=n,e.strstart-=n,e.block_start-=n,e.insert>e.strstart&&(e.insert=e.strstart),uc(e),s+=n),0===e.strm.avail_in)break;if(i=up(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=i,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=ud(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=ud(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)},ub=(e,i)=>{let s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,r,n,o,a=0,l=e.strm.avail_in;do{if(r=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,r>(n=e.strstart-e.block_start)+e.strm.avail_in&&(r=n+e.strm.avail_in),r>o&&(r=o),r<s&&(0===r&&i!==d1||i===dQ||r!==n+e.strm.avail_in)))break;a=+(i===d1&&r===n+e.strm.avail_in),dX(e,0,0,a),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,uu(e.strm),n&&(n>r&&(n=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,r-=n),r&&(up(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(0===a)return((l-=e.strm.avail_in)&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a)?4:i!==dQ&&i!==d1&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(up(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,s=(o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o)>e.w_size?e.w_size:o,((n=e.strstart-e.block_start)>=s||(n||i===d1)&&i!==dQ&&0===e.strm.avail_in&&n<=o)&&(r=n>o?o:n,a=+(i===d1&&0===e.strm.avail_in&&r===n),dX(e,e.block_start,r,a),e.block_start+=r,uu(e.strm)),a?3:1)},uS=(e,i)=>{let s,r;for(;;){if(e.lookahead<262){if(uv(e),e.lookahead<262&&i===dQ)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=ud(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==s&&e.strstart-s<=e.w_size-262&&(e.match_length=um(e,s)),e.match_length>=3)if(r=dj(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=ud(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!=--e.match_length)e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ud(e,e.ins_h,e.window[e.strstart+1]);else r=dj(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(u_(e,!1),0===e.strm.avail_out))return 1}return(e.insert=e.strstart<2?e.strstart:2,i===d1)?(u_(e,!0),0===e.strm.avail_out)?3:4:e.sym_next&&(u_(e,!1),0===e.strm.avail_out)?1:2},uw=(e,i)=>{let s,r,n;for(;;){if(e.lookahead<262){if(uv(e),e.lookahead<262&&i===dQ)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=ud(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==s&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-262&&(e.match_length=um(e,s),e.match_length<=5&&(e.strategy===d7||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,r=dj(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=n&&(e.ins_h=ud(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!=--e.prev_length)if(e.match_available=0,e.match_length=2,e.strstart++,r&&(u_(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=dj(e,0,e.window[e.strstart-1]))&&u_(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return(e.match_available&&(r=dj(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,i===d1)?(u_(e,!0),0===e.strm.avail_out)?3:4:e.sym_next&&(u_(e,!1),0===e.strm.avail_out)?1:2};function uy(e,i,s,r,n){this.good_length=e,this.max_lazy=i,this.nice_length=s,this.max_chain=r,this.func=n}let uC=[new uy(0,0,0,0,ub),new uy(4,4,8,4,uS),new uy(4,5,16,8,uS),new uy(4,6,32,32,uS),new uy(4,4,16,16,uw),new uy(8,16,32,32,uw),new uy(8,16,128,128,uw),new uy(8,32,128,256,uw),new uy(32,128,258,1024,uw),new uy(32,258,258,4096,uw)];function ux(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=un,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*uo),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),uh(this.dyn_ltree),uh(this.dyn_dtree),uh(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),uh(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),uh(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let uE=e=>{if(!e)return 1;let i=e.state;return i&&i.strm===e&&(42===i.status||57===i.status||69===i.status||73===i.status||91===i.status||103===i.status||113===i.status||666===i.status)?0:1};var uk=(e,i)=>{if(uE(e)||i>d2||i<0)return e?ua(e,d6):d6;let s=e.state;if(!e.output||0!==e.avail_in&&!e.input||666===s.status&&i!==d1)return ua(e,0===e.avail_out?d9:d6);let r=s.last_flush;if(s.last_flush=i,0!==s.pending){if(uu(e),0===e.avail_out)return s.last_flush=-1,d5}else if(0===e.avail_in&&ul(i)<=ul(r)&&i!==d1)return ua(e,d9);if(666===s.status&&0!==e.avail_in)return ua(e,d9);if(42===s.status&&0===s.wrap&&(s.status=113),42===s.status){let i=un+(s.w_bits-8<<4)<<8;if(i|=(s.strategy>=ue||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(i|=32),ug(s,i+=31-i%31),0!==s.strstart&&(ug(s,e.adler>>>16),ug(s,65535&e.adler)),e.adler=1,s.status=113,uu(e),0!==s.pending)return s.last_flush=-1,d5}if(57===s.status){if(e.adler=0,uf(s,31),uf(s,139),uf(s,8),s.gzhead)uf(s,+!!s.gzhead.text+2*!!s.gzhead.hcrc+4*!!s.gzhead.extra+8*!!s.gzhead.name+16*!!s.gzhead.comment),uf(s,255&s.gzhead.time),uf(s,s.gzhead.time>>8&255),uf(s,s.gzhead.time>>16&255),uf(s,s.gzhead.time>>24&255),uf(s,9===s.level?2:4*(s.strategy>=ue||s.level<2)),uf(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(uf(s,255&s.gzhead.extra.length),uf(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=dH(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(uf(s,0),uf(s,0),uf(s,0),uf(s,0),uf(s,0),uf(s,9===s.level?2:4*(s.strategy>=ue||s.level<2)),uf(s,3),s.status=113,uu(e),0!==s.pending)return s.last_flush=-1,d5}if(69===s.status){if(s.gzhead.extra){let i=s.pending,r=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+r>s.pending_buf_size;){let n=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+n),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>i&&(e.adler=dH(e.adler,s.pending_buf,s.pending-i,i)),s.gzindex+=n,uu(e),0!==s.pending)return s.last_flush=-1,d5;i=0,r-=n}let n=new Uint8Array(s.gzhead.extra);s.pending_buf.set(n.subarray(s.gzindex,s.gzindex+r),s.pending),s.pending+=r,s.gzhead.hcrc&&s.pending>i&&(e.adler=dH(e.adler,s.pending_buf,s.pending-i,i)),s.gzindex=0}s.status=73}if(73===s.status){if(s.gzhead.name){let i,r=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>r&&(e.adler=dH(e.adler,s.pending_buf,s.pending-r,r)),uu(e),0!==s.pending)return s.last_flush=-1,d5;r=0}i=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,uf(s,i)}while(0!==i)s.gzhead.hcrc&&s.pending>r&&(e.adler=dH(e.adler,s.pending_buf,s.pending-r,r)),s.gzindex=0}s.status=91}if(91===s.status){if(s.gzhead.comment){let i,r=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>r&&(e.adler=dH(e.adler,s.pending_buf,s.pending-r,r)),uu(e),0!==s.pending)return s.last_flush=-1,d5;r=0}i=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,uf(s,i)}while(0!==i)s.gzhead.hcrc&&s.pending>r&&(e.adler=dH(e.adler,s.pending_buf,s.pending-r,r))}s.status=103}if(103===s.status){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(uu(e),0!==s.pending))return s.last_flush=-1,d5;uf(s,255&e.adler),uf(s,e.adler>>8&255),e.adler=0}if(s.status=113,uu(e),0!==s.pending)return s.last_flush=-1,d5}if(0!==e.avail_in||0!==s.lookahead||i!==dQ&&666!==s.status){let r=0===s.level?ub(s,i):s.strategy===ue?((e,i)=>{let s;for(;;){if(0===e.lookahead&&(uv(e),0===e.lookahead)){if(i===dQ)return 1;break}if(e.match_length=0,s=dj(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,s&&(u_(e,!1),0===e.strm.avail_out))return 1}return(e.insert=0,i===d1)?(u_(e,!0),0===e.strm.avail_out)?3:4:e.sym_next&&(u_(e,!1),0===e.strm.avail_out)?1:2})(s,i):s.strategy===ut?((e,i)=>{let s,r,n,o,a=e.window;for(;;){if(e.lookahead<=258){if(uv(e),e.lookahead<=258&&i===dQ)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=a[n=e.strstart-1])===a[++n]&&r===a[++n]&&r===a[++n]){o=e.strstart+258;do;while(r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&r===a[++n]&&n<o)e.match_length=258-(o-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(s=dj(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(s=dj(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),s&&(u_(e,!1),0===e.strm.avail_out))return 1}return(e.insert=0,i===d1)?(u_(e,!0),0===e.strm.avail_out)?3:4:e.sym_next&&(u_(e,!1),0===e.strm.avail_out)?1:2})(s,i):uC[s.level].func(s,i);if((3===r||4===r)&&(s.status=666),1===r||3===r)return 0===e.avail_out&&(s.last_flush=-1),d5;if(2===r&&(i===dJ?dq(s):i!==d2&&(dX(s,0,0,!1),i===d0&&(uh(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),uu(e),0===e.avail_out))return s.last_flush=-1,d5}return i!==d1?d5:s.wrap<=0?d3:(2===s.wrap?(uf(s,255&e.adler),uf(s,e.adler>>8&255),uf(s,e.adler>>16&255),uf(s,e.adler>>24&255),uf(s,255&e.total_in),uf(s,e.total_in>>8&255),uf(s,e.total_in>>16&255),uf(s,e.total_in>>24&255)):(ug(s,e.adler>>>16),ug(s,65535&e.adler)),uu(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?d5:d3)},uA=e=>{if(uE(e))return d6;let i=e.state.status;return e.state=null,113===i?ua(e,d4):d5};let uR=(e,i)=>Object.prototype.hasOwnProperty.call(e,i);var uL=function(e){let i=Array.prototype.slice.call(arguments,1);for(;i.length;){let s=i.shift();if(s){if("object"!=typeof s)throw TypeError(s+"must be non-object");for(let i in s)uR(s,i)&&(e[i]=s[i])}}return e},uT=e=>{let i=0;for(let s=0,r=e.length;s<r;s++)i+=e[s].length;let s=new Uint8Array(i);for(let i=0,r=0,n=e.length;i<n;i++){let n=e[i];s.set(n,r),r+=n.length}return s};let uB=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){uB=!1}let uM=new Uint8Array(256);for(let e=0;e<256;e++)uM[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;uM[254]=uM[254]=1;var uI=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let i,s,r,n,o,a=e.length,l=0;for(n=0;n<a;n++)(64512&(s=e.charCodeAt(n)))==55296&&n+1<a&&(64512&(r=e.charCodeAt(n+1)))==56320&&(s=65536+(s-55296<<10)+(r-56320),n++),l+=s<128?1:s<2048?2:s<65536?3:4;for(o=0,i=new Uint8Array(l),n=0;o<l;n++)(64512&(s=e.charCodeAt(n)))==55296&&n+1<a&&(64512&(r=e.charCodeAt(n+1)))==56320&&(s=65536+(s-55296<<10)+(r-56320),n++),s<128?i[o++]=s:(s<2048?i[o++]=192|s>>>6:(s<65536?i[o++]=224|s>>>12:(i[o++]=240|s>>>18,i[o++]=128|s>>>12&63),i[o++]=128|s>>>6&63),i[o++]=128|63&s);return i},uD=(e,i)=>{let s,r,n=i||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,i));let o=Array(2*n);for(r=0,s=0;s<n;){let i=e[s++];if(i<128){o[r++]=i;continue}let a=uM[i];if(a>4){o[r++]=65533,s+=a-1;continue}for(i&=2===a?31:3===a?15:7;a>1&&s<n;)i=i<<6|63&e[s++],a--;if(a>1){o[r++]=65533;continue}i<65536?o[r++]=i:(i-=65536,o[r++]=55296|i>>10&1023,o[r++]=56320|1023&i)}var a=r;if(a<65534&&o.subarray&&uB)return String.fromCharCode.apply(null,o.length===a?o:o.subarray(0,a));let l="";for(let e=0;e<a;e++)l+=String.fromCharCode(o[e]);return l},uN=(e,i)=>{(i=i||e.length)>e.length&&(i=e.length);let s=i-1;for(;s>=0&&(192&e[s])==128;)s--;return s<0||0===s?i:s+uM[e[s]]>i?s:i},uO=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let uP=Object.prototype.toString,{Z_NO_FLUSH:uF,Z_SYNC_FLUSH:uW,Z_FULL_FLUSH:uz,Z_FINISH:uU,Z_OK:u$,Z_STREAM_END:uV,Z_DEFAULT_COMPRESSION:uH,Z_DEFAULT_STRATEGY:uK,Z_DEFLATED:uG}=dG;function uY(e){let i,s;this.options=uL({level:uH,method:uG,chunkSize:16384,windowBits:15,memLevel:8,strategy:uK},e||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new uO,this.strm.avail_out=0;let n=((e,i,s,r,n,o)=>{var a,l;let h;if(!e)return d6;let c=1;if(i===d8&&(i=6),r<0?(c=0,r=-r):r>15&&(c=2,r-=16),n<1||n>9||s!==un||r<8||r>15||i<0||i>9||o<0||o>ui||8===r&&1!==c)return ua(e,d6);8===r&&(r=9);let d=new ux;return e.state=d,d.strm=e,d.status=42,d.wrap=c,d.gzhead=null,d.w_bits=r,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=n+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+3-1)/3),d.window=new Uint8Array(2*d.w_size),d.head=new Uint16Array(d.hash_size),d.prev=new Uint16Array(d.w_size),d.lit_bufsize=1<<n+6,d.pending_buf_size=4*d.lit_bufsize,d.pending_buf=new Uint8Array(d.pending_buf_size),d.sym_buf=d.lit_bufsize,d.sym_end=(d.lit_bufsize-1)*3,d.level=i,d.strategy=o,d.method=s,(h=(e=>{if(uE(e))return ua(e,d6);e.total_in=e.total_out=0,e.data_type=ur;let i=e.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=2===i.wrap?57:i.wrap?42:113,e.adler=+(2!==i.wrap),i.last_flush=-2,dY(i),d5})(a=e))===d5&&((l=a.state).window_size=2*l.w_size,uh(l.head),l.max_lazy_match=uC[l.level].max_lazy,l.good_match=uC[l.level].good_length,l.nice_match=uC[l.level].nice_length,l.max_chain_length=uC[l.level].max_chain,l.strstart=0,l.block_start=0,l.lookahead=0,l.insert=0,l.match_length=l.prev_length=2,l.match_available=0,l.ins_h=0),h})(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(n!==u$)throw Error(dK[n]);if(r.header&&(i=this.strm,s=r.header,uE(i)||2!==i.state.wrap||(i.state.gzhead=s)),r.dictionary){let e;if(e="string"==typeof r.dictionary?uI(r.dictionary):"[object ArrayBuffer]"===uP.call(r.dictionary)?new Uint8Array(r.dictionary):r.dictionary,(n=((e,i)=>{let s=i.length;if(uE(e))return d6;let r=e.state,n=r.wrap;if(2===n||1===n&&42!==r.status||r.lookahead)return d6;if(1===n&&(e.adler=d$(e.adler,i,s,0)),r.wrap=0,s>=r.w_size){0===n&&(uh(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(i.subarray(s-r.w_size,s),0),i=e,s=r.w_size}let o=e.avail_in,a=e.next_in,l=e.input;for(e.avail_in=s,e.next_in=0,e.input=i,uv(r);r.lookahead>=3;){let e=r.strstart,i=r.lookahead-2;do r.ins_h=ud(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++;while(--i)r.strstart=e,r.lookahead=2,uv(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=a,e.input=l,e.avail_in=o,r.wrap=n,d5})(this.strm,e))!==u$)throw Error(dK[n]);this._dict_set=!0}}function uX(e,i){let s=new uY(i);if(s.push(e,!0),s.err)throw s.msg||dK[s.err];return s.result}uY.prototype.push=function(e,i){let s,r,n=this.strm,o=this.options.chunkSize;if(this.ended)return!1;for(r=i===~~i?i:!0===i?uU:uF,"string"==typeof e?n.input=uI(e):"[object ArrayBuffer]"===uP.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){if(0===n.avail_out&&(n.output=new Uint8Array(o),n.next_out=0,n.avail_out=o),(r===uW||r===uz)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if((s=uk(n,r))===uV)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=uA(this.strm),this.onEnd(s),this.ended=!0,s===u$;if(0===n.avail_out){this.onData(n.output);continue}if(r>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(0===n.avail_in)break}return!0},uY.prototype.onData=function(e){this.chunks.push(e)},uY.prototype.onEnd=function(e){e===u$&&(this.result=uT(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var uZ=function(e,i){let s,r,n,o,a,l,h,c,d,u,_,f,g,p,m,v,b,S,w,y,C,x,E,k,A=e.state;s=e.next_in,E=e.input,r=s+(e.avail_in-5),n=e.next_out,k=e.output,o=n-(i-e.avail_out),a=n+(e.avail_out-257),l=A.dmax,h=A.wsize,c=A.whave,d=A.wnext,u=A.window,_=A.hold,f=A.bits,g=A.lencode,p=A.distcode,m=(1<<A.lenbits)-1,v=(1<<A.distbits)-1;e:do for(f<15&&(_+=E[s++]<<f,f+=8,_+=E[s++]<<f,f+=8),b=g[_&m];;){if(_>>>=S=b>>>24,f-=S,0==(S=b>>>16&255))k[n++]=65535&b;else if(16&S)for(w=65535&b,(S&=15)&&(f<S&&(_+=E[s++]<<f,f+=8),w+=_&(1<<S)-1,_>>>=S,f-=S),f<15&&(_+=E[s++]<<f,f+=8,_+=E[s++]<<f,f+=8),b=p[_&v];;){if(_>>>=S=b>>>24,f-=S,16&(S=b>>>16&255)){if(y=65535&b,f<(S&=15)&&(_+=E[s++]<<f,(f+=8)<S&&(_+=E[s++]<<f,f+=8)),(y+=_&(1<<S)-1)>l){e.msg="invalid distance too far back",A.mode=16209;break e}if(_>>>=S,f-=S,y>(S=n-o)){if((S=y-S)>c&&A.sane){e.msg="invalid distance too far back",A.mode=16209;break e}if(C=0,x=u,0===d){if(C+=h-S,S<w){w-=S;do k[n++]=u[C++];while(--S)C=n-y,x=k}}else if(d<S){if(C+=h+d-S,(S-=d)<w){w-=S;do k[n++]=u[C++];while(--S)if(C=0,d<w){w-=S=d;do k[n++]=u[C++];while(--S)C=n-y,x=k}}}else if(C+=d-S,S<w){w-=S;do k[n++]=u[C++];while(--S)C=n-y,x=k}for(;w>2;)k[n++]=x[C++],k[n++]=x[C++],k[n++]=x[C++],w-=3;w&&(k[n++]=x[C++],w>1&&(k[n++]=x[C++]))}else{C=n-y;do k[n++]=k[C++],k[n++]=k[C++],k[n++]=k[C++],w-=3;while(w>2)w&&(k[n++]=k[C++],w>1&&(k[n++]=k[C++]))}}else if((64&S)==0){b=p[(65535&b)+(_&(1<<S)-1)];continue}else{e.msg="invalid distance code",A.mode=16209;break e}break}else if((64&S)==0){b=g[(65535&b)+(_&(1<<S)-1)];continue}else if(32&S){A.mode=16191;break e}else{e.msg="invalid literal/length code",A.mode=16209;break e}break}while(s<r&&n<a)s-=w=f>>3,f-=w<<3,_&=(1<<f)-1,e.next_in=s,e.next_out=n,e.avail_in=s<r?5+(r-s):5-(s-r),e.avail_out=n<a?257+(a-n):257-(n-a),A.hold=_,A.bits=f};let uj=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),uq=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),uQ=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),uJ=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var u0=(e,i,s,r,n,o,a,l)=>{let h,c,d,u,_,f,g,p,m,v=l.bits,b=0,S=0,w=0,y=0,C=0,x=0,E=0,k=0,A=0,R=0,L=null,T=new Uint16Array(16),B=new Uint16Array(16),M=null;for(b=0;b<=15;b++)T[b]=0;for(S=0;S<r;S++)T[i[s+S]]++;for(y=15,C=v;y>=1&&0===T[y];y--);if(C>y&&(C=y),0===y)return n[o++]=0x1400000,n[o++]=0x1400000,l.bits=1,0;for(w=1;w<y&&0===T[w];w++);for(C<w&&(C=w),k=1,b=1;b<=15;b++)if(k<<=1,(k-=T[b])<0)return -1;if(k>0&&(0===e||1!==y))return -1;for(b=1,B[1]=0;b<15;b++)B[b+1]=B[b]+T[b];for(S=0;S<r;S++)0!==i[s+S]&&(a[B[i[s+S]]++]=S);if(0===e?(L=M=a,f=20):1===e?(L=uj,M=uq,f=257):(L=uQ,M=uJ,f=0),R=0,S=0,b=w,_=o,x=C,E=0,d=-1,u=(A=1<<C)-1,1===e&&A>852||2===e&&A>592)return 1;for(;;){g=b-E,a[S]+1<f?(p=0,m=a[S]):a[S]>=f?(p=M[a[S]-f],m=L[a[S]-f]):(p=96,m=0),h=1<<b-E,w=c=1<<x;do n[_+(R>>E)+(c-=h)]=g<<24|p<<16|m;while(0!==c)for(h=1<<b-1;R&h;)h>>=1;if(0!==h?(R&=h-1,R+=h):R=0,S++,0==--T[b]){if(b===y)break;b=i[s+a[S]]}if(b>C&&(R&u)!==d){for(0===E&&(E=C),_+=w,k=1<<(x=b-E);x+E<y&&!((k-=T[x+E])<=0);)x++,k<<=1;if(A+=1<<x,1===e&&A>852||2===e&&A>592)return 1;n[d=R&u]=C<<24|x<<16|_-o}}return 0!==R&&(n[_+R]=b-E<<24|4194304),l.bits=C,0};let{Z_FINISH:u1,Z_BLOCK:u2,Z_TREES:u5,Z_OK:u3,Z_STREAM_END:u6,Z_NEED_DICT:u4,Z_STREAM_ERROR:u9,Z_DATA_ERROR:u8,Z_MEM_ERROR:u7,Z_BUF_ERROR:_e,Z_DEFLATED:_t}=dG,_i=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function _s(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let _r=e=>{if(!e)return 1;let i=e.state;return+(!i||i.strm!==e||i.mode<16180||i.mode>16211)},_n=e=>{if(_r(e))return u9;let i=e.state;return i.wsize=0,i.whave=0,i.wnext=0,(e=>{if(_r(e))return u9;let i=e.state;return e.total_in=e.total_out=i.total=0,e.msg="",i.wrap&&(e.adler=1&i.wrap),i.mode=16180,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(852),i.distcode=i.distdyn=new Int32Array(592),i.sane=1,i.back=-1,u3})(e)},_o=!0,_a=e=>{if(_o){a=new Int32Array(512),l=new Int32Array(32);let i=0;for(;i<144;)e.lens[i++]=8;for(;i<256;)e.lens[i++]=9;for(;i<280;)e.lens[i++]=7;for(;i<288;)e.lens[i++]=8;for(u0(1,e.lens,0,288,a,0,e.work,{bits:9}),i=0;i<32;)e.lens[i++]=5;u0(2,e.lens,0,32,l,0,e.work,{bits:5}),_o=!1}e.lencode=a,e.lenbits=9,e.distcode=l,e.distbits=5},_l=(e,i,s,r)=>{let n,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(i.subarray(s-o.wsize,s),0),o.wnext=0,o.whave=o.wsize):((n=o.wsize-o.wnext)>r&&(n=r),o.window.set(i.subarray(s-r,s-r+n),o.wnext),(r-=n)?(o.window.set(i.subarray(s-r,s),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0};var _h=(e,i)=>{let s,r,n,o,a,l,h,c,d,u,_,f,g,p,m,v,b,S,w,y,C,x,E,k,A=0,R=new Uint8Array(4),L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(_r(e)||!e.output||!e.input&&0!==e.avail_in)return u9;16191===(s=e.state).mode&&(s.mode=16192),a=e.next_out,n=e.output,h=e.avail_out,o=e.next_in,r=e.input,l=e.avail_in,c=s.hold,d=s.bits,u=l,_=h,x=u3;t:for(;;)switch(s.mode){case 16180:if(0===s.wrap){s.mode=16192;break}for(;d<16;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}if(2&s.wrap&&35615===c){0===s.wbits&&(s.wbits=15),s.check=0,R[0]=255&c,R[1]=c>>>8&255,s.check=dH(s.check,R,2,0),c=0,d=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",s.mode=16209;break}if((15&c)!==_t){e.msg="unknown compression method",s.mode=16209;break}if(c>>>=4,d-=4,C=(15&c)+8,0===s.wbits&&(s.wbits=C),C>15||C>s.wbits){e.msg="invalid window size",s.mode=16209;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&c?16189:16191,c=0,d=0;break;case 16181:for(;d<16;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}if(s.flags=c,(255&s.flags)!==_t){e.msg="unknown compression method",s.mode=16209;break}if(57344&s.flags){e.msg="unknown header flags set",s.mode=16209;break}s.head&&(s.head.text=c>>8&1),512&s.flags&&4&s.wrap&&(R[0]=255&c,R[1]=c>>>8&255,s.check=dH(s.check,R,2,0)),c=0,d=0,s.mode=16182;case 16182:for(;d<32;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}s.head&&(s.head.time=c),512&s.flags&&4&s.wrap&&(R[0]=255&c,R[1]=c>>>8&255,R[2]=c>>>16&255,R[3]=c>>>24&255,s.check=dH(s.check,R,4,0)),c=0,d=0,s.mode=16183;case 16183:for(;d<16;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}s.head&&(s.head.xflags=255&c,s.head.os=c>>8),512&s.flags&&4&s.wrap&&(R[0]=255&c,R[1]=c>>>8&255,s.check=dH(s.check,R,2,0)),c=0,d=0,s.mode=16184;case 16184:if(1024&s.flags){for(;d<16;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}s.length=c,s.head&&(s.head.extra_len=c),512&s.flags&&4&s.wrap&&(R[0]=255&c,R[1]=c>>>8&255,s.check=dH(s.check,R,2,0)),c=0,d=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&s.flags&&((f=s.length)>l&&(f=l),f&&(s.head&&(C=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(r.subarray(o,o+f),C)),512&s.flags&&4&s.wrap&&(s.check=dH(s.check,r,f,o)),l-=f,o+=f,s.length-=f),s.length))break t;s.length=0,s.mode=16186;case 16186:if(2048&s.flags){if(0===l)break t;f=0;do C=r[o+f++],s.head&&C&&s.length<65536&&(s.head.name+=String.fromCharCode(C));while(C&&f<l)if(512&s.flags&&4&s.wrap&&(s.check=dH(s.check,r,f,o)),l-=f,o+=f,C)break t}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&s.flags){if(0===l)break t;f=0;do C=r[o+f++],s.head&&C&&s.length<65536&&(s.head.comment+=String.fromCharCode(C));while(C&&f<l)if(512&s.flags&&4&s.wrap&&(s.check=dH(s.check,r,f,o)),l-=f,o+=f,C)break t}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&s.flags){for(;d<16;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}if(4&s.wrap&&c!==(65535&s.check)){e.msg="header crc mismatch",s.mode=16209;break}c=0,d=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=16191;break;case 16189:for(;d<32;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}e.adler=s.check=_i(c),c=0,d=0,s.mode=16190;case 16190:if(0===s.havedict)return e.next_out=a,e.avail_out=h,e.next_in=o,e.avail_in=l,s.hold=c,s.bits=d,u4;e.adler=s.check=1,s.mode=16191;case 16191:if(i===u2||i===u5)break t;case 16192:if(s.last){c>>>=7&d,d-=7&d,s.mode=16206;break}for(;d<3;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}switch(s.last=1&c,d-=1,3&(c>>>=1)){case 0:s.mode=16193;break;case 1:if(_a(s),s.mode=16199,i===u5){c>>>=2,d-=2;break t}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=16209}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",s.mode=16209;break}if(s.length=65535&c,c=0,d=0,s.mode=16194,i===u5)break t;case 16194:s.mode=16195;case 16195:if(f=s.length){if(f>l&&(f=l),f>h&&(f=h),0===f)break t;n.set(r.subarray(o,o+f),a),l-=f,o+=f,h-=f,a+=f,s.length-=f;break}s.mode=16191;break;case 16196:for(;d<14;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}if(s.nlen=(31&c)+257,d-=5,s.ndist=(31&(c>>>=5))+1,d-=5,s.ncode=(15&(c>>>=5))+4,c>>>=4,d-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=16209;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;d<3;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}s.lens[L[s.have++]]=7&c,c>>>=3,d-=3}for(;s.have<19;)s.lens[L[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,E={bits:s.lenbits},x=u0(0,s.lens,0,19,s.lencode,0,s.work,E),s.lenbits=E.bits,x){e.msg="invalid code lengths set",s.mode=16209;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;m=(A=s.lencode[c&(1<<s.lenbits)-1])>>>24,v=A>>>16&255,b=65535&A,!(m<=d);){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}if(b<16)c>>>=m,d-=m,s.lens[s.have++]=b;else{if(16===b){for(k=m+2;d<k;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}if(c>>>=m,d-=m,0===s.have){e.msg="invalid bit length repeat",s.mode=16209;break}C=s.lens[s.have-1],f=3+(3&c),c>>>=2,d-=2}else if(17===b){for(k=m+3;d<k;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}c>>>=m,d-=m,C=0,f=3+(7&c),c>>>=3,d-=3}else{for(k=m+7;d<k;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}c>>>=m,d-=m,C=0,f=11+(127&c),c>>>=7,d-=7}if(s.have+f>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=16209;break}for(;f--;)s.lens[s.have++]=C}}if(16209===s.mode)break;if(0===s.lens[256]){e.msg="invalid code -- missing end-of-block",s.mode=16209;break}if(s.lenbits=9,E={bits:s.lenbits},x=u0(1,s.lens,0,s.nlen,s.lencode,0,s.work,E),s.lenbits=E.bits,x){e.msg="invalid literal/lengths set",s.mode=16209;break}if(s.distbits=6,s.distcode=s.distdyn,E={bits:s.distbits},x=u0(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,E),s.distbits=E.bits,x){e.msg="invalid distances set",s.mode=16209;break}if(s.mode=16199,i===u5)break t;case 16199:s.mode=16200;case 16200:if(l>=6&&h>=258){e.next_out=a,e.avail_out=h,e.next_in=o,e.avail_in=l,s.hold=c,s.bits=d,uZ(e,_),a=e.next_out,n=e.output,h=e.avail_out,o=e.next_in,r=e.input,l=e.avail_in,c=s.hold,d=s.bits,16191===s.mode&&(s.back=-1);break}for(s.back=0;m=(A=s.lencode[c&(1<<s.lenbits)-1])>>>24,v=A>>>16&255,b=65535&A,!(m<=d);){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}if(v&&(240&v)==0){for(S=m,w=v,y=b;m=(A=s.lencode[y+((c&(1<<S+w)-1)>>S)])>>>24,v=A>>>16&255,b=65535&A,!(S+m<=d);){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}c>>>=S,d-=S,s.back+=S}if(c>>>=m,d-=m,s.back+=m,s.length=b,0===v){s.mode=16205;break}if(32&v){s.back=-1,s.mode=16191;break}if(64&v){e.msg="invalid literal/length code",s.mode=16209;break}s.extra=15&v,s.mode=16201;case 16201:if(s.extra){for(k=s.extra;d<k;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}s.length+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;m=(A=s.distcode[c&(1<<s.distbits)-1])>>>24,v=A>>>16&255,b=65535&A,!(m<=d);){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}if((240&v)==0){for(S=m,w=v,y=b;m=(A=s.distcode[y+((c&(1<<S+w)-1)>>S)])>>>24,v=A>>>16&255,b=65535&A,!(S+m<=d);){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}c>>>=S,d-=S,s.back+=S}if(c>>>=m,d-=m,s.back+=m,64&v){e.msg="invalid distance code",s.mode=16209;break}s.offset=b,s.extra=15&v,s.mode=16203;case 16203:if(s.extra){for(k=s.extra;d<k;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}s.offset+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=16209;break}s.mode=16204;case 16204:if(0===h)break t;if(f=_-h,s.offset>f){if((f=s.offset-f)>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=16209;break}f>s.wnext?(f-=s.wnext,g=s.wsize-f):g=s.wnext-f,f>s.length&&(f=s.length),p=s.window}else p=n,g=a-s.offset,f=s.length;f>h&&(f=h),h-=f,s.length-=f;do n[a++]=p[g++];while(--f)0===s.length&&(s.mode=16200);break;case 16205:if(0===h)break t;n[a++]=s.length,h--,s.mode=16200;break;case 16206:if(s.wrap){for(;d<32;){if(0===l)break t;l--,c|=r[o++]<<d,d+=8}if(_-=h,e.total_out+=_,s.total+=_,4&s.wrap&&_&&(e.adler=s.check=s.flags?dH(s.check,n,_,a-_):d$(s.check,n,_,a-_)),_=h,4&s.wrap&&(s.flags?c:_i(c))!==s.check){e.msg="incorrect data check",s.mode=16209;break}c=0,d=0}s.mode=16207;case 16207:if(s.wrap&&s.flags){for(;d<32;){if(0===l)break t;l--,c+=r[o++]<<d,d+=8}if(4&s.wrap&&c!==(0|s.total)){e.msg="incorrect length check",s.mode=16209;break}c=0,d=0}s.mode=16208;case 16208:x=u6;break t;case 16209:x=u8;break t;case 16210:return u7;default:return u9}return e.next_out=a,e.avail_out=h,e.next_in=o,e.avail_in=l,s.hold=c,s.bits=d,(s.wsize||_!==e.avail_out&&s.mode<16209&&(s.mode<16206||i!==u1))&&_l(e,e.output,e.next_out,_-e.avail_out),u-=e.avail_in,_-=e.avail_out,e.total_in+=u,e.total_out+=_,s.total+=_,4&s.wrap&&_&&(e.adler=s.check=s.flags?dH(s.check,n,_,e.next_out-_):d$(s.check,n,_,e.next_out-_)),e.data_type=s.bits+64*!!s.last+128*(16191===s.mode)+256*(16199===s.mode||16194===s.mode),(0===u&&0===_||i===u1)&&x===u3&&(x=_e),x},_c=e=>{if(_r(e))return u9;let i=e.state;return i.window&&(i.window=null),e.state=null,u3},_d=(e,i)=>{let s,r=i.length;return _r(e)||0!==(s=e.state).wrap&&16190!==s.mode?u9:16190===s.mode&&d$(1,i,r,0)!==s.check?u8:_l(e,i,r,r)?(s.mode=16210,u7):(s.havedict=1,u3)},_u=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let __=Object.prototype.toString,{Z_NO_FLUSH:_f,Z_FINISH:_g,Z_OK:_p,Z_STREAM_END:_m,Z_NEED_DICT:_v,Z_STREAM_ERROR:_b,Z_DATA_ERROR:_S,Z_MEM_ERROR:_w}=dG;function _y(e){this.options=uL({chunkSize:65536,windowBits:15,to:""},e||{});let i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,0===i.windowBits&&(i.windowBits=-15)),i.windowBits>=0&&i.windowBits<16&&!(e&&e.windowBits)&&(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&(15&i.windowBits)==0&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new uO,this.strm.avail_out=0;let s=((e,i)=>{if(!e)return u9;let s=new _s;e.state=s,s.strm=e,s.window=null,s.mode=16180;let r=((e,i)=>{let s;if(_r(e))return u9;let r=e.state;return(i<0?(s=0,i=-i):(s=(i>>4)+5,i<48&&(i&=15)),i&&(i<8||i>15))?u9:(null!==r.window&&r.wbits!==i&&(r.window=null),r.wrap=s,r.wbits=i,_n(e))})(e,i);return r!==u3&&(e.state=null),r})(this.strm,i.windowBits);if(s!==_p||(this.header=new _u,((e,i)=>{if(_r(e))return;let s=e.state;return(2&s.wrap)==0||(s.head=i,i.done=!1)})(this.strm,this.header),i.dictionary&&("string"==typeof i.dictionary?i.dictionary=uI(i.dictionary):"[object ArrayBuffer]"===__.call(i.dictionary)&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw)&&(s=_d(this.strm,i.dictionary))!==_p))throw Error(dK[s])}function _C(e,i){let s=new _y(i);if(s.push(e),s.err)throw s.msg||dK[s.err];return s.result}_y.prototype.push=function(e,i){let s,r,n,o=this.strm,a=this.options.chunkSize,l=this.options.dictionary;if(this.ended)return!1;for(r=i===~~i?i:!0===i?_g:_f,"[object ArrayBuffer]"===__.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;;){for(0===o.avail_out&&(o.output=new Uint8Array(a),o.next_out=0,o.avail_out=a),(s=_h(o,r))===_v&&l&&((s=_d(o,l))===_p?s=_h(o,r):s===_S&&(s=_v));o.avail_in>0&&s===_m&&o.state.wrap>0&&0!==e[o.next_in];)_n(o),s=_h(o,r);switch(s){case _b:case _S:case _v:case _w:return this.onEnd(s),this.ended=!0,!1}if(n=o.avail_out,o.next_out&&(0===o.avail_out||s===_m))if("string"===this.options.to){let e=uN(o.output,o.next_out),i=o.next_out-e,s=uD(o.output,e);o.next_out=i,o.avail_out=a-i,i&&o.output.set(o.output.subarray(e,e+i),0),this.onData(s)}else this.onData(o.output.length===o.next_out?o.output:o.output.subarray(0,o.next_out));if(s!==_p||0!==n){if(s===_m)return s=_c(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===o.avail_in)break}}return!0},_y.prototype.onData=function(e){this.chunks.push(e)},_y.prototype.onEnd=function(e){e===_p&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=uT(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};let{Deflate:_x,deflate:_E,deflateRaw:_k,gzip:_A}={Deflate:uY,deflate:uX,deflateRaw:function(e,i){return(i=i||{}).raw=!0,uX(e,i)},gzip:function(e,i){return(i=i||{}).gzip=!0,uX(e,i)},constants:dG},{Inflate:_R,inflate:_L,inflateRaw:_T,ungzip:_B}={Inflate:_y,inflate:_C,inflateRaw:function(e,i){return(i=i||{}).raw=!0,_C(e,i)},ungzip:_C,constants:dG};function _M(e){let i=cD(new co,cI,cv(di,e)).finish();if(i.length>1024){let e=_E(i);if(e.length<i.length){let i=new Uint8Array(e.length+1);return i[0]=1,i.set(e,1),i.buffer}}let s=new Uint8Array(i.length+1);return s[0]=0,s.set(i,1),s.buffer}function _I(e){return h6(di,{message:{case:"input",value:h6(ds,{data:new TextEncoder().encode(e)})}})}function _D(e,i){return h6(di,{message:{case:"resize",value:h6(dr,{cols:e,rows:i})}})}function _N(){return h6(di,{message:{case:"refresh",value:h6(da,{})}})}function _O(e,i,s,r,n=!1,o=!1,a=!1){return h6(di,{message:{case:"mouse",value:h6(dl,{col:e,row:i,button:s,eventType:r,shift:n,ctrl:o,alt:a})}})}function _P(e){return h6(di,{message:{case:"focus",value:h6(dh,{focused:e})}})}function _F(e){let i=e=>e.toString(16).padStart(2,"0");return`#${i(e.r)}${i(e.g)}${i(e.b)}`}let _W=null,_z=null,_U=()=>{let e=window.innerWidth,i=window.innerHeight,s=Math.min(e,i);return s<500?i<e?i<400?4:5:4:s<768?6:e<1024?10:14},_$=new TextDecoder;function _V({wsUrl:e,fontSize:i,onStatusChange:s,onThemeChange:r,onRefit:n,onFocus:o,onRetryingChange:a,onConnectControl:l,onSendInput:h,onHyperlinkAdded:c,onUserVarChanged:d,onSelectionChanged:u}){let _=(0,ew.useRef)(null),f=(0,ew.useRef)(null),g=(0,ew.useRef)(null),p=(0,ew.useRef)(null),m=(0,ew.useRef)(null),[v,b]=(0,ew.useState)("disconnected"),S=(0,ew.useRef)([]),w=(0,ew.useRef)(null),y=(0,ew.useRef)([]),C=(0,ew.useRef)(!0),x=(0,ew.useRef)(null),E=(0,ew.useRef)(500),k=(0,ew.useRef)(!1),A=(0,ew.useRef)(!1),R=(0,ew.useRef)(null),L=(0,ew.useRef)(0),T=(0,ew.useRef)(!1),B=(0,ew.useRef)(!1),M=(0,ew.useRef)(!1),I=(0,ew.useRef)(new Map),D=(0,ew.useRef)(new Map),N=(0,ew.useRef)(e),O=(0,ew.useRef)(i),P=e=>{b(e),s?.(e)},F=(0,ew.useCallback)(()=>{S.current.length>0&&g.current&&(g.current.write(S.current.join("")),S.current=[]),w.current=null},[]),W=(0,ew.useCallback)(e=>{let i=e;for(;y.current.length>0&&i.length>0;){let e=y.current[0];if(i.startsWith(e))i=i.slice(e.length),y.current.shift();else{y.current=[];break}}i.length>0&&(S.current.push(i),w.current||(w.current=requestAnimationFrame(F)))},[F]),z=(0,ew.useCallback)(()=>{x.current&&(clearTimeout(x.current),x.current=null),k.current=!1,A.current=!0,E.current=500,a?.(!1)},[a]),U=(0,ew.useCallback)(()=>{if(A.current)return;k.current=!0,a?.(!0);let e=E.current;console.log(`Scheduling reconnect in ${e}ms`),x.current=setTimeout(()=>{A.current||(E.current=Math.min(2*E.current,5e3),H())},e)},[a]),$=(0,ew.useCallback)(()=>{R.current&&(clearInterval(R.current),R.current=null)},[]),V=(0,ew.useCallback)(()=>{$(),L.current=Date.now(),R.current=setInterval(()=>{let e=p.current;if(!e||e.readyState!==WebSocket.OPEN)return void $();let i=Date.now()-L.current;if(i>35e3){console.warn(`Connection stale: no pong in ${i}ms, closing`),$(),e.close();return}try{e.send(_M(h6(di,{message:{case:"ping",value:h6(dn,{})}}))),console.log("Heartbeat ping sent")}catch(i){console.error("Failed to send heartbeat ping:",i),$(),e.close()}},25e3)},[$]);(0,ew.useEffect)(()=>{let e,s,r;if(!_.current||g.current)return;if(_W&&_z)console.log("Restoring preserved terminal (StrictMode remount)"),e=_W,s=_z,_W=null,_z=null;else{let r=window.innerWidth<640||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),n=i??_U();console.log(`Terminal init: width=${window.innerWidth}, mobile=${r}, fontSize=${n}`),e=new nQ({cursorBlink:!r,fontSize:n,fontFamily:"'Symbols Nerd Font', 'JetBrains Mono', 'Fira Code', 'ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'monospace'",rescaleOverlappingGlyphs:!0,scrollback:r?500:1e3,scrollOnUserInput:!0,theme:{background:"#0a0a0a",foreground:"#e0e0e0",cursor:"#60a5fa",cursorAccent:"#0a0a0a",selectionBackground:"#3a3a3a",black:"#1a1a1a",red:"#f87171",green:"#4ade80",yellow:"#fbbf24",blue:"#60a5fa",magenta:"#c084fc",cyan:"#22d3ee",white:"#e0e0e0",brightBlack:"#888888",brightRed:"#fca5a5",brightGreen:"#86efac",brightYellow:"#fde047",brightBlue:"#93c5fd",brightMagenta:"#d8b4fe",brightCyan:"#67e8f9",brightWhite:"#f5f5f5"},allowProposedApi:!0}),s=new nJ;let o=new l2((e,i)=>{window.open(i,"_blank","noopener,noreferrer")}),a=new hI;e.loadAddon(s),e.loadAddon(o),e.loadAddon(a),e.unicode.activeVersion="11",document.fonts?document.fonts.ready.then(()=>{if(_.current){e.open(_.current);try{let i=new lY;e.loadAddon(i),console.log("WebGL renderer enabled")}catch(e){console.warn("WebGL renderer failed, using default DOM renderer:",e)}e.parser.registerCsiHandler({final:"c"},()=>!0),e.parser.registerCsiHandler({prefix:">",final:"c"},()=>!0),e.parser.registerCsiHandler({prefix:"=",final:"c"},()=>!0),e.parser.registerCsiHandler({final:"n"},()=>!0),e.parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},()=>!0),console.log("Suppressed xterm.js DA/DSR responses (handled by backend terminal)"),s.fit()}}):(e.open(_.current),e.parser.registerCsiHandler({final:"c"},()=>!0),e.parser.registerCsiHandler({prefix:">",final:"c"},()=>!0),e.parser.registerCsiHandler({prefix:"=",final:"c"},()=>!0),e.parser.registerCsiHandler({final:"n"},()=>!0),e.parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},()=>!0),s.fit())}m.current=s,g.current=e,n&&n(()=>{setTimeout(()=>{let i=O.current??_U();console.log(`Refit: current fontSize=${e.options.fontSize}, new=${i}`),console.log(`Refit: before fit - cols=${e.cols}, rows=${e.rows}`),e.options.fontSize!==i&&(e.options.fontSize=i);let r=_.current;r&&console.log(`Refit: container size - ${r.clientWidth}x${r.clientHeight}`),s.fit();let n=e.cols,o=e.rows;console.log(`Refit: after fit - cols=${n}, rows=${o}`),e.resize(n,o),e.refresh(0,o-1),console.log(`Refit: after explicit resize - cols=${e.cols}, rows=${e.rows}`),p.current?.readyState===WebSocket.OPEN&&(console.log(`Refit: sending resize ${n}x${o}`),p.current.send(_M(_D(n,o))))},50)}),o&&o(()=>{e.focus()}),h&&h(e=>{p.current?.readyState===WebSocket.OPEN&&p.current.send(_M(_I(e)))});let a=()=>{clearTimeout(r),r=setTimeout(()=>{if(void 0===O.current){let i=_U();e.options.fontSize!==i&&(e.options.fontSize=i)}s.fit()},100)};window.addEventListener("resize",a);let l=()=>{setTimeout(()=>{if(void 0===O.current){let i=_U();e.options.fontSize=i}s.fit()},200)};window.addEventListener("orientationchange",l);let c=e.onData(i=>{if(C.current&&1===i.length){let s=i.charCodeAt(0);s>=32&&s<=126&&(e.write(i),y.current.push(i))}p.current?.readyState===WebSocket.OPEN&&p.current.send(_M(_I(i)))}),d=e.onResize(({cols:e,rows:i})=>{p.current?.readyState===WebSocket.OPEN&&(console.log(`Client resized to: ${e}x${i}`),p.current.send(_M(_D(e,i))))}),u=_.current,f=i=>{let s=e.element?.querySelector(".xterm-screen");if(!s)return null;let r=s.getBoundingClientRect(),n=r.width/e.cols,o=r.height/e.rows,a=Math.floor((i.clientX-r.left)/n),l=Math.floor((i.clientY-r.top)/o);return a<0||a>=e.cols||l<0||l>=e.rows?null:{col:a,row:l}},v=e=>{if(!T.current||p.current?.readyState!==WebSocket.OPEN)return;let i=f(e);i&&p.current.send(_M(_O(i.col,i.row,e.button,"press",e.shiftKey,e.ctrlKey,e.altKey)))},b=e=>{if(!T.current||p.current?.readyState!==WebSocket.OPEN)return;let i=f(e);i&&p.current.send(_M(_O(i.col,i.row,3,"release",e.shiftKey,e.ctrlKey,e.altKey)))},x=e=>{if(!T.current||p.current?.readyState!==WebSocket.OPEN)return;let i=f(e);i&&p.current.send(_M(_O(i.col,i.row,0,"move",e.shiftKey,e.ctrlKey,e.altKey)))},E=e=>{if(!T.current||p.current?.readyState!==WebSocket.OPEN)return;let i=f(e);if(!i)return;let s=e.deltaY<0?4:5;p.current.send(_M(_O(i.col,i.row,s,"scroll",e.shiftKey,e.ctrlKey,e.altKey)))};u?.addEventListener("mousedown",v),u?.addEventListener("mouseup",b),u?.addEventListener("mousemove",x),u?.addEventListener("wheel",E);let k=()=>{B.current&&p.current?.readyState===WebSocket.OPEN&&p.current.send(_M(_P(!0)))},A=()=>{B.current&&p.current?.readyState===WebSocket.OPEN&&p.current.send(_M(_P(!1)))};window.addEventListener("focus",k),window.addEventListener("blur",A);let R=e=>{if(M.current&&p.current?.readyState===WebSocket.OPEN){let i=e.clipboardData?.getData("text");i&&(e.preventDefault(),p.current.send(_M(h6(di,{message:{case:"paste",value:h6(dc,{content:i})}}))))}};return u?.addEventListener("paste",R),()=>{clearTimeout(r),window.removeEventListener("resize",a),window.removeEventListener("orientationchange",l),window.removeEventListener("focus",k),window.removeEventListener("blur",A),u?.removeEventListener("paste",R),u?.removeEventListener("mousedown",v),u?.removeEventListener("mouseup",b),u?.removeEventListener("mousemove",x),u?.removeEventListener("wheel",E),c.dispose(),d.dispose(),w.current&&(cancelAnimationFrame(w.current),w.current=null),S.current.length>0&&e&&(e.write(S.current.join("")),S.current=[]),_W=e,_z=s,setTimeout(()=>{_W===e&&(console.log("Real unmount - disposing terminal"),e.dispose(),p.current?.close(),_W=null,_z=null)},100),g.current=null,m.current=null}},[]);let H=(0,ew.useCallback)(()=>{let i;if(g.current){p.current?.readyState===WebSocket.OPEN&&(console.log("Closing existing connection before reconnecting"),p.current.close(),p.current=null),A.current=!1,P("connecting");try{i=new WebSocket(e)}catch(i){console.error("Invalid WebSocket URL:",i),P("error"),g.current&&g.current.write(`\r
\x1b[1;31mInvalid WebSocket URL: ${e}\x1b[0m\r
`);return}i.binaryType="arraybuffer",p.current=i,i.onopen=()=>{console.log("WebSocket connected"),P("connected"),E.current=500,k.current=!1,a?.(!1),V(),m.current&&m.current.fit()},i.onmessage=e=>{try{let s=function(e){let i,s=new Uint8Array(e);if(0===s.length)throw Error("Empty message");let r=s[0],n=s.slice(1);if(1&r){if(n.length>262144)throw Error(`Compressed payload too large: ${n.length} bytes (max 262144)`);if((i=_L(n)).length>2097152)throw Error(`Decompressed payload too large: ${i.length} bytes (max 2097152)`)}else{if(n.length>2097152)throw Error(`Payload too large: ${n.length} bytes (max 2097152)`);i=n}return cW(dt,i)}(e.data),n=g.current;if(!n)return;switch(s.message.case){case"output":{let e=s.message.value,i=_$.decode(e.data);W(i);break}case"connected":{let e=s.message.value,o=e.initialScreen?.length||0;if(console.log(`Session ID: ${e.sessionId}`),console.log(`Server initial size: ${e.cols}x${e.rows}, Client size: ${n.cols}x${n.rows}`),console.log(`Initial screen provided: ${!!e.initialScreen}, length: ${o}`),o>1048576&&console.error(`Initial screen too large (${o} bytes), skipping`),e.theme&&(e=>{let i,s,n;if(!g.current)return;console.log("Applying theme:",e.name);let o=(i={background:e.background?_F(e.background):"#000000",foreground:e.foreground?_F(e.foreground):"#ffffff"},s=["black","red","green","yellow","blue","magenta","cyan","white"],e.normal.forEach((e,r)=>{r<s.length&&(i[s[r]]=_F(e))}),n=["brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"],e.bright.forEach((e,s)=>{s<n.length&&(i[n[s]]=_F(e))}),i);g.current.options.theme=o;let a=o.background||"#000000";f.current&&(f.current.style.backgroundColor=a),r?.(a)})(e.theme),n.reset(),n.clear(),y.current=[],T.current=!1,B.current=!1,M.current=!1,I.current.clear(),D.current.clear(),i.readyState===WebSocket.OPEN){let e=n.cols,s=n.rows;console.log(`Sending resize after connect: ${e}x${s}`),i.send(_M(_D(e,s))),console.log("Requesting refresh after connect"),i.send(_M(_N()))}n.focus();break}case"resize":{let e=s.message.value;n.resize(e.cols,e.rows),console.log(`Terminal resized: ${e.cols}x${e.rows}`),i.readyState===WebSocket.OPEN&&(console.log("Requesting screen refresh after resize"),i.send(_M(_N())));break}case"refresh":{let e=s.message.value,i=e.screenContent?.length||0;if(console.log(`Refresh response received: ${e.cols}x${e.rows}`),console.log("=== CLIENT REFRESH DEBUG ==="),console.log(`Client terminal size: ${n.cols}x${n.rows}`),console.log(`Server snapshot size: ${e.cols}x${e.rows}`),console.log(`Snapshot length: ${i} bytes`),console.log("============================"),i>1048576){console.error(`Snapshot too large (${i} bytes), rejecting to prevent UI freeze`),n.write("\r\n\x1b[1;33mWarning: Screen snapshot too large, display may be incomplete\x1b[0m\r\n");break}if(n.reset(),n.clear(),e.screenContent&&i>0){let i=_$.decode(e.screenContent);n.write(i)}n.scrollToBottom(),n.focus();break}case"title":{let e=s.message.value;document.title=e.title+" - Terminal Streaming",console.log(`Title changed: ${e.title}`);break}case"bell":console.log("Bell received");break;case"error":{let e=s.message.value;console.error("Server error:",e.message),n.write(`\r
\x1b[1;31mError: ${e.message}\x1b[0m\r
`);break}case"shutdown":{let e=s.message.value,i=(e.reason||"").toLowerCase();console.log("Server shutdown:",e.reason),i.includes("shell exited")||i.includes("dead session")?(n.write(`\r
\x1b[1;31mSession ended: ${e.reason}\x1b[0m\r
`),A.current=!0):i.includes("idle timeout")?n.write(`\r
\x1b[1;33mSession timed out due to inactivity\x1b[0m\r
`):n.write(`\r
\x1b[1;33mServer: ${e.reason}\x1b[0m\r
`);break}case"modeChanged":{let e=s.message.value;console.log(`Mode changed: ${e.mode} = ${e.enabled}`),"mouse_tracking"===e.mode?T.current=e.enabled:"focus_tracking"===e.mode?B.current=e.enabled:"bracketed_paste"===e.mode&&(M.current=e.enabled);break}case"pong":L.current=Date.now(),console.log("Heartbeat pong received");break;case"hyperlinkAdded":{let e=s.message.value,i={url:e.url,col:e.col,id:e.id},r=I.current.get(e.row)||[];r.push(i),I.current.set(e.row,r),c?.(e.url,e.row,e.col,e.id);break}case"userVarChanged":{let e=s.message.value;""===e.value?D.current.delete(e.name):D.current.set(e.name,e.value),d?.(e.name,e.value,e.oldValue);break}case"selectionChanged":{let e=s.message.value;if(!n)break;if(e.cleared)n.clearSelection();else if(void 0!==e.startCol&&void 0!==e.startRow&&void 0!==e.endCol&&void 0!==e.endRow){if("line"===e.mode)n.selectLines(e.startRow,e.endRow);else{let i,s=n.cols;(i=e.startRow===e.endRow?e.endCol-e.startCol:s-e.startCol+(e.endRow-e.startRow-1)*s+e.endCol)>0&&n.select(e.startCol,e.startRow,i)}e.text&&navigator.clipboard.writeText(e.text).catch(()=>{})}u?.(e.text,e.cleared)}}}catch(e){console.error("Failed to decode message:",e)}},i.onerror=e=>{console.error("WebSocket error:",e),$(),P("error"),g.current&&g.current.write("\r\n\x1b[1;31mConnection error\x1b[0m\r\n")},i.onclose=()=>{console.log("WebSocket disconnected"),$(),P("disconnected"),p.current=null,g.current&&g.current.write("\r\n\x1b[1;33mDisconnected from server\x1b[0m\r\n"),A.current||U()}}},[e,a,U,W,V,$]),K=(0,ew.useCallback)(()=>{z(),$(),p.current&&(p.current.close(),p.current=null)},[z,$]);return(0,ew.useEffect)(()=>{l?.({connect:H,disconnect:K,cancelRetry:z})},[H,K,z,l]),(0,ew.useEffect)(()=>{if(N.current!==e){console.log(`WebSocket URL changed: ${N.current} -> ${e}`),N.current=e,K();let i=setTimeout(H,100);return()=>clearTimeout(i)}},[e,H,K]),(0,ew.useEffect)(()=>{O.current=i;let e=g.current,s=m.current;e&&s&&void 0!==i&&(console.log(`Font size changed to ${i}px`),e.options.fontSize=i,s.fit(),p.current?.readyState===WebSocket.OPEN&&p.current.send(_M(_D(e.cols,e.rows))))},[i]),(0,ew.useEffect)(()=>{let e=setTimeout(H,500);return()=>{clearTimeout(e),z(),$()}},[H,z,$]),(0,eS.jsx)("div",{ref:f,className:"terminal-shell",onClick:()=>{g.current&&g.current.focus()},children:(0,eS.jsx)("div",{ref:_,className:"flex-1 terminal-scrollbar"})})}e.s(["default",()=>_V],44642)},7074,e=>{e.n(e.i(44642))}]);
